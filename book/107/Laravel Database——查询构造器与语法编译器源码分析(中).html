
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>Laravel Database——查询构造器与语法编译器源码分析(中)-Laravel 源码详解</title>
<meta content='Laravel Database——查询构造器与语法编译器源码分析(中),Laravel 源码详解' name='keywords'>
<meta content='Laravel Database——查询构造器与语法编译器源码分析(中),Laravel 源码详解' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../static/components/css/base.css">
<link rel="stylesheet" href="../../static/components/css/reader.css">
<link rel="stylesheet" href="../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-left ">
<a href="../../book/107/Laravel%20Database——查询构造器与语法编译器源码分析%28上%29.html">
<i class="nav-icon-left uk-icon-small  uk-icon-caret-left"></i>
<span class="">Laravel Dat..</span>
</a>
</div>
<div class="uk-align-right ">
<a href="../../book/107/Laravel%20Database——查询构造器与语法编译器源码分析%28下%29.html">
<span class="">Laravel Dat..</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../book/107/index.html">Laravel 源码详解</a>
<a target="_blank" rel="nofollow" href="https://github.com/tzivanmoe/laravel-source-analysis" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<h2 id="join-语句">join 语句</h2>
<p><code>join</code> 语句对数据库进行连接操作，<code>join</code> 函数的连接条件可以非常简单：</p>
<pre><code class="language-php">DB::table('services')-&gt;select('*')-&gt;join('translations AS t', 't.item_id', '=', 'services.id');
</code></pre>
<p>也可以比较复杂：</p>
<pre><code class="language-php">DB::table('users')-&gt;select('*')-&gt;join('contacts', function ($j) {
        $j-&gt;on('users.id', '=', 'contacts.id')-&gt;orOn('users.name', '=', 'contacts.name');
    });
    //select * from "users" inner join "contacts" on "users"."id" = "contacts"."id" or "users"."name" = "contacts"."name"

    $builder = $this-&gt;getBuilder();
    DB::table('users')-&gt;select('*')-&gt;from('users')-&gt;joinWhere('contacts', 'col1', function ($j) {
        $j-&gt;select('users.col2')-&gt;from('users')-&gt;where('users.id', '=', 'foo')
    });
    //select * from "users" inner join "contacts" on "col1" = (select "users"."col2" from "users" where "users"."id" = foo)
</code></pre>
<p>还可以更加复杂：</p>
<pre><code class="language-php">DB::table('users')-&gt;select('*')-&gt;leftJoin('contacts', function ($j) {
        $j-&gt;on('users.id', '=', 'contacts.id')-&gt;where(function ($j) {
            $j-&gt;where('contacts.country', '=', 'US')-&gt;orWhere('contacts.is_partner', '=', 1);
        });
    });
    //select * from "users" left join "contacts" on "users"."id" = "contacts"."id" and ("contacts"."country" = 'US' or "contacts"."is_partner" = 1)

    DB::table('users')-&gt;select('*')-&gt;leftJoin('contacts', function ($j) {
        $j-&gt;on('users.id', '=', 'contacts.id')-&gt;where('contacts.is_active', '=', 1)-&gt;orOn(function ($j) {
            $j-&gt;orWhere(function ($j) {
                $j-&gt;where('contacts.country', '=', 'UK')-&gt;orOn('contacts.type', '=', 'users.type');
            })-&gt;where(function ($j) {
                $j-&gt;where('contacts.country', '=', 'US')-&gt;orWhereNull('contacts.is_partner');
            });
        });
    });
    //select * from "users" left join "contacts" on "users"."id" = "contacts"."id" and "contacts"."is_active" = 1 or (("contacts"."country" = 'UK' or "contacts"."type" = "users"."type") and ("contacts"."country" = 'US' or "contacts"."is_partner" is null))
</code></pre>
<p>其实 <code>join</code> 语句与 <code>where</code> 语句非常相似，将 <code>join</code> 语句的连接条件看作 <code>where</code> 的查询条件完全可以，接下来我们看看源码。</p>
<h3 id="join-语句-1">join 语句</h3>
<p>从上面的示例代码可以看出，<code>join</code> 函数的参数多变，第二个参数可以是列名，也有可能是闭包函数。当第二个参数是列名的时候，第三个参数可以是闭包，还可以是符号 <code>=</code>、<code>&gt;=</code>。</p>
<pre><code class="language-php">public function join($table, $first, $operator = null, $second = null, $type = 'inner', $where = false)
{
    $join = new JoinClause($this, $type, $table);

    if ($first instanceof Closure) {
        call_user_func($first, $join);

        $this-&gt;joins[] = $join;

        $this-&gt;addBinding($join-&gt;getBindings(), 'join');
    }

    else {
        $method = $where ? 'where' : 'on';

        $this-&gt;joins[] = $join-&gt;$method($first, $operator, $second);

        $this-&gt;addBinding($join-&gt;getBindings(), 'join');
    }

    return $this;
}

</code></pre>
<p>可以看到，程序首先新建了一个 <code>JoinClause</code> 类对象，这个类实际上继承 <code>queryBuilder</code>，也就是说 <code>queryBuilder</code> 上的很多方法它都可以直接用，例如 <code>where</code>、<code>whereNull</code>、<code>whereDate</code> 等等。</p>
<pre><code class="language-php">class JoinClause extends Builder
{
}
</code></pre>
<p>如果第二个参数是闭包函数的话，就会像查询组一样根据查询条件更新 <code>$join</code>。</p>
<p>如果第二个参数是列名，那么就会调用 <code>on</code> 方法或 <code>where</code> 方法。这两个方法的区别是，<code>on</code> 方法只支持 <code>whereColumn</code>方法和 <code>whereNested</code>，也就是说只能写出 <code>join on col1 = col2</code> 这样的语句，而 <code>where</code> 方法可以传递数组、子查询等等.</p>
<pre><code class="language-php">public function on($first, $operator = null, $second = null, $boolean = 'and')
{
    if ($first instanceof Closure) {
        return $this-&gt;whereNested($first, $boolean);
    }

    return $this-&gt;whereColumn($first, $operator, $second, $boolean);
}

public function orOn($first, $operator = null, $second = null)
{
    return $this-&gt;on($first, $operator, $second, 'or');
}

</code></pre>
<h3 id="grammercompilejoins">grammer——compileJoins</h3>
<p>接下来我们来看看如何编译 <code>join</code> 语句：</p>
<pre><code class="language-php">protected function compileJoins(Builder $query, $joins)
{
    return collect($joins)-&gt;map(function ($join) use ($query) {
        $table = $this-&gt;wrapTable($join-&gt;table);

        return trim("{$join-&gt;type} join {$table} {$this-&gt;compileWheres($join)}");
    })-&gt;implode(' ');
}

</code></pre>
<p>可以看到，<code>JoinClause</code> 在编译中是作为 <code>queryBuild</code> 对象来看待的。</p>
<h2 id="union-语句">union 语句</h2>
<p><code>union</code> 用于合并两个或多个 <code>SELECT</code> 语句的结果集。<code>Union</code> 因为要进行重复值扫描，所以效率低。如果合并没有刻意要删除重复行，那么就使用 <code>Union All</code>。</p>
<p>我们在 <code>laravel</code> 中可以这样使用：</p>
<pre><code class="language-php">$query = DB::table('users')-&gt;select('*')-&gt;where('id', '=', 1);
$query-&gt;union(DB::table('users')-&gt;select('*')-&gt;where('id', '=', 2));
//(select * from `users` where `id` = 1) union (select * from `users` where `id` = 2)
</code></pre>
<p>还可以添加多个 <code>union</code> 语句：</p>
<pre><code class="language-php">$query = DB::table('users')-&gt;select('*')-&gt;where('id', '=', 1);
$query-&gt;union(DB::table('users')-&gt;select('*')-&gt;where('id', '=', 2));
$query-&gt;union(DB::table('users')-&gt;select('*')-&gt;where('id', '=', 3));      
//(select * from "users" where "id" = 1) union (select * from "users" where "id" = 2) union (select * from "users" where "id" = 3)
</code></pre>
<p><code>union</code> 语句可以与 <code>orderBy</code> 相结合：</p>
<pre><code class="language-php">$query = DB::table('users')-&gt;select('*')-&gt;where('id', '=', 1);
$query-&gt;union(DB::table('users')-&gt;select('*')-&gt;where('id', '=', 2));
$query-&gt;orderBy('id', 'desc');
//(select * from `users` where `id` = ?) union (select * from `users` where `id` = ?) order by `id` desc
</code></pre>
<p><code>union</code> 语句可以与 <code>limit</code>、<code>offset</code> 相结合：</p>
<pre><code class="language-php">$query = DB::table('users')-&gt;select('*');
$query-&gt;union(DB::table('users')-&gt;select('*'));
$builder-&gt;skip(5)-&gt;take(10);
//(select * from `users`) union (select * from `dogs`) limit 10 offset 5

</code></pre>
<h3 id="union-函数">union 函数</h3>
<p><code>union</code> 函数比较简单：</p>
<pre><code class="language-php">public function union($query, $all = false)
{
    if ($query instanceof Closure) {
        call_user_func($query, $query = $this-&gt;newQuery());
    }

    $this-&gt;unions[] = compact('query', 'all');

    $this-&gt;addBinding($query-&gt;getBindings(), 'union');

    return $this;
}
</code></pre>
<h3 id="grammercompileunions">grammer——compileUnions</h3>
<p>语法编译器对 <code>union</code> 的处理：</p>
<pre><code class="language-php">public function compileSelect(Builder $query)
{
    $sql = parent::compileSelect($query);

    if ($query-&gt;unions) {
        $sql = '('.$sql.') '.$this-&gt;compileUnions($query);
    }

    return $sql;
}
    
protected function compileUnions(Builder $query)
{
    $sql = '';

    foreach ($query-&gt;unions as $union) {
        $sql .= $this-&gt;compileUnion($union);
    }

    if (! empty($query-&gt;unionOrders)) {
        $sql .= ' '.$this-&gt;compileOrders($query, $query-&gt;unionOrders);
    }

    if (isset($query-&gt;unionLimit)) {
        $sql .= ' '.$this-&gt;compileLimit($query, $query-&gt;unionLimit);
    }

    if (isset($query-&gt;unionOffset)) {
        $sql .= ' '.$this-&gt;compileOffset($query, $query-&gt;unionOffset);
    }

    return ltrim($sql);
}

protected function compileUnion(array $union)
{
    $conjuction = $union['all'] ? ' union all ' : ' union ';

    return $conjuction.'('.$union['query']-&gt;toSql().')';
}

</code></pre>
<p>可以看出，<code>union</code> 的处理比较简单，都是调用 <code>query-&gt;toSql</code> 语句而已。值得注意的是，在处理 <code>union</code> 的时候，要特别处理 <code>order</code>、<code>limit</code>、<code>offset</code>。</p>
<h2 id="orderby-语句">orderBy 语句</h2>
<p>orderBy 语句用法很简单，可以设置多个排序字段，也可以用原生排序语句：</p>
<pre><code class="language-php">DB::table('users')-&gt;select('*')-&gt;orderBy('email')-&gt;orderBy('age', 'desc');

DB::table('users')-&gt;select('*')-&gt;orderBy('email')-&gt;orderByRaw('age desc');
</code></pre>
<h3 id="orderby-函数">orderBy 函数</h3>
<p>如果当前查询中有 <code>union</code> 的话，排序的变量会被放入 <code>unionOrders</code> 数组中，这个数组只有在 <code>compileUnions</code> 函数中才会被编译成 <code>sql</code> 语句。否则会被放入 <code>orders</code> 数组中，这时会被 <code>compileOrders</code> 处理：</p>
<pre><code class="language-php">public function orderBy($column, $direction = 'asc')
{
    $this-&gt;{$this-&gt;unions ? 'unionOrders' : 'orders'}[] = [
        'column' =&gt; $column,
        'direction' =&gt; strtolower($direction) == 'asc' ? 'asc' : 'desc',
    ];

    return $this;
}
</code></pre>
<h3 id="grammercompileorders">grammer——compileOrders</h3>
<p>orderBy 的编译也很简单：</p>
<pre><code class="language-php">protected function compileOrders(Builder $query, $orders)
{
    if (! empty($orders)) {
        return 'order by '.implode(', ', $this-&gt;compileOrdersToArray($query, $orders));
    }

    return '';
}

protected function compileOrdersToArray(Builder $query, $orders)
{
    return array_map(function ($order) {
        return ! isset($order['sql'])
                    ? $this-&gt;wrap($order['column']).' '.$order['direction']
                    : $order['sql'];
    }, $orders);
}
</code></pre>
<h2 id="limit-offset-forpage-语句">limit offset forPage 语句</h2>
<p>limit offset 或者 skip take 用法很简单，有趣的是，<code>laravel</code> 考虑了负数的情况：</p>
<pre><code class="language-php">DB::select('*')-&gt;from('users')-&gt;offset(5)-&gt;limit(10);

DB::select('*')-&gt;from('users')-&gt;skip(5)-&gt;take(10);

DB::select('*')-&gt;from('users')-&gt;skip(-5)-&gt;take(-10);

DB::select('*')-&gt;from('users')-&gt;forPage(5, 10);

</code></pre>
<h3 id="limit-offset-函数">limit offset 函数</h3>
<p>和 orderBy 一样，如果当前查询中有 <code>union</code> 的话，limit / offset 会被放入 unionLimit / unionOffset 中，在编译 union 的时候解析：</p>
<pre><code class="language-php">public function take($value)
{
    return $this-&gt;limit($value);
}

public function limit($value)
{
    $property = $this-&gt;unions ? 'unionLimit' : 'limit';

    if ($value &gt;= 0) {
        $this-&gt;$property = $value;
    }

    return $this;
}

public function skip($value)
{
    return $this-&gt;offset($value);
}

public function offset($value)
{
    $property = $this-&gt;unions ? 'unionOffset' : 'offset';

    $this-&gt;$property = max(0, $value);

    return $this;
}

public function forPage($page, $perPage = 15)
{
    return $this-&gt;skip(($page - 1) * $perPage)-&gt;take($perPage);
}
</code></pre>
<h3 id="grammercompilelimit-compileoffset">grammer——compileLimit compileOffset</h3>
<p>这个不能再简单了：</p>
<pre><code class="language-php">protected function compileLimit(Builder $query, $limit)
{
    return 'limit '.(int) $limit;
}

protected function compileOffset(Builder $query, $offset)
{
    return 'offset '.(int) $offset;
}
</code></pre>
<h2 id="group-语句">group 语句</h2>
<p><code>groupBy</code> 语句的参数形式有多种：</p>
<pre><code class="language-php">DB::select('*')-&gt;from('users')-&gt;groupBy('email');

DB::select('*')-&gt;from('users')-&gt;groupBy('id', 'email');

DB::select('*')-&gt;from('users')-&gt;groupBy(['id', 'email']);

DB::select('*')-&gt;from('users')-&gt;groupBy(new Raw('DATE(created_at)'));
</code></pre>
<p><code>groupBy</code> 函数很简单，仅仅是为 <code>$this-&gt;groups</code> 成员变量合并数组：</p>
<pre><code class="language-php">public function groupBy(...$groups)
{
    foreach ($groups as $group) {
        $this-&gt;groups = array_merge(
            (array) $this-&gt;groups,
            Arr::wrap($group)
        );
    }

    return $this;
}
</code></pre>
<p>语法编译器的处理：</p>
<pre><code class="language-php">protected function compileGroups(Builder $query, $groups)
{
    return 'group by '.$this-&gt;columnize($groups);
}
</code></pre>
<h2 id="having-语句">having 语句</h2>
<p><code>having</code> 语句的用法也很简单。大致有 <code>having</code>、<code>orHaving</code>、<code>havingRaw</code>、<code>orHavingRaw</code> 这几个函数：</p>
<pre><code class="language-php">DB::select('*')-&gt;from('users')-&gt;having('email', '&gt;', 1);

DB::select('*')-&gt;from('users')-&gt;groupBy('email')-&gt;having('email', '&gt;', 1);

DB::select('*')-&gt;from('users')-&gt;having('email', 1)-&gt;orHaving('email', 2);

DB::select('*')-&gt;from('users')-&gt;havingRaw('user_foo &lt; user_bar');

DB::select('*')-&gt;from('users')-&gt;having('baz', '=', 1)-&gt;orHavingRaw('user_foo &lt; user_bar');
</code></pre>
<h3 id="having-函数">having 函数</h3>
<p><code>having</code> 函数大致与 <code>whereColumn</code> 相同：</p>
<pre><code class="language-php">public function having($column, $operator = null, $value = null, $boolean = 'and')
{
    $type = 'Basic';

    list($value, $operator) = $this-&gt;prepareValueAndOperator(
        $value, $operator, func_num_args() == 2
    );

    if ($this-&gt;invalidOperator($operator)) {
        list($value, $operator) = [$operator, '='];
    }

    $this-&gt;havings[] = compact('type', 'column', 'operator', 'value', 'boolean');

    if (! $value instanceof Expression) {
        $this-&gt;addBinding($value, 'having');
    }

    return $this;
}
</code></pre>
<p><code>havingRaw</code> 函数：</p>
<pre><code class="language-php">public function havingRaw($sql, array $bindings = [], $boolean = 'and')
{
    $type = 'Raw';

    $this-&gt;havings[] = compact('type', 'sql', 'boolean');

    $this-&gt;addBinding($bindings, 'having');

    return $this;
}
</code></pre>
<h3 id="grammercompilehavings">grammer——compileHavings</h3>
<p>语法编译器：</p>
<pre><code class="language-php">protected function compileHavings(Builder $query, $havings)
{
    $sql = implode(' ', array_map([$this, 'compileHaving'], $havings));

    return 'having '.$this-&gt;removeLeadingBoolean($sql);
}

protected function compileHaving(array $having)
{
    if ($having['type'] === 'Raw') {
        return $having['boolean'].' '.$having['sql'];
    }

    return $this-&gt;compileBasicHaving($having);
}

protected function compileBasicHaving($having)
{
    $column = $this-&gt;wrap($having['column']);

    $parameter = $this-&gt;parameter($having['value']);

    return $having['boolean'].' '.$column.' '.$having['operator'].' '.$parameter;
}
</code></pre>
<h2 id="when--tap--unless-语句">when / tap / unless 语句</h2>
<p><code>when</code> 语句可以根据条件来判断是否执行查询条件，<code>unless</code> 与 <code>when</code> 相反，第一个参数是 <code>false</code> 才会调用闭包函数执行查询，<code>tap</code> 指定 <code>when</code> 的第一参数永远为真：</p>
<pre><code class="language-php">$callback = function ($query, $condition) {
    $this-&gt;assertEquals($condition, 'truthy');

    $query-&gt;where('id', '=', 1);
};

$default = function ($query, $condition) {
    $this-&gt;assertEquals($condition, 0);

    $query-&gt;where('id', '=', 2);
};

DB::select('*')-&gt;from('users')-&gt;when('truthy', $callback, $default)-&gt;where('email', 'foo');

DB::select('*')-&gt;from('users')-&gt;tap($callback)-&gt;where('email', 'foo');

DB::select('*')-&gt;from('users')-&gt;unless('truthy', $callback, $default)-&gt;where('email', 'foo');
</code></pre>
<p><code>when</code>、<code>unless</code>、<code>tap</code> 函数的实现：</p>
<pre><code class="language-php">public function when($value, $callback, $default = null)
{
    if ($value) {
        return $callback($this, $value) ?: $this;
    } elseif ($default) {
        return $default($this, $value) ?: $this;
    }

    return $this;
}

public function unless($value, $callback, $default = null)
{
    if (! $value) {
        return $callback($this, $value) ?: $this;
    } elseif ($default) {
        return $default($this, $value) ?: $this;
    }

    return $this;
}

public function tap($callback)
{
    return $this-&gt;when(true, $callback);
}
</code></pre>
<h2 id="aggregate-查询">Aggregate 查询</h2>
<p>聚合方法也是 sql 的重要组成部分，<code>laravel</code> 提供 <code>count</code>、<code>max</code>、<code>min</code>、<code>avg</code>、<code>sum</code>、<code>exist</code> 等聚合方法：</p>
<pre><code class="language-php">DB::table('users')-&gt;count();//select count(*) as aggregate from "users"

DB::table('users')-&gt;max('id');//select max("id") as aggregate from "users"

DB::table('users')-&gt;min('id');//select min("id") as aggregate from "users"

DB::table('users')-&gt;sum('id');//select sum("id") as aggregate from "users"

DB::table('users')-&gt;exists();//select exists(select * from "users") as "exists"

</code></pre>
<p>这些聚合函数实际上都是调用 <code>aggregate</code> 函数：</p>
<pre><code class="language-php">public function count($columns = '*')
{
    return (int) $this-&gt;aggregate(__FUNCTION__, Arr::wrap($columns));
}

public function aggregate($function, $columns = ['*'])
{
    $results = $this-&gt;cloneWithout(['columns'])
                    -&gt;cloneWithoutBindings(['select'])
                    -&gt;setAggregate($function, $columns)
                    -&gt;get($columns);

    if (! $results-&gt;isEmpty()) {
        return array_change_key_case((array) $results[0])['aggregate'];
    }
}
</code></pre>
<p>可以看出来，<code>aggregate</code> 函数复制了一份 <code>queryBuilder</code>，只是缺少了 <code>select</code>、<code>bingding</code> 成员变量:</p>
<pre><code class="language-php">public function cloneWithout(array $properties)
{
    return tap(clone $this, function ($clone) use ($properties) {
        foreach ($properties as $property) {
            $clone-&gt;{$property} = null;
        }
    });
}

public function cloneWithoutBindings(array $except)
{
    return tap(clone $this, function ($clone) use ($except) {
        foreach ($except as $type) {
            $clone-&gt;bindings[$type] = [];
        }
    });
}

protected function setAggregate($function, $columns)
{
    $this-&gt;aggregate = compact('function', 'columns');

    if (empty($this-&gt;groups)) {
        $this-&gt;orders = null;

        $this-&gt;bindings['order'] = [];
    }

    return $this;
}
</code></pre>
<p><code>exist</code> 聚合函数和其他不一样，它的流程与 <code>whereExist</code> 大致相同：</p>
<pre><code class="language-php">public function exists()
{
    $results = $this-&gt;connection-&gt;select(
        $this-&gt;grammar-&gt;compileExists($this), $this-&gt;getBindings(), ! $this-&gt;useWritePdo
    );

    if (isset($results[0])) {
        $results = (array) $results[0];

        return (bool) $results['exists'];
    }

    return false;
}

</code></pre>
<h3 id="grammercompileaggregate">grammer——compileAggregate</h3>
<p><code>laravel</code> 的聚合函数具有独占性，也就是说调用聚合函数后，不能再 <code>select</code> 其他的列:</p>
<pre><code class="language-php">
protected function compileAggregate(Builder $query, $aggregate)
{
    $column = $this-&gt;columnize($aggregate['columns']);

    if ($query-&gt;distinct &amp;&amp; $column !== '*') {
        $column = 'distinct '.$column;
    }

    return 'select '.$aggregate['function'].'('.$column.') as aggregate';
}

protected function compileColumns(Builder $query, $columns)
{
    if (! is_null($query-&gt;aggregate)) {
        return;
    }

    $select = $query-&gt;distinct ? 'select distinct ' : 'select ';

    return $select.$this-&gt;columnize($columns);
}
</code></pre>
<p>可以看到，如果存在聚合函数，那么编译 <code>select</code> 的 <code>compileColumns</code> 函数将不会运行。</p>
<h2 id="first--find--value--pluck--implode">first / find / value / pluck / implode</h2>
<p>从数据库中取出后数据，我们可以使用 <code>laravel</code> 提供给我们的一些函数进行包装处理。</p>
<p><code>first</code> 函数可以让我们只查询第一条：</p>
<pre><code class="language-php">DB::table('users')-&gt;where('id', '=', 1)-&gt;first();
</code></pre>
<p><code>find</code> 函数，可以利用数据库表的主键来查询第一条：</p>
<pre><code>DB::table('users')-&gt;find(1);
</code></pre>
<p><code>pluck</code> 函数可以取查询记录的某一列：</p>
<pre><code class="language-php">DB::table('users')-&gt;where('id', '=', 1)-&gt;pluck('foo');/['bar', 'baz']
</code></pre>
<p><code>pluck</code> 函数取查询记录的某一列的同时，还可以设置列名的 <code>key</code>：</p>
<pre><code class="language-php">DB::table('users')-&gt;where('id', '=', 1)-&gt;pluck('foo', 'id');//[1 =&gt; 'bar', 10 =&gt; 'baz']
</code></pre>
<p><code>value</code> 函数可以取第一条数据的某一列：</p>
<pre><code class="language-php">DB::table('users')-&gt;where('id', '=', 1)-&gt;value('foo');//bar

</code></pre>
<p><code>implode</code> 函数可以将多条数据的某一列拼成字符串：</p>
<pre><code class="language-php">DB::table('users')-&gt;where('id', '=', 1)-&gt;implode('foo', ',');//'bar,baz'
</code></pre>
<h3 id="first-函数">first 函数</h3>
<p><code>find</code> 函数，使用了 <code>limit 1</code> 的 <code>sql</code> 语句：</p>
<pre><code class="language-php">public function first($columns = ['*'])
{
    return $this-&gt;take(1)-&gt;get($columns)-&gt;first();
}

</code></pre>
<h3 id="find-函数">find 函数</h3>
<p><code>find</code> 函数实际利用主键调用 <code>first</code> 函数：</p>
<pre><code class="language-php">public function find($id, $columns = ['*'])
{
    return $this-&gt;where('id', '=', $id)-&gt;first($columns);
}
</code></pre>
<h3 id="pluck-函数">pluck 函数</h3>
<p><code>pluck</code> 函数主要对得到的数据调用 <code>pluck</code> 函数：</p>
<pre><code class="language-php">public function pluck($column, $key = null)
{
    $results = $this-&gt;get(is_null($key) ? [$column] : [$column, $key]);

    return $results-&gt;pluck(
        $this-&gt;stripTableForPluck($column),
        $this-&gt;stripTableForPluck($key)
    );
}

</code></pre>
<h3 id="implod-函数">implod 函数</h3>
<p><code>implod</code> 函数对一维数组调用 <code>implod</code> 函数：</p>
<pre><code class="language-php">public function implode($column, $glue = '')
{
    return $this-&gt;pluck($column)-&gt;implode($glue);
}

</code></pre>
<h2 id="chunk-语句">chunk 语句</h2>
<p>如果你需要操作数千条数据库记录，可以考虑使用 chunk 方法。这个方法每次只取出一小块结果，并会将每个块传递给一个闭包处理。</p>
<pre><code class="language-php">DB::table('users')-&gt;orderBy('id')-&gt;chunk(100, function ($users) {
    foreach ($users as $user) {
        //
    }
});

</code></pre>
<p>你可以从 闭包 中返回 false，以停止对后续分块的处理：</p>
<pre><code class="language-php">DB::table('users')-&gt;orderBy('id')-&gt;chunk(100, function ($users) {
    // Process the records...
    if (...) {
        return false;
    } 
});

</code></pre>
<p>如果不想按照主键 id 来进行分块，我们还可以自定义分块主键：</p>
<pre><code class="language-php">DB::table('users')-&gt;orderBy('id')-&gt;chunkById(100, function ($users) {
    foreach ($users as $user) {
        //
    }
}, 'someIdField');

</code></pre>
<h3 id="chunk-函数">chunk 函数</h3>
<p><code>chunk</code> 函数的实现实际上是 <code>forPage</code> 函数，当从数据库获得数据后，先判断是否拿到了数据，如果拿到了就会继续执行闭包函数，否则就会中断程序。执行闭包函数后，需要判断返回状态。若取出的数据小于分块的条数，说明数据已经全部获取完毕，结束程序。</p>
<pre><code class="language-php">public function chunk($count, callable $callback)
{
    $this-&gt;enforceOrderBy();

    $page = 1;

    do {
        $results = $this-&gt;forPage($page, $count)-&gt;get();

        $countResults = $results-&gt;count();

        if ($countResults == 0) {
            break;
        }

        if ($callback($results, $page) === false) {
            return false;
        }

        unset($results);

        $page++;
    } while ($countResults == $count);

    return true;
}

protected function enforceOrderBy()
{
    if (empty($this-&gt;query-&gt;orders) &amp;&amp; empty($this-&gt;query-&gt;unionOrders)) {
        $this-&gt;orderBy($this-&gt;model-&gt;getQualifiedKeyName(), 'asc');
    }
}
</code></pre>
<p><code>enforceOrderBy</code> 函数是用于数据按照主键的大小进行排序。</p>
<h3 id="chunkbyid-函数">chunkById 函数</h3>
<p>chunkById 函数与 chunk 函数唯一不同的是 <code>forPage</code> 函数被换成了 <code>forPageAfterId</code> 函数，目的是替换主键：</p>
<pre><code class="language-php">public function chunkById($count, callable $callback, $column = 'id', $alias = null)
{
    $alias = $alias ?: $column;

    $lastId = 0;

    do {
        $clone = clone $this;

        $results = $clone-&gt;forPageAfterId($count, $lastId, $column)-&gt;get();

        $countResults = $results-&gt;count();

        if ($countResults == 0) {
            break;
        }

        if ($callback($results) === false) {
            return false;
        }

        $lastId = $results-&gt;last()-&gt;{$alias};

        unset($results);
    } while ($countResults == $count);

    return true;
}

</code></pre>
<p><code>forPageAfterId</code> 函数实际上是把 <code>offset</code> 函数删除，并按照自定义的列来排序，每次获取最后一条数据的自定义列的数值，利用 <code>where</code> 条件不断获取下一部分分块数据：</p>
<pre><code class="language-php">public function forPageAfterId($perPage = 15, $lastId = 0, $column = 'id')
{
    $this-&gt;orders = $this-&gt;removeExistingOrdersFor($column);

    return $this-&gt;where($column, '&gt;', $lastId)
                -&gt;orderBy($column, 'asc')
                -&gt;take($perPage);
}

protected function removeExistingOrdersFor($column)
{
    return Collection::make($this-&gt;orders)
                -&gt;reject(function ($order) use ($column) {
                    return isset($order['column'])
                           ? $order['column'] === $column : false;
                })-&gt;values()-&gt;all();
}
</code></pre>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/127/index.html">
<img class="uk-book-cover" src="../../static/icons/48/python_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/127/index.html">aiohttp 中文文档</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/68.html">HuberTRoy</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="python">python</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">124页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年7月8日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 34个">34</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/25/index.html">
<img class="uk-book-cover" src="../../static/icons/48/c_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/25/index.html">笨办法学C</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/15.html">wizardforcel</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="c">c</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">54页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 524个">524</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/67/index.html">
<img class="uk-book-cover" src="../../static/icons/48/javascript_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/67/index.html">JavaScript 资源大全中文版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/19.html">伯乐在线</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="javascript">javascript</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">1页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月6日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 4565个">4565</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/113/index.html">
<img class="uk-book-cover" src="../../static/icons/48/react_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/113/index.html">React Native中文文档0.51版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/62.html">tzivanmoe</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="react">react</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">118页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年7月1日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 0个">0</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/138/index.html">
<img class="uk-book-cover" src="../../static/icons/48/code_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/138/index.html">开发经验总结</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/72.html">phodal</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="code">code</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">1页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年8月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 641个">641</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/163/index.html">
<img class="uk-book-cover" src="../../static/icons/48/git_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/163/index.html">Git的奇技淫巧</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/92.html">jackfrued</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="git">git</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">77页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月26日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 28个">28</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../" title="返回首页"><img class="" src="../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../book/107/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../book/107/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../book/107/README.html" title="Introduction" data-book-page-rel-url="README.html" data-book-page-id="7730">Introduction</a>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="PHP Composer 自动加载" disabled data-book-page-rel-url="" data-book-page-id="7731">PHP Composer 自动加载</a>
<ul>
<li>
<a class="pjax" href="../../book/107/PHP%20Composer——自动加载原理.html" title="PHP Composer——自动加载原理" data-book-page-rel-url="PHP%20Composer——自动加载原理.html" data-book-page-id="7732">PHP Composer——自动加载原理</a>
</li>
<li>
<a class="pjax" href="../../book/107/PHP%20Composer——%20初始化源码分析.html" title="PHP Composer—— 初始化源码分析" data-book-page-rel-url="PHP%20Composer——%20初始化源码分析.html" data-book-page-id="7733">PHP Composer—— 初始化源码分析</a>
</li>
<li>
<a class="pjax" href="../../book/107/PHP%20Composer-——-注册与运行源码分析.html" title="PHP Composer-——-注册与运行源码分析" data-book-page-rel-url="PHP%20Composer-——-注册与运行源码分析.html" data-book-page-id="7734">PHP Composer-——-注册与运行源码分析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Facade 门面" disabled data-book-page-rel-url="" data-book-page-id="7735">Laravel Facade 门面</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Facade——Facade%20门面源码分析.html" title="Laravel Facade——Facade 门面源码分析" data-book-page-rel-url="Laravel%20Facade——Facade%20门面源码分析.html" data-book-page-id="7736">Laravel Facade——Facade 门面源码分析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Ioc 容器" disabled data-book-page-rel-url="" data-book-page-id="7737">Laravel Ioc 容器</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Container——IoC%20服务容器.html" title="Laravel Container——IoC 服务容器" data-book-page-rel-url="Laravel%20Container——IoC%20服务容器.html" data-book-page-id="7738">Laravel Container——IoC 服务容器</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Container——IoC%20服务容器源码解析%28服务器绑定%29.html" title="Laravel Container——IoC 服务容器源码解析(服务器绑定)" data-book-page-rel-url="Laravel%20Container——IoC%20服务容器源码解析%28服务器绑定%29.html" data-book-page-id="7739">Laravel Container——IoC 服务容器源码解析(服务器绑定)</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Container——IoC%20服务容器源码解析%28服务器解析%29.html" title="Laravel Container——IoC 服务容器源码解析(服务器解析)" data-book-page-rel-url="Laravel%20Container——IoC%20服务容器源码解析%28服务器解析%29.html" data-book-page-id="7740">Laravel Container——IoC 服务容器源码解析(服务器解析)</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Container——服务容器的细节特性.html" title="Laravel Container——服务容器的细节特性" data-book-page-rel-url="Laravel%20Container——服务容器的细节特性.html" data-book-page-id="7741">Laravel Container——服务容器的细节特性</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Route 路由" disabled data-book-page-rel-url="" data-book-page-id="7742">Laravel Route 路由</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——路由.html" title="Laravel HTTP——路由" data-book-page-rel-url="Laravel%20HTTP——路由.html" data-book-page-id="7743">Laravel HTTP——路由</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——路由加载源码分析.html" title="Laravel HTTP——路由加载源码分析" data-book-page-rel-url="Laravel%20HTTP——路由加载源码分析.html" data-book-page-id="7744">Laravel HTTP——路由加载源码分析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——Pipeline中间件处理源码分析.html" title="Laravel HTTP——Pipeline中间件处理源码分析" data-book-page-rel-url="Laravel%20HTTP——Pipeline中间件处理源码分析.html" data-book-page-id="7745">Laravel HTTP——Pipeline中间件处理源码分析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——路由的正则编译.html" title="Laravel HTTP——路由的正则编译" data-book-page-rel-url="Laravel%20HTTP——路由的正则编译.html" data-book-page-id="7746">Laravel HTTP——路由的正则编译</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——路由的匹配与参数绑定.html" title="Laravel HTTP——路由的匹配与参数绑定" data-book-page-rel-url="Laravel%20HTTP——路由的匹配与参数绑定.html" data-book-page-id="7747">Laravel HTTP——路由的匹配与参数绑定</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——路由中间件源码分析.html" title="Laravel HTTP——路由中间件源码分析" data-book-page-rel-url="Laravel%20HTTP——路由中间件源码分析.html" data-book-page-id="7748">Laravel HTTP——路由中间件源码分析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——SubstituteBindings%20参数绑定中间件的使用与源码解析.html" title="Laravel HTTP——SubstituteBindings 参数绑定中间件的使用与源码解析" data-book-page-rel-url="Laravel%20HTTP——SubstituteBindings%20参数绑定中间件的使用与源码解析.html" data-book-page-id="7749">Laravel HTTP——SubstituteBindings 参数绑定中间件的使用与源码解析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——控制器方法的参数构建与运行.html" title="Laravel HTTP——控制器方法的参数构建与运行" data-book-page-rel-url="Laravel%20HTTP——控制器方法的参数构建与运行.html" data-book-page-id="7750">Laravel HTTP——控制器方法的参数构建与运行</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——%20RESTFul%20风格路由的使用与源码分析.html" title="Laravel HTTP—— RESTFul 风格路由的使用与源码分析" data-book-page-rel-url="Laravel%20HTTP——%20RESTFul%20风格路由的使用与源码分析.html" data-book-page-id="7751">Laravel HTTP—— RESTFul 风格路由的使用与源码分析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20HTTP——重定向的使用与源码分析.html" title="Laravel HTTP——重定向的使用与源码分析" data-book-page-rel-url="Laravel%20HTTP——重定向的使用与源码分析.html" data-book-page-id="7752">Laravel HTTP——重定向的使用与源码分析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel ENV 环境变量" disabled data-book-page-rel-url="" data-book-page-id="7753">Laravel ENV 环境变量</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20ENV——%20环境变量的加载与源码解析.html" title="Laravel ENV—— 环境变量的加载与源码解析" data-book-page-rel-url="Laravel%20ENV——%20环境变量的加载与源码解析.html" data-book-page-id="7754">Laravel ENV—— 环境变量的加载与源码解析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Config 配置文件" disabled data-book-page-rel-url="" data-book-page-id="7755">Laravel Config 配置文件</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Config——%20配置文件的加载与源码解析.html" title="Laravel Config—— 配置文件的加载与源码解析" data-book-page-rel-url="Laravel%20Config——%20配置文件的加载与源码解析.html" data-book-page-id="7756">Laravel Config—— 配置文件的加载与源码解析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Exceptions 异常处理" disabled data-book-page-rel-url="" data-book-page-id="7757">Laravel Exceptions 异常处理</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Exceptions——异常与错误处理.html" title="Laravel Exceptions——异常与错误处理.html" data-book-page-rel-url="Laravel%20Exceptions——异常与错误处理.html" data-book-page-id="7758">Laravel Exceptions——异常与错误处理.html</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Providers 服务提供者" disabled data-book-page-rel-url="" data-book-page-id="7759">Laravel Providers 服务提供者</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Providers——服务提供者的注册与启动源码解析.html" title="Laravel Providers——服务提供者的注册与启动源码解析" data-book-page-rel-url="Laravel%20Providers——服务提供者的注册与启动源码解析.html" data-book-page-id="7760">Laravel Providers——服务提供者的注册与启动源码解析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Database 数据库" disabled data-book-page-rel-url="" data-book-page-id="7761">Laravel Database 数据库</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——数据库服务的启动与连接.html" title="Laravel Database——数据库服务的启动与连接" data-book-page-rel-url="Laravel%20Database——数据库服务的启动与连接.html" data-book-page-id="7762">Laravel Database——数据库服务的启动与连接</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——数据库的%20CRUD%20操作.html" title="Laravel Database——数据库的 CRUD 操作" data-book-page-rel-url="Laravel%20Database——数据库的%20CRUD%20操作.html" data-book-page-id="7763">Laravel Database——数据库的 CRUD 操作</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——查询构造器与语法编译器源码分析%28上%29.html" title="Laravel Database——查询构造器与语法编译器源码分析(上)" data-book-page-rel-url="Laravel%20Database——查询构造器与语法编译器源码分析%28上%29.html" data-book-page-id="7764">Laravel Database——查询构造器与语法编译器源码分析(上)</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——查询构造器与语法编译器源码分析%28中%29.html" title="Laravel Database——查询构造器与语法编译器源码分析(中)" data-book-page-rel-url="Laravel%20Database——查询构造器与语法编译器源码分析%28中%29.html" data-book-page-id="7765">Laravel Database——查询构造器与语法编译器源码分析(中)</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——查询构造器与语法编译器源码分析%28下%29.html" title="Laravel Database——查询构造器与语法编译器源码分析(下)" data-book-page-rel-url="Laravel%20Database——查询构造器与语法编译器源码分析%28下%29.html" data-book-page-id="7766">Laravel Database——查询构造器与语法编译器源码分析(下)</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——分页原理与源码分析.html" title="Laravel Database——分页原理与源码分析" data-book-page-rel-url="Laravel%20Database——分页原理与源码分析.html" data-book-page-id="7767">Laravel Database——分页原理与源码分析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——Eloquent%20Model%20源码分析%28上%29.html" title="Laravel Database——Eloquent Model 源码分析(上)" data-book-page-rel-url="Laravel%20Database——Eloquent%20Model%20源码分析%28上%29.html" data-book-page-id="7768">Laravel Database——Eloquent Model 源码分析(上)</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——Eloquent%20Model%20源码分析（下）.html" title="Laravel Database——Eloquent Model 源码分析（下）" data-book-page-rel-url="Laravel%20Database——Eloquent%20Model%20源码分析（下）.html" data-book-page-id="7769">Laravel Database——Eloquent Model 源码分析（下）</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——Eloquent%20Model%20关联源码分析.html" title="Laravel Database——Eloquent Model 关联源码分析" data-book-page-rel-url="Laravel%20Database——Eloquent%20Model%20关联源码分析.html" data-book-page-id="7770">Laravel Database——Eloquent Model 关联源码分析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——Eloquent%20Model%20模型关系加载与查询.html" title="Laravel Database——Eloquent Model 模型关系加载与查询" data-book-page-rel-url="Laravel%20Database——Eloquent%20Model%20模型关系加载与查询.html" data-book-page-id="7771">Laravel Database——Eloquent Model 模型关系加载与查询</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Database——Eloquent%20Model%20更新关联模型.html" title="Laravel Database——Eloquent Model 更新关联模型" data-book-page-rel-url="Laravel%20Database——Eloquent%20Model%20更新关联模型.html" data-book-page-id="7772">Laravel Database——Eloquent Model 更新关联模型</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Session" disabled data-book-page-rel-url="" data-book-page-id="7773">Laravel Session</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Session——session%20的启动与运行源码分析.html" title="Laravel Session——session 的启动与运行源码分析" data-book-page-rel-url="Laravel%20Session——session%20的启动与运行源码分析.html" data-book-page-id="7774">Laravel Session——session 的启动与运行源码分析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Event 事件系统" disabled data-book-page-rel-url="" data-book-page-id="7775">Laravel Event 事件系统</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Event——事件系统的启动与运行源码分析.html" title="Laravel Event——事件系统的启动与运行源码分析" data-book-page-rel-url="Laravel%20Event——事件系统的启动与运行源码分析.html" data-book-page-id="7776">Laravel Event——事件系统的启动与运行源码分析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Queue 队列" disabled data-book-page-rel-url="" data-book-page-id="7777">Laravel Queue 队列</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Queue——消息队列任务与分发源码剖析.html" title="Laravel Queue——消息队列任务与分发源码剖析" data-book-page-rel-url="Laravel%20Queue——消息队列任务与分发源码剖析.html" data-book-page-id="7778">Laravel Queue——消息队列任务与分发源码剖析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Queue——消息队列任务处理器源码剖析.html" title="Laravel Queue——消息队列任务处理器源码剖析" data-book-page-rel-url="Laravel%20Queue——消息队列任务处理器源码剖析.html" data-book-page-id="7779">Laravel Queue——消息队列任务处理器源码剖析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel 广播系统" disabled data-book-page-rel-url="" data-book-page-id="7780">Laravel 广播系统</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Broadcast——广播系统源码剖析.html" title="Laravel Broadcast——广播系统源码剖析" data-book-page-rel-url="Laravel%20Broadcast——广播系统源码剖析.html" data-book-page-id="7781">Laravel Broadcast——广播系统源码剖析</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="javascript:;" class="uk-link-muted uk-text-muted" title="Laravel Passport" disabled data-book-page-rel-url="" data-book-page-id="7782">Laravel Passport</a>
<ul>
<li>
<a class="pjax" href="../../book/107/Laravel%20Passport——OAuth2%20API%20认证系统源码解析.html" title="Laravel Passport——OAuth2 API 认证系统源码解析" data-book-page-rel-url="Laravel%20Passport——OAuth2%20API%20认证系统源码解析.html" data-book-page-id="7783">Laravel Passport——OAuth2 API 认证系统源码解析</a>
</li>
<li>
<a class="pjax" href="../../book/107/Laravel%20Passport——OAuth2%20API%20认证系统源码解析（下）.html" title="Laravel Passport——OAuth2 API 认证系统源码解析(下)" data-book-page-rel-url="Laravel%20Passport——OAuth2%20API%20认证系统源码解析（下）.html" data-book-page-id="7784">Laravel Passport——OAuth2 API 认证系统源码解析(下)</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =107;var bookPageId =7765;var bookPageRelUrl ='Laravel%20Database——查询构造器与语法编译器源码分析%28中%29.html';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>