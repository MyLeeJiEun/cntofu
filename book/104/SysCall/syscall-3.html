
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>vsyscall and vDSO-Linux 内核揭密</title>
<meta content='vsyscall and vDSO,Linux 内核揭密' name='keywords'>
<meta content='vsyscall and vDSO,Linux 内核揭密' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../../static/components/css/base.css">
<link rel="stylesheet" href="../../../static/components/css/reader.css">
<link rel="stylesheet" href="../../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-left ">
<a href="../../../book/104/SysCall/syscall-2.html">
<i class="nav-icon-left uk-icon-small  uk-icon-caret-left"></i>
<span class="">Linux 内核如何处..</span>
</a>
</div>
<div class="uk-align-right ">
<a href="../../../book/104/SysCall/syscall-4.html">
<span class="">Linux 内核如何运..</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../../book/104/index.html">Linux 内核揭密</a>
<a target="_blank" rel="nofollow" href="https://github.com/ye11ow/linux-insides-zh" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<h1 id="linux-内核系统调用-第三节">Linux 内核系统调用 第三节</h1>
<h2 id="vsyscalls-和-vdso">vsyscalls 和 vDSO</h2>
<p>这是讲解 Linux 内核中系统调用<a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/SysCall/index.html">章节</a>的第三部分，<a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/SysCall/syscall-2.html">前一节</a>讨论了用户空间应用程序发起的系统调用的准备工作及系统调用的处理过程。在这一节将讨论两个与系统调用十分相似的概念，这两个概念是<code>vsyscall</code> 和 <code>vdso</code>。</p>
<p>我们已经了解什么是<code>系统调用</code>。这是 Linux 内核一种特殊的运行机制，使得用户空间的应用程序可以请求，像写入文件和打开套接字等特权级下的任务。正如你所了解的，在 Linux 内核中发起一个系统调用是特别昂贵的操作，因为处理器需要中断当前正在执行的任务，切换内核模式的上下文，在系统调用处理完毕后跳转至用户空间。以下的两种机制 - <code>vsyscall</code> 和d <code>vdso</code> 被设计用来加速系统调用的处理，在这一节我们将了解两种机制的工作原理。</p>
<h2 id="vsyscalls-介绍">vsyscalls 介绍</h2>
<p><code>vsyscall</code> 或 <code>virtual system call</code> 是第一种也是最古老的一种用于加快系统调用的机制。 <code>vsyscall</code> 的工作原则其实十分简单。Linux 内核在用户空间映射一个包含一些变量及一些系统调用的实现的内存页。 对于 <a href="https://en.wikipedia.org/wiki/X86-64">X86_64</a> 架构可以在 Linux 内核的 [文档] (https://github.com/torvalds/linux/blob/master/Documentation/x86/x86_64/mm.txt) 找到关于这一内存区域的信息：</p>
<pre><code>ffffffffff600000 - ffffffffffdfffff (=8 MB) vsyscalls
</code></pre>
<p>或:</p>
<pre><code>~$ sudo cat /proc/1/maps | grep vsyscall
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
</code></pre>
<p>因此, 这些系统调用将在用户空间下执行，这意味着将不发生 <a href="https://en.wikipedia.org/wiki/Context_switch">上下文切换</a>。 <code>vsyscall</code> 内存页的映射在 <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vsyscall/vsyscall_64.c">arch/x86/entry/vsyscall/vsyscall_64.c</a> 源代码中定义的 <code>map_vsyscall</code> 函数中实现。这一函数在 Linux 内核初始化时被 <a href="https://github.com/torvalds/linux/blob/master/arch/x86/kernel/setup.c">arch/x86/kernel/setup.c</a> 源代码中定义的函数<code>setup_arch</code> (我们在<a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/Initialization/linux-initialization-5.html">第五章</a> Linux 内核的初始化中讨论过该函数)。</p>
<p>注意 <code>map_vsyscall</code> 函数的实现依赖于内核配置选项 <code>CONFIG_X86_VSYSCALL_EMULATION</code> :</p>
<pre><code class="language-C">#ifdef CONFIG_X86_VSYSCALL_EMULATION
extern void map_vsyscall(void);
#else
static inline void map_vsyscall(void) {}
#endif
</code></pre>
<p>正如帮助文档中所描述的, <code>CONFIG_X86_VSYSCALL_EMULATION</code> 配置选项: <code>使能 vsyscall 模拟</code>. 为何模拟 <code>vsyscall</code>? 事实上, <code>vsyscall</code> 由于安全原因是一种遗留 <a href="https://en.wikipedia.org/wiki/Application_binary_interface">ABI</a> 。虚拟系统调用具有绑定的地址, 意味着 <code>vsyscall</code> 的内存页的位置在任何时刻是相同，这一位置是在 <code>map_vsyscall</code> 函数中指定的。这一函数的实现如下:</p>
<pre><code class="language-C">void __init map_vsyscall(void)
{
    extern char __vsyscall_page;
    unsigned long physaddr_vsyscall = __pa_symbol(&amp;__vsyscall_page);
	...
	...
	...
}
</code></pre>
<p>在 <code>map_vsyscall</code> 函数的开始，通过宏 <code>__pa_symbol</code> 获取了 <code>vsyscall</code> 内存页的物理地址(我们已在<a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/Initialization/linux-initialization-4.html">第四章</a> of the Linux kernel initialization process)讨论了该宏的实现）。<code>__vsyscall_page</code> 在 <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vsyscall/vsyscall_emu_64.S">arch/x86/entry/vsyscall/vsyscall_emu_64.S</a> 汇编源代码文件中定义， 具有如下的 <a href="https://en.wikipedia.org/wiki/Virtual_address_space">虚拟地址</a>:</p>
<pre><code>ffffffff81881000 D __vsyscall_page
</code></pre>
<p>在 <code>.data..page_aligned, aw</code> <a href="https://en.wikipedia.org/wiki/Memory_segmentation">段</a> 中 包含如下三中系统调用:</p>
<ul>
<li><code>gettimeofday</code>;</li>
<li><code>time</code>;</li>
<li><code>getcpu</code>.</li>
</ul>
<p>或:</p>
<pre><code class="language-assembly">__vsyscall_page:
	mov $__NR_gettimeofday, %rax
	syscall
	ret

	.balign 1024, 0xcc
	mov $__NR_time, %rax
	syscall
	ret

	.balign 1024, 0xcc
	mov $__NR_getcpu, %rax
	syscall
	ret
</code></pre>
<p>回到 <code>map_vsyscall</code> 函数及 <code>__vsyscall_page</code> 的实现，在得到 <code>__vsyscall_page</code> 的物理地址之后，使用 <code>__set_fixmap</code> 为 <code>vsyscall</code> 内存页 检查设置 <a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/mm/linux-mm-2.html">fix-mapped</a>地址的变量<code>vsyscall_mode</code>:</p>
<pre><code class="language-C">if (vsyscall_mode != NONE)
	__set_fixmap(VSYSCALL_PAGE, physaddr_vsyscall,
                 vsyscall_mode == NATIVE
                             ? PAGE_KERNEL_VSYSCALL
                             : PAGE_KERNEL_VVAR);
</code></pre>
<p>The <code>__set_fixmap</code> takes three arguments: The first is index of the <code>fixed_addresses</code> <a href="https://en.wikipedia.org/wiki/Enumerated_type">enum</a>. In our case <code>VSYSCALL_PAGE</code> is the first element of the <code>fixed_addresses</code> enum for the <code>x86_64</code> architecture:</p>
<pre><code class="language-C">enum fixed_addresses {
...
...
...
#ifdef CONFIG_X86_VSYSCALL_EMULATION
	VSYSCALL_PAGE = (FIXADDR_TOP - VSYSCALL_ADDR) &gt;&gt; PAGE_SHIFT,
#endif
...
...
...
</code></pre>
<p>该变量值为 <code>511</code>。第二个参数为映射内存页的物理地址，第三个参数为内存页的标志位。注意 <code>VSYSCALL_PAGE</code> 标志位依赖于变量 <code>vsyscall_mode</code> 。当 <code>vsyscall_mode</code> 变量为 <code>NATIVE</code> 时， 标志位为 <code>PAGE_KERNEL_VSYSCALL</code>，其他情况则是<code>PAGE_KERNEL_VVAR</code> 。两个宏 ( <code>PAGE_KERNEL_VSYSCALL</code> 及 <code>PAGE_KERNEL_VVAR</code>) 都将被扩展以下标志:</p>
<pre><code class="language-C">#define __PAGE_KERNEL_VSYSCALL          (__PAGE_KERNEL_RX | _PAGE_USER)
#define __PAGE_KERNEL_VVAR              (__PAGE_KERNEL_RO | _PAGE_USER)
</code></pre>
<p>标志反映了 <code>vsyscall</code> 内存页的访问权限。两个标志都带有 <code>_PAGE_USER</code> 标志， 这意味着内存页可被运行于低特权级的用户模式进程访问。第二个标志位取决于 <code>vsyscall_mode</code> 变量的值。第一个标志 (<code>__PAGE_KERNEL_VSYSCALL</code>) 在 <code>vsyscall_mode</code> 为 <code>NATIVE</code> 时被设定。这意味着虚拟系统调用将以本地 <code>syscall</code> 指令的方式执行。另一情况下，在 <code>vsyscall_mode</code> 为 <code>emulate</code> 时 vsyscall 为 <code>PAGE_KERNEL_VVAR</code>，此时系统调用将被置于陷阱并被合理的模拟。 <code>vsyscall_mode</code> 变量通过 <code>vsyscall_setup</code> 获取值：</p>
<pre><code class="language-C">static int __init vsyscall_setup(char *str)
{
	if (str) {
		if (!strcmp("emulate", str))
			vsyscall_mode = EMULATE;
		else if (!strcmp("native", str))
			vsyscall_mode = NATIVE;
		else if (!strcmp("none", str))
			vsyscall_mode = NONE;
		else
			return -EINVAL;

		return 0;
	}

	return -EINVAL;
}
</code></pre>
<p>函数将在早期的内核分析时被调用：</p>
<pre><code class="language-C">early_param("vsyscall", vsyscall_setup);
</code></pre>
<p>关于 <code>early_param</code> 宏的更多信息可以在<a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/Initialization/linux-initialization-6.html">第六章</a> Linux 内核初始化中找到。</p>
<p>在函数 <code>vsyscall_map</code> 的最后仅通过 <a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/Initialization/linux-initialization-1.html">BUILD_BUG_ON</a> 宏检查 <code>vsyscall</code> 内存页的虚拟地址是否等于变量 <code>VSYSCALL_ADDR</code> :</p>
<pre><code class="language-C">BUILD_BUG_ON((unsigned long)__fix_to_virt(VSYSCALL_PAGE) !=
             (unsigned long)VSYSCALL_ADDR);
</code></pre>
<p>就这样<code>vsyscall</code> 内存页设置完毕。上述的结果如下： 若设置 <code>vsyscall=native</code> 内核命令行参数，虚拟内存调用将以 <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vsyscall/vsyscall_emu_64.S">arch/x86/entry/vsyscall/vsyscall_emu_64.S</a> 文件中本地 <code>系统调用</code> 指令的方式执行。 <a href="https://en.wikipedia.org/wiki/GNU_C_Library">glibc</a> 知道虚拟系统调用处理器的地址。注意虚拟系统调用的地址以 <code>1024</code> (或 <code>0x400</code>) 比特对齐。</p>
<pre><code class="language-assembly">__vsyscall_page:
	mov $__NR_gettimeofday, %rax
	syscall
	ret

	.balign 1024, 0xcc
	mov $__NR_time, %rax
	syscall
	ret

	.balign 1024, 0xcc
	mov $__NR_getcpu, %rax
	syscall
	ret
</code></pre>
<p><code>vsyscall</code> 内存页的起始地址为 <code>ffffffffff600000</code> 。因此, <a href="https://en.wikipedia.org/wiki/GNU_C_Library">glibc</a> 知道所有虚拟系统调用处理器的地址。可以在 <code>glibc</code> 源码中找到这些地址的定义：</p>
<pre><code class="language-C">#define VSYSCALL_ADDR_vgettimeofday   0xffffffffff600000
#define VSYSCALL_ADDR_vtime 	      0xffffffffff600400
#define VSYSCALL_ADDR_vgetcpu	      0xffffffffff600800
</code></pre>
<p>所有的虚拟系统调用请求都将映射至 <code>__vsyscall_page</code> + <code>VSYSCALL_ADDR_vsyscall_name</code> 偏置, 将虚拟内存系统调用的编号置于通用目的<a href="https://en.wikipedia.org/wiki/Processor_register">寄存器</a>，本地的 x86_64 <code>系统调用</code>指令将被执行。</p>
<p>在第二种情况中, 若将 <code>vsyscall=emulate</code> 参数传递给内核命令行, 提升虚拟系统调用处理器的尝试导致一个 <a href="https://en.wikipedia.org/wiki/Page_fault">page fault</a> 异常。 谨记, <code>vsyscall</code> 内存页 具有 <code>__PAGE_KERNEL_VVAR</code> 的访问权限，这将禁止执行。 <code>do_page_fault</code> 函数是 <code>#PF</code> 或 page fault 的处理器。它将尝试了解最后一次 page fault 的原因。一种可能的场景是 <code>vsyscall</code> 模式为 <code>emulate</code> 情况下的虚拟系统调用。此时 <code>vsyscall</code> 将被 <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vsyscall/vsyscall_64.c">arch/x86/entry/vsyscall/vsyscall_64.c</a> 源码中定义的 <code>emulate_vsyscall</code> 函数处理。</p>
<p>The <code>emulate_vsyscall</code> function gets the number of a virtual system call, checks it, prints error and sends <a href="https://en.wikipedia.org/wiki/Segmentation_fault">segementation fault</a> single:</p>
<pre><code class="language-C">...
...
...
vsyscall_nr = addr_to_vsyscall_nr(address);
if (vsyscall_nr &lt; 0) {
	warn_bad_vsyscall(KERN_WARNING, regs, "misaligned vsyscall...);
	goto sigsegv;
}
...
...
...
sigsegv:
	force_sig(SIGSEGV, current);
	reutrn true;
</code></pre>
<p>As it checked number of a virtual system call, it does some yet another checks like <code>access_ok</code> violations and execute system call function depends on the number of a virtual system call:</p>
<pre><code class="language-C">switch (vsyscall_nr) {
	case 0:
		ret = sys_gettimeofday(
			(struct timeval __user *)regs-&gt;di,
			(struct timezone __user *)regs-&gt;si);
		break;
	...
	...
	...
}
</code></pre>
<p>In the end we put the result of the <code>sys_gettimeofday</code> or another virtual system call handler to the <code>ax</code> general purpose register, as we did it with the normal system calls and restore the <a href="https://en.wikipedia.org/wiki/Program_counter">instruction pointer</a> register and add <code>8</code> bytes to the <a href="https://en.wikipedia.org/wiki/Stack_register">stack pointer</a> register. This operation emulates <code>ret</code> instruction.</p>
<pre><code class="language-C">	regs-&gt;ax = ret;

do_ret:
	regs-&gt;ip = caller;
	regs-&gt;sp += 8;
	return true;
</code></pre>
<p>That's all. Now let's look on the modern concept - <code>vDSO</code>.</p>
<h2 id="introduction-to-vdso">Introduction to vDSO</h2>
<p>As I already wrote above, <code>vsyscall</code> is an obsolete concept and replaced by the <code>vDSO</code> or <code>virtual dynamic shared object</code>. The main difference between the <code>vsyscall</code> and <code>vDSO</code> mechanisms is that <code>vDSO</code> maps memory pages into each process in a shared object <a href="https://en.wikipedia.org/wiki/Library_%28computing%29#Shared_libraries">form</a>, but <code>vsyscall</code> is static in memory and has the same address every time. For the <code>x86_64</code> architecture it is called -<code>linux-vdso.so.1</code>. All userspace applications linked with this shared library via the <code>glibc</code>. For example:</p>
<pre><code>~$ ldd /bin/uname
	linux-vdso.so.1 (0x00007ffe014b7000)
	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fbfee2fe000)
	/lib64/ld-linux-x86-64.so.2 (0x00005559aab7c000)
</code></pre>
<p>Or:</p>
<pre><code>~$ sudo cat /proc/1/maps | grep vdso
7fff39f73000-7fff39f75000 r-xp 00000000 00:00 0       [vdso]
</code></pre>
<p>Here we can see that <a href="https://en.wikipedia.org/wiki/Uname">uname</a> util was linked with the three libraries:</p>
<ul>
<li><code>linux-vdso.so.1</code>;</li>
<li><code>libc.so.6</code>;</li>
<li><code>ld-linux-x86-64.so.2</code>.</li>
</ul>
<p>The first provides <code>vDSO</code> functionality, the second is <code>C</code> <a href="https://en.wikipedia.org/wiki/C_standard_library">standard library</a> and the third is the program interpreter (more about this you can read in the part that describes <a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/Misc/linkers.html">linkers</a>). So, the <code>vDSO</code> solves limitations of the <code>vsyscall</code>. Implementation of the <code>vDSO</code> is similar to <code>vsyscall</code>.</p>
<p>Initialization of the <code>vDSO</code> occurs in the <code>init_vdso</code> function that defined in the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vdso/vma.c">arch/x86/entry/vdso/vma.c</a> source code file. This function starts from the initialization of the <code>vDSO</code> images for 32-bits and 64-bits depends on the <code>CONFIG_X86_X32_ABI</code> kernel configuration option:</p>
<pre><code class="language-C">static int __init init_vdso(void)
{
	init_vdso_image(&amp;vdso_image_64);

#ifdef CONFIG_X86_X32_ABI
	init_vdso_image(&amp;vdso_image_x32);
#endif	
</code></pre>
<p>Both function initialize the <code>vdso_image</code> structure. This structure is defined in the two generated source code files: the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vdso/vdso-image-64.c">arch/x86/entry/vdso/vdso-image-64.c</a> and the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vdso/vdso-image-64.c">arch/x86/entry/vdso/vdso-image-64.c</a>. These source code files generated by the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vdso/vdso2c.c">vdso2c</a> program from the different source code files, represent different approaches to call a system call like <code>int 0x80</code>, <code>sysenter</code> and etc. The full set of the images depends on the kernel configuration.</p>
<p>For example for the <code>x86_64</code> Linux kernel it will contain <code>vdso_image_64</code>:</p>
<pre><code class="language-C">#ifdef CONFIG_X86_64
extern const struct vdso_image vdso_image_64;
#endif
</code></pre>
<p>But for the <code>x86</code> - <code>vdso_image_32</code>:</p>
<pre><code class="language-C">#ifdef CONFIG_X86_X32
extern const struct vdso_image vdso_image_x32;
#endif
</code></pre>
<p>If our kernel is configured for the <code>x86</code> architecture or for the <code>x86_64</code> and compability mode, we will have ability to call a system call with the <code>int 0x80</code> interrupt, if compability mode is enabled, we will be able to call a system call with the native <code>syscall instruction</code> or <code>sysenter</code> instruction in other way:</p>
<pre><code class="language-C">#if defined CONFIG_X86_32 || defined CONFIG_COMPAT
  extern const struct vdso_image vdso_image_32_int80;
#ifdef CONFIG_COMPAT
  extern const struct vdso_image vdso_image_32_syscall;
#endif
 extern const struct vdso_image vdso_image_32_sysenter;
#endif
</code></pre>
<p>As we can understand from the name of the <code>vdso_image</code> structure, it represents image of the <code>vDSO</code> for the certain mode of the system call entry. This structure contains information about size in bytes of the <code>vDSO</code> area that always a multiple of <code>PAGE_SIZE</code> (<code>4096</code> bytes), pointer to the text mapping, start and end address of the <code>alternatives</code> (set of instructions with better alternatives for the certain type of the processor) and etc. For example <code>vdso_image_64</code> looks like this:</p>
<pre><code class="language-C">const struct vdso_image vdso_image_64 = {
	.data = raw_data,
	.size = 8192,
	.text_mapping = {
		.name = "[vdso]",
		.pages = pages,
	},
	.alt = 3145,
	.alt_len = 26,
	.sym_vvar_start = -8192,
	.sym_vvar_page = -8192,
	.sym_hpet_page = -4096,
};
</code></pre>
<p>Where the <code>raw_data</code> contains raw binary code of the 64-bit <code>vDSO</code> system calls which are <code>2</code> page size:</p>
<pre><code class="language-C">static struct page *pages[2];
</code></pre>
<p>or 8 Kilobytes.</p>
<p>The <code>init_vdso_image</code> function is defined in the same source code file and just initializes the <code>vdso_image.text_mapping.pages</code>. First of all this function calculates the number of pages and initializes each <code>vdso_image.text_mapping.pages[number_of_page]</code> with the <code>virt_to_page</code> macro that converts given address to the <code>page</code> structure:</p>
<pre><code class="language-C">void __init init_vdso_image(const struct vdso_image *image)
{
	int i;
	int npages = (image-&gt;size) / PAGE_SIZE;

	for (i = 0; i &lt; npages; i++)
		image-&gt;text_mapping.pages[i] =
			virt_to_page(image-&gt;data + i*PAGE_SIZE);
	...
	...
	...
}
</code></pre>
<p>The <code>init_vdso</code> function passed to the <code>subsys_initcall</code> macro adds the given function to the <code>initcalls</code> list. All functions from this list will be called in the <code>do_initcalls</code> function from the <a href="https://github.com/torvalds/linux/blob/master/init/main.c">init/main.c</a> source code file:</p>
<pre><code class="language-C">subsys_initcall(init_vdso);
</code></pre>
<p>Ok, we just saw initialization of the <code>vDSO</code> and initialization of <code>page</code> structures that are related to the memory pages that contain <code>vDSO</code> system calls. But to where do their pages map? Actually they are mapped by the kernel, when it loads binary to the memory. The Linux kernel calls the <code>arch_setup_additional_pages</code> function from the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/vdso/vma.c">arch/x86/entry/vdso/vma.c</a> source code file that checks that <code>vDSO</code> enabled for the <code>x86_64</code> and calls the <code>map_vdso</code> function:</p>
<pre><code class="language-C">int arch_setup_additional_pages(struct linux_binprm *bprm, int uses_interp)
{
	if (!vdso64_enabled)
		return 0;

	return map_vdso(&amp;vdso_image_64, true);
}
</code></pre>
<p>The <code>map_vdso</code> function is defined in the same source code file and maps pages for the <code>vDSO</code> and for the shared <code>vDSO</code> variables. That's all. The main differences between the <code>vsyscall</code> and the <code>vDSO</code> concepts is that <code>vsyscal</code> has a static address of <code>ffffffffff600000</code> and implements <code>3</code> system calls, whereas the <code>vDSO</code> loads dynamically and implements four system calls:</p>
<ul>
<li><code>__vdso_clock_gettime</code>;</li>
<li><code>__vdso_getcpu</code>;</li>
<li><code>__vdso_gettimeofday</code>;</li>
<li><code>__vdso_time</code>.</li>
</ul>
<p>That's all.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This is the end of the third part about the system calls concept in the Linux kernel. In the previous <a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/SysCall/syscall-2.html">part</a> we discussed the implementation of the preparation from the Linux kernel side, before a system call will be handled and implementation of the <code>exit</code> process from a system call handler. In this part we continued to dive into the stuff which is related to the system call concept and learned two new concepts that are very similar to the system call - the <code>vsyscall</code> and the <code>vDSO</code>.</p>
<p>After all of these three parts, we know almost all things that are related to system calls, we know what system call is and why user applications need them. We also know what occurs when a user application calls a system call and how the kernel handles system calls.</p>
<p>The next part will be the last part in this <a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/SysCall/index.html">chapter</a> and we will see what occurs when a user runs the program.</p>
<p>If you have questions or suggestions, feel free to ping me in twitter <a href="https://twitter.com/0xAX">0xAX</a>, drop me <a href="anotherworldofworld@gmail.com">email</a> or just create <a href="https://github.com/MintCN/linux-insides-zh/issues/new">issue</a>.</p>
<p><strong>Please note that English is not my first language and I am really sorry for any inconvenience. If you found any mistakes please send me PR to <a href="https://github.com/MintCN/linux-insides-zh">linux-insides</a>.</strong></p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://github.com/torvalds/linux/blob/master/Documentation/x86/x86_64/mm.txt">x86_64 memory map</a></li>
<li><a href="https://en.wikipedia.org/wiki/X86-64">x86_64</a></li>
<li><a href="https://en.wikipedia.org/wiki/Context_switch">context switching</a></li>
<li><a href="https://en.wikipedia.org/wiki/Application_binary_interface">ABI</a></li>
<li><a href="https://en.wikipedia.org/wiki/Virtual_address_space">virtual address</a></li>
<li><a href="https://en.wikipedia.org/wiki/Memory_segmentation">Segmentation</a></li>
<li><a href="https://en.wikipedia.org/wiki/Enumerated_type">enum</a></li>
<li><a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/mm/linux-mm-2.html">fix-mapped addresses</a></li>
<li><a href="https://en.wikipedia.org/wiki/GNU_C_Library">glibc</a></li>
<li><a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/Initialization/linux-initialization-1.html">BUILD_BUG_ON</a></li>
<li><a href="https://en.wikipedia.org/wiki/Processor_register">Processor register</a></li>
<li><a href="https://en.wikipedia.org/wiki/Page_fault">Page fault</a></li>
<li><a href="https://en.wikipedia.org/wiki/Segmentation_fault">segementation fault</a></li>
<li><a href="https://en.wikipedia.org/wiki/Program_counter">instruction pointer</a></li>
<li><a href="https://en.wikipedia.org/wiki/Stack_register">stack pointer</a></li>
<li><a href="https://en.wikipedia.org/wiki/Uname">uname</a></li>
<li><a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/Misc/linkers.html">Linkers</a></li>
<li><a href="http://xinqiu.gitbooks.io/linux-insides-cn/content/SysCall/syscall-2.html">Previous part</a></li>
</ul>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/195/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/195/index.html">Linux命令大全搜索工具</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/111.html">jaywcjlove</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">30页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2021年10月24日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 个"></span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/151/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/151/index.html">Shell脚本编程30分钟入门</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/83.html">qinjx</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">5页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年3月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 5224个">5224</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/36/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/36/index.html">米斯特白帽培训讲义</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/15.html">wizardforcel</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">24页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 99个">99</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/58/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/java_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/58/index.html">guava学习记录项目</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/34.html">tiantiangao</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="java">java</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">24页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月5日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 70个">70</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/19/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/go_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/19/index.html">Go命令教程</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/14.html">hyper0x</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="go">go</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">15页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 1478个">1478</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/103/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/code_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/103/index.html">http2讲解中文版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/63.html">ye11ow</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="code">code</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">15页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月29日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 254个">254</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../../" title="返回首页"><img class="" src="../../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../../book/104/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../../book/104/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/README.html" title="简介" data-book-page-rel-url="README.html" data-book-page-id="7458">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/README.html" title="引导" data-book-page-rel-url="Booting/README.html" data-book-page-id="7459">引导</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-1.html" title="从引导加载程序内核" data-book-page-rel-url="Booting/linux-bootstrap-1.html" data-book-page-id="7460">从引导加载程序内核</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-2.html" title="在内核安装代码的第一步" data-book-page-rel-url="Booting/linux-bootstrap-2.html" data-book-page-id="7461">在内核安装代码的第一步</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-3.html" title="视频模式初始化和转换到保护模式" data-book-page-rel-url="Booting/linux-bootstrap-3.html" data-book-page-id="7462">视频模式初始化和转换到保护模式</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-4.html" title="过渡到 64 位模式" data-book-page-rel-url="Booting/linux-bootstrap-4.html" data-book-page-id="7463">过渡到 64 位模式</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-5.html" title="内核解压缩" data-book-page-rel-url="Booting/linux-bootstrap-5.html" data-book-page-id="7464">内核解压缩</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/README.html" title="初始化" data-book-page-rel-url="Initialization/README.html" data-book-page-id="7465">初始化</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-1.html" title="内核解压之后的首要步骤" data-book-page-rel-url="Initialization/linux-initialization-1.html" data-book-page-id="7466">内核解压之后的首要步骤</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-2.html" title="早期的中断和异常控制" data-book-page-rel-url="Initialization/linux-initialization-2.html" data-book-page-id="7467">早期的中断和异常控制</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-3.html" title="在到达内核入口之前最后的准备" data-book-page-rel-url="Initialization/linux-initialization-3.html" data-book-page-id="7468">在到达内核入口之前最后的准备</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-4.html" title="内核入口 - start_kernel" data-book-page-rel-url="Initialization/linux-initialization-4.html" data-book-page-id="7469">内核入口 - start_kernel</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-5.html" title="体系架构初始化" data-book-page-rel-url="Initialization/linux-initialization-5.html" data-book-page-id="7470">体系架构初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-6.html" title="进一步初始化指定体系架构" data-book-page-rel-url="Initialization/linux-initialization-6.html" data-book-page-id="7471">进一步初始化指定体系架构</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-7.html" title="最后对指定体系架构初始化" data-book-page-rel-url="Initialization/linux-initialization-7.html" data-book-page-id="7472">最后对指定体系架构初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-8.html" title="调度器初始化" data-book-page-rel-url="Initialization/linux-initialization-8.html" data-book-page-id="7473">调度器初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-9.html" title="RCU 初始化" data-book-page-rel-url="Initialization/linux-initialization-9.html" data-book-page-id="7474">RCU 初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-10.html" title="初始化结束" data-book-page-rel-url="Initialization/linux-initialization-10.html" data-book-page-id="7475">初始化结束</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/README.html" title="中断" data-book-page-rel-url="Interrupts/README.html" data-book-page-id="7476">中断</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-1.html" title="中断和中断处理 Part 1." data-book-page-rel-url="Interrupts/interrupts-1.html" data-book-page-id="7477">中断和中断处理 Part 1.</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-2.html" title="深入 Linux 内核中的中断" data-book-page-rel-url="Interrupts/interrupts-2.html" data-book-page-id="7478">深入 Linux 内核中的中断</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-3.html" title="初步中断处理" data-book-page-rel-url="Interrupts/interrupts-3.html" data-book-page-id="7479">初步中断处理</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-4.html" title="中断处理" data-book-page-rel-url="Interrupts/interrupts-4.html" data-book-page-id="7480">中断处理</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-5.html" title="异常处理的实现" data-book-page-rel-url="Interrupts/interrupts-5.html" data-book-page-id="7481">异常处理的实现</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-6.html" title="处理不可屏蔽中断" data-book-page-rel-url="Interrupts/interrupts-6.html" data-book-page-id="7482">处理不可屏蔽中断</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-7.html" title="深入外部硬件中断" data-book-page-rel-url="Interrupts/interrupts-7.html" data-book-page-id="7483">深入外部硬件中断</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-8.html" title="IRQs的非早期初始化" data-book-page-rel-url="Interrupts/interrupts-8.html" data-book-page-id="7484">IRQs的非早期初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-9.html" title="Softirq, Tasklets and Workqueues" data-book-page-rel-url="Interrupts/interrupts-9.html" data-book-page-id="7485">Softirq, Tasklets and Workqueues</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-10.html" title="最后一部分" data-book-page-rel-url="Interrupts/interrupts-10.html" data-book-page-id="7486">最后一部分</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/SysCall/README.html" title="系统调用" data-book-page-rel-url="SysCall/README.html" data-book-page-id="7487">系统调用</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/SysCall/syscall-1.html" title="系统调用概念简介" data-book-page-rel-url="SysCall/syscall-1.html" data-book-page-id="7488">系统调用概念简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SysCall/syscall-2.html" title="Linux 内核如何处理系统调用" data-book-page-rel-url="SysCall/syscall-2.html" data-book-page-id="7489">Linux 内核如何处理系统调用</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SysCall/syscall-3.html" title="vsyscall and vDSO" data-book-page-rel-url="SysCall/syscall-3.html" data-book-page-id="7490">vsyscall and vDSO</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SysCall/syscall-4.html" title="Linux 内核如何运行程序" data-book-page-rel-url="SysCall/syscall-4.html" data-book-page-id="7491">Linux 内核如何运行程序</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/README.html" title="定时器和时钟管理" data-book-page-rel-url="Timers/README.html" data-book-page-id="7492">定时器和时钟管理</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-1.html" title="简介" data-book-page-rel-url="Timers/timers-1.html" data-book-page-id="7493">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-2.html" title="时钟源框架简介" data-book-page-rel-url="Timers/timers-2.html" data-book-page-id="7494">时钟源框架简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-3.html" title="The tick broadcast framework and dyntick" data-book-page-rel-url="Timers/timers-3.html" data-book-page-id="7495">The tick broadcast framework and dyntick</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-4.html" title="定时器介绍" data-book-page-rel-url="Timers/timers-4.html" data-book-page-id="7496">定时器介绍</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-5.html" title="Clockevents 框架简介" data-book-page-rel-url="Timers/timers-5.html" data-book-page-id="7497">Clockevents 框架简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-6.html" title="x86 相关的时钟源" data-book-page-rel-url="Timers/timers-6.html" data-book-page-id="7498">x86 相关的时钟源</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-7.html" title="Linux 内核中与时钟相关的系统调用" data-book-page-rel-url="Timers/timers-7.html" data-book-page-id="7499">Linux 内核中与时钟相关的系统调用</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/README.html" title="同步原语" data-book-page-rel-url="SyncPrim/README.html" data-book-page-id="7500">同步原语</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-1.html" title="自旋锁简介" data-book-page-rel-url="SyncPrim/sync-1.html" data-book-page-id="7501">自旋锁简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-2.html" title="队列自旋锁" data-book-page-rel-url="SyncPrim/sync-2.html" data-book-page-id="7502">队列自旋锁</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-3.html" title="信号量" data-book-page-rel-url="SyncPrim/sync-3.html" data-book-page-id="7503">信号量</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-4.html" title="互斥锁" data-book-page-rel-url="SyncPrim/sync-4.html" data-book-page-id="7504">互斥锁</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-5.html" title="读者/写者信号量" data-book-page-rel-url="SyncPrim/sync-5.html" data-book-page-id="7505">读者/写者信号量</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-6.html" title="顺序锁" data-book-page-rel-url="SyncPrim/sync-6.html" data-book-page-id="7506">顺序锁</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/MM/README.html" title="内存管理" data-book-page-rel-url="MM/README.html" data-book-page-id="7508">内存管理</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/MM/linux-mm-1.html" title="内存块" data-book-page-rel-url="MM/linux-mm-1.html" data-book-page-id="7509">内存块</a>
</li>
<li>
<a class="pjax" href="../../../book/104/MM/linux-mm-2.html" title="固定映射地址和 ioremap" data-book-page-rel-url="MM/linux-mm-2.html" data-book-page-id="7510">固定映射地址和 ioremap</a>
</li>
<li>
<a class="pjax" href="../../../book/104/MM/linux-mm-3.html" title="kmemcheck" data-book-page-rel-url="MM/linux-mm-3.html" data-book-page-id="7511">kmemcheck</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Concepts/README.html" title="概念" data-book-page-rel-url="Concepts/README.html" data-book-page-id="7512">概念</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Concepts/per-cpu.html" title="每个 CPU 的变量" data-book-page-rel-url="Concepts/per-cpu.html" data-book-page-id="7513">每个 CPU 的变量</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Concepts/cpumask.html" title="CPU 掩码" data-book-page-rel-url="Concepts/cpumask.html" data-book-page-id="7514">CPU 掩码</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Concepts/initcall.html" title="initcall 机制" data-book-page-rel-url="Concepts/initcall.html" data-book-page-id="7515">initcall 机制</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Concepts/notification_chains.html" title="Linux 内核的通知链" data-book-page-rel-url="Concepts/notification_chains.html" data-book-page-id="7516">Linux 内核的通知链</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/DataStructures/README.html" title="Linux 内核中的数据结构" data-book-page-rel-url="DataStructures/README.html" data-book-page-id="7517">Linux 内核中的数据结构</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/DataStructures/dlist.html" title="双向链表" data-book-page-rel-url="DataStructures/dlist.html" data-book-page-id="7518">双向链表</a>
</li>
<li>
<a class="pjax" href="../../../book/104/DataStructures/radix-tree.html" title="基数树" data-book-page-rel-url="DataStructures/radix-tree.html" data-book-page-id="7519">基数树</a>
</li>
<li>
<a class="pjax" href="../../../book/104/DataStructures/bitmap.html" title="位数组" data-book-page-rel-url="DataStructures/bitmap.html" data-book-page-id="7520">位数组</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Theory/README.html" title="理论" data-book-page-rel-url="Theory/README.html" data-book-page-id="7521">理论</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Theory/Paging.html" title="分页" data-book-page-rel-url="Theory/Paging.html" data-book-page-id="7522">分页</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Theory/ELF.html" title="Elf64 格式" data-book-page-rel-url="Theory/ELF.html" data-book-page-id="7523">Elf64 格式</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Misc/README.html" title="杂项" data-book-page-rel-url="Misc/README.html" data-book-page-id="7524">杂项</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Misc/how_kernel_compiled.html" title="内核编译方法" data-book-page-rel-url="Misc/how_kernel_compiled.html" data-book-page-id="7525">内核编译方法</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Misc/linkers.html" title="链接器" data-book-page-rel-url="Misc/linkers.html" data-book-page-id="7526">链接器</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Misc/contribute.html" title="Linux 内核开发" data-book-page-rel-url="Misc/contribute.html" data-book-page-id="7527">Linux 内核开发</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Misc/program_startup.html" title="用户空间的程序启动过程" data-book-page-rel-url="Misc/program_startup.html" data-book-page-id="7528">用户空间的程序启动过程</a>
</li>
<li>
<a class="pjax" href="../../../book/104/" title="Write and Submit your first Linux kernel Patch" data-book-page-rel-url="" data-book-page-id="7507">Write and Submit your first Linux kernel Patch</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/KernelStructures/README.html" title="内核数据结构" data-book-page-rel-url="KernelStructures/README.html" data-book-page-id="7529">内核数据结构</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/KernelStructures/idt.html" title="中断描述符表" data-book-page-rel-url="KernelStructures/idt.html" data-book-page-id="7530">中断描述符表</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/LINKS.html" title="有帮助的链接" data-book-page-rel-url="LINKS.html" data-book-page-id="7531">有帮助的链接</a>
</li>
<li>
<a class="pjax" href="../../../book/104/contributors.html" title="贡献者" data-book-page-rel-url="contributors.html" data-book-page-id="7532">贡献者</a>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =104;var bookPageId =7490;var bookPageRelUrl ='SysCall/syscall-3.html';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>