
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>x86 相关的时钟源-Linux 内核揭密</title>
<meta content='x86 相关的时钟源,Linux 内核揭密' name='keywords'>
<meta content='x86 相关的时钟源,Linux 内核揭密' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../../static/components/css/base.css">
<link rel="stylesheet" href="../../../static/components/css/reader.css">
<link rel="stylesheet" href="../../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-left ">
<a href="../../../book/104/Timers/timers-5.html">
<i class="nav-icon-left uk-icon-small  uk-icon-caret-left"></i>
<span class="">Clockevents..</span>
</a>
</div>
<div class="uk-align-right ">
<a href="../../../book/104/Timers/timers-7.html">
<span class="">Linux 内核中与时..</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../../book/104/index.html">Linux 内核揭密</a>
<a target="_blank" rel="nofollow" href="https://github.com/ye11ow/linux-insides-zh" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<h1 id="timers-and-time-management-in-the-linux-kernel-part-6">Timers and time management in the Linux kernel. Part 6.</h1>
<h2 id="x86-64-related-clock-sources">x86_64 related clock sources</h2>
<p>This is sixth part of the <a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/Timers/index.html">chapter</a> which describes timers and time management related stuff in the Linux kernel. In the previous <a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/Timers/timers-5.html">part</a> we saw <code>clockevents</code> framework and now we will continue to dive into time management related stuff in the Linux kernel. This part will describe implementation of <a href="https://en.wikipedia.org/wiki/X86">x86</a> architecture related clock sources (more about <code>clocksource</code> concept you can read in the <a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/Timers/timers-2.html">second part</a> of this chapter).</p>
<p>First of all we must know what clock sources may be used at <code>x86</code> architecture. It is easy to know from the <a href="https://en.wikipedia.org/wiki/Sysfs">sysfs</a> or from content of the <code>/sys/devices/system/clocksource/clocksource0/available_clocksource</code>. The <code>/sys/devices/system/clocksource/clocksourceN</code> provides two special files to achieve this:</p>
<ul>
<li><code>available_clocksource</code> - provides information about available clock sources in the system;</li>
<li><code>current_clocksource</code> - provides information about currently used clock source in the system.</li>
</ul>
<p>So, let's look:</p>
<pre><code>$ cat /sys/devices/system/clocksource/clocksource0/available_clocksource 
tsc hpet acpi_pm 
</code></pre>
<p>We can see that there are three registered clock sources in my system:</p>
<ul>
<li><code>tsc</code> - <a href="https://en.wikipedia.org/wiki/Time_Stamp_Counter">Time Stamp Counter</a>;</li>
<li><code>hpet</code> - <a href="https://en.wikipedia.org/wiki/High_Precision_Event_Timer">High Precision Event Timer</a>;</li>
<li><code>acpi_pm</code> - <a href="http://uefi.org/sites/default/files/resources/ACPI_5.pdf">ACPI Power Management Timer</a>.</li>
</ul>
<p>Now let's look at the second file which provides best clock source (a clock source which has the best rating in the system):</p>
<pre><code>$ cat /sys/devices/system/clocksource/clocksource0/current_clocksource 
tsc
</code></pre>
<p>For me it is <a href="https://en.wikipedia.org/wiki/Time_Stamp_Counter">Time Stamp Counter</a>. As we may know from the <a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/Timers/timers-2.html">second part</a> of this chapter, which describes internals of the <code>clocksource</code> framework in the Linux kernel, the best clock source in a system is a clock source with the best (highest) rating or in other words with the highest <a href="https://en.wikipedia.org/wiki/Frequency">frequency</a>.</p>
<p>Frequency of the <a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface">ACPI</a> power management timer is <code>3.579545 MHz</code>. Frequency of the <a href="https://en.wikipedia.org/wiki/High_Precision_Event_Timer">High Precision Event Timer</a> is at least <code>10 MHz</code>. And the frequency of the <a href="https://en.wikipedia.org/wiki/Time_Stamp_Counter">Time Stamp Counter</a> depends on processor. For example On older processors, the <code>Time Stamp Counter</code> was counting internal processor clock cycles. This means its frequency changed when the processor's frequency scaling changed. The situation has changed for newer processors. Newer processors have an <code>invariant Time Stamp counter</code> that increments at a constant rate in all operational states of processor. Actually we can get its frequency in the output of the <code>/proc/cpuinfo</code>. For example for the first processor in the system:</p>
<pre><code>$ cat /proc/cpuinfo
...
model name	: Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz
...
</code></pre>
<p>And although Intel manual says that the frequency of the <code>Time Stamp Counter</code>, while constant, is not necessarily the maximum qualified frequency of the processor, or the frequency given in the brand string, anyway we may see that it will be much more than frequency of the <code>ACPI PM</code> timer or <code>High Precision Event Timer</code>. And we can see that the clock source with the best rating or highest frequency is current in the system.</p>
<p>You can note that besides these three clock source, we don't see yet another two familiar us clock sources in the output of the <code>/sys/devices/system/clocksource/clocksource0/available_clocksource</code>. These clock sources are <code>jiffy</code> and <code>refined_jiffies</code>. We don't see them because this filed maps only high resolution clock sources or in other words clock sources with the <a href="https://github.com/torvalds/linux/blob/master/include/linux/clocksource.h#L113">CLOCK_SOURCE_VALID_FOR_HRES</a> flag.</p>
<p>As I already wrote above, we will consider all of these three clock sources in this part. We will consider it in order of their initialization or:</p>
<ul>
<li><code>hpet</code>;</li>
<li><code>acpi_pm</code>;</li>
<li><code>tsc</code>.</li>
</ul>
<p>We can make sure that the order is exactly like this in the output of the <a href="https://en.wikipedia.org/wiki/Dmesg">dmesg</a> util:</p>
<pre><code>$ dmesg | grep clocksource
[    0.000000] clocksource: refined-jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 1910969940391419 ns
[    0.000000] clocksource: hpet: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 133484882848 ns
[    0.094369] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 1911260446275000 ns
[    0.186498] clocksource: Switched to clocksource hpet
[    0.196827] clocksource: acpi_pm: mask: 0xffffff max_cycles: 0xffffff, max_idle_ns: 2085701024 ns
[    1.413685] tsc: Refined TSC clocksource calibration: 3999.981 MHz
[    1.413688] clocksource: tsc: mask: 0xffffffffffffffff max_cycles: 0x73509721780, max_idle_ns: 881591102108 ns
[    2.413748] clocksource: Switched to clocksource tsc
</code></pre>
<p>The first clock source is the <a href="https://en.wikipedia.org/wiki/High_Precision_Event_Timer">High Precision Event Timer</a>, so let's start from it.</p>
<h2 id="high-precision-event-timer">High Precision Event Timer</h2>
<p>The implementation of the <code>High Precision Event Timer</code> for the <a href="https://en.wikipedia.org/wiki/X86">x86</a> architecture is located in the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/kernel/hpet.c">arch/x86/kernel/hpet.c</a> source code file. Its initialization starts from the call of the <code>hpet_enable</code> function. This function is called during Linux kernel initialization. If we will look into <code>start_kernel</code> function from the <a href="https://github.com/torvalds/linux/blob/master/init/main.c">init/main.c</a> source code file, we will see that after the all architecture-specific stuff initialized, early console is disabled and time management subsystem already ready, call of the following function:</p>
<pre><code class="language-C">if (late_time_init)
	late_time_init();
</code></pre>
<p>which does initialization of the late architecture specific timers after early jiffy counter already initialized. The definition of the <code>late_time_init</code> function for the <code>x86</code> architecture is located in the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/kernel/time.c">arch/x86/kernel/time.c</a> source code file. It looks pretty easy:</p>
<pre><code class="language-C">static __init void x86_late_time_init(void)
{
	x86_init.timers.timer_init();
	tsc_init();
}
</code></pre>
<p>As we may see, it does initialization of the <code>x86</code> related timer and initialization of the <code>Time Stamp Counter</code>. The seconds we will see in the next paragraph, but now let's consider the call of the <code>x86_init.timers.timer_init</code> function. The <code>timer_init</code> points to the <code>hpet_time_init</code> function from the same source code file. We can verify this by looking on the definition of the <code>x86_init</code> structure from the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/kernel/x86_init.c">arch/x86/kernel/x86_init.c</a>:</p>
<pre><code class="language-C">struct x86_init_ops x86_init __initdata = {
   ...
   ...
   ...
   .timers = {
		.setup_percpu_clockev	= setup_boot_APIC_clock,
		.timer_init		= hpet_time_init,
		.wallclock_init		= x86_init_noop,
   },
   ...
   ...
   ...
</code></pre>
<p>The <code>hpet_time_init</code> function does setup of the <a href="https://en.wikipedia.org/wiki/Programmable_interval_timer">programmable interval timer</a> if we can not enable <code>High Precision Event Timer</code> and setups default timer <a href="https://en.wikipedia.org/wiki/Interrupt_request_%28PC_architecture%29">IRQ</a> for the enabled timer:</p>
<pre><code class="language-C">void __init hpet_time_init(void)
{
	if (!hpet_enable())
		setup_pit_timer();
	setup_default_timer_irq();
}
</code></pre>
<p>First of all the <code>hpet_enable</code> function check we can enable <code>High Precision Event Timer</code> in the system by the call of the <code>is_hpet_capable</code> function and if we can, we map a virtual address space for it:</p>
<pre><code class="language-C">int __init hpet_enable(void)
{
	if (!is_hpet_capable())
		return 0;

    hpet_set_mapping();
}
</code></pre>
<p>The <code>is_hpet_capable</code> function checks that we didn't pass <code>hpet=disable</code> to the kernel command line and the <code>hpet_address</code> is received from the <a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface">ACPI HPET</a> table. The <code>hpet_set_mapping</code> function just maps the virtual address spaces for the timer registers:</p>
<pre><code class="language-C">hpet_virt_address = ioremap_nocache(hpet_address, HPET_MMAP_SIZE);
</code></pre>
<p>As we can read in the <a href="http://www.intel.com/content/dam/www/public/us/en/documents/technical-specifications/software-developers-hpet-spec-1-0a.pdf">IA-PC HPET (High Precision Event Timers) Specification</a>:</p>
<blockquote>
<p>The timer register space is 1024 bytes</p>
</blockquote>
<p>So, the <code>HPET_MMAP_SIZE</code> is <code>1024</code> bytes too:</p>
<pre><code class="language-C">#define HPET_MMAP_SIZE		1024
</code></pre>
<p>After we mapped virtual space for the <code>High Precision Event Timer</code>, we read <code>HPET_ID</code> register to get number of the timers:</p>
<pre><code class="language-C">id = hpet_readl(HPET_ID);

last = (id &amp; HPET_ID_NUMBER) &gt;&gt; HPET_ID_NUMBER_SHIFT;
</code></pre>
<p>We need to get this number to allocate correct amount of space for the <code>General Configuration Register</code> of the <code>High Precision Event Timer</code>:</p>
<pre><code class="language-C">cfg = hpet_readl(HPET_CFG);

hpet_boot_cfg = kmalloc((last + 2) * sizeof(*hpet_boot_cfg), GFP_KERNEL);
</code></pre>
<p>After the space is allocated for the configuration register of the <code>High Precision Event Timer</code>, we allow to main counter to run, and allow timer interrupts if they are enabled by the setting of <code>HPET_CFG_ENABLE</code> bit in the configuration register for all timers. In the end we just register new clock source by the call of the <code>hpet_clocksource_register</code> function:</p>
<pre><code class="language-C">if (hpet_clocksource_register())
	goto out_nohpet;
</code></pre>
<p>which just calls already familiar</p>
<pre><code class="language-C">clocksource_register_hz(&amp;clocksource_hpet, (u32)hpet_freq);
</code></pre>
<p>function. Where the <code>clocksource_hpet</code> is the <code>clocksource</code> structure with the rating <code>250</code> (remember rating of the previous <code>refined_jiffies</code> clock source was <code>2</code>), name - <code>hpet</code> and <code>read_hpet</code> callback for the reading of atomic counter provided by the <code>High Precision Event Timer</code>:</p>
<pre><code class="language-C">static struct clocksource clocksource_hpet = {
	.name		= "hpet",
	.rating		= 250,
	.read		= read_hpet,
	.mask		= HPET_MASK,
	.flags		= CLOCK_SOURCE_IS_CONTINUOUS,
	.resume		= hpet_resume_counter,
	.archdata	= { .vclock_mode = VCLOCK_HPET },
};
</code></pre>
<p>After the <code>clocksource_hpet</code> is registered, we can return to the <code>hpet_time_init()</code> function from the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/kernel/time.c">arch/x86/kernel/time.c</a> source code file. We can remember that the last step is the call of the:</p>
<pre><code class="language-C">setup_default_timer_irq();
</code></pre>
<p>function in the <code>hpet_time_init()</code>. The <code>setup_default_timer_irq</code> function checks existence of <code>legacy</code> IRQs or in other words support for the <a href="https://en.wikipedia.org/wiki/Intel_8259">i8259</a> and setups <a href="https://en.wikipedia.org/wiki/Interrupt_request_%28PC_architecture%29#Master_PIC">IRQ0</a> depends on this.</p>
<p>That's all. From this moment the <a href="https://en.wikipedia.org/wiki/High_Precision_Event_Timer">High Precision Event Timer</a> clock source registered in the Linux kernel <code>clock source</code> framework and may be used from generic kernel code via the <code>read_hpet</code>:</p>
<pre><code class="language-C">static cycle_t read_hpet(struct clocksource *cs)
{
	return (cycle_t)hpet_readl(HPET_COUNTER);
}
</code></pre>
<p>function which just reads and returns atomic counter from the <code>Main Counter Register</code>.</p>
<h2 id="acpi-pm-timer">ACPI PM timer</h2>
<p>The seconds clock source is <a href="http://uefi.org/sites/default/files/resources/ACPI_5.pdf">ACPI Power Management Timer</a>. Implementation of this clock source is located in the <a href="https://github.com/torvalds/linux/blob/master/drivers/clocksource_acpi_pm.c">drivers/clocksource/acpi_pm.c</a> source code file and starts from the call of the <code>init_acpi_pm_clocksource</code> function during <code>fs</code> <a href="http://www.compsoc.man.ac.uk/~moz/kernelnewbies/documents/initcall/kernel.html">initcall</a>.</p>
<p>If we will look at implementation of the <code>init_acpi_pm_clocksource</code> function, we will see that it starts from the check of the value of <code>pmtmr_ioport</code> variable:</p>
<pre><code class="language-C">static int __init init_acpi_pm_clocksource(void)
{
    ...
    ...
    ...
	if (!pmtmr_ioport)
		return -ENODEV;
    ...
    ...
    ...
</code></pre>
<p>This <code>pmtmr_ioport</code> variable contains extended address of the <code>Power Management Timer Control Register Block</code>. It gets its value in the <code>acpi_parse_fadt</code> function which is defined in the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/kernel/acpi/boot.c">arch/x86/kernel/acpi/boot.c</a> source code file. This function parses <code>FADT</code> or <code>Fixed ACPI Description Table</code> <a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface">ACPI</a> table and tries to get the values of the <code>X_PM_TMR_BLK</code> field which contains extended address of the <code>Power Management Timer Control Register Block</code>, represented in <code>Generic Address Structure</code> format:</p>
<pre><code class="language-C">static int __init acpi_parse_fadt(struct acpi_table_header *table)
{
#ifdef CONFIG_X86_PM_TIMER
        ...
        ...
        ...
		pmtmr_ioport = acpi_gbl_FADT.xpm_timer_block.address;
        ...
        ...
        ...
#endif
	return 0;
}
</code></pre>
<p>So, if the <code>CONFIG_X86_PM_TIMER</code> Linux kernel configuration option is disabled or something going wrong in the <code>acpi_parse_fadt</code> function, we can't access the <code>Power Management Timer</code> register and return from the <code>init_acpi_pm_clocksource</code>. In other way, if the value of the <code>pmtmr_ioport</code> variable is not zero, we check rate of this timer and register this clock source by the call of the:</p>
<pre><code class="language-C">clocksource_register_hz(&amp;clocksource_acpi_pm, PMTMR_TICKS_PER_SEC);
</code></pre>
<p>function. After the call of the <code>clocksource_register_hs</code>, the <code>acpi_pm</code> clock source will be registered in the <code>clocksource</code> framework of the Linux kernel:</p>
<pre><code class="language-C">static struct clocksource clocksource_acpi_pm = {
	.name		= "acpi_pm",
	.rating		= 200,
	.read		= acpi_pm_read,
	.mask		= (cycle_t)ACPI_PM_MASK,
	.flags		= CLOCK_SOURCE_IS_CONTINUOUS,
};
</code></pre>
<p>with the rating - <code>200</code> and the <code>acpi_pm_read</code> callback to read atomic counter provided by the <code>acpi_pm</code> clock source. The <code>acpi_pm_read</code> function just executes <code>read_pmtmr</code> function:</p>
<pre><code class="language-C">static cycle_t acpi_pm_read(struct clocksource *cs)
{
	return (cycle_t)read_pmtmr();
}
</code></pre>
<p>which reads value of the <code>Power Management Timer</code> register. This register has following structure:</p>
<pre><code>+-------------------------------+----------------------------------+
|                               |                                  |
|  upper eight bits of a        |      running count of the        |
| 32-bit power management timer |     power management timer       |
|                               |                                  |
+-------------------------------+----------------------------------+
31          E_TMR_VAL           24               TMR_VAL           0
</code></pre>
<p>Address of this register is stored in the <code>Fixed ACPI Description Table</code> <a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface">ACPI</a> table and we already have it in the <code>pmtmr_ioport</code>. So, the implementation of the <code>read_pmtmr</code> function is pretty easy:</p>
<pre><code class="language-C">static inline u32 read_pmtmr(void)
{
	return inl(pmtmr_ioport) &amp; ACPI_PM_MASK;
}
</code></pre>
<p>We just read the value of the <code>Power Management Timer</code> register and mask its <code>24</code> bits.</p>
<p>That's all. Now we move to the last clock source in this part - <code>Time Stamp Counter</code>.</p>
<h2 id="time-stamp-counter">Time Stamp Counter</h2>
<p>The third and last clock source in this part is - <a href="https://en.wikipedia.org/wiki/Time_Stamp_Counter">Time Stamp Counter</a> clock source and its implementation is located in the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/kernel/tsc.c">arch/x86/kernel/tsc.c</a> source code file. We already saw the <code>x86_late_time_init</code> function in this part and initialization of the <a href="https://en.wikipedia.org/wiki/Time_Stamp_Counter">Time Stamp Counter</a> starts from this place. This function calls the <code>tsc_init()</code> function from the <a href="https://github.com/torvalds/linux/blob/master/arch/x86/kernel/tsc.c">arch/x86/kernel/tsc.c</a> source code file.</p>
<p>At the beginning of the <code>tsc_init</code> function we can see check, which checks that a processor has support of the <code>Time Stamp Counter</code>:</p>
<pre><code class="language-C">void __init tsc_init(void)
{
	u64 lpj;
	int cpu;

	if (!cpu_has_tsc) {
		setup_clear_cpu_cap(X86_FEATURE_TSC_DEADLINE_TIMER);
		return;
	}
    ...
    ...
    ...
</code></pre>
<p>The <code>cpu_has_tsc</code> macro expands to the call of the <code>cpu_has</code> macro:</p>
<pre><code class="language-C">#define cpu_has_tsc		boot_cpu_has(X86_FEATURE_TSC)

#define boot_cpu_has(bit)	cpu_has(&amp;boot_cpu_data, bit)

#define cpu_has(c, bit)							\
	(__builtin_constant_p(bit) &amp;&amp; REQUIRED_MASK_BIT_SET(bit) ? 1 :	\
	 test_cpu_cap(c, bit))
</code></pre>
<p>which check the given bit (the <code>X86_FEATURE_TSC_DEADLINE_TIMER</code> in our case) in the <code>boot_cpu_data</code> array which is filled during early Linux kernel initialization. If the processor has support of the <code>Time Stamp Counter</code>, we get the frequency of the <code>Time Stamp Counter</code> by the call of the <code>calibrate_tsc</code> function from the same source code file which tries to get frequency from the different source like <a href="https://en.wikipedia.org/wiki/Model-specific_register">Model Specific Register</a>, calibrate over <a href="https://en.wikipedia.org/wiki/Programmable_interval_timer">programmable interval timer</a> and etc, after this we initialize frequency and scale factor for the all processors in the system:</p>
<pre><code class="language-C">tsc_khz = x86_platform.calibrate_tsc();
cpu_khz = tsc_khz;

for_each_possible_cpu(cpu) {
	cyc2ns_init(cpu);
	set_cyc2ns_scale(cpu_khz, cpu);
}
</code></pre>
<p>because only first bootstrap processor will call the <code>tsc_init</code>. After this we check hat <code>Time Stamp Counter</code> is not disabled:</p>
<pre><code>if (tsc_disabled &gt; 0)
	return;
...
...
...
check_system_tsc_reliable();
</code></pre>
<p>and call the <code>check_system_tsc_reliable</code> function which sets the <code>tsc_clocksource_reliable</code> if bootstrap processor has the <code>X86_FEATURE_TSC_RELIABLE</code> feature. Note that we went through the <code>tsc_init</code> function, but did not register our clock source. Actual registration of the <code>Time Stamp Counter</code> clock source occurs in the:</p>
<pre><code class="language-C">static int __init init_tsc_clocksource(void)
{
	if (!cpu_has_tsc || tsc_disabled &gt; 0 || !tsc_khz)
		return 0;
    ...
    ...
    ...
    if (boot_cpu_has(X86_FEATURE_TSC_RELIABLE)) {
		clocksource_register_khz(&amp;clocksource_tsc, tsc_khz);
		return 0;
	}
</code></pre>
<p>function. This function called during the <code>device</code> <a href="http://www.compsoc.man.ac.uk/~moz/kernelnewbies/documents/initcall/kernel.html">initcall</a>. We do it to be sure that the <code>Time Stamp Counter</code> clock source will be registered after the <a href="https://en.wikipedia.org/wiki/High_Precision_Event_Timer">High Precision Event Timer</a> clock source.</p>
<p>After these all three clock sources will be registered in the <code>clocksource</code> framework and the <code>Time Stamp Counter</code> clock source will be selected as active, because it has the highest rating among other clock sources:</p>
<pre><code class="language-C">static struct clocksource clocksource_tsc = {
	.name                   = "tsc",
	.rating                 = 300,
	.read                   = read_tsc,
	.mask                   = CLOCKSOURCE_MASK(64),
	.flags                  = CLOCK_SOURCE_IS_CONTINUOUS | CLOCK_SOURCE_MUST_VERIFY,
	.archdata               = { .vclock_mode = VCLOCK_TSC },
};
</code></pre>
<p>That's all.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This is the end of the sixth part of the <a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/Timers/index.html">chapter</a> that describes timers and timer management related stuff in the Linux kernel. In the previous part got acquainted with the <code>clockevents</code> framework. In this part we continued to learn time management related stuff in the Linux kernel and saw a little about three different clock sources which are used in the <a href="https://en.wikipedia.org/wiki/X86">x86</a> architecture. The next part will be last part of this <a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/Timers/index.html">chapter</a> and we will see some user space related stuff, i.e. how some time related <a href="https://en.wikipedia.org/wiki/System_call">system calls</a> implemented in the Linux kernel.</p>
<p>If you have questions or suggestions, feel free to ping me in twitter <a href="https://twitter.com/0xAX">0xAX</a>, drop me <a href="anotherworldofworld@gmail.com">email</a> or just create <a href="https://github.com/MintCN/linux-insides-zh/issues/new">issue</a>.</p>
<p><strong>Please note that English is not my first language and I am really sorry for any inconvenience. If you found any mistakes please send me PR to <a href="https://github.com/MintCN/linux-insides-zh">linux-insides</a>.</strong></p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/X86">x86</a></li>
<li><a href="https://en.wikipedia.org/wiki/Sysfs">sysfs</a></li>
<li><a href="https://en.wikipedia.org/wiki/Time_Stamp_Counter">Time Stamp Counter</a></li>
<li><a href="https://en.wikipedia.org/wiki/High_Precision_Event_Timer">High Precision Event Timer</a></li>
<li><a href="http://uefi.org/sites/default/files/resources/ACPI_5.pdf">ACPI Power Management Timer (PDF)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Frequency">frequency</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/Dmesg">dmesg</a></li>
<li><a href="https://en.wikipedia.org/wiki/Programmable_interval_timer">programmable interval timer</a></li>
<li><a href="https://en.wikipedia.org/wiki/Interrupt_request_%28PC_architecture%29">IRQ</a></li>
<li><a href="http://www.intel.com/content/dam/www/public/us/en/documents/technical-specifications/software-developers-hpet-spec-1-0a.pdf">IA-PC HPET (High Precision Event Timers) Specification</a></li>
<li><a href="https://en.wikipedia.org/wiki/Interrupt_request_%28PC_architecture%29#Master_PIC">IRQ0</a></li>
<li><a href="https://en.wikipedia.org/wiki/Intel_8259">i8259</a></li>
<li><a href="http://www.compsoc.man.ac.uk/~moz/kernelnewbies/documents/initcall/kernel.html">initcall</a></li>
<li><a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/Timers/timers-5.html">previous part</a></li>
</ul>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/181/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/181/index.html">命令行的艺术</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/101.html">jlevy</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">34页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月26日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 46710个">46710</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/29/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/29/index.html">雪城大学计算机与网络安全讲义</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/15.html">wizardforcel</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">10页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 7个">7</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/28/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/28/index.html">笨办法学 Linux</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/15.html">wizardforcel</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">34页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 326个">326</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/42/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/docker_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/42/index.html">Docker-從入門到實踐</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/22.html">jasonblog</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="docker">docker</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">82页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月30日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 1个">1</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/38/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/java_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/38/index.html">Java资源大全中文版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/19.html">伯乐在线</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="java">java</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">61页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月23日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 7938个">7938</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/161/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/python_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/161/index.html">关于python的面试题</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/92.html">jackfrued</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="python">python</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">271页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月26日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 33个">33</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../../" title="返回首页"><img class="" src="../../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../../book/104/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../../book/104/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/README.html" title="简介" data-book-page-rel-url="README.html" data-book-page-id="7458">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/README.html" title="引导" data-book-page-rel-url="Booting/README.html" data-book-page-id="7459">引导</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-1.html" title="从引导加载程序内核" data-book-page-rel-url="Booting/linux-bootstrap-1.html" data-book-page-id="7460">从引导加载程序内核</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-2.html" title="在内核安装代码的第一步" data-book-page-rel-url="Booting/linux-bootstrap-2.html" data-book-page-id="7461">在内核安装代码的第一步</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-3.html" title="视频模式初始化和转换到保护模式" data-book-page-rel-url="Booting/linux-bootstrap-3.html" data-book-page-id="7462">视频模式初始化和转换到保护模式</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-4.html" title="过渡到 64 位模式" data-book-page-rel-url="Booting/linux-bootstrap-4.html" data-book-page-id="7463">过渡到 64 位模式</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Booting/linux-bootstrap-5.html" title="内核解压缩" data-book-page-rel-url="Booting/linux-bootstrap-5.html" data-book-page-id="7464">内核解压缩</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/README.html" title="初始化" data-book-page-rel-url="Initialization/README.html" data-book-page-id="7465">初始化</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-1.html" title="内核解压之后的首要步骤" data-book-page-rel-url="Initialization/linux-initialization-1.html" data-book-page-id="7466">内核解压之后的首要步骤</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-2.html" title="早期的中断和异常控制" data-book-page-rel-url="Initialization/linux-initialization-2.html" data-book-page-id="7467">早期的中断和异常控制</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-3.html" title="在到达内核入口之前最后的准备" data-book-page-rel-url="Initialization/linux-initialization-3.html" data-book-page-id="7468">在到达内核入口之前最后的准备</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-4.html" title="内核入口 - start_kernel" data-book-page-rel-url="Initialization/linux-initialization-4.html" data-book-page-id="7469">内核入口 - start_kernel</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-5.html" title="体系架构初始化" data-book-page-rel-url="Initialization/linux-initialization-5.html" data-book-page-id="7470">体系架构初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-6.html" title="进一步初始化指定体系架构" data-book-page-rel-url="Initialization/linux-initialization-6.html" data-book-page-id="7471">进一步初始化指定体系架构</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-7.html" title="最后对指定体系架构初始化" data-book-page-rel-url="Initialization/linux-initialization-7.html" data-book-page-id="7472">最后对指定体系架构初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-8.html" title="调度器初始化" data-book-page-rel-url="Initialization/linux-initialization-8.html" data-book-page-id="7473">调度器初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-9.html" title="RCU 初始化" data-book-page-rel-url="Initialization/linux-initialization-9.html" data-book-page-id="7474">RCU 初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Initialization/linux-initialization-10.html" title="初始化结束" data-book-page-rel-url="Initialization/linux-initialization-10.html" data-book-page-id="7475">初始化结束</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/README.html" title="中断" data-book-page-rel-url="Interrupts/README.html" data-book-page-id="7476">中断</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-1.html" title="中断和中断处理 Part 1." data-book-page-rel-url="Interrupts/interrupts-1.html" data-book-page-id="7477">中断和中断处理 Part 1.</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-2.html" title="深入 Linux 内核中的中断" data-book-page-rel-url="Interrupts/interrupts-2.html" data-book-page-id="7478">深入 Linux 内核中的中断</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-3.html" title="初步中断处理" data-book-page-rel-url="Interrupts/interrupts-3.html" data-book-page-id="7479">初步中断处理</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-4.html" title="中断处理" data-book-page-rel-url="Interrupts/interrupts-4.html" data-book-page-id="7480">中断处理</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-5.html" title="异常处理的实现" data-book-page-rel-url="Interrupts/interrupts-5.html" data-book-page-id="7481">异常处理的实现</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-6.html" title="处理不可屏蔽中断" data-book-page-rel-url="Interrupts/interrupts-6.html" data-book-page-id="7482">处理不可屏蔽中断</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-7.html" title="深入外部硬件中断" data-book-page-rel-url="Interrupts/interrupts-7.html" data-book-page-id="7483">深入外部硬件中断</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-8.html" title="IRQs的非早期初始化" data-book-page-rel-url="Interrupts/interrupts-8.html" data-book-page-id="7484">IRQs的非早期初始化</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-9.html" title="Softirq, Tasklets and Workqueues" data-book-page-rel-url="Interrupts/interrupts-9.html" data-book-page-id="7485">Softirq, Tasklets and Workqueues</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Interrupts/interrupts-10.html" title="最后一部分" data-book-page-rel-url="Interrupts/interrupts-10.html" data-book-page-id="7486">最后一部分</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/SysCall/README.html" title="系统调用" data-book-page-rel-url="SysCall/README.html" data-book-page-id="7487">系统调用</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/SysCall/syscall-1.html" title="系统调用概念简介" data-book-page-rel-url="SysCall/syscall-1.html" data-book-page-id="7488">系统调用概念简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SysCall/syscall-2.html" title="Linux 内核如何处理系统调用" data-book-page-rel-url="SysCall/syscall-2.html" data-book-page-id="7489">Linux 内核如何处理系统调用</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SysCall/syscall-3.html" title="vsyscall and vDSO" data-book-page-rel-url="SysCall/syscall-3.html" data-book-page-id="7490">vsyscall and vDSO</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SysCall/syscall-4.html" title="Linux 内核如何运行程序" data-book-page-rel-url="SysCall/syscall-4.html" data-book-page-id="7491">Linux 内核如何运行程序</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/README.html" title="定时器和时钟管理" data-book-page-rel-url="Timers/README.html" data-book-page-id="7492">定时器和时钟管理</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-1.html" title="简介" data-book-page-rel-url="Timers/timers-1.html" data-book-page-id="7493">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-2.html" title="时钟源框架简介" data-book-page-rel-url="Timers/timers-2.html" data-book-page-id="7494">时钟源框架简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-3.html" title="The tick broadcast framework and dyntick" data-book-page-rel-url="Timers/timers-3.html" data-book-page-id="7495">The tick broadcast framework and dyntick</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-4.html" title="定时器介绍" data-book-page-rel-url="Timers/timers-4.html" data-book-page-id="7496">定时器介绍</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-5.html" title="Clockevents 框架简介" data-book-page-rel-url="Timers/timers-5.html" data-book-page-id="7497">Clockevents 框架简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-6.html" title="x86 相关的时钟源" data-book-page-rel-url="Timers/timers-6.html" data-book-page-id="7498">x86 相关的时钟源</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Timers/timers-7.html" title="Linux 内核中与时钟相关的系统调用" data-book-page-rel-url="Timers/timers-7.html" data-book-page-id="7499">Linux 内核中与时钟相关的系统调用</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/README.html" title="同步原语" data-book-page-rel-url="SyncPrim/README.html" data-book-page-id="7500">同步原语</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-1.html" title="自旋锁简介" data-book-page-rel-url="SyncPrim/sync-1.html" data-book-page-id="7501">自旋锁简介</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-2.html" title="队列自旋锁" data-book-page-rel-url="SyncPrim/sync-2.html" data-book-page-id="7502">队列自旋锁</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-3.html" title="信号量" data-book-page-rel-url="SyncPrim/sync-3.html" data-book-page-id="7503">信号量</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-4.html" title="互斥锁" data-book-page-rel-url="SyncPrim/sync-4.html" data-book-page-id="7504">互斥锁</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-5.html" title="读者/写者信号量" data-book-page-rel-url="SyncPrim/sync-5.html" data-book-page-id="7505">读者/写者信号量</a>
</li>
<li>
<a class="pjax" href="../../../book/104/SyncPrim/sync-6.html" title="顺序锁" data-book-page-rel-url="SyncPrim/sync-6.html" data-book-page-id="7506">顺序锁</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/MM/README.html" title="内存管理" data-book-page-rel-url="MM/README.html" data-book-page-id="7508">内存管理</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/MM/linux-mm-1.html" title="内存块" data-book-page-rel-url="MM/linux-mm-1.html" data-book-page-id="7509">内存块</a>
</li>
<li>
<a class="pjax" href="../../../book/104/MM/linux-mm-2.html" title="固定映射地址和 ioremap" data-book-page-rel-url="MM/linux-mm-2.html" data-book-page-id="7510">固定映射地址和 ioremap</a>
</li>
<li>
<a class="pjax" href="../../../book/104/MM/linux-mm-3.html" title="kmemcheck" data-book-page-rel-url="MM/linux-mm-3.html" data-book-page-id="7511">kmemcheck</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Concepts/README.html" title="概念" data-book-page-rel-url="Concepts/README.html" data-book-page-id="7512">概念</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Concepts/per-cpu.html" title="每个 CPU 的变量" data-book-page-rel-url="Concepts/per-cpu.html" data-book-page-id="7513">每个 CPU 的变量</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Concepts/cpumask.html" title="CPU 掩码" data-book-page-rel-url="Concepts/cpumask.html" data-book-page-id="7514">CPU 掩码</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Concepts/initcall.html" title="initcall 机制" data-book-page-rel-url="Concepts/initcall.html" data-book-page-id="7515">initcall 机制</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Concepts/notification_chains.html" title="Linux 内核的通知链" data-book-page-rel-url="Concepts/notification_chains.html" data-book-page-id="7516">Linux 内核的通知链</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/DataStructures/README.html" title="Linux 内核中的数据结构" data-book-page-rel-url="DataStructures/README.html" data-book-page-id="7517">Linux 内核中的数据结构</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/DataStructures/dlist.html" title="双向链表" data-book-page-rel-url="DataStructures/dlist.html" data-book-page-id="7518">双向链表</a>
</li>
<li>
<a class="pjax" href="../../../book/104/DataStructures/radix-tree.html" title="基数树" data-book-page-rel-url="DataStructures/radix-tree.html" data-book-page-id="7519">基数树</a>
</li>
<li>
<a class="pjax" href="../../../book/104/DataStructures/bitmap.html" title="位数组" data-book-page-rel-url="DataStructures/bitmap.html" data-book-page-id="7520">位数组</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Theory/README.html" title="理论" data-book-page-rel-url="Theory/README.html" data-book-page-id="7521">理论</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Theory/Paging.html" title="分页" data-book-page-rel-url="Theory/Paging.html" data-book-page-id="7522">分页</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Theory/ELF.html" title="Elf64 格式" data-book-page-rel-url="Theory/ELF.html" data-book-page-id="7523">Elf64 格式</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/Misc/README.html" title="杂项" data-book-page-rel-url="Misc/README.html" data-book-page-id="7524">杂项</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/Misc/how_kernel_compiled.html" title="内核编译方法" data-book-page-rel-url="Misc/how_kernel_compiled.html" data-book-page-id="7525">内核编译方法</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Misc/linkers.html" title="链接器" data-book-page-rel-url="Misc/linkers.html" data-book-page-id="7526">链接器</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Misc/contribute.html" title="Linux 内核开发" data-book-page-rel-url="Misc/contribute.html" data-book-page-id="7527">Linux 内核开发</a>
</li>
<li>
<a class="pjax" href="../../../book/104/Misc/program_startup.html" title="用户空间的程序启动过程" data-book-page-rel-url="Misc/program_startup.html" data-book-page-id="7528">用户空间的程序启动过程</a>
</li>
<li>
<a class="pjax" href="../../../book/104/" title="Write and Submit your first Linux kernel Patch" data-book-page-rel-url="" data-book-page-id="7507">Write and Submit your first Linux kernel Patch</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/KernelStructures/README.html" title="内核数据结构" data-book-page-rel-url="KernelStructures/README.html" data-book-page-id="7529">内核数据结构</a>
<ul>
<li>
<a class="pjax" href="../../../book/104/KernelStructures/idt.html" title="中断描述符表" data-book-page-rel-url="KernelStructures/idt.html" data-book-page-id="7530">中断描述符表</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/104/LINKS.html" title="有帮助的链接" data-book-page-rel-url="LINKS.html" data-book-page-id="7531">有帮助的链接</a>
</li>
<li>
<a class="pjax" href="../../../book/104/contributors.html" title="贡献者" data-book-page-rel-url="contributors.html" data-book-page-id="7532">贡献者</a>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =104;var bookPageId =7498;var bookPageRelUrl ='Timers/timers-6.html';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>