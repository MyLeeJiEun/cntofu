
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>Securing Apache HBase-HBase中文参考指南 3.0</title>
<meta content='Securing Apache HBase,HBase中文参考指南 3.0' name='keywords'>
<meta content='Securing Apache HBase,HBase中文参考指南 3.0' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../../static/components/css/base.css">
<link rel="stylesheet" href="../../../static/components/css/reader.css">
<link rel="stylesheet" href="../../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-left ">
<a href="../../../book/173/docs/8.html">
<i class="nav-icon-left uk-icon-small  uk-icon-caret-left"></i>
<span class="">HBase and M..</span>
</a>
</div>
<div class="uk-align-right ">
<a href="../../../book/173/docs/10.html">
<span class="">Architecture</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../../book/173/index.html">HBase中文参考指南 3.0</a>
<a target="_blank" rel="nofollow" href="https://github.com/apachecn/hbase-doc-zh" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<h1 id="保护-apache-hbase">保护 Apache HBase</h1>
<blockquote>
<p>报告安全漏洞</p>
<p>为了保护现有的 HBase 安装免受攻击，请<strong>不要</strong>使用 JIRA 报告与安全相关的错误。相反，将您的报告发送到邮件列表 <a href="mailto:private@hbase.apache.org">private@hbase.apache.org</a> ，允许任何人发送邮件，但限制谁可以阅读它们。该列表中的某个人将与您联系以跟进您的报告。 |</p>
<p>HBase 遵守 Apache Software Foundation 关于报告的漏洞的政策，可在 <a href="http://apache.org/security/">http://apache.org/security/</a> 上找到。</p>
<p>如果您希望发送加密报告，可以使用为常规 ASF 安全列表提供的 GPG 详细信息。这可能会增加报告的响应时间。</p>
</blockquote>
<p>HBase 提供了保护 HBase 的各种组件和方面的机制，以及它与 Hadoop 基础架构的其余部分以及 Hadoop 之外的客户端和资源的关系。</p>
<h2 id="59对-web-ui-使用安全-httphttps">59.对 Web UI 使用安全 HTTP（HTTPS）</h2>
<p>默认 HBase 安装为主服务器和区域服务器的 Web UI 使用不安全的 HTTP 连接。要改为启用安全 HTTP（HTTPS）连接，请在 <em>hbase-site.xml</em> 中将<code>hbase.ssl.enabled</code>设置为<code>true</code>。这不会更改 Web UI 使用的端口。要更改给定 HBase 组件的 Web UI 端口，请在 hbase-site.xml 中配置该端口的设置。这些设置是：</p>
<ul>
<li> <p><code>hbase.master.info.port</code></p> </li>
<li> <p><code>hbase.regionserver.info.port</code></p> </li>
</ul>
<blockquote>
<p>如果启用 HTTPS，则客户端应避免使用非安全 HTTP 连接。</p>
<p>如果启用安全 HTTP，客户端应使用<code>https://</code> URL 连接到 HBase。使用<code>http://</code> URL 的客户端将收到<code>200</code>的 HTTP 响应，但不会接收任何数据。记录以下异常：</p>
<pre><code>javax.net.ssl.SSLException: Unrecognized SSL message, plaintext connection? 
</code></pre>
<p>这是因为相同的端口用于 HTTP 和 HTTPS。</p>
<p>HBase 将 Jetty 用于 Web UI。如果不修改 Jetty 本身，似乎不可能将 Jetty 配置为在同一主机上将一个端口重定向到另一个端口。有关更多信息，请参阅 Nick Dimiduk 对此 <a href="http://stackoverflow.com/questions/20611815/redirect-from-http-to-https-in-jetty">Stack Overflow</a> 线程的贡献。如果您知道如何在不打开 HTTPS 的第二个端口的情况下解决这个问题，那么补丁将受到赞赏</p>
</blockquote>
<h2 id="60使用-spnego-进行-web-ui-的-kerberos-身份验证">60.使用 SPNEGO 进行 Web UI 的 Kerberos 身份验证</h2>
<p>可以通过使用 <em>hbase-site.xml</em> 中的<code>hbase.security.authentication.ui</code>属性配置 SPNEGO 来启用对 HBase Web UI 的 Kerberos 身份验证。启用此身份验证要求 HBase 还配置为对 RPC 使用 Kerberos 身份验证（例如<code>hbase.security.authentication</code> = <code>kerberos</code>）。</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authentication.ui&lt;/name&gt;
  &lt;value&gt;kerberos&lt;/value&gt;
  &lt;description&gt;Controls what kind of authentication should be used for the HBase web UIs.&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.authentication&lt;/name&gt;
  &lt;value&gt;kerberos&lt;/value&gt;
  &lt;description&gt;The Kerberos keytab file to use for SPNEGO authentication by the web server.&lt;/description&gt;
&lt;/property&gt; 
</code></pre>
<p>存在许多用于为 Web 服务器配置 SPNEGO 身份验证的属性：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authentication.spnego.kerberos.principal&lt;/name&gt;
  &lt;value&gt;HTTP/_HOST@EXAMPLE.COM&lt;/value&gt;
  &lt;description&gt;Required for SPNEGO, the Kerberos principal to use for SPNEGO authentication by the
  web server. The _HOST keyword will be automatically substituted with the node's
  hostname.&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.authentication.spnego.kerberos.keytab&lt;/name&gt;
  &lt;value&gt;/etc/security/keytabs/spnego.service.keytab&lt;/value&gt;
  &lt;description&gt;Required for SPNEGO, the Kerberos keytab file to use for SPNEGO authentication by the
  web server.&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.authentication.spnego.kerberos.name.rules&lt;/name&gt;
  &lt;value&gt;&lt;/value&gt;
  &lt;description&gt;Optional, Hadoop-style `auth_to_local` rules which will be parsed and used in the
  handling of Kerberos principals&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.authentication.signature.secret.file&lt;/name&gt;
  &lt;value&gt;&lt;/value&gt;
  &lt;description&gt;Optional, a file whose contents will be used as a secret to sign the HTTP cookies
  as a part of the SPNEGO authentication handshake. If this is not provided, Java's `Random` library
  will be used for the secret.&lt;/description&gt;
&lt;/property&gt; 
</code></pre>
<h2 id="61安全客户端访问-apache-hbase">61.安全客户端访问 Apache HBase</h2>
<p>较新版本的 Apache HBase（＆gt; = 0.92）支持客户端的可选 SASL 身份验证。另见 Matteo Bertozzi 关于<a href="https://blog.cloudera.com/blog/2012/09/understanding-user-authentication-and-authorization-in-apache-hbase/">了解 Apache HBase 中用户认证和授权的文章</a>。</p>
<p>介绍如何设置 Apache HBase 和客户端以连接到安全的 HBase 资源。</p>
<h3 id="611先决条件">61.1。先决条件</h3>
<p>Hadoop 身份验证配置</p>
<p>要使用强身份验证运行 HBase RPC，必须将<code>hbase.security.authentication</code>设置为<code>kerberos</code>。在这种情况下，还必须在 core-site.xml 中将<code>hadoop.security.authentication</code>设置为<code>kerberos</code>。否则，您将对 HBase 使用强身份验证，但不会对底层 HDFS 使用强身份验证，这将取消任何好处。</p>
<p>Kerberos KDC</p>
<p>您需要有一个有效的 Kerberos KDC。</p>
<h3 id="612用于安全操作的服务器端配置">61.2。用于安全操作的服务器端配置</h3>
<p>首先，请参阅 <a href="#security.prerequisites">security.prerequisites</a> 并确保您的基础 HDFS 配置是安全的。</p>
<p>将以下内容添加到群集中每台服务器上的<code>hbase-site.xml</code>文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authentication&lt;/name&gt;
  &lt;value&gt;kerberos&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;hbase.coprocessor.region.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.token.TokenProvider&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>部署这些配置更改时，需要完全关闭并重新启动 HBase 服务。</p>
<h3 id="613用于安全操作的客户端配置">61.3。用于安全操作的客户端配置</h3>
<p>首先，请参阅<a href="#security.prerequisites">先决条件</a>并确保您的基础 HDFS 配置是安全的。</p>
<p>将以下内容添加到每个客户端上的<code>hbase-site.xml</code>文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authentication&lt;/name&gt;
  &lt;value&gt;kerberos&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>在 2.2.0 版之前，客户端环境必须通过<code>kinit</code>命令从 KDC 或 keytab 登录到 Kerberos，然后才能与 HBase 集群进行通信。</p>
<p>从 2.2.0 开始，客户端可以在<code>hbase-site.xml</code>中指定以下配置：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.client.keytab.file&lt;/name&gt;
  &lt;value&gt;/local/path/to/client/keytab&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;hbase.client.keytab.principal&lt;/name&gt;
  &lt;value&gt;foo@EXAMPLE.COM&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>然后，应用程序可以自动执行登录和凭据续订作业，而不会受到客户端干扰。</p>
<p>它是可选功能，客户端升级到 2.2.0，只要保持<code>hbase.client.keytab.file</code>和<code>hbase.client.keytab.principal</code>未设置，它仍然可以保留旧版本中的登录和凭证更新逻辑。</p>
<p>请注意，如果客户端和服务器端站点文件中的<code>hbase.security.authentication</code>不匹配，则客户端将无法与群集通信。</p>
<p>将 HBase 配置为安全 RPC 后，可以选择配置加密通信。为此，请将以下内容添加到每个客户端上的<code>hbase-site.xml</code>文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.rpc.protection&lt;/name&gt;
  &lt;value&gt;privacy&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>此配置属性也可以基于每个连接进行设置。将其设置在<code>Table</code>提供的<code>Configuration</code>中：</p>
<pre><code>Configuration conf = HBaseConfiguration.create();
Connection connection = ConnectionFactory.createConnection(conf);
conf.set("hbase.rpc.protection", "privacy");
try (Connection connection = ConnectionFactory.createConnection(conf);
     Table table = connection.getTable(TableName.valueOf(tablename))) {
  .... do your stuff
} 
</code></pre>
<p>对于加密通信，预计性能损失约为 10％。</p>
<h3 id="614用于安全操作的客户端配置---thrift-gateway">61.4。用于安全操作的客户端配置 - Thrift Gateway</h3>
<p>将以下内容添加到每个 Thrift 网关的<code>hbase-site.xml</code>文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.thrift.keytab.file&lt;/name&gt;
  &lt;value&gt;/etc/hbase/conf/hbase.keytab&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.thrift.kerberos.principal&lt;/name&gt;
  &lt;value&gt;$USER/_HOST@HADOOP.LOCALDOMAIN&lt;/value&gt;
  &lt;!-- TODO: This may need to be  HTTP/_HOST@&lt;REALM&gt; and _HOST may not work.
   You may have  to put the concrete full hostname.
   --&gt;
&lt;/property&gt;
&lt;!-- Add these if you need to configure a different DNS interface from the default --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.thrift.dns.interface&lt;/name&gt;
  &lt;value&gt;default&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.thrift.dns.nameserver&lt;/name&gt;
  &lt;value&gt;default&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>分别用 <em>$ USER</em> 和 <em>$ KEYTAB</em> 替换相应的凭证和密钥表。</p>
<p>为了使用 Thrift API 主体与 HBase 交互，还需要将<code>hbase.thrift.kerberos.principal</code>添加到<code>_acl_</code>表中。例如，要给 Thrift API 主体，<code>thrift_server</code>，管理访问权限，这样的命令就足够了：</p>
<pre><code>grant 'thrift_server', 'RWCA' 
</code></pre>
<p>有关 ACL 的更多信息，请参阅<a href="#hbase.accesscontrol.configuration">访问控制标签（ACL）</a>部分</p>
<p>Thrift 网关将使用提供的凭证对 HBase 进行身份验证。 Thrift 网关本身不会执行任何身份验证。通过 Thrift 网关进行的所有客户端访问都将使用 Thrift 网关的凭证并享有其特权。</p>
<h3 id="615配置-thrift-网关以代表客户端进行身份验证">61.5。配置 Thrift 网关以代表客户端进行身份验证</h3>
<p><a href="#security.client.thrift">安全操作的客户端配置 - Thrift Gateway</a> 描述了如何使用固定用户对 Thrift 客户端进行 HBase 认证。作为替代方案，您可以将 Thrift 网关配置为代表客户端对 HBase 进行身份验证，并使用代理用户访问 HBase。这在用于 Thrift 1 的 <a href="https://issues.apache.org/jira/browse/HBASE-11349">HBASE-11349</a> 和用于 Thrift 2 的 <a href="https://issues.apache.org/jira/browse/HBASE-11474">HBASE-11474</a> 中实施。</p>
<blockquote>
<p>Thrift Framed Transpor 的限制</p>
<p>如果您使用框架式传输，则无法利用此功能，因为此时 SASL 不适用于 Thrift 框架传输。</p>
</blockquote>
<p>要启用它，请执行以下操作。</p>
<ol>
<li> <p>按照<a href="#security.client.thrift">安全操作的客户端配置 - Thrift Gateway</a> 中所述的步骤，确保 Thrift 在安全模式下运行。</p> </li>
<li> <p>确保 HBase 配置为允许代理用户，如 <a href="#security.rest.gateway">REST 网关模拟配置</a>中所述。</p> </li>
<li> <p>在运行 Thrift 网关的每个群集节点的 <em>hbase-site.xml</em> 中，将属性<code>hbase.thrift.security.qop</code>设置为以下三个值之一：</p>
<ul>
<li> <p><code>privacy</code> - 身份验证，完整性和机密性检查。</p> </li>
<li> <p><code>integrity</code> - 身份验证和完整性检查</p> </li>
<li> <p><code>authentication</code> - 仅验证身份验证</p> </li>
</ul> </li>
<li> <p>重新启动 Thrift 网关进程以使更改生效。如果节点正在运行 Thrift，则<code>jps</code>命令的输出将列出<code>ThriftServer</code>进程。要在节点上停止 Thrift，请运行命令<code>bin/hbase-daemon.sh stop thrift</code>。要在节点上启动 Thrift，请运行命令<code>bin/hbase-daemon.sh start thrift</code>。</p> </li>
</ol>
<h3 id="616配置-thrift-网关以使用doas功能">61.6。配置 Thrift 网关以使用<code>doAs</code>功能</h3>
<p><a href="#security.gateway.thrift">配置 Thrift 网关以代表客户端进行身份验证</a>描述如何配置 Thrift 网关以代表客户端对 HBase 进行身份验证，以及如何使用代理用户访问 HBase。此方法的局限性在于，使用一组特定凭据初始化客户端后，它无法在会话期间更改这些凭据。 <code>doAs</code>功能提供了一种使用同一客户端模拟多个主体的灵活方式。此功能在 <a href="https://issues.apache.org/jira/browse/HBASE-12640">HBASE-12640</a> 中针对 Thrift 1 实施，但目前不适用于 Thrift 2。</p>
<p><strong>要启用<code>doAs</code>功能</strong>，请将以下内容添加到每个 Thrift 网关的 <em>hbase-site.xml</em> 文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.regionserver.thrift.http&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.thrift.support.proxyuser&lt;/name&gt;
  &lt;value&gt;true/value&gt;
&lt;/property&gt; 
</code></pre>
<p><strong>要在使用<code>doAs</code>模拟时允许代理用户</strong>，请将以下内容添加到每个 HBase 节点的 <em>hbase-site.xml</em> 文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hadoop.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.proxyuser.$USER.groups&lt;/name&gt;
  &lt;value&gt;$GROUPS&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.proxyuser.$USER.hosts&lt;/name&gt;
  &lt;value&gt;$GROUPS&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>看看<a href="https://github.com/apache/hbase/blob/master/hbase-examples/src/main/java/org/apache/hadoop/hbase/thrift/HttpDoAsClient.java">演示客户端</a>，了解如何在客户端使用此功能。</p>
<h3 id="617用于安全操作的客户端配置---rest-网关">61.7。用于安全操作的客户端配置 - REST 网关</h3>
<p>将以下内容添加到每个 REST 网关的<code>hbase-site.xml</code>文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.rest.keytab.file&lt;/name&gt;
  &lt;value&gt;$KEYTAB&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rest.kerberos.principal&lt;/name&gt;
  &lt;value&gt;$USER/_HOST@HADOOP.LOCALDOMAIN&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>Substitute the appropriate credential and keytab for <em>$USER</em> and <em>$KEYTAB</em> respectively.</p>
<p>REST 网关将使用提供的凭据通过 HBase 进行身份验证。</p>
<p>为了使用 REST API 主体与 HBase 交互，还需要将<code>hbase.rest.kerberos.principal</code>添加到<code>_acl_</code>表。例如，要给出 REST API 主体，<code>rest_server</code>，管理访问权限，这样的命令就足够了：</p>
<pre><code>grant 'rest_server', 'RWCA' 
</code></pre>
<p>For more information about ACLs, please see the <a href="#hbase.accesscontrol.configuration">Access Control Labels (ACLs)</a> section</p>
<p>HBase REST 网关支持 <a href="https://hadoop.apache.org/docs/stable/hadoop-auth/index.html">SPNEGO HTTP 身份验证</a>，以便客户端访问网关。要为客户端访问启用 REST 网关 Kerberos 身份验证，请将以下内容添加到每个 REST 网关的<code>hbase-site.xml</code>文件中。</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.rest.support.proxyuser&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rest.authentication.type&lt;/name&gt;
  &lt;value&gt;kerberos&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rest.authentication.kerberos.principal&lt;/name&gt;
  &lt;value&gt;HTTP/_HOST@HADOOP.LOCALDOMAIN&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rest.authentication.kerberos.keytab&lt;/name&gt;
  &lt;value&gt;$KEYTAB&lt;/value&gt;
&lt;/property&gt;
&lt;!-- Add these if you need to configure a different DNS interface from the default --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rest.dns.interface&lt;/name&gt;
  &lt;value&gt;default&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rest.dns.nameserver&lt;/name&gt;
  &lt;value&gt;default&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>用 <em>$ KEYTAB</em> 替换 HTTP 的密钥表。</p>
<p>HBase REST 网关支持不同的'hbase.rest.authentication.type'：simple，kerberos。您还可以通过实现 Hadoop AuthenticationHandler 来实现自定义身份验证，然后将完整的类名指定为“hbase.rest.authentication.type”值。有关更多信息，请参阅 <a href="https://hadoop.apache.org/docs/stable/hadoop-auth/index.html">SPNEGO HTTP 身份验证</a>。</p>
<h3 id="618-rest-网关模拟配置">61.8。 REST 网关模拟配置</h3>
<p>默认情况下，REST 网关不支持模拟。它代表客户端访问 HBase，就像上一节中配置的用户一样。对于 HBase 服务器，所有请求都来自 REST 网关用户。实际用户不详。您可以打开模拟支持。通过模拟，REST 网关用户是代理用户。 HBase 服务器知道每个请求的实际/真实用户。所以它可以应用适当的授权。</p>
<p>要打开 REST 网关模拟，我们需要配置 HBase 服务器（主服务器和区域服务器）以允许代理用户;配置 REST 网关以启用模拟。</p>
<p>要允许代理用户，请将以下内容添加到每个 HBase 服务器的<code>hbase-site.xml</code>文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hadoop.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.proxyuser.$USER.groups&lt;/name&gt;
  &lt;value&gt;$GROUPS&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.proxyuser.$USER.hosts&lt;/name&gt;
  &lt;value&gt;$GROUPS&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>用 <em>$ USER</em> 替换 REST 网关代理用户，用 <em>$ GROUPS</em> 替换允许的组列表。</p>
<p>要启用 REST 网关模拟，请将以下内容添加到每个 REST 网关的<code>hbase-site.xml</code>文件中。</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.rest.authentication.type&lt;/name&gt;
  &lt;value&gt;kerberos&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rest.authentication.kerberos.principal&lt;/name&gt;
  &lt;value&gt;HTTP/_HOST@HADOOP.LOCALDOMAIN&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rest.authentication.kerberos.keytab&lt;/name&gt;
  &lt;value&gt;$KEYTAB&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>Substitute the keytab for HTTP for <em>$KEYTAB</em>.</p>
<h2 id="62-apache-hbase-的简单用户访问">62. Apache HBase 的简单用户访问</h2>
<p>Newer releases of Apache HBase (&gt;= 0.92) support optional SASL authentication of clients. See also Matteo Bertozzi’s article on <a href="https://blog.cloudera.com/blog/2012/09/understanding-user-authentication-and-authorization-in-apache-hbase/">Understanding User Authentication and Authorization in Apache HBase</a>.</p>
<p>介绍如何设置 Apache HBase 和客户端，以便用户轻松访问 HBase 资源。</p>
<h3 id="621简单与安全访问">62.1。简单与安全访问</h3>
<p>以下部分显示如何设置简单用户访问权限。简单的用户访问不是一种安全的 HBase 操作方法。此方法用于防止用户犯错误。它可用于在开发系统上模拟访问控制，而无需设置 Kerberos。</p>
<p>此方法不用于防止恶意或黑客攻击。要使 HBase 对这些类型的攻击安全，您必须配置 HBase 以确保安全操作。请参阅<a href="#hbase.secure.configuration">安全客户端访问 Apache HBase</a> 部分并完成其中描述的所有步骤。</p>
<h3 id="622先决条件">62.2。先决条件</h3>
<p>没有</p>
<h3 id="623用于简单用户访问操作的服务器端配置">62.3。用于简单用户访问操作的服务器端配置</h3>
<p>Add the following to the <code>hbase-site.xml</code> file on every server machine in the cluster:</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authentication&lt;/name&gt;
  &lt;value&gt;simple&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.master.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.region.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.regionserver.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>对于 0.94，将以下内容添加到群集中每台服务器计算机上的<code>hbase-site.xml</code>文件中：</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.rpc.engine&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.master.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.region.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>A full shutdown and restart of HBase service is required when deploying these configuration changes.</p>
<h3 id="624用于简单用户访问操作的客户端配置">62.4。用于简单用户访问操作的客户端配置</h3>
<p>Add the following to the <code>hbase-site.xml</code> file on every client:</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authentication&lt;/name&gt;
  &lt;value&gt;simple&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>For 0.94, add the following to the <code>hbase-site.xml</code> file on every server machine in the cluster:</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.rpc.engine&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.ipc.SecureRpcEngine&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>Be advised that if the <code>hbase.security.authentication</code> in the client- and server-side site files do not match, the client will not be able to communicate with the cluster.</p>
<h4 id="6241简单用户访问操作的客户端配置---thrift-gateway">62.4.1。简单用户访问操作的客户端配置 - Thrift Gateway</h4>
<p>Thrift 网关用户需要访问权限。例如，要给 Thrift API 用户，<code>thrift_server</code>，管理访问权限，这样的命令就足够了：</p>
<pre><code>grant 'thrift_server', 'RWCA' 
</code></pre>
<p>For more information about ACLs, please see the <a href="#hbase.accesscontrol.configuration">Access Control Labels (ACLs)</a> section</p>
<p>The Thrift gateway will authenticate with HBase using the supplied credential. No authentication will be performed by the Thrift gateway itself. All client access via the Thrift gateway will use the Thrift gateway’s credential and have its privilege.</p>
<h4 id="6242用于简单用户访问操作的客户端配置---rest-网关">62.4.2。用于简单用户访问操作的客户端配置 - REST 网关</h4>
<p>REST 网关将使用提供的凭据通过 HBase 进行身份验证。 REST 网关本身不会执行任何身份验证。通过 REST 网关进行的所有客户端访问都将使用 REST 网关的凭证并具有其特权。</p>
<p>REST 网关用户需要访问权限。例如，要给 REST API 用户，<code>rest_server</code>，管理访问权限，这样的命令就足够了：</p>
<pre><code>grant 'rest_server', 'RWCA' 
</code></pre>
<p>For more information about ACLs, please see the <a href="#hbase.accesscontrol.configuration">Access Control Labels (ACLs)</a> section</p>
<p>客户端应该可以通过 SPNEGO HTTP 身份验证以传递方式通过 REST 网关对 HBase 群集进行身份验证。这是未来的工作。</p>
<h2 id="63保护对-hdfs-和-zookeeper-的访问">63.保护对 HDFS 和 ZooKeeper 的访问</h2>
<p>安全 HBase 需要安全的 ZooKeeper 和 HDFS，以便用户无法访问和/或修改 HBase 下的元数据和数据。 HBase 使用 HDFS（或配置文件系统）来保存其数据文件以及预写日志（WAL）和其他数据。 HBase 使用 ZooKeeper 存储一些操作元数据（主地址，表锁，恢复状态等）。</p>
<h3 id="631保护-zookeeper-数据">63.1。保护 ZooKeeper 数据</h3>
<p>ZooKeeper 具有可插入的身份验证机制，可以使用不同的方法从客户端进行访问。 ZooKeeper 甚至可以同时允许经过身份验证和未经身份验证的客户端。可以通过为每个 znode 提供访问控制列表（ACL）来限制对 znode 的访问。 ACL 包含两个组件，即身份验证方法和主体。 ACL 不是按层次强制执行的。有关详细信息，请参阅 <a href="https://zookeeper.apache.org/doc/r3.3.6/zookeeperProgrammers.html#sc_ZooKeeperPluggableAuthentication">ZooKeeper 程序员指南</a>。</p>
<p>HBase 守护进程通过 SASL 和 kerberos 向 ZooKeeper 进行身份验证（请参阅 <a href="#zk.sasl.auth">SASL 身份验证与 ZooKeeper</a> ）。 HBase 设置 znode ACL，以便只有 HBase 用户和配置的 hbase 超级用户（<code>hbase.superuser</code>）可以访问和修改数据。如果 ZooKeeper 用于服务发现或与客户端共享状态，HBase 创建的 znode 也将允许任何人（无论身份验证）读取这些 znode（clusterId，主地址，元位置等），但只允许 HBase 用户可以修改它们。</p>
<h3 id="632保护文件系统hdfs数据">63.2。保护文件系统（HDFS）数据</h3>
<p>管理中的所有数据都保存在文件系统的根目录下（<code>hbase.rootdir</code>）。应限制对文件系统中的数据和 WAL 文件的访问，以便用户无法绕过 HBase 层，并从文件系统中查看底层数据文件。 HBase 假定使用的文件系统（HDFS 或其他）分层次地强制执行权限。如果未提供对文件系统（授权和身份验证）的充分保护，则 HBase 级别授权控制（ACL，可见性标签等）毫无意义，因为用户始终可以从文件系统访问数据。</p>
<p>HBase 将类似 posix 的权限 700（<code>rwx------</code>）强制执行到其根目录。这意味着只有 HBase 用户可以读取或写入 FS 中的文件。可以通过在 hbase-site.xml 中配置<code>hbase.rootdir.perms</code>来更改默认设置。需要重新启动活动主服务器，以便更改已使用的权限。对于 1.2.0 之前的版本，您可以检查是否已提交 HBASE-13780，如果没有，则可以根据需要手动设置根目录的权限。使用 HDFS，命令将是：</p>
<pre><code>sudo -u hdfs hadoop fs -chmod 700 /hbase 
</code></pre>
<p>如果使用其他<code>hbase.rootdir</code>，则应更改<code>/hbase</code>。</p>
<p>在安全模式下，应配置 SecureBulkLoadEndpoint 并将其用于将从 MR 作业创建的用户文件正确处理到 HBase 守护程序和 HBase 用户。用于批量加载的分布式文件系统中的暂存目录（<code>hbase.bulkload.staging.dir</code>，默认为<code>/tmp/hbase-staging</code>）应具有（模式 711 或<code>rwx—​x—​x</code>），以便用户可以访问在该父目录下创建的暂存目录，但不能做任何其他操作。有关如何配置 SecureBulkLoadEndPoint 的信息，请参阅<a href="#hbase.secure.bulkload">安全批量加载</a>。</p>
<h2 id="64保护对数据的访问">64.保护对数据的访问</h2>
<p>在 HBase 客户端和服务器进程和网关之间配置安全身份验证后，您需要考虑数据本身的安全性。 HBase 提供了几种保护数据的策略：</p>
<ul>
<li> <p>基于角色的访问控制（RBAC）使用熟悉的角色范例控制哪些用户或组可以读取和写入给定的 HBase 资源或执行协处理器端点。</p> </li>
<li> <p>可见性标签，允许您标记单元格并控制对标记单元格的访问，以进一步限制谁可以读取或写入数据的某些子集。可见性标签存储为标签。有关详细信息，请参阅 <a href="#hbase.tags">hbase.tags</a> 。</p> </li>
<li> <p>在 HFiles 和 WAL 中对底层文件系统上的静态数据进行透明加密。这可以保护您的静态数据免受可以访问底层文件系统的攻击者的攻击，而无需更改客户端的实现。它还可以防止来自不正确处理的磁盘的数据泄漏，这对于法律和法规合规性而言非常重要。</p> </li>
</ul>
<p>下面讨论每个功能的服务器端配置，管理和实现细节，以及任何性能权衡。最后给出了一个示例安全配置，以显示所有这些功能一起使用，因为它们可能位于真实场景中。</p>
<blockquote>
<p>HBase 的所有安全方面都在积极发展并迅速发展。您应采用任何策略来保护数据的安全性。此外，其中一些功能仍处于开发的实验阶段。要利用其中的许多功能，您必须运行 HBase 0.98+并使用 HFile v3 文件格式。</p>
<p>保护敏感文件</p>
<p>本节中的几个过程要求您在群集节点之间复制文件。复制密钥，配置文件或包含敏感字符串的其他文件时，请使用安全方法（如<code>ssh</code>）以避免泄露敏感数据。</p>
</blockquote>
<p>过程：基本服务器端配置</p>
<ol>
<li> <p>通过在 <em>hbase-site.xml</em> 中将<code>hfile.format.version</code>设置为 3 来启用 HFile v3。这是 HBase 1.0 和更新版本的默认值。</p> <pre><code>&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hfile.format.version&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;3&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt; 
</code></pre> </li>
<li> <p>为 RPC 和 ZooKeeper 启用 SASL 和 Kerberos 身份验证，如 <a href="#security.prerequisites">security.prerequisites</a> 和 <a href="#zk.sasl.auth">SASL 身份验证与 ZooKeeper</a> 中所述。</p> </li>
</ol>
<h3 id="641标签">64.1。标签</h3>
<p>_ 标签 _ 是 HFile v3 的一个功能。标记是一段元数据，它是单元格的一部分，与键，值和版本分开。标签是一个实现细节，为其他与安全相关的功能（如单元级 ACL 和可见性标签）提供基础。标签存储在 HFiles 本身中。将来，标签可能会用于实现其他 HBase 功能。您不需要了解很多关于标签的信息，以便使用它们启用的安全功能。</p>
<h4 id="6411实施细节">64.1.1。实施细节</h4>
<p>每个单元格可以包含零个或多个标记。每个标记都有一个类型和实际的标记字节数组。</p>
<p>就像可以对行键，列族，限定符和值进行编码一样（参见 <a href="#data.block.encoding.types">data.block.encoding.types</a> ），也可以对标记进行编码。您可以在列族的级别启用或禁用标记编码，默认情况下启用它。使用<code>HColumnDescriptor#setCompressionTags(boolean compressTags)</code>方法管理列族的编码设置。您还需要为列族启用 DataBlockEncoder，以使标记的编码生效。</p>
<p>如果还启用了 WAL 压缩，则可以通过在 <em>hbase-site.xml</em> 中将<code>hbase.regionserver.wal.tags.enablecompression</code>的值设置为<code>true</code>来启用 WAL 中每个标记的压缩。标签压缩使用字典编码。</p>
<p>在 RegionServers 上运行服务器端的协处理器可以对单元标记执行 get 和 set 操作。在发送读取响应之前，标记在 RPC 层被剥离，因此客户端不会看到这些标记。使用 WAL 加密时不支持标记压缩。</p>
<h3 id="642访问控制标签acl">64.2。访问控制标签（ACL）</h3>
<h4 id="6421这个怎么运作">64.2.1。这个怎么运作</h4>
<p>HBase 中的 ACL 基于用户在组中的成员资格或从组中排除，以及给定组访问给定资源的权限。 ACL 实现为名为 AccessController 的协处理器。</p>
<p>HBase 不维护专用组映射，但依赖于 _Hadoop 组映射器 _，它映射目录（如 LDAP 或 Active Directory）和 HBase 用户之间的实体。任何受支持的 Hadoop 组映射器都可以使用。然后，用户将被授予针对资源（全局，名称空间，表，单元或端点）的特定权限（读取，写入，执行，创建，管理）。</p>
<blockquote>
<p>启用 Kerberos 和访问控制后，将对 HBase 的客户端访问进行身份验证，并且除非已明确授予访问权限，否则用户数据将为私有。</p>
</blockquote>
<p>HBase 比关系数据库具有更简单的安全模型，尤其是在客户端操作方面。例如，插入（新记录）和更新（现有记录）之间没有区别，因为两者都折叠为 Put。</p>
<h5 id="了解访问级别">了解访问级别</h5>
<p>HBase 访问级别彼此独立地授予，并允许在给定范围内的不同类型的操作。</p>
<ul>
<li> <p><em>Read（R）</em> - 可以读取给定范围内的数据</p> </li>
<li> <p>_ 写（W）_ - 可以在给定范围内写入数据</p> </li>
<li> <p>_ 执行（X）_ - 可以在给定范围内执行协处理器端点</p> </li>
<li> <p><em>Create（C）</em> - 可以在给定范围内创建表或删除表（甚至是那些他们没有创建的表）</p> </li>
<li> <p><em>Admin（A）</em> - 可以执行集群操作，例如平衡集群或在给定范围内分配区域</p> </li>
</ul>
<p>可能的范围是：</p>
<ul>
<li> <p>_ 超级用户 _ - 超级用户可以在任何资源上执行 HBase 中可用的任何操作。在群集上运行 HBase 的用户是超级用户，分配给 HMaster 上 <em>hbase-site.xml</em> 中的配置属性<code>hbase.superuser</code>的任何主体也是如此。</p> </li>
<li> <p><em>Global</em> - 在 <em>global</em> 范围内授予的权限允许管理员在集群的所有表上运行。</p> </li>
<li> <p>_ 命名空间 _ - 在 _ 命名空间 _ 范围内授予的权限适用于给定命名空间内的所有表。</p> </li>
<li> <p>_ 表 _ - 在 _ 表 _ 范围内授予的权限适用于给定表中的数据或元数据。</p> </li>
<li> <p><em>ColumnFamily</em> - 在 <em>ColumnFamily</em> 范围内授予的权限适用于该 ColumnFamily 中的单元格。</p> </li>
<li> <p><em>Cell</em> - 在 _ 单元格 _ 范围内授予的权限适用于该确切的单元格坐标（键，值，时间戳）。这允许政策演变以及数据。</p> <p>要更改特定单元格上的 ACL，请使用新 ACL 将更新的单元格写入原始的精确坐标。</p> <p>如果您具有多版本架构并且想要更新所有可见版本上的 ACL，则需要为所有可见版本编写新单元。该应用程序完全控制政策演变。</p> <p>上述规则的例外是<code>append</code>和<code>increment</code>处理。附加和增量可以在操作中携带 ACL。如果操作中包含一个，则它将应用于<code>append</code>或<code>increment</code>的结果。否则，将保留要附加或递增的现有单元格的 ACL。</p> </li>
</ul>
<p>访问级别和范围的组合创建了可以授予用户的可能访问级别的矩阵。在生产环境中，根据执行特定工作所需的内容来考虑访问级别很有用。以下列表描述了一些常见类型的 HBase 用户的适当访问级别。重要的是不要授予比给定用户执行所需任务所需的访问权限更多的访问权限。</p>
<ul>
<li> <p>_ 超级用户 _ - 在生产系统中，只有 HBase 用户应具有超级用户访问权限。在开发环境中，管理员可能需要超级用户访问权限才能快速控制和管理群集。但是，这种类型的管理员通常应该是全局管理员而不是超级用户。</p> </li>
<li> <p>_ 全局管理员 _ - 全局管理员可以执行任务并访问 HBase 中的每个表。在典型的生产环境中，管理员不应对表中的数据具有读取或写入权限。</p> </li>
<li> <p>具有管理员权限的全局管理员可以在群集上执行群集范围的操作，例如平衡，分配或取消分配区域，或调用显式主要压缩。这是一个操作角色。</p> </li>
<li> <p>具有“创建”权限的全局管理员可以在 HBase 中创建或删除任何表。这更像是 DBA 类型的角色。</p> <p>在生产环境中，不同用户可能只拥有管理员和创建权限之一。</p> <p>| |</p> <p>在当前实现中，具有<code>Admin</code>权限的全局管理员可以在表上授予自己<code>Read</code>和<code>Write</code>权限，并获得对该表数据的访问权限。因此，仅向实际需要它们的受信任用户授予<code>Global Admin</code>权限。</p> <p>另请注意，具有<code>Create</code>权限的<code>Global Admin</code>可以对 ACL 表执行<code>Put</code>操作，模拟<code>grant</code>或<code>revoke</code>并绕过<code>Global Admin</code>权限的授权检查。</p> <p>由于这些问题，请谨慎授予<code>Global Admin</code>权限。</p> <p>|</p> </li>
<li> <p>_ 命名空间管理员 _ - 具有<code>Create</code>权限的命名空间管理员可以在该命名空间内创建或删除表，并获取和恢复快照。具有<code>Admin</code>权限的命名空间管理员可以对该命名空间中的表执行拆分或主要压缩等操作。</p> </li>
<li> <p>_ 表管理员 _ - 表管理员只能对该表执行管理操作。具有<code>Create</code>权限的表管理员可以从该表创建快照或从快照还原该表。具有<code>Admin</code>权限的表管理员可以对该表执行拆分或主要压缩等操作。</p> </li>
<li> <p>_ 用户 _ - 用户可以读取或写入数据，或两者兼而有之。如果给予<code>Executable</code>权限，用户还可以执行协处理器端点。</p> </li>
</ul>
<table>
<thead>
<tr>
<th>职称</th>
<th>范围</th>
<th>权限</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>高级管理员</td>
<td>全球</td>
<td>访问，创建</td>
<td>管理群集并授予初级管理员访问权限。</td>
</tr>
<tr>
<td>初级管理员</td>
<td>Global</td>
<td>创建</td>
<td>创建表并提供对表管理员的访问权限。</td>
</tr>
<tr>
<td>表管理员</td>
<td>表</td>
<td>访问</td>
<td>从操作的角度维护表。</td>
</tr>
<tr>
<td>数据分析师</td>
<td>Table</td>
<td>读</td>
<td>从 HBase 数据创建报告。</td>
</tr>
<tr>
<td>Web 应用程序</td>
<td>Table</td>
<td>读，写</td>
<td>将数据放入 HBase 并使用 HBase 数据执行操作。</td>
</tr>
</tbody>
</table>
<p>ACL 矩阵</p>
<p>有关 ACL 如何映射到特定 HBase 操作和任务的更多详细信息，请参阅<a href="#appendix_acl_matrix">附录 acl 矩阵</a>。</p>
<h5 id="实施细节">实施细节</h5>
<p>单元级 ACL 使用标签实现（参见<a href="#hbase.tags">标签</a>）。要使用单元级 ACL，您必须使用 HFile v3 和 HBase 0.98 或更高版本。</p>
<ol>
<li> <p>HBase 创建的文件由运行 HBase 进程的操作系统用户拥有。要与 HBase 文件进行交互，您应该使用 API​​或批量加载工具。</p> </li>
<li> <p>HBase 不会在 HBase 内部模拟“角色”。相反，可以为组名授予权限。这允许通过组成员身份对角色进行外部建模。通过 Hadoop 组映射服务在 HBase 外部创建和操作组。</p> </li>
</ol>
<h5 id="服务器端配置">服务器端配置</h5>
<ol>
<li> <p>作为先决条件，执行<a href="#security.data.basic.server.side">过程：基本服务器端配置</a>中的步骤。</p> </li>
<li> <p>通过在 <em>hbase-site.xml</em> 中设置以下属性来安装和配置 AccessController 协处理器。这些属性采用类列表。</p> <p>&gt; 如果将 AccessController 与 VisibilityController 一起使用，则 AccessController 必须位于列表的第一位，因为两个组件都处于活动状态，VisibilityController 会将其系统表的访问控制委托给 AccessController。有关同时使用两者的示例，请参见<a href="#security.example.config">安全配置示例</a>。</p> <pre><code>&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.security.authorization&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.access.AccessController, org.apache.hadoop.hbase.security.token.TokenProvider&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.coprocessor.master.classes&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.access.AccessController&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.coprocessor.regionserver.classes&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.access.AccessController&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.security.exec.permission.checks&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt; 
</code></pre> <p>（可选）您可以通过将<code>hbase.rpc.protection</code>设置为<code>privacy</code>来启用传输安全性。这需要 HBase 0.98.4 或更高版本。</p> </li>
<li> <p>在 Hadoop namenode 的 <em>core-site.xml</em> 中设置 Hadoop 组映射器。这是一个 Hadoop 文件，而不是 HBase 文件。根据您网站的需求进行自定义。以下是一个例子。</p> <pre><code>&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.security.LdapGroupsMapping&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping.ldap.url&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;ldap://server&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping.ldap.bind.user&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;Administrator@example-ad.local&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping.ldap.bind.password&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;****&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping.ldap.base&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;dc=example-ad,dc=local&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping.ldap.search.filter.user&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;(&amp;amp;(objectClass=user)(sAMAccountName={0}))&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping.ldap.search.filter.group&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;(objectClass=group)&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping.ldap.search.attr.member&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;member&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hadoop.security.group.mapping.ldap.search.attr.group.name&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;cn&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt; 
</code></pre> </li>
<li> <p>（可选）启用早期评估策略。在 HBase 0.98.0 之前，如果未授予用户访问列族或至少列限定符的权限，则会抛出 AccessDeniedException。 HBase 0.98.0 删除了此异常，以便允许单元级别的特殊授权。要恢复 HBase 0.98.0-0.98.6 中的旧行为，请在 <em>hbase-site.xml</em> 中将<code>hbase.security.access.early_out</code>设置为<code>true</code>。在 HBase 0.98.6 中，默认值已返回到<code>true</code>。</p> </li>
<li> <p>分发配置并重新启动群集以使更改生效。</p> </li>
<li> <p>要测试您的配置，请以给定用户身份登录 HBase Shell，并使用<code>whoami</code>命令报告您的用户所属的组。在此示例中，用户被报告为<code>services</code>组的成员。</p> <pre><code>hbase&amp;gt; whoami
service (auth:KERBEROS)
    groups: services 
</code></pre> </li>
</ol>
<h5 id="管理">管理</h5>
<p>管理任务可以从 HBase Shell 或通过 API 执行。</p>
<blockquote>
<p>API 示例</p>
<p>下面的许多 API 示例都来自源文件 <em>hbase-server / src / test / java / org / apache / hadoop / hbase / security / access / TestAccessController.java</em> 和 <em>hbase-server / src / test / java / org / apache / hadoop / hbase / security / access / SecureTestUtil.java</em> 。</p>
<p>这些示例以及它们的源文件都不是公共 HBase API 的一部分，仅供参考。有关使用说明，请参阅官方 API。</p>
</blockquote>
<ol>
<li> <p>用户和组管理</p> <p>用户和组在您的目录中维护在 HBase 外部。</p> </li>
<li> <p>授予对命名空间，表，列族或单元格的访问权限</p> <p>grant 语句有几种不同类型的语法。第一个，也是最熟悉的，如下所示，表和列族是可选的：</p> <pre><code>grant 'user', 'RWXCA', 'TABLE', 'CF', 'CQ' 
</code></pre> <p>组和用户以相同的方式被授予访问权限，但组的前缀为<code>@</code>符号。同样，表和名称空间以相同的方式指定，但名称空间以<code>@</code>符号为前缀。</p> <p>也可以在单个语句中为同一资源授予多个权限，如本示例所示。第一个子句将用户映射到 ACL，第二个子子句指定资源。</p> <p>&gt; HBase Shell 支持在单元级别授予和撤销访问权限，用于测试和验证支持，不应用于生产用途，因为它不会将权限应用于尚不存在的单元格。应用单元级权限的正确方法是在存储值时在应用程序代码中执行此操作。</p> <p>ACL 粒度和评估顺序</p> <p>ACL 从最小粒度到最细粒度进行评估，当达到授予权限的 ACL 时，评估将停止。这意味着单元 ACL 不会以较小的粒度覆盖 ACL。</p> <p>例 14. HBase Shell</p>
<ul>
<li> <p>全球：</p> <pre><code>hbase&amp;gt; grant '@admins', 'RWXCA' 
</code></pre> </li>
<li> <p>命名空间：</p> <pre><code>hbase&amp;gt; grant 'service', 'RWXCA', '@test-NS' 
</code></pre> </li>
<li> <p>表：</p> <pre><code>hbase&amp;gt; grant 'service', 'RWXCA', 'user' 
</code></pre> </li>
<li> <p>专栏系列：</p> <pre><code>hbase&amp;gt; grant '@developers', 'RW', 'user', 'i' 
</code></pre> </li>
<li> <p>列限定符：</p> <pre><code>hbase&amp;gt; grant 'service, 'RW', 'user', 'i', 'foo' 
</code></pre> </li>
<li> <p>细胞：</p> <p>授予单元 ACL 的语法使用以下语法：</p> <pre><code>grant &amp;lt;table&amp;gt;, \
  { '&amp;lt;user-or-group&amp;gt;' =&amp;gt; \
    '&amp;lt;permissions&amp;gt;', ... }, \
  { &amp;lt;scanner-specification&amp;gt; } 
</code></pre> </li>
<li> <p>是用户名或组名，如果是组，则以<code>@</code>为前缀。</p> </li>
<li> <p>是包含任何或所有“RWXCA”的字符串，但只有 R 和 W 在细胞范围内有意义。</p> </li>
<li> <p><em>&lt;scanner-specification&gt;&lt;/scanner-specification&gt;</em> 是'scan'hell 命令使用的扫描器规范语法和约定。有关扫描程序规范的一些示例，请发出以下 HBase Shell 命令。</p> <pre><code>hbase&amp;gt; help "scan" 
</code></pre> <p>如果需要启用 cell acl，则 hbase-site.xml 中的 hfile.format.version 选项应大于或等于 3，并且 hbase.security.access.early_out 选项应设置为 false。此示例授予读取权限访问“testuser”用户以及“pii”列中与过滤器匹配的单元格上的“开发人员”组的读/写访问权限。</p> <pre><code>hbase&amp;gt; grant 'user', \
  { '@developers' =&amp;gt; 'RW', 'testuser' =&amp;gt; 'R' }, \
  { COLUMNS =&amp;gt; 'pii', FILTER =&amp;gt; "(PrefixFilter ('test'))" } 
</code></pre> <p>shell 将运行具有给定条件的扫描程序，使用新 ACL 重写找到的单元格，并将它们存储回其精确坐标。</p> </li>
</ul> <p>例 15. API</p> <p>以下示例显示如何在表级别授予访问权限。</p> <pre><code>public static void grantOnTable(final HBaseTestingUtility util, final String user,
    final TableName table, final byte[] family, final byte[] qualifier,
    final Permission.Action... actions) throws Exception {
  SecureTestUtil.updateACLs(util, new Callable&amp;lt;Void&amp;gt;() {
    @Override
    public Void call() throws Exception {
      try (Connection connection = ConnectionFactory.createConnection(util.getConfiguration());
           Table acl = connection.getTable(AccessControlLists.ACL_TABLE_NAME)) {
        BlockingRpcChannel service = acl.coprocessorService(HConstants.EMPTY_START_ROW);
        AccessControlService.BlockingInterface protocol =
          AccessControlService.newBlockingStub(service);
        AccessControlUtil.grant(null, protocol, user, table, family, qualifier, false, actions);
      }
      return null;
    }
  });
} 
</code></pre> <p>要在单元级别授予权限，可以使用<code>Mutation.setACL</code>方法：</p> <pre><code>Mutation.setACL(String user, Permission perms)
Mutation.setACL(Map&amp;lt;String, Permission&amp;gt; perms) 
</code></pre> <p>具体来说，此示例为特定 Put 操作中包含的任何单元格上的<code>user1</code>用户提供读取权限：</p> <pre><code>put.setACL(“user1”, new Permission(Permission.Action.READ)) 
</code></pre> </li>
<li> <p>从命名空间，表，列系列或单元格撤消访问控制</p> <p><code>revoke</code>命令和 API 是 grant 命令和 API 的双胞胎，语法完全相同。唯一的例外是您无法在单元级别撤消权限。您只能撤消先前已授予的访问权限，并且<code>revoke</code>语句与显式拒绝资源不同。</p> <p>&gt; HBase Shell 对授予和撤销访问权限的支持用于测试和验证支持，不应用于生产用途，因为它不会将权限应用于尚不存在的单元格。应用单元级权限的正确方法是在存储值时在应用程序代码中执行此操作。</p> <p>示例 16.撤销对表的访问</p> <pre><code>public static void revokeFromTable(final HBaseTestingUtility util, final String user,
    final TableName table, final byte[] family, final byte[] qualifier,
    final Permission.Action... actions) throws Exception {
  SecureTestUtil.updateACLs(util, new Callable&amp;lt;Void&amp;gt;() {
    @Override
    public Void call() throws Exception {
      Configuration conf = HBaseConfiguration.create();
      Connection connection = ConnectionFactory.createConnection(conf);
      Table acl = connection.getTable(util.getConfiguration(), AccessControlLists.ACL_TABLE_NAME);
      try {
        BlockingRpcChannel service = acl.coprocessorService(HConstants.EMPTY_START_ROW);
        AccessControlService.BlockingInterface protocol =
            AccessControlService.newBlockingStub(service);
        ProtobufUtil.revoke(protocol, user, table, family, qualifier, actions);
      } finally {
        acl.close();
      }
      return null;
    }
  });
} 
</code></pre> </li>
<li> <p>显示用户的有效权限</p> <p>HBase Shell</p> <pre><code>hbase&amp;gt; user_permission 'user'

hbase&amp;gt; user_permission '.*'

hbase&amp;gt; user_permission JAVA_REGEX 
</code></pre> </li>
</ol>
<p>例 17. API</p>
<pre><code>public static void verifyAllowed(User user, AccessTestAction action, int count) throws Exception {
  try {
    Object obj = user.runAs(action);
    if (obj != null &amp;&amp; obj instanceof List&lt;?&gt;) {
      List&lt;?&gt; results = (List&lt;?&gt;) obj;
      if (results != null &amp;&amp; results.isEmpty()) {
        fail("Empty non null results from action for user '" ` user.getShortName() ` "'");
      }
      assertEquals(count, results.size());
    }
  } catch (AccessDeniedException ade) {
    fail("Expected action to pass for user '" ` user.getShortName() ` "' but was denied");
  }
} 
</code></pre>
<h3 id="643可见性标签">64.3。可见性标签</h3>
<p>可见性标签控件可用于仅允许与给定标签关联的用户或主体读取或访问具有该标签的单元。例如，您可以标记单元格<code>top-secret</code>，并仅将该标签的访问权限授予<code>managers</code>组。可见性标签使用标签实现，标签是 HFile v3 的一项功能，允许您按单元格存储元数据。标签是一个字符串，标签可以通过使用逻辑运算符（＆amp;，|或！）并使用括号进行分组来组合成表达式。 HBase 不会对基本格式良好的表达式进行任何形式的验证。可见性标签本身没有任何意义，可用于表示敏感度级别，权限级别或任何其他任意语义含义。</p>
<p>如果用户的标签与单元格的标签或表达式不匹配，则拒绝用户访问该单元格。</p>
<p>在 HBase 0.98.6 及更新版本中，可见性标签和表达式支持 UTF-8 编码。使用<code>org.apache.hadoop.hbase.security.visibility.VisibilityClient</code>类提供的<code>addLabels(conf, labels)</code>方法创建标签并通过 Scan 或 Get 在 Authorizations 中传递标签时，标签可以包含 UTF-8 字符，以及通常在可见性标签中使用的逻辑运算符，具有普通的 Java 表示法，无需任何转义方法。但是，当您通过 Mutation 传递 CellVisibility 表达式时，如果使用 UTF-8 字符或逻辑运算符，则必须使用<code>CellVisibility.quote()</code>方法将表达式括起来。参见<code>TestExpressionParser</code>和源文件 <em>hbase-client / src / test / java / org / apache / hadoop / hbase / client / TestScan.java</em> 。</p>
<p>用户在 Put 操作期间向单元格添加可见性表达式。在默认配置中，用户无需访问标签即可使用标签标记单元格。此行为由配置选项<code>hbase.security.visibility.mutations.checkauths</code>控制。如果将此选项设置为<code>true</code>，则用户正在修改的标签必须与用户关联，否则突变将失败。在获取或扫描期间确定用户是否被授权读取标记的单元格，并且过滤掉用户不被允许读取的结果。这会导致相同的 I / O 损失，就像返回结果一样，但会降低网络负载。</p>
<p>在删除操作期间也可以指定可见性标签。有关可见性标签和删除的详细信息，请参阅 <a href="https://issues.apache.org/jira/browse/HBASE-10885">HBASE-10885</a> 。</p>
<p>当 RegionServer 首次收到请求时，用户的有效标签集将构建在 RPC 上下文中。用户与标签关联的方式是可插入的。默认插件通过添加到“获取”或“扫描”的“授权”中指定的标签，并根据主叫用户的经过身份验证的标签列表检查这些标签。当客户端传递未对用户进行身份验证的标签时，默认插件会删除它们。您可以通过<code>Get#setAuthorizations(Authorizations(String,…​))</code>和<code>Scan#setAuthorizations(Authorizations(String,…​));</code>方法传递用户身份验证标签的子集。</p>
<p>可以以与用户相同的方式向组授予可见性标签。组以@符号为前缀。在检查用户的可见性标签时，服务器将包括用户所属的组的可见性标签以及用户自己的标签。当使用 API​​ <code>VisibilityClient#getAuths</code>或 Shell 命令<code>get_auths</code>为用户检索可见性标签时，我们将返回专门为该用户添加的标签，而不是组级标签。</p>
<p>可见性标签访问检查由 VisibilityController 协处理器执行。您可以使用接口<code>VisibilityLabelService</code>提供自定义实现和/或控制可见性标签与单元格一起存储的方式。有关示例，请参阅源文件 <em>hbase-server / src / test / java / org / apache / hadoop / hbase / security / visibility / TestVisibilityLabelsWithCustomVisLabService.java</em> 。</p>
<p>可见性标签可与 ACL 一起使用。</p>
<blockquote>
<p>必须先明确定义标签，然后才能在可见性标签中使用它们。请参阅下面的示例，了解如何执行此操作。</p>
<p>目前无法确定哪些标签已应用于单元格。有关详细信息，请参见 <a href="https://issues.apache.org/jira/browse/HBASE-12470">HBASE-12470</a> 。</p>
<p>可见性标签目前不适用于超级用户。</p>
</blockquote>
<table>
<thead>
<tr>
<th>表达</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<pre><code>fulltime 
</code></pre>
<p>|允许访问与全时标签关联的用户。 | |</p>
<pre><code>!public 
</code></pre>
<p>|允许访问与公共标签无关的用户。 | |</p>
<pre><code>( secret &amp;#124; topsecret ) &amp; !probationary 
</code></pre>
<p>|允许访问与 secret 或 topsecret 标签关联且与试用标签无关的用户。 |</p>
<h4 id="6431服务器端配置">64.3.1。服务器端配置</h4>
<ol>
<li> <p>As a prerequisite, perform the steps in <a href="#security.data.basic.server.side">Procedure: Basic Server-Side Configuration</a>.</p> </li>
<li> <p>通过在 <em>hbase-site.xml</em> 中设置以下属性来安装和配置 VisibilityController 协处理器。这些属性采用类名列表。</p> <pre><code>&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.security.authorization&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.coprocessor.region.classes&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.visibility.VisibilityController&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.coprocessor.master.classes&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hbase.security.visibility.VisibilityController&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt; 
</code></pre> <p>&gt; 如果同时使用 AccessController 和 VisibilityController 协处理器，则 AccessController 必须位于列表的第一位，因为两个组件都处于活动状态，VisibilityController 会将其系统表的访问控制委托给 AccessController。</p> </li>
<li> <p>调整配置</p> <p>默认情况下，用户可以使用任何标签标记单元格，包括与之无关的标签，这意味着用户可以放置他无法读取的数据。例如，即使用户未与该标签相关联，用户也可以用（假设的）'topsecret'标签标记单元格。如果您只希望用户能够使用与之关联的标签标记单元格，请将<code>hbase.security.visibility.mutations.checkauths</code>设置为<code>true</code>。在这种情况下，如果使用与用户无关的标签，则突变将失败。</p> </li>
<li> <p>Distribute your configuration and restart your cluster for changes to take effect.</p> </li>
</ol>
<h4 id="6432管理">64.3.2。管理</h4>
<p>可以使用 HBase Shell 或 Java API 执行管理任务。为了定义可见性标签列表并将标签与用户关联，HBase Shell 可能更简单。</p>
<blockquote>
<p>API Examples</p>
<p>本节中的许多 Java API 示例都来自源文件 <em>hbase-server / src / test / java / org / apache / hadoop / hbase / security / visibility / TestVisibilityLabels.java</em> 。有关更多上下文，请参阅该文件或 API 文档。</p>
<p>这些示例以及它们的源文件都不是公共 HBase API 的一部分，仅供参考。有关使用说明，请参阅官方 API。</p>
</blockquote>
<ol>
<li> <p>定义可见性标签列表</p> <p>HBase Shell</p> <pre><code>hbase&amp;gt; add_labels [ 'admin', 'service', 'developer', 'test' ] 
</code></pre> <p>示例 18. Java API</p> <pre><code>public static void addLabels() throws Exception {
  PrivilegedExceptionAction&amp;lt;VisibilityLabelsResponse&amp;gt; action = new PrivilegedExceptionAction&amp;lt;VisibilityLabelsResponse&amp;gt;() {
    public VisibilityLabelsResponse run() throws Exception {
      String[] labels = { SECRET, TOPSECRET, CONFIDENTIAL, PUBLIC, PRIVATE, COPYRIGHT, ACCENT,
          UNICODE_VIS_TAG, UC1, UC2 };
      try {
        VisibilityClient.addLabels(conf, labels);
      } catch (Throwable t) {
        throw new IOException(t);
      }
      return null;
    }
  };
  SUPERUSER.runAs(action);
} 
</code></pre> </li>
<li> <p>将标签与用户关联</p> <p>HBase Shell</p> <pre><code>hbase&amp;gt; set_auths 'service', [ 'service' ] 
</code></pre> </li>
</ol>
<pre><code>hbase&gt; set_auths 'testuser', [ 'test' ] 
</code></pre>
<pre><code>hbase&gt; set_auths 'qa', [ 'test', 'developer' ] 
</code></pre>
<pre><code>hbase&gt; set_auths '@qagroup', [ 'test' ] 
</code></pre>
<ul>
<li>.Java API</li>
</ul>
<pre><code>public void testSetAndGetUserAuths() throws Throwable {
  final String user = "user1";
  PrivilegedExceptionAction&lt;Void&gt; action = new PrivilegedExceptionAction&lt;Void&gt;() {
    public Void run() throws Exception {
      String[] auths = { SECRET, CONFIDENTIAL };
      try {
        VisibilityClient.setAuths(conf, auths, user);
      } catch (Throwable e) {
      }
      return null;
    }
    ... 
</code></pre>
<ol>
<li> <p>清除用户标签</p> <p>HBase Shell</p> <pre><code>hbase&amp;gt; clear_auths 'service', [ 'service' ] 
</code></pre> </li>
</ol>
<pre><code>hbase&gt; clear_auths 'testuser', [ 'test' ] 
</code></pre>
<pre><code>hbase&gt; clear_auths 'qa', [ 'test', 'developer' ] 
</code></pre>
<pre><code>hbase&gt; clear_auths '@qagroup', [ 'test', 'developer' ] 
</code></pre>
<ul>
<li>.Java API</li>
</ul>
<pre><code>...
auths = new String[] { SECRET, PUBLIC, CONFIDENTIAL };
VisibilityLabelsResponse response = null;
try {
  response = VisibilityClient.clearAuths(conf, auths, user);
} catch (Throwable e) {
  fail("Should not have failed");
  ...
} 
</code></pre>
<ol>
<li> <p>将标签或表达式应用于单元格</p> <p>标签仅在写入数据时应用。标签与给定版本的单元格相关联。</p> <p>HBase Shell</p> <pre><code>hbase&amp;gt; set_visibility 'user', 'admin|service|developer', { COLUMNS =&amp;gt; 'i' } 
</code></pre> </li>
</ol>
<pre><code>hbase&gt; set_visibility 'user', 'admin|service', { COLUMNS =&gt; 'pii' } 
</code></pre>
<pre><code>hbase&gt; set_visibility 'user', 'test', { COLUMNS =&gt; [ 'i', 'pii' ], FILTER =&gt; "(PrefixFilter ('test'))" } 
</code></pre>
<ul>
<li> <p>注意：HBase Shell 支持对单元格应用标签或权限，用于测试和验证支持，不应用于生产用途，因为它不会将标签应用于尚不存在的单元格。应用单元格级别标签的正确方法是在存储值时在应用程序代码中执行此操作。</p> </li>
<li> <p>.Java API</p> </li>
</ul>
<pre><code>static Table createTableAndWriteDataWithLabels(TableName tableName, String... labelExps)
    throws Exception {
  Configuration conf = HBaseConfiguration.create();
  Connection connection = ConnectionFactory.createConnection(conf);
  Table table = NULL;
  try {
    table = TEST_UTIL.createTable(tableName, fam);
    int i = 1;
    List&lt;Put&gt; puts = new ArrayList&lt;Put&gt;();
    for (String labelExp : labelExps) {
      Put put = new Put(Bytes.toBytes("row" + i));
      put.add(fam, qual, HConstants.LATEST_TIMESTAMP, value);
      put.setCellVisibility(new CellVisibility(labelExp));
      puts.add(put);
      i++;
    }
    table.put(puts);
  } finally {
    if (table != null) {
      table.flushCommits();
    }
  } 
</code></pre>
<h4 id="6433用标签读取单元格">64.3.3。用标签读取单元格</h4>
<p>当您发出扫描或获取时，HBase 使用您的默认授权集来过滤掉您无权访问的单元格。超级用户可以使用<code>set_auths</code> HBase Shell 命令或 <a href="https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/security/visibility/VisibilityClient.html#setAuths-org.apache.hadoop.hbase.client.Connection-java.lang.String:A-java.lang.String-">VisibilityClient.setAuths（）</a>方法为给定用户设置默认授权集。</p>
<p>您可以在扫描或获取期间通过传递 HBase Shell 中的 AUTHORIZATIONS 选项或 <a href="https://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Scan.html#setAuthorizations-org.apache.hadoop.hbase.security.visibility.Authorizations-">Scan.setAuthorizations（）</a>方法（如果使用 API​​）指定其他授权。此授权将与您的默认设置组合作为附加过滤器。它将进一步过滤您的结果，而不是给您额外的授权。</p>
<p>HBase Shell</p>
<pre><code>hbase&gt; get_auths 'myUser'
hbase&gt; scan 'table1', AUTHORIZATIONS =&gt; ['private'] 
</code></pre>
<p>示例 19. Java API</p>
<pre><code>...
public Void run() throws Exception {
  String[] auths1 = { SECRET, CONFIDENTIAL };
  GetAuthsResponse authsResponse = null;
  try {
    VisibilityClient.setAuths(conf, auths1, user);
    try {
      authsResponse = VisibilityClient.getAuths(conf, user);
    } catch (Throwable e) {
      fail("Should not have failed");
    }
  } catch (Throwable e) {
  }
  List&lt;String&gt; authsList = new ArrayList&lt;String&gt;();
  for (ByteString authBS : authsResponse.getAuthList()) {
    authsList.add(Bytes.toString(authBS.toByteArray()));
  }
  assertEquals(2, authsList.size());
  assertTrue(authsList.contains(SECRET));
  assertTrue(authsList.contains(CONFIDENTIAL));
  return null;
}
... 
</code></pre>
<h4 id="6434实现您自己的可见性标签算法">64.3.4。实现您自己的可见性标签算法</h4>
<p>解释为给定的 get / scan 请求验证的标签是可插入的算法。</p>
<p>您可以使用属性<code>hbase.regionserver.scan.visibility.label.generator.class</code>指定自定义插件或插件。第一个<code>ScanLabelGenerator</code>的输出将是下一个的输出，直到列表的结尾。</p>
<p>在 <a href="https://issues.apache.org/jira/browse/HBASE-12466">HBASE-12466</a> 中实现的默认实现加载了两个插件，<code>FeedUserAuthScanLabelGenerator</code>和<code>DefinedSetFilterScanLabelGenerator</code>。参见<a href="#reading_cells_with_labels">用标签读取细胞</a>。</p>
<h4 id="6435将可见性标记复制为字符串">64.3.5。将可见性标记复制为字符串</h4>
<p>如上面部分所述，接口<code>VisibilityLabelService</code>可用于实现在单元格中存储可见性表达式的不同方式。启用了复制的群集还必须将可见性表达式复制到对等群集。如果<code>DefaultVisibilityLabelServiceImpl</code>用作<code>VisibilityLabelService</code>的实现，则所有可见性表达式将根据存储在标签表中的每个可见性标签的序数转换为相应的表达式。在复制期间，可见细胞也复制，基于序数的表达完整。对等群集可能没有相同的<code>labels</code>表，其可见性标签具有相同的序数映射。在这种情况下，复制序数是没有意义的。如果复制发生在将可见性表达式作为字符串传输的情况下会更好。要将可见性表达式作为字符串复制到对等集群，请创建<code>RegionServerObserver</code>配置，该配置基于<code>VisibilityLabelService</code>接口的实现而工作。下面的配置允许将可见性表达式作为字符串复制到对等集群。更多详细信息，请参见 <a href="https://issues.apache.org/jira/browse/HBASE-11639">HBASE-11639</a> 。</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.regionserver.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.visibility.VisibilityController$VisibilityReplication&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<h3 id="644静态数据的透明加密">64.4。静态数据的透明加密</h3>
<p>HBase 提供了一种机制，用于保护静态数据，HFiles 和 WAL，它们驻留在 HDFS 或其他分布式文件系统中。双层体系结构用于灵活且非侵入式的密钥轮换。 “透明”意味着客户端不需要进行任何实现更改。写入数据时，会对其进行加密。读取时，按需解密。</p>
<h4 id="6441这个怎么运作">64.4.1。这个怎么运作</h4>
<p>管理员为群集配置主密钥，该密钥存储在每个受信任的 HBase 进程可访问的密钥提供程序中，包括管理工作站上的 HMaster，RegionServers 和客户端（如 HBase Shell）。默认密钥提供程序与 Java KeyStore API 以及支持它的任何密钥管理系统集成在一起。其他自定义密钥提供程序实现是可能密钥检索机制在 <em>hbase-site.xml</em> 配置文件中配置。主密钥可以存储在集群服务器上，受安全 KeyStore 文件保护，或者存储在外部密钥服务器上，或者存储在硬件安全模块中。 HBase 进程通过配置的密钥提供程序根据需要解析此主密钥。</p>
<p>接下来，可以在每个列族的模式中指定加密使用，方法是创建或修改列描述符以包含两个附加属性：要使用的加密算法的名称（当前仅支持“AES”），还可以选择数据密钥使用群集主密钥包装（加密）。如果没有为 ColumnFamily 显式配置数据密钥，HBase 将为每个 HFile 创建一个随机数据密钥。这提供了替代方案的安全性的逐步改进。除非您需要提供显式数据密钥，例如在使用给定数据密钥生成用于批量导入的加密 HFile 的情况下，否则仅在 ColumnFamily 模式元数据中指定加密算法，并让 HBase 按需创建数据密钥。每列族键有助于低影响增量键旋转，并减少关键材料的任何外部泄漏范围。包装的数据密钥存储在 ColumnFamily 模式元数据中，并存储在列系列的每个 HFile 中，使用集群主密钥加密。在列系列配置为加密后，任何新的 HFile 都将被加密写入。要确保加密所有 HFile，请在启用此功能后触发主要压缩。</p>
<p>当 HFile 打开时，数据密钥从 HFile 中提取，用集群主密钥解密，并用于解密 HFile 的其余部分。如果主密钥不可用，HFile 将无法读取。如果远程用户以某种方式获得对 HFile 数据的访问，因为 HDFS 权限有所失效，或者来自不适当的丢弃媒体，则无法解密数据密钥或文件数据。</p>
<p>也可以加密 WAL。即使 WAL 是瞬态的，在基础文件系统受到损害的情况下，有必要加密 WALEdits 以避免绕过加密列族的 HFile 保护。启用 WAL 加密后，无论相关的 HFile 是否加密，所有 WAL 都会被加密。</p>
<h4 id="6442服务器端配置">64.4.2。服务器端配置</h4>
<p>此过程假定您使用的是默认的 Java 密钥库实现。如果您使用的是自定义实现，请检查其文档并进行相应调整。</p>
<ol>
<li> <p>使用<code>keytool</code>实用程序为 AES 加密创建适当长度的密钥。</p> <pre><code>$ keytool -keystore /path/to/hbase/conf/hbase.jks \
  -storetype jceks -storepass **** \
  -genseckey -keyalg AES -keysize 128 \
  -alias &amp;lt;alias&amp;gt; 
</code></pre> <p>将 <strong>**</strong> 替换为密钥库文件的密码，将&lt;alias&gt;替换为 HBase 服务帐户的用户名或任意字符串。如果使用任意字符串，则需要配置 HBase 才能使用它，如下所述。指定适当的密钥大小。不要为密钥指定单独的密码，但在出现提示时按&lt;kbd&gt;返回&lt;/kbd&gt;。&lt;/alias&gt;</p> </li>
<li> <p>在密钥文件上设置适当的权限，并将其分发给所有 HBase 服务器。</p> <p>上一个命令在 HBase <em>conf /</em> 目录中创建了一个名为 <em>hbase.jks</em> 的文件。设置此文件的权限和所有权，以便只有 HBase 服务帐户用户可以读取该文件，并将密钥安全地分发给所有 HBase 服务器。</p> </li>
<li> <p>配置 HBase 守护进程。</p> <p>在区域服务器上的 <em>hbase-site.xml</em> 中设置以下属性，以配置 HBase 守护程序以使用由 KeyStore 文件支持的密钥提供程序或检索集群主密钥。在下面的示例中，用密码替换 <strong>**</strong>。</p> <pre><code>&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.crypto.keyprovider&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hbase.io.crypto.KeyStoreKeyProvider&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.crypto.keyprovider.parameters&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;jceks:///path/to/hbase/conf/hbase.jks?password=****&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt; 
</code></pre> <p>默认情况下，HBase 服务帐户名称将用于解析群集主密钥。但是，您可以使用任意别名（在<code>keytool</code>命令中）存储它。在这种情况下，请将以下属性设置为您使用的别名。</p> <pre><code>&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.crypto.master.key.name&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;my-alias&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt; 
</code></pre> <p>您还需要确保您的 HFile 使用 HFile v3，以便使用透明加密。这是 HBase 1.0 以后的默认配置。对于以前的版本，请在 <em>hbase-site.xml</em> 文件中设置以下属性。</p> <pre><code>&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hfile.format.version&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;3&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt; 
</code></pre> <p>（可选）您可以使用其他密码提供程序，Java Cryptography Encryption（JCE）算法提供程序或自定义 HBase 密码实现。</p>
<ul>
<li> <p>JCE：</p>
<ul>
<li> <p>安装签名的 JCE 提供程序（支持 128 位密钥的<code>AES/CTR/NoPadding</code>模式）</p> </li>
<li> <p>将它以最高优先级添加到 JCE 站点配置文件 _ $ JAVA <em>HOME / lib / security / java.security</em> 。</p> </li>
<li> <p>更新 <em>hbase-site.xml</em> 中的<code>hbase.crypto.algorithm.aes.provider</code>和<code>hbase.crypto.algorithm.rng.provider</code>选项。</p> </li>
</ul> </li>
<li> <p>自定义 HBase 密码：</p>
<ul>
<li> <p>实施<code>org.apache.hadoop.hbase.io.crypto.CipherProvider</code>。</p> </li>
<li> <p>将实现添加到服务器类路径。</p> </li>
<li> <p>更新 <em>hbase-site.xml</em> 中的<code>hbase.crypto.cipherprovider</code>。</p> </li>
</ul> </li>
</ul> </li>
<li> <p>配置 WAL 加密。</p> <p>通过设置以下属性，在每个 RegionServer 的 <em>hbase-site.xml</em> 中配置 WAL 加密。您也可以将这些包含在 HMaster 的 <em>hbase-site.xml</em> 中，但是 HMaster 没有 WAL 并且不会使用它们。</p> <pre><code>&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.regionserver.hlog.reader.impl&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hbase.regionserver.wal.SecureProtobufLogReader&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.regionserver.hlog.writer.impl&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hbase.regionserver.wal.SecureProtobufLogWriter&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hbase.regionserver.wal.encryption&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt; 
</code></pre> </li>
<li> <p>配置 <em>hbase-site.xml</em> 文件的权限。</p> <p>由于密钥库密码存储在 hbase-site.xml 中，因此您需要确保只有 HBase 用户可以使用文件所有权和权限读取 <em>hbase-site.xml</em> 文件。</p> </li>
<li> <p>重新启动群集。</p> <p>将新配置文件分发到所有节点并重新启动群集。</p> </li>
</ol>
<h4 id="6443管理">64.4.3。管理</h4>
<p>管理任务可以在 HBase Shell 或 Java API 中执行。</p>
<blockquote>
<p>Java API</p>
<p>本节中的 Java API 示例取自源文件 <em>hbase-server / src / test / java / org / apache / hadoop / hbase / util / TestHBaseFsckEncryption.java</em> 。 。</p>
<p>这些示例以及它们的源文件都不是公共 HBase API 的一部分，仅供参考。有关使用说明，请参阅官方 API。</p>
</blockquote>
<p>在列族上启用加密</p>
<p>要在列族上启用加密，可以使用 HBase Shell 或 Java API。启用加密后，触发主要压缩。当主要压缩完成时，HFiles 将被加密。</p>
<p>旋转数据键</p>
<p>要旋转数据键，首先更改列描述符中的 ColumnFamily 键，然后触发主要压缩。压缩完成后，将使用新数据密钥重新加密所有 HFile。在压缩完成之前，旧的 HFiles 仍然可以使用旧密钥读取。</p>
<p>在使用随机数据密钥和指定密钥之间切换</p>
<p>如果您将列族配置为使用特定键，并且希望返回使用该列系列的随机生成的键的默认行为，请使用 Java API 更改<code>HColumnDescriptor</code>，以便不会发送任何值。键<code>ENCRYPTION_KEY</code>。</p>
<p>旋转万能钥匙</p>
<p>要旋转主密钥，请先生成并分发新密钥。然后更新 KeyStore 以包含新的主密钥，并使用不同的别名将旧主密钥保留在 KeyStore 中。接下来，配置回退到 <em>hbase-site.xml</em> 文件中的旧主密钥。</p>
<h3 id="645安全批量加载">64.5。安全批量加载</h3>
<p>安全模式下的批量加载比正常设置要多一些，因为客户端必须将 MapReduce 作业生成的文件的所有权转移到 HBase。安全批量加载由名为 <a href="https://hbase.apache.org/devapidocs/org/apache/hadoop/hbase/security/access/SecureBulkLoadEndpoint.html">SecureBulkLoadEndpoint</a> 的协处理器实现，该协处理器使用由配置属性<code>hbase.bulkload.staging.dir</code>配置的暂存目录，默认为 <em>/ tmp / hbase-staging /</em> 。</p>
<p>安全批量加载算法</p>
<ul>
<li> <p>仅限一次，创建一个可由世界遍历并且由运行 HBase 的用户拥有的暂存目录（模式 711 或<code>rwx—​x—​x</code>）。此目录的列表将类似于以下内容：</p> <pre><code>$ ls -ld /tmp/hbase-staging
drwx--x--x  2 hbase  hbase  68  3 Sep 14:54 /tmp/hbase-staging 
</code></pre> </li>
<li> <p>用户将数据写入该用户拥有的安全输出目录。例如， <em>/ user / foo / data</em> 。</p> </li>
<li> <p>在内部，HBase 创建一个全局可读/可写的秘密登台目录（<code>-rwxrwxrwx, 777</code>）。例如， <em>/ tmp / hbase-staging / averylongandrandomdirectoryname</em> 。此目录的名称和位置不会向用户公开。 HBase 管理此目录的创建和删除。</p> </li>
<li> <p>用户使数据具有全局可读性和全局可写性，将其移动到随机登台目录中，然后调用<code>SecureBulkLoadClient#bulkLoadHFiles</code>方法。</p> </li>
</ul>
<p>安全性的强度在于秘密目录的长度和随机性。</p>
<p>要启用安全批量加载，请将以下属性添加到 <em>hbase-site.xml</em> 。</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.bulkload.staging.dir&lt;/name&gt;
  &lt;value&gt;/tmp/hbase-staging&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.region.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.token.TokenProvider,
  org.apache.hadoop.hbase.security.access.AccessController,org.apache.hadoop.hbase.security.access.SecureBulkLoadEndpoint&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<h3 id="646安全启用">64.6。安全启用</h3>
<p>在 hbase-2.x 之后，默认的'hbase.security.authorization'发生了变化。在 hbase-2.x 之前，它默认为 true，在后来的 HBase 版本中，默认值为 false。因此，要启用 hbase 授权，必须在 <em>hbase-site.xml</em> 中配置以下属性。见 <a href="https://issues.apache.org/jira/browse/HBASE-19483">HBASE-19483</a> ;</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hbase.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<h2 id="65安全配置示例">65.安全配置示例</h2>
<p>此配置示例包括对 HFile v3，ACL，可见性标签以及静态和 WAL 数据的透明加密的支持。所有选项都在上面的章节中单独讨论过。</p>
<p>示例 20. <em>hbase-site.xml</em> 中的示例安全设置</p>
<pre><code>&lt;!-- HFile v3 Support --&gt;
&lt;property&gt;
  &lt;name&gt;hfile.format.version&lt;/name&gt;
  &lt;value&gt;3&lt;/value&gt;
&lt;/property&gt;
&lt;!-- HBase Superuser --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.superuser&lt;/name&gt;
  &lt;value&gt;hbase,admin&lt;/value&gt;
&lt;/property&gt;
&lt;!-- Coprocessors for ACLs and Visibility Tags --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.region.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController,
  org.apache.hadoop.hbase.security.visibility.VisibilityController,
  org.apache.hadoop.hbase.security.token.TokenProvider&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.master.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController,
  org.apache.hadoop.hbase.security.visibility.VisibilityController&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.regionserver.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;
&lt;/property&gt;
&lt;!-- Executable ACL for Coprocessor Endpoints --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.exec.permission.checks&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;!-- Whether a user needs authorization for a visibility tag to set it on a cell --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.security.visibility.mutations.checkauth&lt;/name&gt;
  &lt;value&gt;false&lt;/value&gt;
&lt;/property&gt;
&lt;!-- Secure RPC Transport --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rpc.protection&lt;/name&gt;
  &lt;value&gt;privacy&lt;/value&gt;
 &lt;/property&gt;
 &lt;!-- Transparent Encryption --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.crypto.keyprovider&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.io.crypto.KeyStoreKeyProvider&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.crypto.keyprovider.parameters&lt;/name&gt;
  &lt;value&gt;jceks:///path/to/hbase/conf/hbase.jks?password=***&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.crypto.master.key.name&lt;/name&gt;
  &lt;value&gt;hbase&lt;/value&gt;
&lt;/property&gt;
&lt;!-- WAL Encryption --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.regionserver.hlog.reader.impl&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.regionserver.wal.SecureProtobufLogReader&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.regionserver.hlog.writer.impl&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.regionserver.wal.SecureProtobufLogWriter&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.regionserver.wal.encryption&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;!-- For key rotation --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.crypto.master.alternate.key.name&lt;/name&gt;
  &lt;value&gt;hbase.old&lt;/value&gt;
&lt;/property&gt;
&lt;!-- Secure Bulk Load --&gt;
&lt;property&gt;
  &lt;name&gt;hbase.bulkload.staging.dir&lt;/name&gt;
  &lt;value&gt;/tmp/hbase-staging&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hbase.coprocessor.region.classes&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hbase.security.token.TokenProvider,
  org.apache.hadoop.hbase.security.access.AccessController,org.apache.hadoop.hbase.security.access.SecureBulkLoadEndpoint&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
<p>示例 21. Hadoop <em>core-site.xml</em> 中的示例组映射器</p>
<p>调整这些设置以适合您的环境。</p>
<pre><code>&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.security.LdapGroupsMapping&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping.ldap.url&lt;/name&gt;
  &lt;value&gt;ldap://server&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping.ldap.bind.user&lt;/name&gt;
  &lt;value&gt;Administrator@example-ad.local&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping.ldap.bind.password&lt;/name&gt;
  &lt;value&gt;****&lt;/value&gt; &lt;!-- Replace with the actual password --&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping.ldap.base&lt;/name&gt;
  &lt;value&gt;dc=example-ad,dc=local&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping.ldap.search.filter.user&lt;/name&gt;
  &lt;value&gt;(&amp;amp;(objectClass=user)(sAMAccountName={0}))&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping.ldap.search.filter.group&lt;/name&gt;
  &lt;value&gt;(objectClass=group)&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping.ldap.search.attr.member&lt;/name&gt;
  &lt;value&gt;member&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;hadoop.security.group.mapping.ldap.search.attr.group.name&lt;/name&gt;
  &lt;value&gt;cn&lt;/value&gt;
&lt;/property&gt; 
</code></pre>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/119/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/code_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/119/index.html">给小白看的设计模式书</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/62.html">tzivanmoe</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="code">code</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">13页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年7月1日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 0个">0</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/64/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/code_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/64/index.html">免费的编程中文书籍索引</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/40.html">justjavac</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="code">code</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">56页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月5日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 33914个">33914</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/187/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/code_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/187/index.html">软件开发的工程化</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/105.html">azl397985856</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="code">code</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月26日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 112个">112</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/25/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/c_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/25/index.html">笨办法学C</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/15.html">wizardforcel</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="c">c</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">54页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 524个">524</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/47/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/phpstorm_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/47/index.html">CodeIgniter3.1.8源码分析</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/24.html">NightSakura</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="phpstorm">phpstorm</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">22页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月2日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 2个">2</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/45/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/45/index.html">嵌入式 Linux 知识库</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/23.html">泰晓科技</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">402页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月30日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 97个">97</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../../" title="返回首页"><img class="" src="../../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../../book/173/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../../book/173/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/173/README.html" title="HBase™ 中文参考指南 3.0" data-book-page-rel-url="README.html" data-book-page-id="11767">HBase™ 中文参考指南 3.0</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/0.html" title="Preface" data-book-page-rel-url="docs/0.html" data-book-page-id="11768">Preface</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/1.html" title="Getting Started" data-book-page-rel-url="docs/1.html" data-book-page-id="11769">Getting Started</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/2.html" title="Apache HBase Configuration" data-book-page-rel-url="docs/2.html" data-book-page-id="11770">Apache HBase Configuration</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/3.html" title="Upgrading" data-book-page-rel-url="docs/3.html" data-book-page-id="11771">Upgrading</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/4.html" title="The Apache HBase Shell" data-book-page-rel-url="docs/4.html" data-book-page-id="11772">The Apache HBase Shell</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/5.html" title="Data Model" data-book-page-rel-url="docs/5.html" data-book-page-id="11773">Data Model</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/6.html" title="HBase and Schema Design" data-book-page-rel-url="docs/6.html" data-book-page-id="11774">HBase and Schema Design</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/7.html" title="RegionServer Sizing Rules of Thumb" data-book-page-rel-url="docs/7.html" data-book-page-id="11775">RegionServer Sizing Rules of Thumb</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/8.html" title="HBase and MapReduce" data-book-page-rel-url="docs/8.html" data-book-page-id="11776">HBase and MapReduce</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/9.html" title="Securing Apache HBase" data-book-page-rel-url="docs/9.html" data-book-page-id="11777">Securing Apache HBase</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/10.html" title="Architecture" data-book-page-rel-url="docs/10.html" data-book-page-id="11778">Architecture</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/11.html" title="In-memory Compaction" data-book-page-rel-url="docs/11.html" data-book-page-id="11779">In-memory Compaction</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/12.html" title="Backup and Restore" data-book-page-rel-url="docs/12.html" data-book-page-id="11780">Backup and Restore</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/13.html" title="Synchronous Replication" data-book-page-rel-url="docs/13.html" data-book-page-id="11781">Synchronous Replication</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/14.html" title="Apache HBase APIs" data-book-page-rel-url="docs/14.html" data-book-page-id="11782">Apache HBase APIs</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/15.html" title="Apache HBase External APIs" data-book-page-rel-url="docs/15.html" data-book-page-id="11783">Apache HBase External APIs</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/16.html" title="Thrift API and Filter Language" data-book-page-rel-url="docs/16.html" data-book-page-id="11784">Thrift API and Filter Language</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/17.html" title="HBase and Spark" data-book-page-rel-url="docs/17.html" data-book-page-id="11785">HBase and Spark</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/18.html" title="Apache HBase Coprocessors" data-book-page-rel-url="docs/18.html" data-book-page-id="11786">Apache HBase Coprocessors</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/19.html" title="Apache HBase Performance Tuning" data-book-page-rel-url="docs/19.html" data-book-page-id="11787">Apache HBase Performance Tuning</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/20.html" title="Troubleshooting and Debugging Apache HBase" data-book-page-rel-url="docs/20.html" data-book-page-id="11788">Troubleshooting and Debugging Apache HBase</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/21.html" title="Apache HBase Case Studies" data-book-page-rel-url="docs/21.html" data-book-page-id="11789">Apache HBase Case Studies</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/22.html" title="Apache HBase Operational Management" data-book-page-rel-url="docs/22.html" data-book-page-id="11790">Apache HBase Operational Management</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/23.html" title="Building and Developing Apache HBase" data-book-page-rel-url="docs/23.html" data-book-page-id="11791">Building and Developing Apache HBase</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/24.html" title="Unit Testing HBase Applications" data-book-page-rel-url="docs/24.html" data-book-page-id="11792">Unit Testing HBase Applications</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/25.html" title="Protobuf in HBase" data-book-page-rel-url="docs/25.html" data-book-page-id="11793">Protobuf in HBase</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/26.html" title="Procedure Framework (Pv2): HBASE-12439" data-book-page-rel-url="docs/26.html" data-book-page-id="11794">Procedure Framework (Pv2): HBASE-12439</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/27.html" title="AMv2 Description for Devs" data-book-page-rel-url="docs/27.html" data-book-page-id="11795">AMv2 Description for Devs</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/28.html" title="ZooKeeper" data-book-page-rel-url="docs/28.html" data-book-page-id="11796">ZooKeeper</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/29.html" title="Community" data-book-page-rel-url="docs/29.html" data-book-page-id="11797">Community</a>
</li>
<li>
<a class="pjax" href="../../../book/173/docs/30.html" title="Appendix" data-book-page-rel-url="docs/30.html" data-book-page-id="11798">Appendix</a>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =173;var bookPageId =11777;var bookPageRelUrl ='docs/9.html';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>