
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>在ASP.NET Core MVC 应用程序中集成 Microsoft Graph-Office 365 开发入门指南</title>
<meta content='在ASP.NET Core MVC 应用程序中集成 Microsoft Graph,Office 365 开发入门指南' name='keywords'>
<meta content='在ASP.NET Core MVC 应用程序中集成 Microsoft Graph,Office 365 开发入门指南' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../../static/components/css/base.css">
<link rel="stylesheet" href="../../../static/components/css/reader.css">
<link rel="stylesheet" href="../../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-left ">
<a href="../../../book/131/docs/deamonapplication.html">
<i class="nav-icon-left uk-icon-small  uk-icon-caret-left"></i>
<span class="">Microsoft G..</span>
</a>
</div>
<div class="uk-align-right ">
<a href="../../../book/131/docs/graphextensions.html">
<span class="">扩展Microsoft..</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../../book/131/index.html">Office 365 开发入门指南</a>
<a target="_blank" rel="nofollow" href="https://github.com/chenxizhang/office365dev" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<h1 id="跨平台应用集成在aspnet-core-mvc-应用程序中集成-microsoft-graph">跨平台应用集成(在ASP.NET Core MVC 应用程序中集成 Microsoft Graph)</h1>
<blockquote>
<p>作者：陈希章 发表于 2017年6月25日</p>
</blockquote>
<h2 id="谈一谈net-的跨平台">谈一谈.NET 的跨平台</h2>
<p>终于要写到这一篇了。跨平台的支持可以说是 Office 365 平台在设计伊始就考虑的目标。我在前面的文章已经提到过了，Microsoft Graph 服务针对一些主流的开源平台（主要用来做跨平台应用）都有支持，例如 python,nodejs 等。他们真的非常好用，与此同时我虽然对他们也有一定的了解，但要跟我最熟悉的 Microsoft .NET 来比较的话，我自然还是更喜欢后者了。</p>
<p>所以，一直在等待合适的时间，要来写 Microsoft .NET 的跨平台应用，这是多么令人期待的事情啊。经过一段时间的研究，我今天正式隆重地给大家介绍，如何在 ASP.NET Core 平台上面构建一个 MVC 应用程序，并且在里面集成 Microsoft Graph。</p>
<p>关于Microsoft .NET 这几年的发展，我是感到比较兴奋的，作为一个从.NET 1.1就开始追随的骨灰级粉丝，我很高兴地看到现在.NET 已经真正迈出了跨平台的脚步，而且完全开源了。如果要讲这个话题，恐怕我是一时半会刹不住车的，所以我就此打住吧，有兴趣的朋友们可以通过下面这个网址了解更多.NET 的发展情况。 <a href="https://img.cntofu.com/book/office365dev/docs/images/microsoftdotnet.png" data-uk-lightbox><img src="https://img.cntofu.com/book/office365dev/docs/images/microsoftdotnet.png" alt=""></a></p>
<p>这一篇文章用到的技术，是最新的.NET Core 中 ASP.NET Core 提供的，我使用了其中的 MVC 这个模板创建了一个简单的应用程序，并且略微改造了一下，使其能够采用 Azure AD 进行身份验证，继而通过获得的用户凭据能实现对 Microsoft Graph 的使用。</p>
<p><a href="https://img.cntofu.com/book/office365dev/docs/images/aspnetcore.png" data-uk-lightbox><img src="https://img.cntofu.com/book/office365dev/docs/images/aspnetcore.png" alt=""></a></p>
<h2 id="aspnet-core-mvc-整合了-graph-的场景效果">ASP.NET Core MVC 整合了 Graph 的场景效果</h2>
<p>我已经编写好了一个完整的范例，请大家通过下面的地址进行下载，我后面将大致提到一些重点的功能是如何实现的 <a href="https://github.com/chenxizhang/office365dev/tree/master/samples/aspnetcoremvc">https://github.com/chenxizhang/office365dev/tree/master/samples/aspnetcoremvc</a></p>
<p>在准备这个范例，以及编写这个文章的时候，为了全面地测试在跨平台开发方面的能力，我完全采用了一台全新的 MacBook 作为工作用机，开发工具我使用的是 Visual Studio Code（这个直接就可以在 Mac 里面运行），就像你看到的这样。</p>
<p><a href="https://img.cntofu.com/book/office365dev/docs/images/visualstudiocode.png" data-uk-lightbox><img src="https://img.cntofu.com/book/office365dev/docs/images/visualstudiocode.png" alt=""></a></p>
<p>好的，大致背景我也交代清楚了，如果大家下载了代码，可以跟我一起来体验一下这个应用程序运行起来的效果吧 —— 我推荐你也用 Visual Studio Code 来打开这个应用程序。（是的，你不再需要安装 Visual Studio 完整版）</p>
<p>打开命令行工具，我们很快要运行几个命令 <a href="https://img.cntofu.com/book/office365dev/docs/images/vscodeprojectview.png" data-uk-lightbox><img src="https://img.cntofu.com/book/office365dev/docs/images/vscodeprojectview.png" alt=""></a></p>
<p>请运行下面的命令，下载当前项目所依赖的一些组件包</p>
<blockquote>
<p>dotnet restore</p>
</blockquote>
<p>然后运行下面的命令，可以将当前项目运行起来</p>
<blockquote>
<p>dotnet run</p>
</blockquote>
<p>如果不出意外的话，我写好的这个简单的应用程序会启动起来，并且在本机的5000端口进行监听</p>
<p><a href="https://img.cntofu.com/book/office365dev/docs/images/aspnetcoremvchomepage.png" data-uk-lightbox><img src="https://img.cntofu.com/book/office365dev/docs/images/aspnetcoremvchomepage.png" alt=""></a></p>
<p>看起来跟我们一般的 MVC 程序真的是一样一样的，此时，请点击页面顶部左上角的“About”，看看会发生什么呢</p>
<p><a href="https://img.cntofu.com/book/office365dev/docs/images/aspnetcorelogin.png" data-uk-lightbox><img src="https://img.cntofu.com/book/office365dev/docs/images/aspnetcorelogin.png" alt=""></a></p>
<p>输入正确的用户名和密码后，你就可以看到该用户的基本信息了</p>
<p><a href="https://img.cntofu.com/book/office365dev/docs/images/aspnetcoreaboutpage.png" data-uk-lightbox><img src="https://img.cntofu.com/book/office365dev/docs/images/aspnetcoreaboutpage.png" alt=""></a></p>
<p>好了，功能确实就是这样，足够简单，不是吗？但是正如我猜想你应该会想到的那样，只要打开了 Graph 这扇大门，无穷的宝藏就等着你尽情地创造性地利用了。</p>
<h2 id="代码解析">代码解析</h2>
<p>下面我还是简单地讲解一下我在标准的模板基础上做过哪些定制，从而实现了上面的功能的。</p>
<blockquote>
<p>要创建这个应用程序，你需要安装 dotnet sdk（<a href="https://www.microsoft.com/net/download/core">https://www.microsoft.com/net/download/core</a> ），然后在本地命令行工具中运行 dotnet new mvc 即可</p>
</blockquote>
<p>首先，我为项目添加了几个外部组件包，这是通过修改项目定义文件（aspnetcoremvc.csproj）来实现的。</p>
<pre><code>&lt;PackageReference Include="Microsoft.Graph" Version="1.4.0"../../../&gt;
&lt;PackageReference Include="Microsoft.AspNetCore.Authentication.OpenIdConnect" Version="1.1.0"../../../&gt;
&lt;PackageReference Include="Microsoft.AspNetCore.Authentication.Cookies" Version="1.1.0"../../../&gt;
&lt;PackageReference Include="Microsoft.IdentityModel.Clients.ActiveDirectory" Version="3.13.9"../../../&gt;
&lt;PackageReference Include="Microsoft.AspNetCore.Session" Version="1.1.0"../../../&gt;
&lt;PackageReference Include="Microsoft.Extensions.Caching.Memory" Version="1.1.2"../../../&gt;

</code></pre>
<blockquote>
<p>这些组件都是托管在 nuget.org 这个网站上面，甚至整个 dotnet core 的核心组件也都是开源托管在这个上面。一般添加完这些组件后，都需要运行 dotnet restore 命令在本地进行还原。</p>
</blockquote>
<p>然后，我修改了 Startup.cs 文件。这是 asp.net core 应用程序的一个标准文件，用来定义程序入口，加载相关服务和中间件。（这里涉及的知识面太多，以至于我无法一一说明，有兴趣可以参考 <a href="https://asp.net/core">https://asp.net/core</a> 了解。</p>
<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
//这里增加了一写命名空间导入
using Microsoft.Extensions.Caching;
using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.AspNetCore.Authentication.OpenIdConnect;
using Microsoft.AspNetCore.Session;
using Microsoft.IdentityModel.Protocols.OpenIdConnect;
using Microsoft.IdentityModel.Clients.ActiveDirectory;
using Microsoft.AspNetCore.Authentication;
using System.Security.Claims;
using Microsoft.AspNetCore.Http;

namespace aspntecoremvc
{
    public class Startup
    {

        // This method gets called by the runtime. Use this method to add services to the container.
        //这里引入一些服务，注入一些组件
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddSession();
            services.AddAuthentication(sharedoptions =&gt; sharedoptions.SignInScheme = CookieAuthenticationDefaults.AuthenticationScheme);
           
            // Add framework services.
            services.AddMvc();
        }

        //这里定义了一些静态信息
        private readonly string ClientId="e91ef175-e38d-4feb-b1ed-f243a6a81b93";
        private readonly string Authority=String.Format("https://login.microsoftonline.com/{0}","office365devlabs.onmicrosoft.com");
        private readonly string ClientSecret="2F5jdoGGNn59oxeDLE9fXx5tD86uvzIji74dmLaj3YI=";
        private readonly string GraphResourceId="https://graph.microsoft.com";
        private readonly string CallbackPath ="../../../signin-oidc";

        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
        public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
        {
            loggerFactory.AddConsole();
            loggerFactory.AddDebug();

            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
                app.UseBrowserLink();
            }
            else
            {
                app.UseExceptionHandler("../../../Home/Error");
            }

            app.UseStaticFiles();
            //这里几步是最关键的，定义了如何进行身份认证以及如何保存
            app.UseSession();
            app.UseCookieAuthentication();
            app.UseOpenIdConnectAuthentication(new OpenIdConnectOptions{
                ClientId = ClientId,
                Authority = Authority,
                ClientSecret = ClientSecret,
                ResponseType = OpenIdConnectResponseType.CodeIdToken,
                CallbackPath = CallbackPath,
                GetClaimsFromUserInfoEndpoint =true,
                Events = new OpenIdConnectEvents{
                    OnAuthorizationCodeReceived = OnAuthorizationCodeReceived
                }
            });

            app.UseMvc(routes =&gt;
            {
                routes.MapRoute(
                    name: "default",
                    template: "{controller=Home}/{action=Index}/{id?}");
            });
        }
        private async Task OnAuthorizationCodeReceived(AuthorizationCodeReceivedContext context)
        {
            
            // 将 Token 信息保存在 session 里面，后续 Graph 就可以直接调用了

            string userObjectId = (context.Ticket.Principal.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier"))?.Value;
            ClientCredential clientCred = new ClientCredential(ClientId, ClientSecret);
            AuthenticationContext authContext = new AuthenticationContext(Authority, new SampleSessionCache(userObjectId, context.HttpContext.Session));
            AuthenticationResult authResult = await authContext.AcquireTokenByAuthorizationCodeAsync(
                context.ProtocolMessage.Code, new Uri(context.Properties.Items[OpenIdConnectDefaults.RedirectUriForCodePropertiesKey]), clientCred, GraphResourceId);

            
        }

        private Task OnAuthenticationFailed(FailureContext context)
        {
            context.HandleResponse();
            context.Response.Redirect("../../../Home/Error?message=" + context.Failure.Message);
            return Task.FromResult(0);
        }
    }
}

</code></pre>
<p>我还专门定义了一个简单的类用来保存 Token 信息。为了简单起见，我们将 Token 保存在 Session 里面，这样的话，用户登陆一次后，在一个会话里面就不需要多次登录，而是可以直接重用这些 Token。</p>
<p>这个类其实我是重用了之前在 ASP.NET MVC 开发中的那个类，没有什么特别要交待的，请直接打开 SampleSessionCache.cs 这个文件了解即可。</p>
<p>接下来，为了便于后续在 Controller 里面快速地访问到 Graph，我对 GraphServiceClient 进行了封装，请参考 SDKHelper.cs 这个文件</p>
<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Security.Claims;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Configuration;
using Microsoft.IdentityModel.Clients.ActiveDirectory;
using Microsoft.Graph;
using System.Net.Http.Headers;
using Microsoft.AspNetCore.Http;


namespace aspntecoremvc{
    public static class SDKHelper{
        
        //这里其实是对 ControllerBase 这个类型进行了扩展
        public static async Task&lt;GraphServiceClient&gt; GetAuthenticatedClient(this ControllerBase controller){

            var Authority = String.Format("https://login.microsoftonline.com/{0}","office365devlabs.onmicrosoft.com");
            var ClientId = "e91ef175-e38d-4feb-b1ed-f243a6a81b93";
            var ClientSecret = "2F5jdoGGNn59oxeDLE9fXx5tD86uvzIji74dmLaj3YI=";
            var GraphResourceId = "https://graph.microsoft.com";


            string userObjectId = controller.HttpContext.User.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier")?.Value;
            ClientCredential clientCred = new ClientCredential(ClientId, ClientSecret);
            AuthenticationContext authContext = new AuthenticationContext(Authority, new SampleSessionCache(userObjectId, controller.HttpContext.Session));
            AuthenticationResult result = await authContext.AcquireTokenSilentAsync(GraphResourceId,ClientId);

            GraphServiceClient client = new GraphServiceClient(new DelegateAuthenticationProvider(async request=&gt;{
                request.Headers.Authorization = new AuthenticationHeaderValue("bearer", result.AccessToken);
                await Task.FromResult(0);
            }));

            return client;

        }

    }

}

</code></pre>
<p>有了上面的准备，在真正需要用到 Graph 服务的地方，我们的代码是非常简单的，请参考 HomeController.cs 文件中的 About 方法</p>
<pre><code>[Authorize]//用这个标记该方法需要用户登录
public async Task&lt;IActionResult&gt; About()
{
    var client = await this.GetAuthenticatedClient();  
    //获取用户详细信息，然后传递给视图
    return View(await client.Me.Request().GetAsync());
}
</code></pre>
<p>到这里为止，我的这个例子的主要代码就解释完了。你可能会觉得，这太简单了吧。如果你这样认为，我一方面感到很高兴，因为这是我希望呈现出来的效果；另一方面我要提醒你的是，由于 asp.net core 是一个还比较新的技术，这方面的材料相当少，其实我还是做了相当多的研究才精炼成这样的，其间遇到过多少坑，多少曲折迂回，不足以外人道也，但我很看好 asp.net core，并且将持续在此之上进行投资，这也几乎是可以肯定的。</p>
<h2 id="结语">结语</h2>
<p>这个例子实现的功能并没有什么惊天动地的，但与咱们之前一系列的范例相呼应的是，我是要帮助大家打开 Microsoft Graph 的大门，至于你要怎么去利用里面丰富的宝藏，我就选择的权利交给你自己。</p>
<p>写到这里，我的这个系列文章的第一个大的里程碑应该是要实现了。我用了将近四个月的时间，写了十几篇跟 Office 365 开发入门，以及具体的 Microsoft Graph 开发有关的文章，差不多算是比较完整了。</p>
<p>我还将继续写后续的内容，例如 Office Add-ins，SharePoint 开发，Teams 开发（Bot 等），有兴趣的朋友们可继续关注。</p>
<h2 id="2017年6月30日更新">2017年6月30日更新</h2>
<p>作为一个不断追求代码复用的程序猿，我这两天在上面这个范例基础上对代码进行了一定的封装，如果你此时查看代码的话，会发现已经有了较大的不同。</p>
<p>首先，我将所有公用的代码全部提取到了一个单独的项目（<a href="https://github.com/chenxizhang/office365dev/tree/master/samples/Office365GraphCoreMVCHelper">Office365GraphCoreMVCHelper</a> ）中，这里面的关键代码有</p>
<p>一个用来读取配置文件的类型</p>
<pre><code>namespace Office365GraphCoreMVCHelper
{
    public class AppSetting
    {

        public Info Office365ApplicationInfo { get; set; }

        public class Info
        {
            public string ClientId { get; set; }
            public string ClientSecret { get; set; }
            public string Authority { get; set; }

            public string GraphResourceId { get; set; }
        }
    }
}

</code></pre>
<p>一个可公用的Startup类型</p>
<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Caching;
using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.AspNetCore.Authentication.OpenIdConnect;
using Microsoft.AspNetCore.Session;
using Microsoft.IdentityModel.Protocols.OpenIdConnect;
using Microsoft.IdentityModel.Clients.ActiveDirectory;
using Microsoft.AspNetCore.Authentication;
using System.Security.Claims;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Options;

namespace Office365GraphCoreMVCHelper
{
    public class Startup
    {

        static IConfigurationRoot Configuration { get; set; }

        public Startup(IHostingEnvironment env)
        {
            Configuration = new ConfigurationBuilder()
                            .SetBasePath(env.ContentRootPath)
                            .AddJsonFile("appsettings.json")
                            .Build();
        }

        // This method gets called by the runtime. Use this method to add services to the container.
        public void ConfigureServices(IServiceCollection services)
        {

            //这里将配置信息注入到应用程序中
            services.AddOptions();
            services.Configure&lt;AppSetting&gt;(Configuration);

            services.AddSession();
            services.AddAuthentication(sharedoptions =&gt; sharedoptions.SignInScheme = CookieAuthenticationDefaults.AuthenticationScheme);

            // Add framework services.
            services.AddMvc();
        }


        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
        public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
        {
            loggerFactory.AddConsole();
            loggerFactory.AddDebug();

            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
                app.UseBrowserLink();
            }
            else
            {
                app.UseExceptionHandler("../../../Home/Error");
            }

            //ConfigureMiddleware(app,env,loggerFactory);

            app.UseStaticFiles();
            app.UseSession();
            app.UseCookieAuthentication();
            //获得之前注入的配置信息
            var options = app.ApplicationServices.GetRequiredService&lt;IOptions&lt;AppSetting&gt;&gt;();

            app.UseOpenIdConnectAuthentication(new OpenIdConnectOptions
            {
                ClientId = options.Value.Office365ApplicationInfo.ClientId,
                Authority = options.Value.Office365ApplicationInfo.Authority,
                ClientSecret = options.Value.Office365ApplicationInfo.ClientSecret,
                ResponseType = OpenIdConnectResponseType.CodeIdToken,
                CallbackPath = "../../../signin-oidc",
                GetClaimsFromUserInfoEndpoint = true,
                Events = new OpenIdConnectEvents
                {
                    OnAuthorizationCodeReceived = async (context) =&gt;
                    {
                        string userObjectId = (context.Ticket.Principal.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier"))?.Value;
                        ClientCredential clientCred = new ClientCredential(options.Value.Office365ApplicationInfo.ClientId, options.Value.Office365ApplicationInfo.ClientSecret);
                        AuthenticationContext authContext = new AuthenticationContext(options.Value.Office365ApplicationInfo.Authority, new SampleSessionCache(userObjectId, context.HttpContext.Session));
                        AuthenticationResult authResult = await authContext.AcquireTokenByAuthorizationCodeAsync(
                            context.ProtocolMessage.Code, new Uri(context.Properties.Items[OpenIdConnectDefaults.RedirectUriForCodePropertiesKey]), clientCred, options.Value.Office365ApplicationInfo.GraphResourceId);
                    }
                }
            });

            app.UseMvc(routes =&gt;
            {
                routes.MapRoute(
                    name: "default",
                    template: "{controller=Home}/{action=Index}/{id?}");
            });
        }

        private Task OnAuthenticationFailed(FailureContext context)
        {
            context.HandleResponse();
            context.Response.Redirect("../../../Home/Error?message=" + context.Failure.Message);
            return Task.FromResult(0);
        }
    }
}
</code></pre>
<p>改造过的SDKHelper类型，主要增加了从配置文件中读取信息的功能</p>
<pre><code>using System;
using System.Net.Http.Headers;
using System.Threading.Tasks;
using Microsoft.Graph;
using Microsoft.IdentityModel.Clients.ActiveDirectory;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Options;
using Microsoft.AspNetCore.Builder;

namespace Office365GraphCoreMVCHelper
{
    public static class SDKHelper
    {
        public static async Task&lt;GraphServiceClient&gt; GetAuthenticatedClient(this ControllerBase controller,IOptions&lt;AppSetting&gt; options)
        {
            var Authority = options.Value.Office365ApplicationInfo.Authority;
            var ClientId = options.Value.Office365ApplicationInfo.ClientId;
            var ClientSecret = options.Value.Office365ApplicationInfo.ClientSecret;
            var GraphResourceId = options.Value.Office365ApplicationInfo.GraphResourceId;


            string userObjectId = controller.HttpContext.User.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier")?.Value;
            ClientCredential clientCred = new ClientCredential(ClientId, ClientSecret);
            AuthenticationContext authContext = new AuthenticationContext(Authority, new SampleSessionCache(userObjectId, controller.HttpContext.Session));
            AuthenticationResult result = await authContext.AcquireTokenSilentAsync(GraphResourceId, ClientId);

            GraphServiceClient client = new GraphServiceClient(new DelegateAuthenticationProvider(async request =&gt;
            {
                request.Headers.Authorization = new AuthenticationHeaderValue("bearer", result.AccessToken);
                await Task.FromResult(0);
            }));

            return client;

        }

    }
}
</code></pre>
<p>由于有了这个公用的组件，那么在aspnetcoremvc这个主程序中，我可以极大地简化代码。</p>
<p>首先，我在项目文件中定义了对公用组件的引用</p>
<pre><code>
&lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;

  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;netcoreapp1.1&lt;/TargetFramework&gt;
  &lt;/PropertyGroup&gt;


  &lt;ItemGroup&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore" Version="1.1.2" /&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.Mvc" Version="1.1.3" /&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.StaticFiles" Version="1.1.2" /&gt;
    &lt;PackageReference Include="Microsoft.Extensions.Logging.Debug" Version="1.1.2" /&gt;
    &lt;PackageReference Include="Microsoft.VisualStudio.Web.BrowserLink" Version="1.1.2" /&gt;
    &lt;PackageReference Include="Microsoft.Graph" Version="1.4.0"../../../&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.Authentication.OpenIdConnect" Version="1.1.0"../../../&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.Authentication.Cookies" Version="1.1.0"../../../&gt;
    &lt;PackageReference Include="Microsoft.IdentityModel.Clients.ActiveDirectory" Version="3.13.9"../../../&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.Session" Version="1.1.0"../../../&gt;
    &lt;PackageReference Include="Microsoft.Extensions.Caching.Memory" Version="1.1.2"../../../&gt;
  &lt;/ItemGroup&gt;
  &lt;ItemGroup&gt;   
    &lt;ProjectReference Include="..\Office365GraphCoreMVCHelper\Office365GraphCoreMVCHelper.csproj" /&gt;
  &lt;/ItemGroup&gt;  

&lt;/Project&gt;

</code></pre>
<p>然后，我删除了该项目中的Startup类型，取而代之的在Program中直接引用公用组件中定义好的那个Startup</p>
<pre><code>using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Hosting;
using Office365GraphCoreMVCHelper;

namespace aspntecoremvc
{
    public class Program
    {
        public static void Main(string[] args)
        {
            var host = new WebHostBuilder()
                .UseSetting("startupAssembly","Office365GraphCoreMVCHelper")
                .UseKestrel()
                .UseContentRoot(Directory.GetCurrentDirectory())
                .UseIISIntegration()
                .Build();

            host.Run();
        }
    }
}
</code></pre>
<p>当然，我们需要定义一个配置文件来保存clientId等信息，该文件命名为appsettings.json</p>
<pre><code>{
    "Office365ApplicationInfo":{
        "ClientId":"e91ef175-e38d-4feb-b1ed-f243a6a81b93",
        "ClientSecret":"2F5jdoGGNn59oxeDLE9fXx5tD86uvzIji74dmLaj3YI=",
        "Authority":"https://login.microsoftonline.com/office365devlabs.onmicrosoft.com",
        "GraphResourceId":"https://graph.microsoft.com"
    }
}
</code></pre>
<p>最后，在HomeController（或者同类需要用到Microsoft Graph的Controller）中，通过下面的代码来实现调用</p>
<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Security.Claims;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Configuration;
using Microsoft.IdentityModel.Clients.ActiveDirectory;
using Microsoft.Graph;
using System.Net.Http.Headers;
using Office365GraphCoreMVCHelper;
using Microsoft.Extensions.Options;

namespace aspntecoremvc.Controllers
{
    public class HomeController : Controller
    {
        private readonly IOptions&lt;AppSetting&gt; Options;
        public HomeController(IOptions&lt;AppSetting&gt; options)
        {
            this.Options = options;
        }
    
        public IActionResult Index()
        {

            return View();
        }

        [Authorize]
        public async Task&lt;IActionResult&gt; About()
        {
            var client = await this.GetAuthenticatedClient(this.Options);            
            return View(await client.Me.Request().GetAsync());
        }

        public IActionResult Contact()
        {
            ViewData["Message"] = "Your contact page.";

            return View();
        }

        public IActionResult Error()
        {
            return View();
        }
    }
}

</code></pre>
<h2 id="2017年7月1日更新">2017年7月1日更新</h2>
<p>我进一步上面分离出来的这个Office365GraphCoreMVCHelper的项目打包成了一个nuget的package<a href="https://www.nuget.org/packages/Office365GraphCoreMVCHelper/">https://www.nuget.org/packages/Office365GraphCoreMVCHelper/</a>，以便实现更大范围的复用。</p>
<p><a href="https://img.cntofu.com/book/office365dev/docs/images/aspnetcorehelpernugetpackage.png" data-uk-lightbox><img src="https://img.cntofu.com/book/office365dev/docs/images/aspnetcorehelpernugetpackage.png" alt=""></a></p>
<p>如何使用它呢？很简单，请按照下面的步骤即可</p>
<ol>
<li>创建一个ASP.NET Core MVC项目</li>
</ol>
<blockquote>
<p>dotnet new mvc</p>
</blockquote>
<ol start="2">
<li>增加对于Office365GraphCoreMVCHelper的引用，修改csproj文件，添加如下的定义</li>
</ol>
<blockquote>
<packagereference Include="Office365GraphCoreMVCHelper" Version="1.1.0" />
</blockquote>
<ol start="3">
<li>下载这个包</li>
</ol>
<blockquote>
<p>dotnet restore</p>
</blockquote>
<ol start="4">
<li>修改Program.cs文件，使用Office365GraphCoreMVCHelper 定义好的Startup类（增加下面代码中的UseSetting这一句）。当前项目的Startup.cs文件可以删除。</li>
</ol>
<pre><code>using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Hosting;

namespace testaspnetcoremvc
{
    public class Program
    {
        public static void Main(string[] args)
        {
            var host = new WebHostBuilder()
                .UseKestrel()
                .UseContentRoot(Directory.GetCurrentDirectory())
                .UseIISIntegration()
                .UseSetting("startupAssembly","Office365GraphCoreMVCHelper")
                .Build();

            host.Run();
        }
    }
}

</code></pre>
<ol start="4">
<li>修改appsettings.json文件，确保里面有如下Office365ApplicationInfo信息</li>
</ol>
<pre><code>{
  "Office365ApplicationInfo":{
    "ClientId":"e91ef175-e38d-4feb-b1ed-f243a6a81b93",
    "ClientSecret":"2F5jdoGGNn59oxeDLE9fXx5tD86uvzIji74dmLaj3YI=",
    "Authority":"https://login.microsoftonline.com/office365devlabs.onmicrosoft.com",
    "GraphResourceId":"https://graph.microsoft.com"
  },
  "Logging": {
    "IncludeScopes": false,
    "LogLevel": {
      "Default": "Warning"
    }
  }
}


</code></pre>
<ol start="5">
<li>修改HomeController，在需要进行身份验证以及调用Graph API的地方使用如下的代码即可</li>
</ol>
<pre><code>//添加几个引用
using Office365GraphCoreMVCHelper;
using Microsoft.Extensions.Options;
using Microsoft.AspNetCore.Authorization;

//修改构造函数，接受注入的配置信息
private IOptions&lt;AppSetting&gt; settings;
public HomeController(IOptions&lt;AppSetting&gt; options)
{
    settings = options;
}


//在需要调用Graph API的Action中做如下修改
[Authorize]
public async Task&lt;IActionResult&gt; About()
{
    var client = await this.GetAuthenticatedClient(settings);
    var user = client.Me.Request().GetAsync().Result;

    ViewData["Message"] = $"Hello,{user.DisplayName}";
    return View();
}
</code></pre>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/98/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/visualstudio_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/98/index.html">Microsoft Visual Studio Code 中文手册</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/60.html">likebeta</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="visualstudio">visualstudio</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">66页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月29日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 0个">0</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/78/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/java_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/78/index.html">阿里巴巴Java开发手册</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/49.html">Alibaba</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="java">java</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">24页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月24日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 9831个">9831</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/174/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/machine-learning_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/174/index.html">人工智能知识树</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/18.html">ApacheCN</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="machine-learning">machine-learning</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">1页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月26日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 119个">119</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/118/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/influxdb_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/118/index.html">Influxdb 简明手册 教程 入门 文档</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/62.html">tzivanmoe</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="influxdb">influxdb</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">18页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年7月1日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 0个">0</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/18/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/go_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/18/index.html">Go社区的知识图谱</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/13.html">golang foundation</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="go">go</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">1页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 1356个">1356</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/160/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/python_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/160/index.html">Python - 100天从新手到大师</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/92.html">jackfrued</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="python">python</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">75页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月26日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 33569个">33569</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../../" title="返回首页"><img class="" src="../../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../../book/131/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../../book/131/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/131/README.html" title="系列文章简介" data-book-page-rel-url="README.html" data-book-page-id="9986">系列文章简介</a>
<ul>
<li>
<a class="pjax" href="../../../book/131/docs/office365dev-overview-1.html" title="上篇" data-book-page-rel-url="docs/office365dev-overview-1.html" data-book-page-id="10548">上篇</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/office365dev-overview-2.html" title="下篇" data-book-page-rel-url="docs/office365dev-overview-2.html" data-book-page-id="10549">下篇</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/office365devenv.html" title="Office 365开发环境搭建" data-book-page-rel-url="docs/office365devenv.html" data-book-page-id="10550">Office 365开发环境搭建</a>
<ul>
<li>
<a class="pjax" href="../../../book/131/docs/microsoftgraphoverview.html" title="Microsoft Graph 概述" data-book-page-rel-url="docs/microsoftgraphoverview.html" data-book-page-id="10551">Microsoft Graph 概述</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/graphexplorer.html" title="通过GraphExplorer体验Microsoft Graph" data-book-page-rel-url="docs/graphexplorer.html" data-book-page-id="10552">通过GraphExplorer体验Microsoft Graph</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/graph-tools.html" title="通过其他第三方工具体验Microsoft Graph" data-book-page-rel-url="docs/graph-tools.html" data-book-page-id="10553">通过其他第三方工具体验Microsoft Graph</a>
<ul>
<li>
<a class="pjax" href="../../../book/131/docs/applicationregisteration.html" title="注册Azure AD 应用程序" data-book-page-rel-url="docs/applicationregisteration.html" data-book-page-id="10554">注册Azure AD 应用程序</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/applicationregisteration2.0.html" title="注册Azure AD 2.0 应用程序" data-book-page-rel-url="docs/applicationregisteration2.0.html" data-book-page-id="10555">注册Azure AD 2.0 应用程序</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/chinaoffice365applicationregisteration.html" title="注册中国版Microsoft Graph应用程序" data-book-page-rel-url="docs/chinaoffice365applicationregisteration.html" data-book-page-id="10556">注册中国版Microsoft Graph应用程序</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/understandapplication.html" title="掀起Azure AD的盖头来——深入理解Microsoft Graph应用程序和服务权限声明" data-book-page-rel-url="docs/understandapplication.html" data-book-page-id="10557">掀起Azure AD的盖头来——深入理解Microsoft Graph应用程序和服务权限声明</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/desktopapplication.html" title="Microsoft Graph 桌面应用程序" data-book-page-rel-url="docs/desktopapplication.html" data-book-page-id="10558">Microsoft Graph 桌面应用程序</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/powershell-application.html" title="PowerShell脚本访问Microsoft Graph" data-book-page-rel-url="docs/powershell-application.html" data-book-page-id="10559">PowerShell脚本访问Microsoft Graph</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/powershell-module.html" title="支持国内版Office 365的PowerShell模块现已发布" data-book-page-rel-url="docs/powershell-module.html" data-book-page-id="10560">支持国内版Office 365的PowerShell模块现已发布</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/webapplication.html" title="Microsoft Graph  Web应用程序极致开发体验" data-book-page-rel-url="docs/webapplication.html" data-book-page-id="10561">Microsoft Graph Web应用程序极致开发体验</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/gettenantid.html" title="如何通过PowerShell获取Office 365 TenantID" data-book-page-rel-url="docs/gettenantid.html" data-book-page-id="10562">如何通过PowerShell获取Office 365 TenantID</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/deamonapplication.html" title="Microsoft Graph  服务应用程序" data-book-page-rel-url="docs/deamonapplication.html" data-book-page-id="10563">Microsoft Graph 服务应用程序</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/crossplatform.html" title="在ASP.NET Core MVC 应用程序中集成 Microsoft Graph" data-book-page-rel-url="docs/crossplatform.html" data-book-page-id="10564">在ASP.NET Core MVC 应用程序中集成 Microsoft Graph</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/graphextensions.html" title="扩展Microsoft Graph数据结构 -开放扩展" data-book-page-rel-url="docs/graphextensions.html" data-book-page-id="10565">扩展Microsoft Graph数据结构 -开放扩展</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/graphschemaextensions.html" title="扩展Microsoft Graph数据结构 -架构扩展" data-book-page-rel-url="docs/graphschemaextensions.html" data-book-page-id="10566">扩展Microsoft Graph数据结构 -架构扩展</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/excelgraph.html" title="Excel as a Service —— Excel 开发居然可以这么玩" data-book-page-rel-url="docs/excelgraph.html" data-book-page-id="10567">Excel as a Service —— Excel 开发居然可以这么玩</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/timeline.html" title="基于Microsoft Graph打造自己的Timeline应用" data-book-page-rel-url="docs/timeline.html" data-book-page-id="10568">基于Microsoft Graph打造自己的Timeline应用</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/tokenplease.html" title="通过tokenPlease()函数获取accessToken" data-book-page-rel-url="docs/tokenplease.html" data-book-page-id="10569">通过tokenPlease()函数获取accessToken</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/id_token.html" title="解码id_token" data-book-page-rel-url="docs/id_token.html" data-book-page-id="10570">解码id_token</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/oauth.html" title="详解 OAuth的场景" data-book-page-rel-url="docs/oauth.html" data-book-page-id="10571">详解 OAuth的场景</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/officeaddins.html" title="Office Add-in 架构和入门" data-book-page-rel-url="docs/officeaddins.html" data-book-page-id="10572">Office Add-in 架构和入门</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/officeaddindev.html" title="在Visual Studio 中开发Office Add-in" data-book-page-rel-url="docs/officeaddindev.html" data-book-page-id="10573">在Visual Studio 中开发Office Add-in</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/vscodetoofficeaddin.html" title="在Visual Studio Code中开发Office Add-in" data-book-page-rel-url="docs/vscodetoofficeaddin.html" data-book-page-id="10574">在Visual Studio Code中开发Office Add-in</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/officeaddindesignguide.html" title="Office Add-in 设计规范与最佳实践" data-book-page-rel-url="docs/officeaddindesignguide.html" data-book-page-id="10575">Office Add-in 设计规范与最佳实践</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/exceladdinsample.html" title="实战Excel Add-in的三种玩法(VBA,VSTO,Web Add-in)" data-book-page-rel-url="docs/exceladdinsample.html" data-book-page-id="10576">实战Excel Add-in的三种玩法(VBA,VSTO,Web Add-in)</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/exceladdinpractics.html" title="Office Web Add-in的技术原理和开发常见问题剖析" data-book-page-rel-url="docs/exceladdinpractics.html" data-book-page-id="10577">Office Web Add-in的技术原理和开发常见问题剖析</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/officeaddinmanifest.html" title="详解Office Add-in 清单文件" data-book-page-rel-url="docs/officeaddinmanifest.html" data-book-page-id="10578">详解Office Add-in 清单文件</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/officeaddinpublish.html" title="在企业和应用市场发布Office Add-in" data-book-page-rel-url="docs/officeaddinpublish.html" data-book-page-id="10579">在企业和应用市场发布Office Add-in</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/officeaddinsso.html" title="在Office Add-in中实现单点登陆（SSO）" data-book-page-rel-url="docs/officeaddinsso.html" data-book-page-id="10580">在Office Add-in中实现单点登陆（SSO）</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/sharepoint.html" title="再谈 SharePoint 大局观" data-book-page-rel-url="docs/sharepoint.html" data-book-page-id="10581">再谈 SharePoint 大局观</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/sharepointaddin.html" title="SharePoint Add-in 开发" data-book-page-rel-url="docs/sharepointaddin.html" data-book-page-id="10582">SharePoint Add-in 开发</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/sharepointpnp.html" title="SharePoint Patterns and Practices 简介" data-book-page-rel-url="docs/sharepointpnp.html" data-book-page-id="10583">SharePoint Patterns and Practices 简介</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/sharepointframework.html" title="SharePoint Framework 简介" data-book-page-rel-url="docs/sharepointframework.html" data-book-page-id="10584">SharePoint Framework 简介</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/office365connector.html" title="Office 365 Connectors 的使用与自定义开发" data-book-page-rel-url="docs/office365connector.html" data-book-page-id="10585">Office 365 Connectors 的使用与自定义开发</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/officebusinessapp.html" title="基于Office 365的随需应变业务应用平台" data-book-page-rel-url="docs/officebusinessapp.html" data-book-page-id="10586">基于Office 365的随需应变业务应用平台</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/powerapps.html" title="PowerApps 入门篇" data-book-page-rel-url="docs/powerapps.html" data-book-page-id="10587">PowerApps 入门篇</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/powerappsadv.html" title="PowerApps 进阶篇" data-book-page-rel-url="docs/powerappsadv.html" data-book-page-id="10588">PowerApps 进阶篇</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/microsoftflow.html" title="Microsoft Flow 概览" data-book-page-rel-url="docs/microsoftflow.html" data-book-page-id="10589">Microsoft Flow 概览</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/commondatamodel.html" title="Common Data Service 初探" data-book-page-rel-url="docs/commondatamodel.html" data-book-page-id="10590">Common Data Service 初探</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/powerappsconnector.html" title="为PowerApps和Flow开发自定义连接器" data-book-page-rel-url="docs/powerappsconnector.html" data-book-page-id="10591">为PowerApps和Flow开发自定义连接器</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/powerbi.html" title="观未见，行不止 —— Power BI 两周年技术和方案交流圆桌会议纪实" data-book-page-rel-url="docs/powerbi.html" data-book-page-id="10592">观未见，行不止 —— Power BI 两周年技术和方案交流圆桌会议纪实</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/officeandai.html" title="人工智能背景下的Office 365现状和发展趋势" data-book-page-rel-url="docs/officeandai.html" data-book-page-id="10593">人工智能背景下的Office 365现状和发展趋势</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/botframeworkquickstart.html" title="Office 365 机器人（Bot）开发入门" data-book-page-rel-url="docs/botframeworkquickstart.html" data-book-page-id="10594">Office 365 机器人（Bot）开发入门</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/botframeworkguide.html" title="Office 365 机器人（Bot）开发入门指南" data-book-page-rel-url="docs/botframeworkguide.html" data-book-page-id="10595">Office 365 机器人（Bot）开发入门指南</a>
</li>
<li>
<a class="pjax" href="../../../book/131/docs/office365opensource.html" title="拥抱开源，Office 365开发迎来新的时代" data-book-page-rel-url="docs/office365opensource.html" data-book-page-id="10596">拥抱开源，Office 365开发迎来新的时代</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =131;var bookPageId =10564;var bookPageRelUrl ='docs/crossplatform.html';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>