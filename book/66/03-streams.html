
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>Streams-Java 8:新特性教程(Java 8: The Missing Tutorial)</title>
<meta content='Streams,Java 8:新特性教程,Java 8: The Missing Tutorial' name='keywords'>
<meta content='Streams,Java 8:新特性教程,Java 8: The Missing Tutorial' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../static/components/css/base.css">
<link rel="stylesheet" href="../../static/components/css/reader.css">
<link rel="stylesheet" href="../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-left ">
<a href="../../book/66/02-lambdas.html">
<i class="nav-icon-left uk-icon-small  uk-icon-caret-left"></i>
<span class="">Lambdas</span>
</a>
</div>
<div class="uk-align-right ">
<a href="../../book/66/04-collectors.html">
<span class="">Collectors</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../book/66/index.html">Java 8:新特性教程 (Java 8: The Missing Tutorial)</a>
<a target="_blank" rel="nofollow" href="https://github.com/shekhargulati/java8-the-missing-tutorial" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<h2 id="streams">Streams</h2>
<p>In <a href="./02-lambdas.html">chapter 2</a>, we learned how lambdas can help us write clean, concise code, by allowing us to pass behavior without the need to create a class. Lambdas are a simple language construct that help developers express their intent on the fly by using functional interfaces. The real power of lambdas can be experienced when an API is designed while keeping lambdas in mind, i.e. a fluent API that makes use of Functional interfaces (we discussed them in the <a href="./02-lambdas.html#do-i-need-to-write-my-own-functional-interfaces">lambdas chapter</a>).</p>
<p>One such API that makes use of lambdas is the Stream API introduced in JDK 8. Streams provide a higher level abstraction to express computations on Java collections in a declarative way similar to how SQL helps you declaratively query data in a database. Declarative means developers write what they want to do rather than how it should be done. In this chapter, we will discuss the need for a new data processing API, the difference between <code>Collection</code> and <code>Stream</code>, and how to use the Stream API in your applications.</p>
<blockquote>
<p>Code for this section is inside <a href="https://github.com/shekhargulati/java8-the-missing-tutorial/tree/master/code/src/main/java/com/shekhargulati/java8_tutorial/ch03">ch03 package</a>.</p>
</blockquote>
<h2 id="why-we-need-a-new-data-processing-abstraction">Why we need a new data processing abstraction</h2>
<p>In my opinion, there are two reasons:</p>
<ol>
<li> <p>The <code>Collection</code> API does not provide higher level constructs to query the data, so developers are forced to write a lot of boilerplate code for trivial tasks.</p> </li>
<li> <p>It has limited language support to process <code>Collection</code> data in parallel. It is left to the developer to use Java language concurrency constructs and process data effectively and efficiently in parallel.</p> </li>
</ol>
<h2 id="data-processing-before-java-8">Data processing before Java 8</h2>
<p>Look at the code shown below and try to predict what it does.</p>
<pre><code class="language-java">public class Example1_Java7 {

    public static void main(String[] args) {
        List&lt;Task&gt; tasks = getTasks();

        List&lt;Task&gt; readingTasks = new ArrayList&lt;&gt;();
        for (Task task : tasks) {
            if (task.getType() == TaskType.READING) {
                readingTasks.add(task);
            }
        }
        Collections.sort(readingTasks, new Comparator&lt;Task&gt;() {
            @Override
            public int compare(Task t1, Task t2) {
                return t1.getTitle().length() - t2.getTitle().length();
            }
        });
        for (Task readingTask : readingTasks) {
            System.out.println(readingTask.getTitle());
        }
    }
}
</code></pre>
<p>The code shown above prints all the reading task titles, sorted by their title length. Java 7 developers write this kind of code every day. To write such a simple program, we had to write 15 lines of Java code. The bigger problem with the above mentioned code is not the number of lines a developer has to write but, that it misses the developer's intent, i.e. filtering reading tasks, sorting by title length, and transforming to String List.</p>
<h2 id="data-processing-in-java-8">Data processing in Java 8</h2>
<p>The above mentioned code can be simplified using the Java 8 <code>Stream</code> API, as shown below.</p>
<pre><code class="language-java">public class Example1_Stream {

    public static void main(String[] args) {
        List&lt;Task&gt; tasks = getTasks();

        List&lt;String&gt; readingTasks = tasks.stream()
                .filter(task -&gt; task.getType() == TaskType.READING)
                .sorted((t1, t2) -&gt; t1.getTitle().length() - t2.getTitle().length())
                .map(Task::getTitle)
                .collect(Collectors.toList());

        readingTasks.forEach(System.out::println);
    }
}
</code></pre>
<p>The code shown above constructs a pipeline comprising multiple stream operations, each discussed below.</p>
<ul>
<li><strong>stream()</strong> - Created a stream pipeline by invoking the <code>stream()</code> method on the source collection, i.e. <code>tasks</code> <code>List&lt;Task&gt;</code>.</li>
<li><strong>filter(Predicate
<t>
)
</t></strong> - This operation extracted elements in the stream matching the condition defined by the predicate. Once you have a stream you can call zero or more intermediate operations on it. The lambda expression <code>task -&gt; task.getType() == TaskType.READING</code> defined a predicate to filter all reading tasks. The type of lambda expression is <code>java.util.function.Predicate&lt;Task&gt;</code>.</li>
<li><strong>sorted(Comparator
<t>
)
</t></strong>: This operation returns a stream consisting of all the stream elements sorted by the Comparator defined by lambda expression i.e. <code>(t1, t2) -&gt; t1.getTitle().length() - t2.getTitle().length()</code> in the example shown above.</li>
<li><strong>map(Function&lt;T,R&gt;)</strong>: This operation returns a stream after applying the Function&lt;T,R&gt; on each element of this stream.</li>
<li><strong>collect(toList())</strong> - This operation collects results of the operations performed on the Stream into a List.</li>
</ul>
<h3 id="why-java-8-code-is-better">Why Java 8 code is better</h3>
<p>In my opinion Java 8 code is better because of following reasons:</p>
<ol>
<li> <p>Java 8 code clearly reflects developer intent of filtering, sorting, etc.</p> </li>
<li> <p>Developers express what they want to do rather than how they want do it by using a higher level abstraction in the form of the Stream API.</p> </li>
<li> <p>The Stream API provides a unified language for data processing. Now developers will have a common vocabulary when talking about data processing. When two developers talk about a <code>filter</code> function, you can be sure that they both are applying a data filtering operation.</p> </li>
<li> <p>No boilerplate code is required to express data processing. Developers no longer have to write explicit <code>for</code> loops, or create temporary collections to store data. All is taken care by the Stream API itself.</p> </li>
<li> <p>Streams do not modify your underlying collection - they are non-mutating.</p> </li>
</ol>
<h2 id="what-is-a-stream">What is a Stream?</h2>
<p>Stream is an abstract view over some data. For example, Stream can be a view over a list, or lines in a file, or any other sequence of elements. The Stream API provides aggregate operations that can be performed sequentially, or in parallel. <em><strong>One thing that developers should keep in mind is that Stream is a higher level abstraction, not a data structure. Stream does not store your data.</strong></em> Streams are <strong>lazy</strong> by nature, and they are only computed when accessed. This allows us to produce infinite streams of data. In Java 8, you can very easily write a Stream that will produce infinite unique identifiers as shown below.</p>
<pre><code>public static void main(String[] args) {
    Stream&lt;String&gt; uuidStream = Stream.generate(() -&gt; UUID.randomUUID().toString());
}
</code></pre>
<p>There are various static factory methods like <code>of</code>, <code>generate</code>, and <code>iterate</code> in the Stream interface, that one can use to create Stream instances. The <code>generate</code> method shown above takes a <code>Supplier</code>. <code>Supplier</code> is a functional interface to describe a function that does not take any input and produce a value. We passed the <code>generate</code> method a supplier, that, when invoked, generates a unique identifier.</p>
<pre><code class="language-java">Supplier&lt;String&gt; uuids = () -&gt; UUID.randomUUID().toString()
</code></pre>
<p>If you run this program nothing will happen as Streams are lazy and until they are accessed nothing will be computed. If we update the program to the one shown below we will see UUID printing to the console. The program will never terminate.</p>
<pre><code class="language-java">public static void main(String[] args) {
    Stream&lt;String&gt; uuidStream = Stream.generate(() -&gt; UUID.randomUUID().toString());
    uuidStream.forEach(System.out::println);
}
</code></pre>
<p>Java 8 allows you to create a Stream from a Collection by calling the <code>stream</code> method on it. Stream supports data processing operations so that developers can express computations using higher level data processing constructs.</p>
<h2 id="collection-vs-stream">Collection vs Stream</h2>
<p>The table shown below explains the difference between a Collection and a Stream.</p>
<p><a href="https://whyjava.files.wordpress.com/2015/10/collection_vs_stream.png" data-uk-lightbox><img src="https://whyjava.files.wordpress.com/2015/10/collection_vs_stream.png" alt="Collection vs Stream"></a></p>
<p>Let's discuss External iteration vs internal iteration, and Lazy evaluation in detail.</p>
<h3 id="external-iteration-vs-internal-iteration">External iteration vs internal iteration</h3>
<p>The difference between Java 8 Stream API code and Collection API code shown above is who controls the iteration -- the iterator or the client that uses the iterator. Users of the Stream API just provide the operations they want to apply, and the iterator applies those operations to every element in the underlying Collection. When iterating over the underlying collection and the process is handled by the iterator itself, this is called <strong>internal iteration</strong>. On the other hand, when iteration is handled by the client it is called <strong>external iteration</strong>. The use of <code>for-each</code> construct in the Collection API code is an example of <strong>external iteration</strong>.</p>
<p>Some might argue that in the Collection API code we didn't have to work with the underlying iterator as the <code>for-each</code> construct took care of that but, <code>for-each</code> is nothing more than syntactic sugar over manual iteration using the iterator API. The <code>for-each</code> construct, although very simple, has a few disadvantages -- 1) It is inherently sequential, 2) It leads to imperative code, and 3) It is difficult to parallelize.</p>
<h3 id="lazy-evaluation">Lazy evaluation</h3>
<p>Streams are not evaluated until a terminal operation is called on them. Most of the operations in the Stream API return a Stream. These operations do not perform any execution -- they just build the pipeline. Let's look at the code shown below and try to predict its output.</p>
<pre><code class="language-java">List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 3, 4, 5);
Stream&lt;Integer&gt; stream = numbers.stream().map(n -&gt; n / 0).filter(n -&gt; n % 2 == 0);
</code></pre>
<p>In the code shown above, we are dividing elements in numbers stream by 0. We might expect that this code will throw <code>ArithmeticException</code> when the code is executed. But, when you run this code no exception will be thrown. This is because streams are not evaluated until a terminal operation is called on the stream. If you add terminal operation to the stream pipeline, then the stream is executed, and an exception is thrown.</p>
<pre><code class="language-java">List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 3, 4, 5);
Stream&lt;Integer&gt; stream = numbers.stream().map(n -&gt; n / 0).filter(n -&gt; n % 2 == 0);
stream.collect(toList());
</code></pre>
<p>You will get stack trace as shown below.</p>
<pre><code>Exception in thread "main" java.lang.ArithmeticException: / by zero
	at org._7dayswithx.java8.day2.EagerEvaluationExample.lambda$main$0(EagerEvaluationExample.java:13)
	at org._7dayswithx.java8.day2.EagerEvaluationExample$$Lambda$1/1915318863.apply(Unknown Source)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:948)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:512)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:502)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
</code></pre>
<h2 id="using-stream-api">Using Stream API</h2>
<p>The Stream API provides many operations that developers can use to query data from collections. Stream operations fall into either of the two categories -- intermediate operation, or terminal operation.</p>
<p><strong>Intermediate operations</strong> are functions that produce another stream from the existing stream like <code>filter</code>, <code>map</code>, <code>sorted</code>, etc.</p>
<p><strong>Terminal operations</strong> are functions that produce a non-stream result from the Stream like <code>collect(toList())</code> , <code>forEach</code>, <code>count</code> etc.</p>
<p>Intermediate operations allow you to build the pipeline which gets executed when you call the terminal operation. Below is the list of functions that are part of the Stream API.</p>
<p><a href="https://whyjava.files.wordpress.com/2015/07/stream-api.png"><a href="https://whyjava.files.wordpress.com/2015/07/stream-api.png" data-uk-lightbox><img class="aligncenter size-full wp-image-2983" src="https://whyjava.files.wordpress.com/2015/07/stream-api.png" alt="stream-api" height="450"></a></a></p>
<h3 id="example-domain">Example domain</h3>
<p>Throughout this tutorial we will use Task management domain to explain concepts. Our example domain has one class called Task -- a task to be performed by user. The class is shown below.</p>
<pre><code class="language-java">import java.time.LocalDate;
import java.util.*;

public class Task {
    private final String id;
    private final String title;
    private final TaskType type;
    private final LocalDate createdOn;
    private boolean done = false;
    private Set&lt;String&gt; tags = new HashSet&lt;&gt;();
    private LocalDate dueOn;

    // removed constructor, getter, and setter for brevity
}
</code></pre>
<p>The sample dataset is given below. We will use this list throughout our Stream API examples.</p>
<pre><code class="language-java">Task task1 = new Task("Read Version Control with Git book", TaskType.READING, LocalDate.of(2015, Month.JULY, 1)).addTag("git").addTag("reading").addTag("books");

Task task2 = new Task("Read Java 8 Lambdas book", TaskType.READING, LocalDate.of(2015, Month.JULY, 2)).addTag("java8").addTag("reading").addTag("books");

Task task3 = new Task("Write a mobile application to store my tasks", TaskType.CODING, LocalDate.of(2015, Month.JULY, 3)).addTag("coding").addTag("mobile");

Task task4 = new Task("Write a blog on Java 8 Streams", TaskType.WRITING, LocalDate.of(2015, Month.JULY, 4)).addTag("blogging").addTag("writing").addTag("streams");

Task task5 = new Task("Read Domain Driven Design book", TaskType.READING, LocalDate.of(2015, Month.JULY, 5)).addTag("ddd").addTag("books").addTag("reading");

List&lt;Task&gt; tasks = Arrays.asList(task1, task2, task3, task4, task5);
</code></pre>
<blockquote>
<p>We will not discuss about Java 8 Date Time API in this chapter. For now, just think of as the fluent API to work with dates.</p>
</blockquote>
<h3 id="example-1-find-all-reading-task-titles-sorted-by-their-creation-date">Example 1: Find all reading task titles sorted by their creation date</h3>
<p>The first example that we will discuss is to find all the reading task titles sorted by creation date. The operations that we need to perform are:</p>
<ol>
<li>Filter all the tasks that have TaskType as <code>READING</code>.</li>
<li>Sort the filtered values tasks by <code>createdOn</code> field.</li>
<li>Get the value of title for each task.</li>
<li>Collect the resulting titles in a List.</li>
</ol>
<p>The following four operations can be easily translated to the code as shown below.</p>
<pre><code class="language-java">private static List&lt;String&gt; allReadingTasks(List&lt;Task&gt; tasks) {
        List&lt;String&gt; readingTaskTitles = tasks.stream().
                filter(task -&gt; task.getType() == TaskType.READING).
                sorted((t1, t2) -&gt; t1.getCreatedOn().compareTo(t2.getCreatedOn())).
                map(task -&gt; task.getTitle()).
                collect(Collectors.toList());
        return readingTaskTitles;
}
</code></pre>
<p>In the code shown above, we used the following methods of the Stream API:</p>
<ul>
<li><strong>filter</strong>: Allows you to specify a predicate to exclude some elements from the underlying stream. The predicate <strong>task -&gt; task.getType() == TaskType.READING</strong> selects all the tasks whose TaskType is <code>READING</code>.</li>
<li><strong>sorted</strong>: Allows you to specify a Comparator that will sort the stream. In this case, you sorted based on the creation date. The lambda expression <strong>(t1, t2) -&gt; t1.getCreatedOn().compareTo(t2.getCreatedOn())</strong> provides implementation of the <code>compare</code> method of Comparator functional interface.</li>
<li><strong>map</strong>: It takes a lambda that implements <code>Function&lt;? super T, ? extends R&gt;</code> which transforms one stream to another stream. The lambda expression <strong>task -&gt; task.getTitle()</strong> transforms a task into a title.</li>
<li><strong>collect(toList())</strong> It is a terminal operation that collects the resulting reading titles into a List.</li>
</ul>
<p>We can improve the above Java 8 code by using <code>comparing</code> method of <code>Comparator</code> interface and method references as shown below.</p>
<pre><code class="language-java">public List&lt;String&gt; allReadingTasks(List&lt;Task&gt; tasks) {
    return tasks.stream().
            filter(task -&gt; task.getType() == TaskType.READING).
            sorted(Comparator.comparing(Task::getCreatedOn)).
            map(Task::getTitle).
            collect(Collectors.toList());

}
</code></pre>
<blockquote>
<p>From Java 8, interfaces can have method implementations in the form of static and default methods. This is covered in <a href="./01-default-static-interface-methods.html">ch01</a>.</p>
</blockquote>
<p>In the code shown above, we used a static helper method <code>comparing</code> available in the <code>Comparator</code> interface which accepts a <code>Function</code> that extracts a <code>Comparable</code> key, and returns a <code>Comparator</code> that compares by that key. The method reference <code>Task::getCreatedOn</code> resolves to <code>Function&lt;Task, LocalDate&gt;</code>.</p>
<p>Using function composition, we can very easily write code that reverses the sorting order by calling the <code>reversed()</code> method on Comparator, as shown below.</p>
<pre><code class="language-java">public List&lt;String&gt; allReadingTasksSortedByCreatedOnDesc(List&lt;Task&gt; tasks) {
    return tasks.stream().
            filter(task -&gt; task.getType() == TaskType.READING).
            sorted(Comparator.comparing(Task::getCreatedOn).reversed()).
            map(Task::getTitle).
            collect(Collectors.toList());
}
</code></pre>
<h3 id="example-2-find-distinct-tasks">Example 2: Find distinct tasks</h3>
<p>Suppose, we have a dataset which contains duplicate tasks. We can very easily remove the duplicates and get only distinct elements by using the <code>distinct</code> method on the stream, as shown below.</p>
<pre><code class="language-java">public List&lt;Task&gt; allDistinctTasks(List&lt;Task&gt; tasks) {
    return tasks.stream().distinct().collect(Collectors.toList());
}
</code></pre>
<p>The <code>distinct()</code> method converts one stream into another without duplicates. It uses the Object's <code>equals</code> method for determining the object equality. According to that Object's <code>equals</code> method contract, when two objects are equal, they are considered duplicates, and will be removed from the resulting stream.</p>
<h3 id="example-3-find-top-5-reading-tasks-sorted-by-creation-date">Example 3: Find top 5 reading tasks sorted by creation date</h3>
<p>The <code>limit</code> function can be used to limit the result set to a given size. <code>limit</code> is a short circuiting operation which means it does not evaluate all the elements to find the result.</p>
<pre><code class="language-java">public List&lt;String&gt; topN(List&lt;Task&gt; tasks, int n){
    return tasks.stream().
            filter(task -&gt; task.getType() == TaskType.READING).
            sorted(comparing(Task::getCreatedOn)).
            map(Task::getTitle).
            limit(n).
            collect(toList());
}
</code></pre>
<p>You can use <code>limit</code> along with the <code>skip</code> method to create pagination, as shown below.</p>
<pre><code class="language-java">// page starts from 0. So to view a second page `page` will be 1 and n will be 5.
List&lt;String&gt; readingTaskTitles = tasks.stream().
                filter(task -&gt; task.getType() == TaskType.READING).
                sorted(comparing(Task::getCreatedOn).reversed()).
                map(Task::getTitle).
                skip(page * n).
                limit(n).
                collect(toList());
</code></pre>
<h3 id="example-4-count-all-reading-tasks">Example 4: Count all reading tasks</h3>
<p>To get the count of all the reading tasks, we can use <code>count</code> method on the stream. This method is a terminal operation.</p>
<pre><code class="language-java">public long countAllReadingTasks(List&lt;Task&gt; tasks) {
    return tasks.stream().
            filter(task -&gt; task.getType() == TaskType.READING).
            count();
}
</code></pre>
<h3 id="example-5-find-all-unique-tags-from-all-tasks">Example 5: Find all unique tags from all tasks</h3>
<p>To find all the distinct tags we have to perform following operations:</p>
<ol>
<li>Extract tags for each task.</li>
<li>Collect all the tags into one stream.</li>
<li>Remove the duplicates.</li>
<li>Finally collect the result into a list.</li>
</ol>
<p>The first and second operations can be performed by using the <code>flatMap</code> operation on the <code>tasks</code> stream. The <code>flatMap</code> operation flattens the streams returned by each invocation of <code>tasks.getTags().stream()</code> into one stream. Once we have all the tags in one stream, we just used <code>distinct</code> method on it to get all unique tags.</p>
<pre><code class="language-java">private static List&lt;String&gt; allDistinctTags(List&lt;Task&gt; tasks) {
        return tasks.stream().flatMap(task -&gt; task.getTags().stream()).distinct().collect(toList());
}
</code></pre>
<h3 id="example-6-check-if-all-reading-tasks-have-tag-books">Example 6: Check if all reading tasks have tag <code>books</code></h3>
<p>The Stream API has methods that allows the user to check if elements in the dataset match a given property. These methods are <code>allMatch</code>, <code>anyMatch</code>, <code>noneMatch</code>, <code>findFirst</code>, and <code>findAny</code>. To check if all reading titles have a tag with name <code>books</code>, we can write code as shown below.</p>
<pre><code class="language-java">public boolean isAllReadingTasksWithTagBooks(List&lt;Task&gt; tasks) {
    return tasks.stream().
            filter(task -&gt; task.getType() == TaskType.READING).
            allMatch(task -&gt; task.getTags().contains("books"));
}
</code></pre>
<p>To check whether any reading task has a <code>java8</code> tag, then we can use <code>anyMatch</code> operation as shown below.</p>
<pre><code class="language-java">public boolean isAnyReadingTasksWithTagJava8(List&lt;Task&gt; tasks) {
    return tasks.stream().
            filter(task -&gt; task.getType() == TaskType.READING).
            anyMatch(task -&gt; task.getTags().contains("java8"));
}
</code></pre>
<h3 id="example-7-creating-a-summary-of-all-titles">Example 7: Creating a summary of all titles</h3>
<p>Suppose you want to create a summary of all the titles. Use the <code>reduce</code> operation, which reduces the stream to a value. The <code>reduce</code> function takes a lambda which joins elements of the stream.</p>
<pre><code class="language-java">public String joinAllTaskTitles(List&lt;Task&gt; tasks) {
    return tasks.stream().
            map(Task::getTitle).
            reduce((first, second) -&gt; first + " *** " + second).
            get();
}
</code></pre>
<h3 id="example-8-working-with-primitive-streams">Example 8: Working with primitive Streams</h3>
<p>Apart from the generic stream that works over objects, Java 8 also provides specific streams that work over primitive types like int, long, and double. Let's look at few examples of primitive streams.</p>
<p>To create a range of values, we can use <code>range</code> method that creates a stream with value starting from 0 and ending at 9. It excludes 10.</p>
<pre><code class="language-java">IntStream.range(0, 10).forEach(System.out::println);
</code></pre>
<p>The <code>rangeClosed</code> method allows you to create streams that includes the upper bound as well. So, the below mentioned stream will start at 1 and end at 10.</p>
<pre><code class="language-java">IntStream.rangeClosed(1, 10).forEach(System.out::println);
</code></pre>
<p>You can also create infinite streams using iterate method on the primitive streams as shown below.</p>
<pre><code class="language-java">LongStream infiniteStream = LongStream.iterate(1, el -&gt; el + 1);
</code></pre>
<p>To filter out all even numbers in an infinite stream, we can write code as shown below.</p>
<pre><code class="language-java">infiniteStream.filter(el -&gt; el % 2 == 0).forEach(System.out::println);
</code></pre>
<p>We can limit the resulting stream by using the <code>limit</code> operation as shown below.</p>
<pre><code class="language-java">infiniteStream.filter(el -&gt; el % 2 == 0).limit(100).forEach(System.out::println);
</code></pre>
<h3 id="example-9-creating-streams-from-arrays">Example 9: Creating Streams from Arrays</h3>
<p>You can create streams from arrays by using the static <code>stream</code> method on the <code>Arrays</code> class as shown below.</p>
<pre><code class="language-java">String[] tags = {"java", "git", "lambdas", "machine-learning"};
Arrays.stream(tags).map(String::toUpperCase).forEach(System.out::println);
</code></pre>
<p>You can also create a stream from the array by specifying the start and end indexes as shown below. Here, starting index is inclusive and ending index is exclusive.</p>
<pre><code class="language-java">Arrays.stream(tags, 1, 3).map(String::toUpperCase).forEach(System.out::println);
</code></pre>
<h2 id="parallel-streams">Parallel Streams</h2>
<p>One advantage that you get by using the <code>Stream</code> abstraction is that now the library can effectively manage parallelism, as iteration is internal. You can make a stream parallel by calling <code>parallel</code> method on it. The <code>parallel</code> method underneath uses the fork-join API introduced in JDK 7. By default, it will spawn up threads equal to the number of CPUs in the host machine. In the code show below, we are grouping numbers by thread that processed them. You will learn about <code>collect</code> and <code>groupingBy</code> functions in chapter 4. For now, just understand that they allow you to group elements based on a key.</p>
<pre><code class="language-java">public class ParallelStreamExample {

    public static void main(String[] args) {
        Map&lt;String, List&lt;Integer&gt;&gt; numbersPerThread = IntStream.rangeClosed(1, 160)
                .parallel()
                .boxed()
                .collect(groupingBy(i -&gt; Thread.currentThread().getName()));

        numbersPerThread.forEach((k, v) -&gt; System.out.println(String.format("%s &gt;&gt; %s", k, v)));
    }
}
</code></pre>
<p>The output of the above program on my machine looks like as shown below.</p>
<pre><code>ForkJoinPool.commonPool-worker-7 &gt;&gt; [46, 47, 48, 49, 50]
ForkJoinPool.commonPool-worker-1 &gt;&gt; [41, 42, 43, 44, 45, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130]
ForkJoinPool.commonPool-worker-2 &gt;&gt; [146, 147, 148, 149, 150]
main &gt;&gt; [106, 107, 108, 109, 110]
ForkJoinPool.commonPool-worker-5 &gt;&gt; [71, 72, 73, 74, 75]
ForkJoinPool.commonPool-worker-6 &gt;&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160]
ForkJoinPool.commonPool-worker-3 &gt;&gt; [21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 76, 77, 78, 79, 80]
ForkJoinPool.commonPool-worker-4 &gt;&gt; [91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145]
</code></pre>
<p>Not every thread processed the same number of elements. You can control the size of the fork-join thread pool by setting a system property <code>System.setProperty("java.util.concurrent.ForkJoinPool.common.parallelism", "2")</code>.</p>
<p>Another example where you can use the <code>parallel</code> operation is when you are processing a list of URLs, as shown below.</p>
<pre><code class="language-java">String[] urls = {"https://www.google.co.in/", "https://twitter.com/", "http://www.facebook.com/"};
Arrays.stream(urls).parallel().map(url -&gt; getUrlContent(url)).forEach(System.out::println);
</code></pre>
<p>If you need to understand when to use a Parallel Stream, I recommend reading this article by Doug Lea et al. <a href="http://gee.cs.oswego.edu/dl/html/StreamParallelGuidance.html">http://gee.cs.oswego.edu/dl/html/StreamParallelGuidance.html</a>.</p>
<p><a href="https://github.com/igrigorik/ga-beacon"><a href="https://ga-beacon.appspot.com/UA-59411913-3/shekhargulati/java8-the-missing-tutorial/03-streams" data-uk-lightbox><img src="https://ga-beacon.appspot.com/UA-59411913-3/shekhargulati/java8-the-missing-tutorial/03-streams" alt="Analytics"></a></a></p>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/10/index.html">
<img class="uk-book-cover" src="../../static/icons/48/java_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/10/index.html">Java 编码规范</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/6.html">waylau</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="java">java</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">12页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 127个">127</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/38/index.html">
<img class="uk-book-cover" src="../../static/icons/48/java_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/38/index.html">Java资源大全中文版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/19.html">伯乐在线</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="java">java</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">61页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月23日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 7938个">7938</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/20/index.html">
<img class="uk-book-cover" src="../../static/icons/48/java_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/20/index.html">Java 8 简明教程</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/15.html">wizardforcel</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="java">java</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">11页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 133个">133</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/6/index.html">
<img class="uk-book-cover" src="../../static/icons/48/spring_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/6/index.html">Spring Framework 4.x 参考文档中文版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/6.html">waylau</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="spring">spring</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">47页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 1192个">1192</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/28/index.html">
<img class="uk-book-cover" src="../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/28/index.html">笨办法学 Linux</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/15.html">wizardforcel</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">34页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 326个">326</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/136/index.html">
<img class="uk-book-cover" src="../../static/icons/48/code_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/136/index.html">Serverless 架构应用开发指南</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/72.html">phodal</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="code">code</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">1页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年8月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 396个">396</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../" title="返回首页"><img class="" src="../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../book/66/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../book/66/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../book/66/01-default-static-interface-methods.html" title="Default and Static Methods for Interfaces" data-book-page-rel-url="01-default-static-interface-methods.html" data-book-page-id="5490">Default and Static Methods for Interfaces</a>
</li>
<li>
<a class="pjax" href="../../book/66/02-lambdas.html" title="Lambdas" data-book-page-rel-url="02-lambdas.html" data-book-page-id="5491">Lambdas</a>
</li>
<li>
<a class="pjax" href="../../book/66/03-streams.html" title="Streams" data-book-page-rel-url="03-streams.html" data-book-page-id="5492">Streams</a>
</li>
<li>
<a class="pjax" href="../../book/66/04-collectors.html" title="Collectors" data-book-page-rel-url="04-collectors.html" data-book-page-id="5493">Collectors</a>
</li>
<li>
<a class="pjax" href="../../book/66/05-optionals.html" title="Optionals" data-book-page-rel-url="05-optionals.html" data-book-page-id="5494">Optionals</a>
</li>
<li>
<a class="pjax" href="../../book/66/08-date-time-api.html" title="Date Time API" data-book-page-rel-url="08-date-time-api.html" data-book-page-id="5495">Date Time API</a>
</li>
<li>
<a class="pjax" href="../../book/66/10-nashorn.html" title="Nashorn" data-book-page-rel-url="10-nashorn.html" data-book-page-id="5496">Nashorn</a>
</li>
<li>
<a class="pjax" href="../../book/66/12-annotations.html" title="Annotation improvements" data-book-page-rel-url="12-annotations.html" data-book-page-id="5497">Annotation improvements</a>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =66;var bookPageId =5492;var bookPageRelUrl ='03-streams.html';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>