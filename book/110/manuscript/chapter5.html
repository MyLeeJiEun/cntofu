
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>第五章-React 学习之道</title>
<meta content='第五章,React 学习之道' name='keywords'>
<meta content='第五章,React 学习之道' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../../static/components/css/base.css">
<link rel="stylesheet" href="../../../static/components/css/reader.css">
<link rel="stylesheet" href="../../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-left ">
<a href="../../../book/110/manuscript/chapter4.html">
<i class="nav-icon-left uk-icon-small  uk-icon-caret-left"></i>
<span class="">第四章</span>
</a>
</div>
<div class="uk-align-right ">
<a href="../../../book/110/manuscript/chapter6-cn.html">
<span class="">第六章</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../../book/110/index.html">React 学习之道</a>
<a target="_blank" rel="nofollow" href="https://github.com/tzivanmoe/the-road-to-learn-react-chinese" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<h1 id="advanced-react-components">Advanced React Components</h1>
<p>The chapter will focus on the implementation of advanced React components. You will learn about higher order components and how to implement them. In addition you will dive into more advanced topics in React and implement complex interactions with it.</p>
<h2 id="ref-a-dom-element">Ref a DOM Element</h2>
<p>Sometimes you need to interact with your DOM nodes in React. The <code>ref</code> attribute gives you access to a node in your elements. Usually that is an anti pattern in React, because you should use its declarative way of doing things and its unidirectional data flow. You have learned about it when you have introduced your first search input field. But there are certain cases where you need access to the DOM node. The official documentation mentions three use cases:</p>
<ul>
<li>to use the DOM API (focus, media playback etc.)</li>
<li>to invoke imperative DOM node animations</li>
<li>to integrate with third-party library that needs the DOM node (e.g. <a href="https://d3js.org/">D3.js</a>)</li>
</ul>
<p>Let's do it by example with the Search component. When the application renders the first time, the input field should be focused. That's one use case where you would need access to the DOM API. This chapter will show you how it works, but since it is not very useful for the application itself, we will omit the changes after the chapter. You can keep it for your own application though.</p>
<p>In general, you can use the <code>ref</code> attribute in both functional stateless components and ES6 class components. In the example of the focus use case, you will need a lifecycle method. That's why the approach is first showcased by using the <code>ref</code> attribute with an ES6 class component.</p>
<p>The initial step is to refactor the functional stateless component to an ES6 class component.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code># leanpub-start-insert
class Search extends Component {
  render() {
    const {
      value,
      onChange,
      onSubmit,
      children
    } = this.props;

    return (
# leanpub-end-insert
      &lt;form onSubmit={onSubmit}&gt;
        &lt;input
          type="text"
          value={value}
          onChange={onChange}
        /&gt;
        &lt;button type="submit"&gt;
          {children}
        &lt;/button&gt;
      &lt;/form&gt;
# leanpub-start-insert
    );
  }
}
# leanpub-end-insert
</code></pre>
<p>The <code>this</code> object of an ES6 class component helps us to reference the DOM node with the <code>ref</code> attribute.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class Search extends Component {
  render() {
    const {
      value,
      onChange,
      onSubmit,
      children
    } = this.props;

    return (
      &lt;form onSubmit={onSubmit}&gt;
        &lt;input
          type="text"
          value={value}
          onChange={onChange}
# leanpub-start-insert
          ref={(node) =&gt; { this.input = node; }}
# leanpub-end-insert
        /&gt;
        &lt;button type="submit"&gt;
          {children}
        &lt;/button&gt;
      &lt;/form&gt;
    );
  }
}
</code></pre>
<p>Now you can focus the input field when the component mounted by using the <code>this</code> object, the appropriate lifecycle method, and the DOM API.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class Search extends Component {
# leanpub-start-insert
  componentDidMount() {
    if(this.input) {
      this.input.focus();
    }
  }
# leanpub-end-insert

  render() {
    const {
      value,
      onChange,
      onSubmit,
      children
    } = this.props;

    return (
      &lt;form onSubmit={onSubmit}&gt;
        &lt;input
          type="text"
          value={value}
          onChange={onChange}
          ref={(node) =&gt; { this.input = node; }}
        /&gt;
        &lt;button type="submit"&gt;
          {children}
        &lt;/button&gt;
      &lt;/form&gt;
    );
  }
}
</code></pre>
<p>The input field should be focused when the application renders. That's it basically for using the <code>ref</code> attribute.</p>
<p>But how would you get access to the <code>ref</code> in a functional stateless component without the <code>this</code> object? The following functional stateless component demonstrates it.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const Search = ({
  value,
  onChange,
  onSubmit,
  children
}) =&gt; {
# leanpub-start-insert
  let input;
# leanpub-end-insert
  return (
    &lt;form onSubmit={onSubmit}&gt;
      &lt;input
        type="text"
        value={value}
        onChange={onChange}
# leanpub-start-insert
        ref={(node) =&gt; input = node}
# leanpub-end-insert
      /&gt;
      &lt;button type="submit"&gt;
        {children}
      &lt;/button&gt;
    &lt;/form&gt;
  );
}
</code></pre>
<p>Now you would be able to access the input DOM element. In the example of the focus use case it wouldn't help you, because you have no lifecycle method in a functional stateless component to trigger the focus. But in the future you might come across other use cases where it can make sense to use a functional stateless component with the <code>ref</code> attribute.</p>
<h3 id="exercises">Exercises</h3>
<ul>
<li>read more about <a href="https://facebook.github.io/react/docs/refs-and-the-dom.html">the ref attribute in general in React</a></li>
<li>read more about <a href="https://www.robinwieruch.de/react-ref-attribute-dom-node/">the usage of the ref attribute in React</a></li>
</ul>
<h2 id="loading-">Loading ...</h2>
<p>Now let's get back to the application. You might want to show a loading indicator when you submit a search request to the Hacker News API. The request is asynchronous and you should show your user some feedback that something is about to happen. Let's define a reusable Loading component in your <em>src/App.js</em> file.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const Loading = () =&gt;
  &lt;div&gt;Loading ...&lt;/div&gt;
</code></pre>
<p>Now you will need a property to store the loading state. Based on the loading state you can decide to show the Loading component later on.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class App extends Component {

  constructor(props) {
    super(props);

    this.state = {
      results: null,
      searchKey: '',
      searchTerm: DEFAULT_QUERY,
      error: null,
# leanpub-start-insert
      isLoading: false,
# leanpub-end-insert
    };

    ...
  }

  ...

}
</code></pre>
<p>The initial value of that <code>isLoading</code> property is false. You don't load anything before the App component is mounted.</p>
<p>When you make the request, you set a loading state to true. Eventually the request will succeed and you can set the loading state to false.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class App extends Component {

  ...

  setSearchTopStories(result) {
    ...

    this.setState({
      results: {
        ...results,
        [searchKey]: { hits: updatedHits, page }
      },
# leanpub-start-insert
      isLoading: false
# leanpub-end-insert
    });
  }

  fetchSearchTopStories(searchTerm, page = 0) {
# leanpub-start-insert
    this.setState({ isLoading: true });
# leanpub-end-insert

    fetch(`${PATH_BASE}${PATH_SEARCH}?${PARAM_SEARCH}${searchTerm}&amp;${PARAM_PAGE}${page}&amp;${PARAM_HPP}${DEFAULT_HPP}`)
      .then(response =&gt; response.json())
      .then(result =&gt; this.setSearchTopStories(result))
      .catch(e =&gt; this.setState({ error: e }));
  }

  ...

}
</code></pre>
<p>In the last step, you will use the Loading component in your App. A conditional rendering based on the loading state will decide whether you show a Loading component or the Button component. The latter one is your button to fetch more data.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class App extends Component {

  ...

  render() {
    const {
      searchTerm,
      results,
      searchKey,
      error,
# leanpub-start-insert
      isLoading
# leanpub-end-insert
    } = this.state;

    ...

    return (
      &lt;div className="page"&gt;
        ...
        &lt;div className="interactions"&gt;
# leanpub-start-insert
          { isLoading
            ? &lt;Loading /&gt;
            : &lt;Button
              onClick={() =&gt; this.fetchSearchTopStories(searchKey, page + 1)}&gt;
              More
            &lt;/Button&gt;
          }
# leanpub-end-insert
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
}
</code></pre>
<p>Initially the Loading component will show up when you start your application, because you make a request on <code>componentDidMount()</code>. There is no Table component, because the list is empty. When the response returns from the Hacker News API, the result is shown, the loading state is set to false and the Loading component disappears. Instead, the "More" button to fetch more data appears. Once you fetch more data, the button will disappear again and the Loading component will show up.</p>
<h3 id="exercises-1">Exercises:</h3>
<ul>
<li>use a library such as <a href="http://fontawesome.io/">Font Awesome</a> to show a loading icon instead of the "Loading ..." text</li>
</ul>
<h2 id="higher-order-components">Higher Order Components</h2>
<p>Higher order components (HOC) are an advanced concept in React. HOCs are an equivalent to higher order functions. They take any input - most of the time a component, but also optional arguments - and return a component as output. The returned component is an enhanced version of the input component and can be used in your JSX.</p>
<p>HOCs are used for different use cases. They can prepare properties, manage state or alter the representation of a component. One use case could be to use a HOC as a helper for a conditional rendering. Imagine you have a List component that renders a list of items or nothing, because the list is empty or null. The HOC could shield away that the list would render nothing when there is no list. On the other hand, the plain List component doesn't need to bother anymore about an non existent list. It only cares about rendering the list.</p>
<p>Let's do a simple HOC which takes a component as input and returns a component. You can place it in your <em>src/App.js</em> file.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>function withFoo(Component) {
  return function(props) {
    return &lt;Component { ...props } /&gt;;
  }
}
</code></pre>
<p>One neat convention is to prefix the naming of a HOC with <code>with</code>. Since you are using JavaScript ES6, you can express the HOC more concisely with an ES6 arrow function.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const withFoo = (Component) =&gt; (props) =&gt;
  &lt;Component { ...props } /&gt;
</code></pre>
<p>In the example, the input component would stay the same as the output component. Nothing happens. It renders the same component instance and passes all of the props to the output component. But that's useless. Let's enhance the output component. The output component should show the Loading component, when the loading state is true, otherwise it should show the input component. A conditional rendering is a great use case for a HOC.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code># leanpub-start-insert
const withLoading = (Component) =&gt; (props) =&gt;
  props.isLoading
    ? &lt;Loading /&gt;
    : &lt;Component { ...props } /&gt;
# leanpub-end-insert
</code></pre>
<p>Based on the loading property you can apply a conditional rendering. The function will return the Loading component or the input component.</p>
<p>In general it can be very efficient to spread an object, like the props object in the previous example, as input for a component. See the difference in the following code snippet.</p>
<p>{title="Code Playground",lang="javascript"}</p>
<pre><code>// before you would have to destructure the props before passing them
const { foo, bar } = props;
&lt;SomeComponent foo={foo} bar={bar} /&gt;

// but you can use the object spread operator to pass all object properties
&lt;SomeComponent { ...props } /&gt;
</code></pre>
<p>There is one little thing that you should avoid. You pass all the props including the <code>isLoading</code> property, by spreading the object, into the input component. However, the input component may not care about the <code>isLoading</code> property. You can use the ES6 rest destructuring to avoid it.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code># leanpub-start-insert
const withLoading = (Component) =&gt; ({ isLoading, ...rest }) =&gt;
  isLoading
    ? &lt;Loading /&gt;
    : &lt;Component { ...rest } /&gt;
# leanpub-end-insert
</code></pre>
<p>It takes one property out of the object, but keeps the remaining object. It works with multiple properties as well. You might have already read about it in the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destructuring assignment</a>.</p>
<p>Now you can use the HOC in your JSX. An use case in the application could be to show either the "More" button or the Loading component. The Loading component is already encapsulated in the HOC, but an input component is missing. In the use case of showing a Button component or a Loading component, the Button is the input component of the HOC. The enhanced output component is a ButtonWithLoading component.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const Button = ({ onClick, className = '', children }) =&gt;
  &lt;button
    onClick={onClick}
    className={className}
    type="button"
  &gt;
    {children}
  &lt;/button&gt;

const Loading = () =&gt;
  &lt;div&gt;Loading ...&lt;/div&gt;

const withLoading = (Component) =&gt; ({ isLoading, ...rest }) =&gt;
  isLoading
    ? &lt;Loading /&gt;
    : &lt;Component { ...rest } /&gt;

# leanpub-start-insert
const ButtonWithLoading = withLoading(Button);
# leanpub-end-insert
</code></pre>
<p>Everything is defined now. As a last step, you have to use the ButtonWithLoading component, which receives the loading state as an additional property. While the HOC consumes the loading property, all other props get passed to the Button component.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class App extends Component {

  ...

  render() {
    ...
    return (
      &lt;div className="page"&gt;
        ...
        &lt;div className="interactions"&gt;
# leanpub-start-insert
          &lt;ButtonWithLoading
            isLoading={isLoading}
            onClick={() =&gt; this.fetchSearchTopStories(searchKey, page + 1)}&gt;
            More
          &lt;/ButtonWithLoading&gt;
# leanpub-end-insert
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
}
</code></pre>
<p>When you run your tests again, you will notice that your snapshot test for the App component fails. The diff might look like the following on the command line:</p>
<p>{title="Command Line",lang="text"}</p>
<pre><code>-    &lt;button
-      className=""
-      onClick={[Function]}
-      type="button"
-    &gt;
-      More
-    &lt;/button&gt;
+    &lt;div&gt;
+      Loading ...
+    &lt;/div&gt;
</code></pre>
<p>You can either fix the component now, when you think there is something wrong about it, or can accept the new snapshot of it. Because you introduced the Loading component in this chapter, you can accept the altered snapshot test on the command line in the interactive test.</p>
<p>Higher order components are an advanced technique in React. They have multiple purposes like improved reusability of components, greater abstraction, composability of components and manipulations of props, state and view. Don't worry if you don't understand them immediately. It takes time to get used to them.</p>
<p>I encourage you to read the <a href="https://www.robinwieruch.de/gentle-introduction-higher-order-components/">gentle introduction to higher order components</a>. It gives you another approach to learn them, shows you an elegant way to use them a functional programming way and solves specifically the problem of conditional rendering with higher order components.</p>
<h3 id="exercises-2">Exercises:</h3>
<ul>
<li>read <a href="https://www.robinwieruch.de/gentle-introduction-higher-order-components/">a gentle introduction to higher order components</a></li>
<li>experiment with the HOC you have created</li>
<li>think about a use case where another HOC would make sense
<ul>
<li>implement the HOC, if there is a use case</li>
</ul> </li>
</ul>
<h2 id="advanced-sorting">Advanced Sorting</h2>
<p>You have already implemented a client- and server-side search interaction. Since you have a Table component, it would make sense to enhance the Table with advanced interactions. What about introducing a sort functionality for each column by using the column headers of the Table?</p>
<p>It would be possible to write your own sort function, but personally I prefer to use a utility library for such cases. <a href="https://lodash.com/">Lodash</a> is one of these utility libraries, but you can use whatever library suits you. Let's install Lodash and use it for the sort functionality.</p>
<p>{title="Command Line",lang="text"}</p>
<pre><code>npm install lodash
</code></pre>
<p>Now you can import the sort functionality of Lodash in your <em>src/App.js</em> file.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>import React, { Component } from 'react';
import fetch from 'isomorphic-fetch';
# leanpub-start-insert
import { sortBy } from 'lodash';
# leanpub-end-insert
import './App.css';
</code></pre>
<p>You have several columns in your Table. There are title, author, comments and points columns. You can define sort functions whereas each function takes a list and returns a list of items sorted by a specific property. Additionally, you will need one default sort function which doesn't sort but only returns the unsorted list. That will be your initial state.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>...

# leanpub-start-insert
const SORTS = {
  NONE: list =&gt; list,
  TITLE: list =&gt; sortBy(list, 'title'),
  AUTHOR: list =&gt; sortBy(list, 'author'),
  COMMENTS: list =&gt; sortBy(list, 'num_comments').reverse(),
  POINTS: list =&gt; sortBy(list, 'points').reverse(),
};
# leanpub-end-insert

class App extends Component {
  ...
}
...
</code></pre>
<p>You can see that two of the sort functions return a reversed list. That's because you want to see the items with the highest comments and points rather than to see the items with the lowest counts when you sort the list for the first time.</p>
<p>The <code>SORTS</code> object allows you to reference any sort function now.</p>
<p>Again your App component is responsible for storing the state of the sort. The initial state will be the initial default sort function, which doesn't sort at all and returns the input list as output.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>this.state = {
  results: null,
  searchKey: '',
  searchTerm: DEFAULT_QUERY,
  error: null,
  isLoading: false,
# leanpub-start-insert
  sortKey: 'NONE',
# leanpub-end-insert
};
</code></pre>
<p>Once you choose a different <code>sortKey</code>, let's say the <code>AUTHOR</code> key, you will sort the list with the appropriate sort function from the <code>SORTS</code> object.</p>
<p>Now you can define a new class method in your App component that simply sets a <code>sortKey</code> to your local component state. Afterward, the <code>sortKey</code> can be used to retrieve the sorting function to apply it on your list.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class App extends Component {

  constructor(props) {

    ...

    this.needsToSearchTopStories = this.needsToSearchTopStories.bind(this);
    this.setSearchTopStories = this.setSearchTopStories.bind(this);
    this.fetchSearchTopStories = this.fetchSearchTopStories.bind(this);
    this.onSearchSubmit = this.onSearchSubmit.bind(this);
    this.onSearchChange = this.onSearchChange.bind(this);
    this.onDismiss = this.onDismiss.bind(this);
# leanpub-start-insert
    this.onSort = this.onSort.bind(this);
# leanpub-end-insert
  }

# leanpub-start-insert
  onSort(sortKey) {
    this.setState({ sortKey });
  }
# leanpub-end-insert

  ...

}
</code></pre>
<p>The next step is to pass the method and <code>sortKey</code> to your Table component.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class App extends Component {

  ...

  render() {
    const {
      searchTerm,
      results,
      searchKey,
      error,
      isLoading,
# leanpub-start-insert
      sortKey
# leanpub-end-insert
    } = this.state;

    ...

    return (
      &lt;div className="page"&gt;
        ...
        &lt;Table
          list={list}
# leanpub-start-insert
          sortKey={sortKey}
          onSort={this.onSort}
# leanpub-end-insert
          onDismiss={this.onDismiss}
        /&gt;
        ...
      &lt;/div&gt;
    );
  }
}
</code></pre>
<p>The Table component is responsible for sorting the list. It takes one of the <code>SORT</code> functions by <code>sortKey</code> and passes the list as input. Afterward it keeps mapping over the sorted list.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code># leanpub-start-insert
const Table = ({
  list,
  sortKey,
  onSort,
  onDismiss
}) =&gt;
# leanpub-end-insert
  &lt;div className="table"&gt;
# leanpub-start-insert
    {SORTS[sortKey](list).map(item =&gt;
# leanpub-end-insert
      &lt;div key={item.objectID} className="table-row"&gt;
        ...
      &lt;/div&gt;
    )}
  &lt;/div&gt;
</code></pre>
<p>In theory the list would get sorted by one of the functions. But the default sort is set to <code>NONE</code>, so nothing is sorted yet. So far, no one executes the <code>onSort()</code> method to change the <code>sortKey</code>. Let's extend the Table with a row of column headers that use Sort components in columns to sort each column.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const Table = ({
  list,
  sortKey,
  onSort,
  onDismiss
}) =&gt;
  &lt;div className="table"&gt;
# leanpub-start-insert
    &lt;div className="table-header"&gt;
      &lt;span style={{ width: '40%' }}&gt;
        &lt;Sort
          sortKey={'TITLE'}
          onSort={onSort}
        &gt;
          Title
        &lt;/Sort&gt;
      &lt;/span&gt;
      &lt;span style={{ width: '30%' }}&gt;
        &lt;Sort
          sortKey={'AUTHOR'}
          onSort={onSort}
        &gt;
          Author
        &lt;/Sort&gt;
      &lt;/span&gt;
      &lt;span style={{ width: '10%' }}&gt;
        &lt;Sort
          sortKey={'COMMENTS'}
          onSort={onSort}
        &gt;
          Comments
        &lt;/Sort&gt;
      &lt;/span&gt;
      &lt;span style={{ width: '10%' }}&gt;
        &lt;Sort
          sortKey={'POINTS'}
          onSort={onSort}
        &gt;
          Points
        &lt;/Sort&gt;
      &lt;/span&gt;
      &lt;span style={{ width: '10%' }}&gt;
        Archive
      &lt;/span&gt;
    &lt;/div&gt;
# leanpub-end-insert
    {SORTS[sortKey](list).map(item =&gt;
      ...
    )}
  &lt;/div&gt;
</code></pre>
<p>Each Sort component gets a specific <code>sortKey</code> and the general <code>onSort()</code> function. Internally it calls the method with the <code>sortKey</code> to set the specific key.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const Sort = ({ sortKey, onSort, children }) =&gt;
  &lt;Button onClick={() =&gt; onSort(sortKey)}&gt;
    {children}
  &lt;/Button&gt;
</code></pre>
<p>As you can see, the Sort component reuses your common Button component. On a button click each individual passed <code>sortKey</code> will get set by the <code>onSort()</code> method. Now you should be able to sort the list when you click on the column headers.</p>
<p>There is one minor improvement for an improved look. So far, the button in a column header looks a bit silly. Let's give the button in the Sort component a proper <code>className</code>.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const Sort = ({ sortKey, onSort, children }) =&gt;
# leanpub-start-insert
  &lt;Button
    onClick={() =&gt; onSort(sortKey)}
    className="button-inline"
  &gt;
# leanpub-end-insert
    {children}
  &lt;/Button&gt;
</code></pre>
<p>It should look nice now. The next goal would be to implement a reverse sort as well. The list should get reverse sorted once you click a Sort component twice. First, you need to define the reverse state with a boolean. The sort can be either reversed or non reversed.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>this.state = {
  results: null,
  searchKey: '',
  searchTerm: DEFAULT_QUERY,
  error: null,
  isLoading: false,
  sortKey: 'NONE',
# leanpub-start-insert
  isSortReverse: false,
# leanpub-end-insert
};
</code></pre>
<p>Now in your sort method, you can evaluate if the list is reverse sorted. It is reverse if the <code>sortKey</code> in the state is the same as the incoming <code>sortKey</code> and the reverse state is not already set to true.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>onSort(sortKey) {
# leanpub-start-insert
  const isSortReverse = this.state.sortKey === sortKey &amp;&amp; !this.state.isSortReverse;
  this.setState({ sortKey, isSortReverse });
# leanpub-end-insert
}
</code></pre>
<p>Again you can pass the reverse prop to your Table component.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>class App extends Component {

  ...

  render() {
    const {
      searchTerm,
      results,
      searchKey,
      error,
      isLoading,
      sortKey,
# leanpub-start-insert
      isSortReverse
# leanpub-end-insert
    } = this.state;

    ...

    return (
      &lt;div className="page"&gt;
        ...
        &lt;Table
          list={list}
          sortKey={sortKey}
# leanpub-start-insert
          isSortReverse={isSortReverse}
# leanpub-end-insert
          onSort={this.onSort}
          onDismiss={this.onDismiss}
        /&gt;
        ...
      &lt;/div&gt;
    );
  }
}
</code></pre>
<p>The Table has to have an arrow function block body to compute the data now.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code># leanpub-start-insert
const Table = ({
  list,
  sortKey,
  isSortReverse,
  onSort,
  onDismiss
}) =&gt; {
  const sortedList = SORTS[sortKey](list);
  const reverseSortedList = isSortReverse
    ? sortedList.reverse()
    : sortedList;

  return(
# leanpub-end-insert
    &lt;div className="table"&gt;
      &lt;div className="table-header"&gt;
        ...
      &lt;/div&gt;
# leanpub-start-insert
      {reverseSortedList.map(item =&gt;
# leanpub-end-insert
        ...
      )}
    &lt;/div&gt;
# leanpub-start-insert
  );
}
# leanpub-end-insert
</code></pre>
<p>The reverse sort should work now.</p>
<p>Last but not least, you have to deal with one open question for the sake of an improved user experience. Can a user distinguish which column is actively sorted? So far, it is not possible. Let's give the user a visual feedback.</p>
<p>Each Sort component gets its specific <code>sortKey</code> already. It could be used to identify the activated sort. You can pass the <code>sortKey</code> from the internal component state as active sort key to your Sort component.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const Table = ({
  list,
  sortKey,
  isSortReverse,
  onSort,
  onDismiss
}) =&gt; {
  const sortedList = SORTS[sortKey](list);
  const reverseSortedList = isSortReverse
    ? sortedList.reverse()
    : sortedList;

  return(
    &lt;div className="table"&gt;
      &lt;div className="table-header"&gt;
        &lt;span style={{ width: '40%' }}&gt;
          &lt;Sort
            sortKey={'TITLE'}
            onSort={onSort}
# leanpub-start-insert
            activeSortKey={sortKey}
# leanpub-end-insert
          &gt;
            Title
          &lt;/Sort&gt;
        &lt;/span&gt;
        &lt;span style={{ width: '30%' }}&gt;
          &lt;Sort
            sortKey={'AUTHOR'}
            onSort={onSort}
# leanpub-start-insert
            activeSortKey={sortKey}
# leanpub-end-insert
          &gt;
            Author
          &lt;/Sort&gt;
        &lt;/span&gt;
        &lt;span style={{ width: '10%' }}&gt;
          &lt;Sort
            sortKey={'COMMENTS'}
            onSort={onSort}
# leanpub-start-insert
            activeSortKey={sortKey}
# leanpub-end-insert
          &gt;
            Comments
          &lt;/Sort&gt;
        &lt;/span&gt;
        &lt;span style={{ width: '10%' }}&gt;
          &lt;Sort
            sortKey={'POINTS'}
            onSort={onSort}
# leanpub-start-insert
            activeSortKey={sortKey}
# leanpub-end-insert
          &gt;
            Points
          &lt;/Sort&gt;
        &lt;/span&gt;
        &lt;span style={{ width: '10%' }}&gt;
          Archive
        &lt;/span&gt;
      &lt;/div&gt;
      {reverseSortedList.map(item =&gt;
          ...
      )}
    &lt;/div&gt;
  );
}
</code></pre>
<p>Now in your Sort component, you know based on the <code>sortKey</code> and <code>activeSortKey</code> whether the sort is active. Give your Sort component an extra <code>className</code> attribute, in case it is sorted, to give the user a visual feedback.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code># leanpub-start-insert
const Sort = ({
  sortKey,
  activeSortKey,
  onSort,
  children
}) =&gt; {
  const sortClass = ['button-inline'];

  if (sortKey === activeSortKey) {
    sortClass.push('button-active');
  }

  return (
    &lt;Button
      onClick={() =&gt; onSort(sortKey)}
      className={sortClass.join(' ')}
    &gt;
      {children}
    &lt;/Button&gt;
  );
}
# leanpub-end-insert
</code></pre>
<p>The way to define the <code>sortClass</code> is a bit clumsy, isn't it? There is a neat little library to get rid of this. First you have to install it.</p>
<p>{title="Command Line",lang="text"}</p>
<pre><code>npm install classnames
</code></pre>
<p>And second you have to import it on top of your <em>src/App.js</em> file.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>import React, { Component } from 'react';
import fetch from 'isomorphic-fetch';
import { sortBy } from 'lodash';
# leanpub-start-insert
import classNames from 'classnames';
# leanpub-end-insert
import './App.css';
</code></pre>
<p>Now you can use it to define your component <code>className</code> with conditional classes.</p>
<p>{title="src/App.js",lang=javascript}</p>
<pre><code>const Sort = ({
  sortKey,
  activeSortKey,
  onSort,
  children
}) =&gt; {
# leanpub-start-insert
  const sortClass = classNames(
    'button-inline',
    { 'button-active': sortKey === activeSortKey }
  );
# leanpub-end-insert

  return (
# leanpub-start-insert
    &lt;Button
      onClick={() =&gt; onSort(sortKey)}
      className={sortClass}
    &gt;
# leanpub-end-insert
      {children}
    &lt;/Button&gt;
  );
}
</code></pre>
<p>Again, when you run your tests, you should see failing snapshot tests but also failing unit tests for the Table component. Since you changed again your component representations, you can accept the snapshot tests. But you have to fix the unit test. In your <em>src/App.test.js</em> file, you need to provide a <code>sortKey</code> and the <code>isSortReverse</code> boolean for the Table component.</p>
<p>{title="src/App.test.js",lang=javascript}</p>
<pre><code>...

describe('Table', () =&gt; {

  const props = {
    list: [
      { title: '1', author: '1', num_comments: 1, points: 2, objectID: 'y' },
      { title: '2', author: '2', num_comments: 1, points: 2, objectID: 'z' },
    ],
# leanpub-start-insert
    sortKey: 'TITLE',
    isSortReverse: false,
# leanpub-end-insert
  };

  ...

});
</code></pre>
<p>Once again you might need to accept the failing snapshot tests for your Table component, because you provided extended props for the Table component.</p>
<p>Finally your advanced sort interaction is complete now.</p>
<h3 id="exercises-3">Exercises:</h3>
<ul>
<li>use a library like <a href="http://fontawesome.io/">Font Awesome</a> to indicate the (reverse) sort
<ul>
<li>it could be an arrow up or arrow down icon next to each Sort header</li>
</ul> </li>
<li>read more about the <a href="https://github.com/JedWatson/classnames">classnames library</a></li>
</ul>
<p>{pagebreak}</p>
<p>You have learned advanced component techniques in React! Let's recap the last chapters:</p>
<ul>
<li>React
<ul>
<li>the ref attribute to reference DOM nodes</li>
<li>higher order components are a common way to build advanced components</li>
<li>implementation of advanced interactions in React</li>
<li>conditional classNames with a neat helper library</li>
</ul> </li>
<li>ES6
<ul>
<li>rest destructuring to split up objects and arrays</li>
</ul> </li>
</ul>
<p>You can find the source code in the <a href="https://github.com/rwieruch/hackernews-client/tree/4.5">official repository</a>.</p>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/113/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/react_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/113/index.html">React Native中文文档0.51版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/62.html">tzivanmoe</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="react">react</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">118页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年7月1日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 0个">0</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/60/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/react_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/60/index.html">React 入门教程</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/36.html">hulufei</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="react">react</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">23页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月5日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 328个">328</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/44/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/linux_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/44/index.html">Shell 编程范例</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/23.html">泰晓科技</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="linux">linux</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">15页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月30日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 296个">296</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/132/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/vuejs_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/132/index.html">vue-router文档</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/71.html">srzyhead</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="vuejs">vuejs</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">30页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年8月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 0个">0</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/108/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/storm_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/108/index.html">Apache Storm 官方文档中文版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/62.html">tzivanmoe</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="storm">storm</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">74页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年7月1日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 3个">3</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/23/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/cplusplus_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/23/index.html">数据结构思维</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/15.html">wizardforcel</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="cplusplus">cplusplus</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">20页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 286个">286</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../../" title="返回首页"><img class="" src="../../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../../book/110/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../../book/110/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/110/README.html" title="简介" data-book-page-rel-url="README.html" data-book-page-id="7874">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/foreword-cn.html" title="前言" data-book-page-rel-url="manuscript/foreword-cn.html" data-book-page-id="7875">前言</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/chapter1-cn.html" title="第一章" data-book-page-rel-url="manuscript/chapter1-cn.html" data-book-page-id="7876">第一章</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/chapter2-cn.html" title="第二章" data-book-page-rel-url="manuscript/chapter2-cn.html" data-book-page-id="7877">第二章</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/chapter3-cn.html" title="第三章" data-book-page-rel-url="manuscript/chapter3-cn.html" data-book-page-id="7878">第三章</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/chapter4.html" title="第四章" data-book-page-rel-url="manuscript/chapter4.html" data-book-page-id="7879">第四章</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/chapter5.html" title="第五章" data-book-page-rel-url="manuscript/chapter5.html" data-book-page-id="7880">第五章</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/chapter6-cn.html" title="第六章" data-book-page-rel-url="manuscript/chapter6-cn.html" data-book-page-id="7881">第六章</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/deployChapter-cn.html" title="部署" data-book-page-rel-url="manuscript/deployChapter-cn.html" data-book-page-id="7882">部署</a>
</li>
<li>
<a class="pjax" href="../../../book/110/manuscript/finalwords-cn.html" title="概述" data-book-page-rel-url="manuscript/finalwords-cn.html" data-book-page-id="7883">概述</a>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =110;var bookPageId =7880;var bookPageRelUrl ='manuscript/chapter5.html';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>