
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>保存进 Elasticsearch-Logstash最佳实践</title>
<meta content='保存进 Elasticsearch,Logstash最佳实践' name='keywords'>
<meta content='保存进 Elasticsearch,Logstash最佳实践' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../../static/components/css/base.css">
<link rel="stylesheet" href="../../../static/components/css/reader.css">
<link rel="stylesheet" href="../../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-left ">
<a href="../../../book/52/output/file.html">
<i class="nav-icon-left uk-icon-small  uk-icon-caret-left"></i>
<span class="">保存成文件(File)</span>
</a>
</div>
<div class="uk-align-right ">
<a href="../../../book/52/output/redis.html">
<span class="">输出到 Redis</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../../book/52/index.html">Logstash最佳实践</a>
<a target="_blank" rel="nofollow" href="https://github.com/chenryn/logstash-best-practice-cn" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<h1 id="保存进-elasticsearch">保存进 Elasticsearch</h1>
<p>Logstash 早期有三个不同的 elasticsearch 插件。到 1.4.0 版本的时候，开发者彻底重写了 <code>LogStash::Outputs::Elasticsearch</code> 插件。从此，我们只需要用这一个插件，就能任意切换使用 Elasticsearch 集群支持的各种不同协议了。</p>
<h2 id="配置示例">配置示例</h2>
<pre><code>output {
    elasticsearch {
        host =&gt; "192.168.0.2"
        protocol =&gt; "http"
        index =&gt; "logstash-%{type}-%{+YYYY.MM.dd}"
        index_type =&gt; "%{type}"
        workers =&gt; 5
        template_overwrite =&gt; true
    }
}
</code></pre>
<h2 id="解释">解释</h2>
<h3 id="协议">协议</h3>
<p>现在，新插件支持三种协议： <em>node</em>，<em>http</em> 和 <em>transport</em>。</p>
<p>一个小集群里，使用 <em>node</em> 协议最方便了。Logstash 以 elasticsearch 的 client 节点身份(即不存数据不参加选举)运行。如果你运行下面这行命令，你就可以看到自己的 logstash 进程名，对应的 <code>node.role</code> 值是 <strong>c</strong>：</p>
<pre><code># curl 127.0.0.1:9200/_cat/nodes?v
host       ip      heap.percent ram.percent load node.role master name
local 192.168.0.102  7      c         -      logstash-local-1036-2012
local 192.168.0.2    7      d         *      Sunstreak

</code></pre>
<p>特别的，作为一个快速运行示例的需要，你还可以在 logstash 进程内部运行一个<strong>内嵌</strong>的 elasticsearch 服务器。内嵌服务器默认会在 <code>$PWD/data</code> 目录里存储索引。如果你想变更这些配置，在 <code>$PWD/elasticsearch.yml</code> 文件里写自定义配置即可，logstash 会尝试自动加载这个文件。</p>
<p>对于拥有很多索引的大集群，你可以用 <em>transport</em> 协议。logstash 进程会转发所有数据到你指定的某台主机上。这种协议跟上面的 <em>node</em> 协议是不同的。<em>node</em> 协议下的进程是可以接收到整个 Elasticsearch 集群状态信息的，当进程收到一个事件时，它就知道这个事件应该存在集群内哪个机器的分片里，所以它就会直接连接该机器发送这条数据。而 <em>transport</em> 协议下的进程不会保存这个信息，在集群状态更新(节点变化，索引变化都会发送全量更新)时，就不会对所有的 logstash 进程也发送这种信息。更多 Elasticsearch 集群状态的细节，参阅<a href="http://www.elasticsearch.org/guide">http://www.elasticsearch.org/guide</a>。</p>
<p>如果你已经有现成的 Elasticsearch 集群，但是版本跟 logstash 自带的又不太一样，建议你使用 <em>http</em> 协议。Logstash 会使用 POST 方式发送数据。</p>
<h4 id="小贴士">小贴士</h4>
<ul>
<li>Logstash 1.4.2 在 transport 和 http 协议的情况下是固定连接指定 host 发送数据。从 1.5.0 开始，host 可以设置数组，它会从节点列表中选取不同的节点发送数据，达到 Round-Robin 负载均衡的效果。</li>
<li>Kibana4 强制要求 ES 全集群所有 node 版本在 1.4 以上，所以采用 node 方式发送数据的 logstash-1.4(携带的 Elasticsearch.jar 库是 1.1.1 版本) 会导致 Kibana4 无法运行，采用 Kibana4 的读者务必改用 http 方式。</li>
<li>开发者在 IRC freenode#logstash 频道里表示："高于 1.0 版本的 Elasticsearch 应该都能跟最新版 logstash 的 node 协议一起正常工作"。此信息仅供参考，请认真测试后再上线。</li>
<li>index 注意index中不能有大写字母，否则es在日志中会报InvalidIndexNameException，但是logstash不会报错，这个错误比较隐晦，也容易掉进这个坑中。</li>
</ul>
<h4 id="性能问题">性能问题</h4>
<p>Logstash 1.4.2 在 http 协议下默认使用作者自己的 ftw 库，随同分发的是 0.0.39 版。该版本有<a href="https://github.com/elasticsearch/logstash/issues/1604">内存泄露问题</a>，长期运行下输出性能越来越差！</p>
<p>解决办法：</p>
<ol>
<li> <p>对性能要求不高的，可以在启动 logstash 进程时，配置环境变量ENV["BULK"]，强制采用 elasticsearch 官方 Ruby 库。命令如下：</p> <p>export BULK="esruby"</p> </li>
<li> <p>对性能要求高的，可以尝试采用 logstash-1.5.0RC2 。新版的 outputs/elasticsearch 放弃了 ftw 库，改用了一个 JRuby 平台专有的 <a href="https://github.com/cheald/manticore/wiki/Performance">Manticore 库</a>。根据测试，性能跟 ftw 比<a href="https://github.com/elasticsearch/logstash/pull/1777">相当接近</a>。</p> </li>
<li> <p>对性能要求极高的，可以手动更新 ftw 库版本，目前最新版是 0.0.42 版，据称内存问题在 0.0.40 版即解决。</p> </li>
</ol>
<h3 id="模板">模板</h3>
<p>Elasticsearch 支持给索引预定义设置和 mapping(前提是你用的 elasticsearch 版本支持这个 API，不过估计应该都支持)。Logstash 自带有一个优化好的模板，内容如下:</p>
<pre><code class="language-json">{
  "template" : "logstash-*",
  "settings" : {
    "index.refresh_interval" : "5s"
  },
  "mappings" : {
    "_default_" : {
       "_all" : {"enabled" : true},
       "dynamic_templates" : [ {
         "string_fields" : {
           "match" : "*",
           "match_mapping_type" : "string",
           "mapping" : {
             "type" : "string", "index" : "analyzed", "omit_norms" : true,
               "fields" : {
                 "raw" : {"type": "string", "index" : "not_analyzed", "ignore_above" : 256}
               }
           }
         }
       } ],
       "properties" : {
         "@version": { "type": "string", "index": "not_analyzed" },
         "geoip"  : {
           "type" : "object",
             "dynamic": true,
             "path": "full",
             "properties" : {
               "location" : { "type" : "geo_point" }
             }
         }
       }
    }
  }
}
</code></pre>
<p>这其中的关键设置包括：</p>
<ul>
<li>template for index-pattern</li>
</ul>
<p>只有匹配 <code>logstash-*</code> 的索引才会应用这个模板。有时候我们会变更 Logstash 的默认索引名称，记住你也得通过 PUT 方法上传可以匹配你自定义索引名的模板。当然，我更建议的做法是，把你自定义的名字放在 "logstash-" 后面，变成 <code>index =&gt; "logstash-custom-%{+yyyy.MM.dd}"</code> 这样。</p>
<ul>
<li>refresh_interval for indexing</li>
</ul>
<p>Elasticsearch 是一个<em>近</em>实时搜索引擎。它实际上是每 1 秒钟刷新一次数据。对于日志分析应用，我们用不着这么实时，所以 logstash 自带的模板修改成了 5 秒钟。你还可以根据需要继续放大这个刷新间隔以提高数据写入性能。</p>
<ul>
<li>multi-field with not_analyzed</li>
</ul>
<p>Elasticsearch 会自动使用自己的默认分词器(空格，点，斜线等分割)来分析字段。分词器对于搜索和评分是非常重要的，但是大大降低了索引写入和聚合请求的性能。所以 logstash 模板定义了一种叫"多字段"(multi-field)类型的字段。这种类型会自动添加一个 ".raw" 结尾的字段，并给这个字段设置为不启用分词器。简单说，你想获取 url 字段的聚合结果的时候，不要直接用 "url" ，而是用 "url.raw" 作为字段名。</p>
<ul>
<li>geo_point</li>
</ul>
<p>Elasticsearch 支持 <em>geo_point</em> 类型， <em>geo distance</em> 聚合等等。比如说，你可以请求某个 <em>geo_point</em> 点方圆 10 千米内数据点的总数。在 Kibana 的 bettermap 类型面板里，就会用到这个类型的数据。</p>
<h3 id="其他模板配置建议">其他模板配置建议</h3>
<ul>
<li>doc_values</li>
</ul>
<p>doc_values 是 Elasticsearch 1.3 版本引入的新特性。启用该特性的字段，索引写入的时候会在磁盘上构建 fielddata。而过去，fielddata 是固定只能使用内存的。在请求范围加大的时候，很容易触发 OOM 报错：</p>
<blockquote>
<p>ElasticsearchException[org.elasticsearch.common.breaker.CircuitBreakingException: Data too large, data for field [@timestamp] would be larger than limit of [639015321/609.4mb]]</p>
</blockquote>
<p>doc_values 只能给不分词(对于字符串字段就是设置了 <code>"index":"not_analyzed"</code>，数值和时间字段默认就没有分词) 的字段配置生效。</p>
<p>doc_values 虽然用的是磁盘，但是系统本身也有自带 VFS 的 cache 效果并不会太差。据官方测试，经过 1.4 的优化后，只比使用内存的 fielddata 慢 15% 。所以，在数据量较大的情况下，<strong>强烈建议开启</strong>该配置：</p>
<pre><code class="language-json">{
  "template" : "logstash-*",
  "settings" : {
    "index.refresh_interval" : "5s"
  },
  "mappings" : {
    "_default_" : {
       "_all" : {"enabled" : true},
       "dynamic_templates" : [ {
         "string_fields" : {
           "match" : "*",
           "match_mapping_type" : "string",
           "mapping" : {
             "type" : "string", "index" : "analyzed", "omit_norms" : true,
               "fields" : {
                 "raw" : { "type": "string", "index" : "not_analyzed", "ignore_above" : 256, "doc_values": true }
               }
           }
         }
       } ],
       "properties" : {
         "@version": { "type": "string", "index": "not_analyzed" },
         "@timestamp": { "type": "date", "index": "not_analyzed", "doc_values": true, "format": "dateOptionalTime" },
         "geoip"  : {
           "type" : "object",
             "dynamic": true,
             "path": "full",
             "properties" : {
               "location" : { "type" : "geo_point" }
             }
         }
       }
    }
  }
}
</code></pre>
<ul>
<li>order</li>
</ul>
<p>如果你有自己单独定制 template 的想法，很好。这时候有几种选择：</p>
<ol>
<li>在 logstash/outputs/elasticsearch 配置中开启 <code>manage_template =&gt; false</code> 选项，然后一切自己动手；</li>
<li>在 logstash/outputs/elasticsearch 配置中开启 <code>template =&gt; "../../../path/to/your/tmpl.json"</code> 选项，让 logstash 来发送你自己写的 template 文件；</li>
<li>避免变更 logstash 里的配置，而是另外发送一个 template ，利用 elasticsearch 的 templates order 功能。</li>
</ol>
<p>这个 order 功能，就是 elasticsearch 在创建一个索引的时候，如果发现这个索引同时匹配上了多个 template ，那么就会先应用 order 数值小的 template 设置，然后再应用一遍 order 数值高的作为覆盖，最终达到一个 merge 的效果。</p>
<p>比如，对上面这个模板已经很满意，只想修改一下 <code>refresh_interval</code> ，那么只需要新写一个：</p>
<pre><code class="language-json">{
  "order" : 1,
  "template" : "logstash-*",
  "settings" : {
    "index.refresh_interval" : "20s"
  }
}
</code></pre>
<p>然后运行 <code>curl -XPUT http://localhost:9200/_template/template_newid -d '@/path/to/your/tmpl.json'</code> 即可。</p>
<p>logstash 默认的模板， order 是 0，id 是 logstash，通过 logstash/outputs/elasticsearch 的配置选项 <code>template_name</code> 修改。你的新模板就不要跟这个名字冲突了。</p>
<h2 id="推荐阅读">推荐阅读</h2>
<ul>
<li><a href="http://www.elasticsearch.org/guide">http://www.elasticsearch.org/guide</a></li>
</ul>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/163/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/git_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/163/index.html">Git的奇技淫巧</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/92.html">jackfrued</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="git">git</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">77页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月26日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 28个">28</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/61/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/javascript_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/61/index.html">前端开发者手册</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/37.html">dwqs</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="html5">html5</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="javascript">javascript</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="css3">css3</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">92页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月5日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 548个">548</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/108/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/storm_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/108/index.html">Apache Storm 官方文档中文版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/62.html">tzivanmoe</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="storm">storm</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">74页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年7月1日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 3个">3</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/42/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/docker_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/42/index.html">Docker-從入門到實踐</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/22.html">jasonblog</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="docker">docker</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">82页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月30日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 1个">1</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/203/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/java_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/203/index.html">Java Web 入门开发教程</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/115.html">skyline75489</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="java">java</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">22页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2021年10月24日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 647个">647</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../../book/160/index.html">
<img class="uk-book-cover" src="../../../static/icons/48/python_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../../book/160/index.html">Python - 100天从新手到大师</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../../user/92.html">jackfrued</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="python">python</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">75页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月26日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 33569个">33569</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../../" title="返回首页"><img class="" src="../../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../../book/52/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../../book/52/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/52/README.html" title="简介" data-book-page-rel-url="README.html" data-book-page-id="4835">简介</a>
</li>
<li>
<a class="pjax" href="../../../book/52/get_start/README.html" title="基础知识" data-book-page-rel-url="get_start/README.html" data-book-page-id="4836">基础知识</a>
<ul>
<li>
<a class="pjax" href="../../../book/52/get_start/introduction.html" title="介绍" data-book-page-rel-url="get_start/introduction.html" data-book-page-id="4837">介绍</a>
</li>
<li>
<a class="pjax" href="../../../book/52/get_start/install.html" title="安装" data-book-page-rel-url="get_start/install.html" data-book-page-id="4838">安装</a>
</li>
<li>
<a class="pjax" href="../../../book/52/get_start/hello_world.html" title="Hello World" data-book-page-rel-url="get_start/hello_world.html" data-book-page-id="4839">Hello World</a>
</li>
<li>
<a class="pjax" href="../../../book/52/get_start/daemon.html" title="长期运行" data-book-page-rel-url="get_start/daemon.html" data-book-page-id="4840">长期运行</a>
</li>
<li>
<a class="pjax" href="../../../book/52/get_start/full_config.html" title="配置语法" data-book-page-rel-url="get_start/full_config.html" data-book-page-id="4841">配置语法</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/52/input/README.html" title="输入插件(Input)" data-book-page-rel-url="input/README.html" data-book-page-id="4842">输入插件(Input)</a>
<ul>
<li>
<a class="pjax" href="../../../book/52/input/stdin.html" title="标准输入(Stdin)" data-book-page-rel-url="input/stdin.html" data-book-page-id="4843">标准输入(Stdin)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/input/file.html" title="读取文件(File)" data-book-page-rel-url="input/file.html" data-book-page-id="4844">读取文件(File)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/input/tcp.html" title="读取网络数据(TCP)" data-book-page-rel-url="input/tcp.html" data-book-page-id="4845">读取网络数据(TCP)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/input/generator.html" title="生成测试数据(Generator)" data-book-page-rel-url="input/generator.html" data-book-page-id="4846">生成测试数据(Generator)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/input/syslog.html" title="读取 Syslog 数据" data-book-page-rel-url="input/syslog.html" data-book-page-id="4847">读取 Syslog 数据</a>
</li>
<li>
<a class="pjax" href="../../../book/52/input/redis.html" title="读取 Redis 数据" data-book-page-rel-url="input/redis.html" data-book-page-id="4848">读取 Redis 数据</a>
</li>
<li>
<a class="pjax" href="../../../book/52/input/collectd.html" title="读取 Collectd 数据" data-book-page-rel-url="input/collectd.html" data-book-page-id="4849">读取 Collectd 数据</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/52/codec/README.html" title="编码插件(Codec)" data-book-page-rel-url="codec/README.html" data-book-page-id="4850">编码插件(Codec)</a>
<ul>
<li>
<a class="pjax" href="../../../book/52/codec/json.html" title="采用 JSON 编码" data-book-page-rel-url="codec/json.html" data-book-page-id="4851">采用 JSON 编码</a>
</li>
<li>
<a class="pjax" href="../../../book/52/codec/multiline.html" title="合并多行数据(Multiline)" data-book-page-rel-url="codec/multiline.html" data-book-page-id="4852">合并多行数据(Multiline)</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/README.html" title="过滤器插件(Filter)" data-book-page-rel-url="filter/README.html" data-book-page-id="4853">过滤器插件(Filter)</a>
<ul>
<li>
<a class="pjax" href="../../../book/52/filter/grok.html" title="Grok 正则捕获" data-book-page-rel-url="filter/grok.html" data-book-page-id="4854">Grok 正则捕获</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/date.html" title="时间处理(Date)" data-book-page-rel-url="filter/date.html" data-book-page-id="4855">时间处理(Date)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/mutate.html" title="数据修改(Mutate)" data-book-page-rel-url="filter/mutate.html" data-book-page-id="4856">数据修改(Mutate)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/geoip.html" title="GeoIP 查询归类" data-book-page-rel-url="filter/geoip.html" data-book-page-id="4857">GeoIP 查询归类</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/json.html" title="JSON 编解码" data-book-page-rel-url="filter/json.html" data-book-page-id="4858">JSON 编解码</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/split.html" title="split 拆分事件" data-book-page-rel-url="filter/split.html" data-book-page-id="4859">split 拆分事件</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/useragent.html" title="UserAgent 匹配归类" data-book-page-rel-url="filter/useragent.html" data-book-page-id="4860">UserAgent 匹配归类</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/kv.html" title="Key-Value 切分" data-book-page-rel-url="filter/kv.html" data-book-page-id="4861">Key-Value 切分</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/ruby.html" title="随心所欲的 Ruby 处理" data-book-page-rel-url="filter/ruby.html" data-book-page-id="4862">随心所欲的 Ruby 处理</a>
</li>
<li>
<a class="pjax" href="../../../book/52/filter/metrics.html" title="数值统计(Metrics)" data-book-page-rel-url="filter/metrics.html" data-book-page-id="4863">数值统计(Metrics)</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/52/output/README.html" title="输出插件(Output)" data-book-page-rel-url="output/README.html" data-book-page-id="4864">输出插件(Output)</a>
<ul>
<li>
<a class="pjax" href="../../../book/52/output/stdout.html" title="标准输出(Stdout)" data-book-page-rel-url="output/stdout.html" data-book-page-id="4865">标准输出(Stdout)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/output/file.html" title="保存成文件(File)" data-book-page-rel-url="output/file.html" data-book-page-id="4866">保存成文件(File)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/output/elasticsearch.html" title="保存进 Elasticsearch" data-book-page-rel-url="output/elasticsearch.html" data-book-page-id="4867">保存进 Elasticsearch</a>
</li>
<li>
<a class="pjax" href="../../../book/52/output/redis.html" title="输出到 Redis" data-book-page-rel-url="output/redis.html" data-book-page-id="4868">输出到 Redis</a>
</li>
<li>
<a class="pjax" href="../../../book/52/output/tcp.html" title="输出网络数据(TCP)" data-book-page-rel-url="output/tcp.html" data-book-page-id="4869">输出网络数据(TCP)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/output/statsd.html" title="输出到 Statsd" data-book-page-rel-url="output/statsd.html" data-book-page-id="4870">输出到 Statsd</a>
</li>
<li>
<a class="pjax" href="../../../book/52/output/nagios.html" title="报警到 Nagios" data-book-page-rel-url="output/nagios.html" data-book-page-id="4871">报警到 Nagios</a>
</li>
<li>
<a class="pjax" href="../../../book/52/output/email.html" title="发送邮件(Email)" data-book-page-rel-url="output/email.html" data-book-page-id="4872">发送邮件(Email)</a>
</li>
<li>
<a class="pjax" href="../../../book/52/output/exec.html" title="调用命令执行(Exec)" data-book-page-rel-url="output/exec.html" data-book-page-id="4873">调用命令执行(Exec)</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/52/contrib_plugins/README.html" title="尚未进入官方库的常用插件" data-book-page-rel-url="contrib_plugins/README.html" data-book-page-id="4874">尚未进入官方库的常用插件</a>
<ul>
<li>
<a class="pjax" href="../../../book/52/contrib_plugins/kafka.html" title="Kafka" data-book-page-rel-url="contrib_plugins/kafka.html" data-book-page-id="4875">Kafka</a>
</li>
<li>
<a class="pjax" href="../../../book/52/contrib_plugins/hdfs.html" title="HDFS" data-book-page-rel-url="contrib_plugins/hdfs.html" data-book-page-id="4876">HDFS</a>
</li>
<li>
<a class="pjax" href="../../../book/52/contrib_plugins/scribe.html" title="Scribe" data-book-page-rel-url="contrib_plugins/scribe.html" data-book-page-id="4877">Scribe</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/52/dive_into/README.html" title="深入了解" data-book-page-rel-url="dive_into/README.html" data-book-page-id="4878">深入了解</a>
<ul>
<li>
<a class="pjax" href="../../../book/52/dive_into/write_your_own.html" title="自己写一个插件" data-book-page-rel-url="dive_into/write_your_own.html" data-book-page-id="4879">自己写一个插件</a>
</li>
<li>
<a class="pjax" href="../../../book/52/dive_into/why_jvm_and_howto_run_with_mri.html" title="为什么用 JRuby? 能用 MRI 运行么?" data-book-page-rel-url="dive_into/why_jvm_and_howto_run_with_mri.html" data-book-page-id="4880">为什么用 JRuby? 能用 MRI 运行么?</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../../book/52/ecosystem/README.html" title="周边项目" data-book-page-rel-url="ecosystem/README.html" data-book-page-id="4881">周边项目</a>
<ul>
<li>
<a class="pjax" href="../../../book/52/ecosystem/rsyslog.html" title="Rsyslog" data-book-page-rel-url="ecosystem/rsyslog.html" data-book-page-id="4882">Rsyslog</a>
</li>
<li>
<a class="pjax" href="../../../book/52/ecosystem/logstash_forwarder.html" title="logstash-forwarder" data-book-page-rel-url="ecosystem/logstash_forwarder.html" data-book-page-id="4883">logstash-forwarder</a>
</li>
<li>
<a class="pjax" href="../../../book/52/ecosystem/nxlog.html" title="nxlog" data-book-page-rel-url="ecosystem/nxlog.html" data-book-page-id="4884">nxlog</a>
</li>
<li>
<a class="pjax" href="../../../book/52/ecosystem/heka.html" title="heka" data-book-page-rel-url="ecosystem/heka.html" data-book-page-id="4885">heka</a>
</li>
<li>
<a class="pjax" href="../../../book/52/ecosystem/message_passing.html" title="Message::Passing" data-book-page-rel-url="ecosystem/message_passing.html" data-book-page-id="4886">Message::Passing</a>
</li>
<li>
<a class="pjax" href="../../../book/52/ecosystem/fluent.html" title="fluent" data-book-page-rel-url="ecosystem/fluent.html" data-book-page-id="4887">fluent</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =52;var bookPageId =4867;var bookPageRelUrl ='output/elasticsearch.html';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>