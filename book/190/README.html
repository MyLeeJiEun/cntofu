
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>Introduction-Nginx 管理员手册(Nginx Admin's Handbook)</title>
<meta content='Introduction,Nginx 管理员手册,Nginx Admin's Handbook' name='keywords'>
    <meta content='Introduction,Nginx 管理员手册,Nginx Admin's Handbook' name='description'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"../../>
<meta name="applicable-device" content="pc,mobile">
<link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon" />
<meta name="renderer" content="webkit">
<link rel="stylesheet" href="../../static/components/uikit-2.27.5/css/uikit.custom.css">
<link rel="stylesheet" href="../../static/components/social-share/social-share.min.css">
<link rel="stylesheet" href="../../static/components/highlight/styles/custom.css">
<link rel="stylesheet" href="../../static/components/css/base.css">
<link rel="stylesheet" href="../../static/components/css/reader.css">
<link rel="stylesheet" href="../../static/components/css/markdown.css">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5313208362165053" crossorigin="anonymous"></script>
</head>
<body>
<div class=" book-main-wrap uk-container uk-container-center uk-margin-top ">
<div class="uk-grid">
<div class="uk-width-1-1 reader-wrap ">
<div class=" bottom-nav uk-clearfix ">
<div class="uk-align-right ">
<a href="../../book/190/README.html#general-disclaimer">
<span class="">General dis..</span>
<i class="nav-icon-right uk-icon-small  uk-icon-caret-right"></i>
</a>
</div>
</div>
<div class="uk-text-center">
<h2 class="book-page-title uk-container-center">
<a href="../../book/190/index.html">Nginx 管理员手册 (Nginx Admin's Handbook)</a>
<a target="_blank" rel="nofollow" href="https://github.com/trimstray/nginx-admins-handbook" class="uk-icon-button uk-icon-github" title="github项目地址"></a>
</h2>
</div>
<script type="text/javascript" src="../../static/components/js/app_intro.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5313208362165053" data-ad-slot="1328047120"></ins>
<script>(adsbygoogle =window.adsbygoogle ||[]).push({});</script>
<hr class="uk-article-divider">
<div class="book-content-section  md-content-section  uk-margin-bottom">
<div align="center">
<h1>Nginx Admin's Handbook</h1>
</div>
<div align="center">
<b><code>My notes on NGINX administration basics, tips &amp; tricks, caveats, and gotchas.</code></b>
</div>
<br>
<p align="center"> <a href="https://www.hostingadvice.com/how-to/nginx-vs-apache/"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx_meme.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx_meme.png" alt="Meme"></a> </a> </p>
<br>
<p align="center"> <i> Hi-diddle-diddle, he played on his<br> fiddle and danced with lady pigs.<br> Number three said, "Nicks on tricks!<br> I'll build my house with <b>EN-jin-EKS</b>!".<br> <a href="https://g.co/kgs/HCcQVz">The Three Little Pigs: Who's Afraid of the Big Bad Wolf?</a> </i> </p>
<br>
<p align="center"> <a href="https://github.com/trimstray/nginx-admins-handbook/pulls"> <a href="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?longCache=true" data-uk-lightbox><img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?longCache=true" alt="Pull Requests"></a> </a> <a href="http://www.gnu.org/licenses/"> <a href="https://img.shields.io/badge/License-GNU-blue.svg?longCache=true" data-uk-lightbox><img src="https://img.shields.io/badge/License-GNU-blue.svg?longCache=true" alt="License"></a> </a> </p>
<div align="center">
<sub>Created by <a href="https://twitter.com/trimstray">trimstray</a> and <a href="https://github.com/trimstray/nginx-admins-handbook/graphs/contributors">contributors</a> </sub>
</div>
<br>
<hr>
<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><strong><a href="#introduction">Introduction</a></strong>
<ul>
<li><a href="#general-disclaimer">General disclaimer</a></li>
<li><a href="#contributing--support">Contributing &amp; Support</a></li>
<li><a href="#todo-list">ToDo list</a></li>
<li><a href="#reports-blkcipherinfo">Reports: blkcipher.info</a>
<ul>
<li><a href="#ssl-labs">SSL Labs</a></li>
<li><a href="#mozilla-observatory">Mozilla Observatory</a></li>
</ul> </li>
<li><a href="#printable-high-res-hardening-cheatsheet">Printable high-res hardening cheatsheet</a></li>
<li><a href="#all-in-one-checklist-as-a-quick-introduction">All in one checklist as a quick introduction</a></li>
</ul> </li>
<li><strong><a href="#books">Books</a></strong>
<ul>
<li><a href="#nginx-essentials">Nginx Essentials</a></li>
<li><a href="#nginx-cookbook">Nginx Cookbook</a></li>
<li><a href="#nginx-http-server">Nginx HTTP Server</a></li>
<li><a href="#nginx-high-performance">Nginx High Performance</a></li>
<li><a href="#mastering-nginx">Mastering Nginx</a></li>
<li><a href="#modsecurity-30-and-nginx-quick-start-guide">ModSecurity 3.0 and NGINX: Quick Start Guide</a></li>
<li><a href="#cisco-ace-to-nginx-migration-guide">Cisco ACE to NGINX: Migration Guide</a></li>
</ul> </li>
<li><strong><a href="#external-resources">External Resources</a></strong>
<ul>
<li><a href="#nginx-official">Nginx official</a></li>
<li><a href="#based-on-the-nginx">Based on the Nginx</a></li>
<li><a href="#comparison-reviews">Comparison reviews</a></li>
<li><a href="#cheatsheets--references">Cheatsheets &amp; References</a></li>
<li><a href="#performance--hardening">Performance &amp; Hardening</a></li>
<li><a href="#playgrounds">Playgrounds</a></li>
<li><a href="#config-generators">Config generators</a></li>
<li><a href="#static-analyzers">Static analyzers</a></li>
<li><a href="#log-analyzers">Log analyzers</a></li>
<li><a href="#performance-analyzers">Performance analyzers</a></li>
<li><a href="#benchmarking-tools">Benchmarking tools</a></li>
<li><a href="#debugging-tools">Debugging tools</a></li>
<li><a href="#development">Development</a></li>
<li><a href="#online-tools">Online tools</a></li>
<li><a href="#other-stuff">Other stuff</a></li>
</ul> </li>
<li><strong><a href="#helpers">Helpers</a></strong>
<ul>
<li><a href="#nginx-directories-and-files">Nginx directories and files</a></li>
<li><a href="#nginx-commands">Nginx commands</a></li>
<li><a href="#nginx-processes">Nginx processes</a></li>
<li><a href="#configuration-syntax">Configuration syntax</a>
<ul>
<li><a href="#comments">Comments</a></li>
<li><a href="#variables--strings">Variables &amp; Strings</a></li>
<li><a href="#directives-blocks-and-contexts">Directives, Blocks, and Contexts</a></li>
<li><a href="#measurement-units">Measurement units</a></li>
<li><a href="#enable-syntax-highlight-for-nginx-configuration-file">Enable syntax highlight for Nginx configuration file</a></li>
</ul> </li>
<li><a href="#connection-processing">Connection processing</a></li>
<li><a href="#request-processing-stages">Request processing stages</a></li>
<li><a href="#server-blocks-logic">Server blocks logic</a>
<ul>
<li><a href="#handle-incoming-connections">Handle incoming connections</a></li>
<li><a href="#matching-location">Matching location</a></li>
</ul> </li>
<li><a href="#error-log-severity-levels">Error log severity levels</a></li>
<li><a href="#rate-limiting">Rate limiting</a></li>
<li><a href="#analyse-configuration">Analyse configuration</a></li>
<li><a href="#monitoring">Monitoring</a>
<ul>
<li><a href="#goaccess">GoAccess</a>
<ul>
<li><a href="#build-and-install">Build and install</a></li>
<li><a href="#analyse-log-file-and-enable-all-recorded-statistics">Analyse log file and enable all recorded statistics</a></li>
<li><a href="#analyse-compressed-log-file">Analyse compressed log file</a></li>
<li><a href="#analyse-log-file-remotely">Analyse log file remotely</a></li>
<li><a href="#analyse-log-file-and-generate-html-report">Analyse log file and generate html report</a></li>
</ul> </li>
<li><a href="#ngxtop">Ngxtop</a>
<ul>
<li><a href="#analyse-log-file">Analyse log file</a></li>
<li><a href="#analyse-log-file-and-print-requests-with-4xx-and-5xx">Analyse log file and print requests with 4xx and 5xx</a></li>
<li><a href="#analyse-log-file-remotely-1">Analyse log file remotely</a></li>
</ul> </li>
</ul> </li>
<li><a href="#testing">Testing</a>
<ul>
<li><a href="#send-request-and-show-response-headers">Send request and show response headers</a></li>
<li><a href="#send-request-with-http-method-user-agent-follow-redirects-and-show-response-headers">Send request with http method, user-agent, follow redirects and show response headers</a></li>
<li><a href="#send-multiple-requests">Send multiple requests</a></li>
<li><a href="#testing-ssl-connection">Testing SSL connection</a></li>
<li><a href="#testing-ssl-connection-with-sni-support">Testing SSL connection (with SNI support)</a></li>
<li><a href="#testing-ssl-connection-with-specific-ssl-version">Testing SSL connection with specific SSL version</a></li>
<li><a href="#testing-ssl-connection-with-specific-cipher">Testing SSL connection with specific cipher</a></li>
<li><a href="#tcp-syn-flood-denial-of-service-attack">TCP SYN flood Denial of Service attack</a></li>
<li><a href="#tcp-syn-flood-denial-of-service-attack">HTTP Denial of Service attack</a></li>
</ul> </li>
<li><a href="#debugging">Debugging</a>
<ul>
<li><a href="#show-information-about-nginx-processes">Show information about NGINX processes</a></li>
<li><a href="#check-if-the-module-has-been-compiled">Check if the module has been compiled</a></li>
<li><a href="#show-the-most-accessed-ip-addresses">Show the most accessed IP addresses</a></li>
<li><a href="#show-the-top-5-visitors-ip-addresses">Show the top 5 visitors (IP addresses)</a></li>
<li><a href="#show-the-most-requested-urls">Show the most requested urls</a></li>
<li><a href="#show-the-most-requested-urls-containing-string">Show the most requested urls containing 'string'</a></li>
<li><a href="#show-the-most-requested-urls-with-http-methods">Show the most requested urls with http methods</a></li>
<li><a href="#show-the-most-accessed-response-codes">Show the most accessed response codes</a></li>
<li><a href="#analyse-web-server-log-and-show-only-2xx-http-codes">Analyse web server log and show only 2xx http codes</a></li>
<li><a href="#analyse-web-server-log-and-show-only-5xx-http-codes">Analyse web server log and show only 5xx http codes</a></li>
<li><a href="#show-requests-which-result-502-and-sort-them-by-number-per-requests-by-url">Show requests which result 502 and sort them by number per requests by url</a></li>
<li><a href="#show-requests-which-result-404-for-php-files-and-sort-them-by-number-per-requests-by-url">Show requests which result 404 for php files and sort them by number per requests by url</a></li>
<li><a href="#calculating-amount-of-http-response-codes">Calculating amount of http response codes</a></li>
<li><a href="#calculating-requests-per-second">Calculating requests per second</a></li>
<li><a href="#calculating-requests-per-second-with-ip-addresses">Calculating requests per second with IP addresses</a></li>
<li><a href="#calculating-requests-per-second-with-ip-addresses-and-urls">Calculating requests per second with IP addresses and urls</a></li>
<li><a href="#get-entries-within-last-n-hours">Get entries within last n hours</a></li>
<li><a href="#get-entries-between-two-timestamps-range-of-dates">Get entries between two timestamps (range of dates)</a></li>
<li><a href="#get-line-rates-from-web-server-log">Get line rates from web server log</a></li>
<li><a href="#trace-network-traffic-for-all-nginx-processes">Trace network traffic for all NGINX processes</a></li>
<li><a href="#list-all-files-accessed-by-a-nginx">List all files accessed by a NGINX</a></li>
<li><a href="#check-that-the-gzip_static-module-is-working">Check that the gzip_static module is working</a></li>
<li><a href="#which-worker-processing-current-request">Which worker processing current request</a></li>
<li><a href="#capture-only-http-packets">Capture only http packets</a></li>
<li><a href="#extract-http-user-agent-from-the-http-packets">Extract http User Agent from the http packets</a></li>
<li><a href="#capture-only-http-get-and-post-packets">Capture only http GET and POST packets</a></li>
<li><a href="#capture-requests-and-filter-by-source-ip-and-destination-port">Capture requests and filter by source ip and destination port</a></li>
</ul> </li>
<li><a href="#shell-aliases">Shell aliases</a></li>
<li><a href="#configuration-snippets">Configuration snippets</a>
<ul>
<li><a href="#restricting-access-with-basic-authentication">Restricting access with basic authentication</a></li>
<li><a href="#blockingallowing-ip-addresses">Blocking/allowing IP addresses</a></li>
<li><a href="#blocking-referrer-spam">Blocking referrer spam</a></li>
<li><a href="#limiting-referrer-spam">Limiting referrer spam</a></li>
<li><a href="#limiting-the-rate-of-requests-with-burst-mode">Limiting the rate of requests with burst mode</a></li>
<li><a href="#limiting-the-rate-of-requests-with-burst-mode-and-nodelay">Limiting the rate of requests with burst mode and nodelay</a></li>
<li><a href="#limiting-the-number-of-connections">Limiting the number of connections</a></li>
<li><a href="#adding-and-removing-the-www-prefix">Adding and removing the www prefix</a></li>
<li><a href="#rewrite-post-request-with-payload-to-external-endpoint">Rewrite POST request with payload to external endpoint</a></li>
<li><a href="#allow-multiple-cross-domains-using-the-cors-headers">Allow multiple cross-domains using the CORS headers</a></li>
</ul> </li>
<li><a href="#other-snippets">Other snippets</a>
<ul>
<li><a href="#create-a-temporary-static-backend">Create a temporary static backend</a></li>
<li><a href="#create-a-temporary-static-backend-with-ssl-support">Create a temporary static backend with SSL support</a></li>
<li><a href="#generate-private-key-without-passphrase">Generate private key without passphrase</a></li>
<li><a href="#generate-csr">Generate CSR</a></li>
<li><a href="#generate-csr-metadata-from-existing-certificate">Generate CSR (metadata from existing certificate)</a></li>
<li><a href="#generate-csr-with--config-param">Generate CSR with -config param</a></li>
<li><a href="#generate-private-key-and-csr">Generate private key and csr</a></li>
<li><a href="#generate-ecdsa-private-key">Generate ECDSA private key</a></li>
<li><a href="#generate-private-key-with-csr-ecc">Generate private key with csr (ECC)</a></li>
<li><a href="#generate-self-signed-certificate">Generate self-signed certificate</a></li>
<li><a href="#generate-self-signed-certificate-from-existing-private-key">Generate self-signed certificate from existing private key</a></li>
<li><a href="#generate-self-signed-certificate-from-existing-private-key-and-csr">Generate self-signed certificate from existing private key and csr</a></li>
<li><a href="#generate-multidomain-certificate">Generate multidomain certificate</a></li>
<li><a href="#generate-wildcard-certificate">Generate wildcard certificate</a></li>
<li><a href="#generate-certificate-with-4096-bit-private-key">Generate certificate with 4096 bit private key</a></li>
<li><a href="#generate-dh-param-key">Generate DH Param key</a></li>
<li><a href="#convert-der-to-pem">Convert DER to PEM</a></li>
<li><a href="#convert-pem-to-der">Convert PEM to DER</a></li>
<li><a href="#verification-of-the-private-key">Verification of the private key</a></li>
<li><a href="#verification-of-the-public-key">Verification of the public key</a></li>
<li><a href="#verification-of-the-certificate">Verification of the certificate</a></li>
<li><a href="#verification-of-the-csr">Verification of the CSR</a></li>
<li><a href="#check-whether-the-private-key-and-the-certificate-match">Check whether the private key and the certificate match</a></li>
</ul> </li>
<li><a href="#installation-from-prebuilt-packages">Installation from prebuilt packages</a>
<ul>
<li><a href="#rhel7-or-centos-7">RHEL7 or CentOS 7</a></li>
<li><a href="#debian-or-ubuntu">Debian or Ubuntu</a></li>
</ul> </li>
<li><a href="#installation-from-source">Installation from source</a>
<ul>
<li><a href="#automatic-installation">Automatic installation</a></li>
<li><a href="#nginx-package">Nginx package</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#3rd-party-modules">3rd party modules</a></li>
<li><a href="#compiler-and-linker">Compiler and linker</a></li>
<li><a href="#systemtap">SystemTap</a></li>
<li><a href="#install-nginx-on-centos-7">Install Nginx on CentOS 7</a>
<ul>
<li><a href="#pre-installation-tasks">Pre installation tasks</a></li>
<li><a href="#install-or-build-dependencies">Install or build dependencies</a></li>
<li><a href="#get-nginx-sources">Get Nginx sources</a></li>
<li><a href="#download-3rd-party-modules">Download 3rd party modules</a></li>
<li><a href="#build-nginx">Build Nginx</a></li>
<li><a href="#post-installation-tasks">Post installation tasks</a></li>
</ul> </li>
<li><a href="#install-openresty-on-centos-7">Install OpenResty on CentOS 7</a></li>
<li><a href="#install-tengine-on-ubuntu-1804">Install Tengine on Ubuntu 18.04</a></li>
</ul> </li>
</ul> </li>
<li><strong><a href="#base-rules">Base Rules</a></strong>
<ul>
<li><a href="#beginner-organising-nginx-configuration">Organising Nginx configuration</a></li>
<li><a href="#beginner-format-prettify-and-indent-your-nginx-code">Format, prettify and indent your Nginx code</a></li>
<li><a href="#beginner-use-reload-method-to-change-configurations-on-the-fly">Use reload method to change configurations on the fly</a></li>
<li><a href="#beginner-separate-listen-directives-for-80-and-443">Separate listen directives for 80 and 443</a></li>
<li><a href="#beginner-define-the-listen-directives-explicitly-with-addressport-pair">Define the listen directives explicitly with address:port pair</a></li>
<li><a href="#beginner-prevent-processing-requests-with-undefined-server-names">Prevent processing requests with undefined server names</a></li>
<li><a href="#beginner-use-only-one-ssl-config-for-specific-listen-directive">Use only one SSL config for specific listen directive</a></li>
<li><a href="#beginner-force-all-connections-over-tls">Force all connections over TLS</a></li>
<li><a href="#beginner-use-geomap-modules-instead-allowdeny">Use geo/map modules instead allow/deny</a></li>
<li><a href="#beginner-map-all-the-things">Map all the things...</a></li>
<li><a href="#beginner-drop-the-same-root-inside-location-block">Drop the same root inside location block</a></li>
<li><a href="#beginner-use-debug-mode-for-debugging">Use debug mode for debugging</a></li>
<li><a href="#beginner-use-custom-log-formats-for-debugging">Use custom log formats for debugging</a></li>
</ul> </li>
<li><strong><a href="#performance">Performance</a></strong>
<ul>
<li><a href="#beginner-adjust-worker-processes">Adjust worker processes</a></li>
<li><a href="#beginner-use-http2">Use HTTP/2</a></li>
<li><a href="#beginner-maintaining-ssl-sessions">Maintaining SSL sessions</a></li>
<li><a href="#beginner-use-exact-names-in-server-name-directive-where-possible">Use exact names in server_name directive where possible</a></li>
<li><a href="#beginner-avoid-checks-server_name-with-if-directive">Avoid checks server_name with if directive</a></li>
<li><a href="#beginner-make-an-exact-location-match-to-speed-up-the-selection-process">Make an exact location match to speed up the selection process</a></li>
<li><a href="#beginner-use-limit_conn-to-improve-limiting-the-download-speed">Use limit_conn to improve limiting the download speed</a></li>
</ul> </li>
<li><strong><a href="#hardening">Hardening</a></strong>
<ul>
<li><a href="#keep-nginx-up-to-date">Keep NGINX up-to-date</a></li>
<li><a href="#beginner-run-as-an-unprivileged-user">Run as an unprivileged user</a></li>
<li><a href="#beginner-disable-unnecessary-modules">Disable unnecessary modules</a></li>
<li><a href="#beginner-protect-sensitive-resources">Protect sensitive resources</a></li>
<li><a href="#beginner-hide-nginx-version-number">Hide Nginx version number</a></li>
<li><a href="#beginner-hide-nginx-server-signature">Hide Nginx server signature</a></li>
<li><a href="#beginner-hide-upstream-proxy-headers">Hide upstream proxy headers</a></li>
<li><a href="#beginner-use-only-the-latest-supported-openssl-version">Use only the latest supported OpenSSL version</a></li>
<li><a href="#beginner-use-min-2048-bit-private-keys">Use min. 2048-bit private keys</a></li>
<li><a href="#beginner-keep-only-tls-12-and-tls-13">Keep only TLS 1.2 and TLS 1.3</a></li>
<li><a href="#beginner-use-only-strong-ciphers">Use only strong ciphers</a></li>
<li><a href="#beginner-use-more-secure-ecdh-curve">Use more secure ECDH Curve</a></li>
<li><a href="#beginner-use-strong-key-exchange">Use strong Key Exchange</a></li>
<li><a href="#beginner-defend-against-the-beast-attack">Defend against the BEAST attack</a></li>
<li><a href="#beginner-mitigation-of-crimebreach-attacks">Mitigation of CRIME/BREACH attacks)</a></li>
<li><a href="#beginner-http-strict-transport-security">HTTP Strict Transport Security</a></li>
<li><a href="#beginner-reduce-xss-risks-content-security-policy">Reduce XSS risks (Content-Security-Policy)</a></li>
<li><a href="#beginner-control-the-behavior-of-the-referer-header-referrer-policy">Control the behavior of the Referer header (Referrer-Policy)</a></li>
<li><a href="#beginner-provide-clickjacking-protection-x-frame-options">Provide clickjacking protection (X-Frame-Options)</a></li>
<li><a href="#beginner-prevent-some-categories-of-xss-attacks-x-xss-protection">Prevent some categories of XSS attacks (X-XSS-Protection)</a></li>
<li><a href="#beginner-prevent-sniff-mimetype-middleware-x-content-type-options">Prevent Sniff Mimetype middleware (X-Content-Type-Options)</a></li>
<li><a href="#beginner-deny-the-use-of-browser-features-feature-policy">Deny the use of browser features (Feature-Policy)</a></li>
<li><a href="#beginner-reject-unsafe-http-methods">Reject unsafe HTTP methods</a></li>
<li><a href="#beginner-control-buffer-overflow-attacks">Control Buffer Overflow attacks</a></li>
<li><a href="#beginner-mitigating-slow-http-dos-attack-closing-slow-connections">Mitigating Slow HTTP DoS attack (Closing Slow Connections)</a></li>
</ul> </li>
<li><strong><a href="#reverse-proxy">Reverse Proxy</a></strong></li>
<li><strong><a href="#load-balancing">Load Balancing</a></strong>
<ul>
<li><a href="#beginner-tweak-passive-health-checks">Tweak passive health checks</a></li>
<li><a href="#beginner-dont-disable-backends-by-comments-use-down-parameter">Don't disable backends by comments, use down parameter</a></li>
</ul> </li>
<li><strong><a href="#others">Others</a></strong>
<ul>
<li><a href="#beginner-enable-dns-caa-policy">Enable DNS CAA Policy</a></li>
<li><a href="#beginner-define-security-policies-with-securitytxt">Define security policies with security.txt</a></li>
</ul> </li>
<li><strong><a href="#configuration-examples">Configuration Examples</a></strong>
<ul>
<li><a href="#reverse-proxy">Reverse Proxy</a>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#import-configuration">Import configuration</a></li>
<li><a href="#set-bind-ip-address">Set bind IP address</a></li>
<li><a href="#set-your-domain-name">Set your domain name</a></li>
<li><a href="#regenerate-private-keys-and-certs">Regenerate private keys and certs</a></li>
<li><a href="#update-modules-list">Update modules list</a></li>
<li><a href="#generating-the-necessary-error-pages">Generating the necessary error pages</a></li>
<li><a href="#add-new-domain">Add new domain</a></li>
<li><a href="#test-your-configuration">Test your configuration</a></li>
</ul> </li>
</ul> </li>
</ul>
<h1 id="introduction">Introduction</h1>
<br>
<p align="center"> <a href="https://www.nginx.com/"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx_admins_handbook_logo.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx_admins_handbook_logo.png"></a> </a> </p>
<br>
<blockquote>
<p>Before you start playing with NGINX please read an official <strong><a href="http://nginx.org/en/docs/beginners_guide.html">Beginner’s Guide</a></strong>. It's a great introduction for everyone.</p>
</blockquote>
<p><strong>Nginx</strong> (<em>/ˌɛndʒɪnˈɛks/ EN-jin-EKS</em>, stylized as NGINX or nginx) is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server. It is originally written by <a href="http://sysoev.ru/en/">Igor Sysoev</a>. For a long time, it has been running on many heavily loaded Russian sites including Yandex, Mail.Ru, VK, and Rambler.</p>
<p>NGINX is a fast, light-weight and powerful web server that can also be used as a fast HTTP reverse proxy, reliable load balancer and high performance caching server. Generally it provides the core of complete web stacks.</p>
<p>These essential documents should be the main source of knowledge for you:</p>
<ul>
<li><strong><a href="https://www.nginx.com/resources/wiki/start/">Getting Started</a></strong></li>
<li><strong><a href="https://nginx.org/en/docs/">NGINX Documentation</a></strong></li>
</ul>
<p>In addition, I would like to recommend two great articles focuses on the concept of the HTTP protocol:</p>
<ul>
<li><strong><a href="https://www.jmarshall.com/easy/http/">HTTP Made Really Easy</a></strong></li>
<li><strong><a href="https://www.w3.org/Protocols/">Hypertext Transfer Protocol Specification</a></strong></li>
</ul>
<h2 id="general-disclaimer">General disclaimer</h2>
<p>This handbook is a collection of rules, notes and papers, best practices and recommendations collected and used by me (also in production environments but not only). Many of these refer to external resources.</p>
<p>I've never found one guide that covers the most important things about NGINX, and around NGINX. Of course, we have <a href="https://nginx.org/en/docs/">official documentation</a> - it's probably the best place for us.</p>
<p>I think, however, there hasn't been a truly in-depth cheatsheet which describe a variety of configurations and important cross-cutting topics for HTTP servers. That's why I created this repository to help us to configure high performing NGINX web and proxy servers that are fast, secure and stable. I still have a lot <a href="#todo-list">to improve and to do</a>.</p>
<p>Throughout this handbook you will explore the many features of NGINX and how to use them. This guide is fairly comprehensive, and touches a lot of the functions (e.g. security, performance) of NGINX.</p>
<p>If you do not have the time to read hundreds of articles this multipurpose handbook may be useful. I created it in the hope that it will be useful especially for System Administrators and WebOps. I hope you enjoy it.</p>
<p>Before you start remember about the two most important things:</p>
<blockquote>
<p><strong><code>Do not follow guides just to get 100% of something. Think about what you actually do at your server!</code></strong></p>
</blockquote>
<blockquote>
<p><strong><code>These guidelines provides recommendations for very restrictive setup.</code></strong></p>
</blockquote>
<h2 id="contributing--support">Contributing &amp; Support</h2>
<blockquote>
<p><em>A real community, however, exists only when its members interact in a meaningful way that deepens their understanding of each other and leads to learning.</em></p>
</blockquote>
<p>If you find something which doesn't make sense, or something doesn't seem right, please make a pull request and please add valid and well-reasoned explanations about your changes or comments.</p>
<p>Before adding a pull request, please see the <strong><a href="CONTRIBUTING.html">contributing guidelines</a></strong>.</p>
<p>If this project is useful and important for you, you can bring <strong>positive energy</strong> by giving some <strong>good words</strong> or <strong>supporting this project</strong>. Thank you!</p>
<h2 id="todo-list">ToDo list</h2>
<p>New chapters:</p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<strong>Reverse Proxy</strong></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<strong>Caching</strong></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<strong>3rd party modules</strong></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<strong>Web Application Firewall</strong></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<strong>ModSecurity</strong></li>
</ul>
<p>Existing chapters:</p>
<details>
<summary><b>Introduction</b></summary>
<br>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>All in one checklist as a quick introduction</em></li>
</ul>
</details>
<details>
<summary><b>Books</b></summary>
<br>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>ModSecurity 3.0 and NGINX: Quick Start Guide</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Cisco ACE to NGINX: Migration Guide</em></li>
</ul>
</details>
<details>
<summary><b>External Resources</b></summary>
<br>
<ul>
<li><em>Nginx official</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Nginx Official Forum</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Nginx Official Mailing List</em></li>
</ul> </li>
<li><em>Static analyzers</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>nginx-minify-conf</em></li>
</ul> </li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Comparison reviews</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Debugging tools</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>htrace.sh</em></li>
</ul> </li>
</ul>
</details>
<details>
<summary><b>Helpers</b></summary>
<br>
<ul>
<li><em>Configuration syntax</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Enable syntax highlight for Nginx configuration file</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Measurement units</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Comments</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Variables &amp; Strings</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Directives, Blocks, and Contexts</em></li>
</ul> </li>
<li><em>Monitoring</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>CollectD, Prometheus, and Grafana</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>nginx-vts-exporter</em></li>
</ul> </li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>CollectD, InfluxDB, and Grafana</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Telegraf, InfluxDB, and Grafana</em></li>
</ul> </li>
<li><em>Testing</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Send request and show response headers</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Send request with http method, user-agent, follow redirects and show response headers</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Send multiple requests</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Testing SSL connection</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Testing SSL connection (with SNI support)</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Testing SSL connection with specific SSL version</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Testing SSL connection with specific cipher</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>TCP SYN flood Denial of Service attack</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>HTTP Denial of Service attack</em></li>
</ul> </li>
<li><em>Debugging</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Check that the gzip_static module is working</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Which worker processing current request</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>SystemTap cheatsheet</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Show information about NGINX processes</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Show the most requested urls with http methods</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Show the most accessed response codes</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Calculating requests per second with IP addresses and urls</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Extract http User Agent from the http packets</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Capture only http GET and POST packets</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Capture only http packets</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Capture requests and filter by source ip and destination port</em></li>
</ul> </li>
<li><em>Configuration snippets</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Custom error pages</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Adding and removing the www prefix</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Rewrite POST request with payload to external endpoint</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Allow multiple cross-domains using the CORS headers</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Tips and methods for high load traffic testing (cheatsheet)</em></li>
</ul> </li>
<li><em>Other snippets</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Create a temporary static backend</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Create a temporary static backend with SSL support</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate private key without passphrase</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate CSR</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate CSR (metadata from existing certificate)</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate CSR with -config param</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate private key and csr</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate ECDSA private key</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate private key with csr (ECC)</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate self-signed certificate</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate self-signed certificate from existing private key</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate self-signed certificate from existing private key and csr</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate multidomain certificate</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate wildcard certificate</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate certificate with 4096 bit private key</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Generate DH Param key</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Convert DER to PEM</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Convert PEM to DER</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Verification of the private key</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Verification of the public key</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Verification of the certificate</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Verification of the CSR</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Check whether the private key and the certificate match</em></li>
</ul> </li>
<li><em>Installation from source</em>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Add autoinstaller for RHEL/Debian like distributions</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Add compiler and linker options</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Add SystemTap - Real-time analysis and diagnoistcs tools</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Separation and improvement of installation methods</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Add installation process on CentOS 7 for NGINX</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Add installation process on CentOS 7 for OpenResty</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Add installation process on FreeBSD 11.2</em></li>
</ul> </li>
</ul>
</details>
<details>
<summary><b>Base Rules</b></summary>
<br>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Format, prettify and indent your Nginx code</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Never use a hostname in a listen directive</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Making a rewrite absolute (with scheme)</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Use "return" directive for URL redirection (301, 302)</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Use mirror module to copy requests to another backend</em></li>
</ul>
</details>
<details>
<summary><b>Performance</b></summary>
<br>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Use "index" directive in the http block</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Avoid multiple "index" directives</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Use "$request_uri" to avoid using regular expressions</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Use "try_files" directive to ensure a file exists</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Don't pass all requests to backends - use "try_files"</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Set proxy timeouts for normal load and under heavy load</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Configure kernel parameters for high load traffic</em></li>
</ul>
</details>
<details>
<summary><b>Hardening</b></summary>
<br>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Keep NGINX up-to-date</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Use only the latest supported OpenSSL version</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Set properly files and directories permissions (also with acls) on a paths</em></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Implement HTTPOnly and secure attributes on cookies</em></li>
</ul>
</details>
<details>
<summary><b>Reverse Proxy</b></summary>
<br>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled readonly>&nbsp;<em>Setting up FastCGI proxying</em></li>
</ul>
</details>
<details>
<summary><b>Others</b></summary>
<br>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Define security policies with security.txt</em></li>
</ul>
</details>
<p>Other stuff:</p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled readonly>&nbsp;<em>Add static error pages generator to NGINX snippets directory</em></li>
</ul>
<h2 id="reports-blkcipherinfo">Reports: blkcipher.info</h2>
<p>Many of these recipes have been applied to the configuration of my private website.</p>
<blockquote>
<p>An example configuration is in <a href="#configuration-examples">configuration examples</a> chapter. It's also based on <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx-hardening-cheatsheet-tls13.png">this</a> version of printable high-res hardening cheatsheet.</p>
</blockquote>
<h3 id="ssl-labs">SSL Labs</h3>
<blockquote>
<p>Read about SSL Labs grading <a href="https://community.qualys.com/docs/DOC-6321-ssl-labs-grading-2018">here</a> (SSL Labs Grading 2018).</p>
</blockquote>
<blockquote>
<p>Short SSL Labs grades explanation: <em>A+ is clearly the desired grade, both A and B grades are acceptable and result in adequate commercial security. The B grade, in particular, may be applied to configurations designed to support very wide audiences (for old clients)</em>.</p>
</blockquote>
<p>I finally got <strong>A+</strong> grade and following scores:</p>
<ul>
<li>Certificate = <strong>100%</strong></li>
<li>Protocol Support = <strong>100%</strong></li>
<li>Key Exchange = <strong>90%</strong></li>
<li>Cipher Strength = <strong>90%</strong></li>
</ul>
<p align="center"> <a href="https://www.ssllabs.com/ssltest/analyze.html?d=blkcipher.info&amp;hideResults=on"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/blkcipher_ssllabs_preview.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/blkcipher_ssllabs_preview.png" alt="blkcipher_ssllabs_preview"></a> </a> </p>
<h3 id="mozilla-observatory">Mozilla Observatory</h3>
<blockquote>
<p>Read about Mozilla Observatory <a href="https://observatory.mozilla.org/faq/">here</a>.</p>
</blockquote>
<p>I also got the highest note from Mozilla:</p>
<p align="center"> <a href="https://observatory.mozilla.org/analyze/blkcipher.info?third-party=false"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/blkcipher_mozilla_observatory_preview.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/blkcipher_mozilla_observatory_preview.png" alt="blkcipher_mozilla_observatory_preview"></a> </a> </p>
<h2 id="printable-high-res-hardening-cheatsheet">Printable high-res hardening cheatsheet</h2>
<p>I created printable posters with hardening cheatsheets (High-Res 5000x8200) based on these recipes:</p>
<blockquote>
<p>For <code>*.xcf</code> and <code>*.pdf</code> formats please see <a href="https://github.com/trimstray/nginx-admins-handbook/tree/master/static/img">this</a> directory.</p>
</blockquote>
<ul>
<li> <p><strong>A+</strong> with all <strong>100%’s</strong> on <a href="https://github.com/ssllabs"><strong>@ssllabs</strong></a> and <strong>120/100</strong> on <a href="https://github.com/mozilla"><strong>@mozilla</strong></a> observatory:</p>
<blockquote>
<p>It provides the highest scores of the SSL Labs test. Setup is very restrictive with 4096-bit private key, only TLS 1.2 and also modern strict TLS cipher suites (non 128-bits).</p>
</blockquote> </li>
</ul>
<p align="center"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx-hardening-cheatsheet-tls12-100p.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx-hardening-cheatsheet-tls12-100p.png" alt="nginx-hardening-cheatsheet-100p" width="75%" height="75%"></a> </p>
<ul>
<li> <p><strong>A+</strong> on <a href="https://github.com/ssllabs"><strong>@ssllabs</strong></a> and <strong>120/100</strong> on <a href="https://github.com/mozilla"><strong>@mozilla</strong></a> observatory with TLS 1.3 support:</p>
<blockquote>
<p>It provides less restrictive setup with 2048-bit private key, TLS 1.2 and 1.3 and also modern strict TLS cipher suites (128/256-bits). The final grade is also in line with the industry standards. Recommend using this configuration.</p>
</blockquote> </li>
</ul>
<p align="center"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx-hardening-cheatsheet-tls13.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx-hardening-cheatsheet-tls13.png" alt="nginx-hardening-cheatsheet-tls13" width="75%" height="75%"></a> </p>
<h2 id="all-in-one-checklist-as-a-quick-introduction">All in one checklist as a quick introduction</h2>
<blockquote>
<p>This checklist contains 44 rules from this handbook.</p>
</blockquote>
<p>Generally, I think that each of these principles is important and should be considered. I tried, however, to separate them into three levels of priority.</p>
<table>
<thead>
<tr>
<th align="left"><b>RULE</b></th>
<th align="left"><b>CHAPTER</b></th>
<th align="center"><b>SEVERITY</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a href="#beginner-define-the-listen-directives-explicitly-with-addressport-pair">Define the listen directives explicitly with address:port pair</a><br>Prevents soft mistakes which may be difficult to debug.</td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-prevent-processing-requests-with-undefined-server-names">Prevent processing requests with undefined server names</a><br>It also protects against configuration errors and don't pass traffic to incorrect backends</td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-force-all-connections-over-tls">Force all connections over TLS</a><br>Protect your website especially for handle sensitive communications.</td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#keep-nginx-up-to-date">Keep NGINX up-to-date</a><br>Use newest NGINX package to fix a vulnerabilities, bugs and use new features.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-run-as-an-unprivileged-user">Run as an unprivileged user</a><br>Use the principle of least privilege. This way only master process runs as root.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-protect-sensitive-resources">Protect sensitive resources</a><br>Hidden directories and files should never be web accessible.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-min-2048-bit-private-keys">Use min. 2048-bit private keys</a><br>2048 bits private keys are sufficient for commercial use.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-keep-only-tls-12-and-tls-13">Keep only TLS 1.2 and TLS 1.3</a><br>Use TLS with modern cryptographic algorithms and without protocol weaknesses.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-only-strong-ciphers">Use only strong ciphers</a><br>Use only strong and not vulnerable cipher suites.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-more-secure-ecdh-curve">Use more secure ECDH Curve</a><br>Use ECDH Curves with according to NIST recommendations.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-strong-key-exchange">Use strong Key Exchange</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-defend-against-the-beast-attack">Defend against the BEAST attack</a><br>The server ciphers should be preferred over the client ciphers.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-mitigation-of-crimebreach-attacks">Mitigation of CRIME/BREACH attacks</a><br>Disable HTTP compression or compress only zero sensitive content.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-http-strict-transport-security">HTTP Strict Transport Security</a><br>Tell browsers that it should only be accessed using HTTPS, instead of using HTTP.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-reduce-xss-risks-content-security-policy">Reduce XSS risks (Content-Security-Policy)</a><br>CSP is best used as defense-in-depth. It reduces the harm that a malicious injection can cause.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-control-the-behavior-of-the-referer-header-referrer-policy">Control the behavior of the Referer header (Referrer-Policy)</a><br>The default behaviour of referrer leaking puts websites at risk of privacy and security breaches.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-provide-clickjacking-protection-x-frame-options">Provide clickjacking protection (X-Frame-Options)</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-prevent-some-categories-of-xss-attacks-x-xss-protection">Prevent some categories of XSS attacks (X-XSS-Protection)</a><br>Prevents to render pages if a potential XSS reflection attack is detected.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-prevent-sniff-mimetype-middleware-x-content-type-options">Prevent Sniff Mimetype middleware (X-Content-Type-Options)</a><br>Tells browsers not to sniff MIME types.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-reject-unsafe-http-methods">Reject unsafe HTTP methods</a><br>Only allow the HTTP methods for which you, in fact, provide services.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/high.png" alt="high"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-organising-nginx-configuration">Organising Nginx configuration</a></td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-format-prettify-and-indent-your-nginx-code">Format, prettify and indent your Nginx code</a></td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-http2">Use HTTP/2</a><br>HTTP/2 will make our applications faster, simpler, and more robust.</td>
<td align="left">Performance</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-maintaining-ssl-sessions">Maintaining SSL sessions</a></td>
<td align="left">Performance</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-exact-names-in-server-name-directive-where-possible">Use exact names in server_name directive where possible</a></td>
<td align="left">Performance</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-avoid-checks-server_name-with-if-directive">Avoid checks server_name with if directive</a></td>
<td align="left">Performance</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-disable-unnecessary-modules">Disable unnecessary modules</a><br>Limits vulnerabilities, improve performance and memory efficiency.</td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-hide-nginx-version-number">Hide Nginx version number</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-hide-nginx-server-signature">Hide Nginx server signature</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-hide-upstream-proxy-headers">Hide upstream proxy headers</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-only-the-latest-supported-openssl-version">Use only the latest supported OpenSSL version</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-deny-the-use-of-browser-features-feature-policy">Deny the use of browser features (Feature-Policy)</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-control-buffer-overflow-attacks">Control Buffer Overflow attacks</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-mitigating-slow-http-dos-attack-closing-slow-connections">Mitigating Slow HTTP DoS attack (Closing Slow Connections)</a></td>
<td align="left">Hardening</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-enable-dns-caa-policy">Enable DNS CAA Policy</a></td>
<td align="left">Others</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/medium.png" alt="medium"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-separate-listen-directives-for-80-and-443">Separate listen directives for 80 and 443</a></td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-only-one-ssl-config-for-specific-listen-directive">Use only one SSL config for specific listen directive</a></td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-geomap-modules-instead-allowdeny">Use geo/map modules instead allow/deny</a></td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-drop-the-same-root-inside-location-block">Drop the same root inside location block</a></td>
<td align="left">Base Rules</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-adjust-worker-processes">Adjust worker processes</a></td>
<td align="left">Performance</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-make-an-exact-location-match-to-speed-up-the-selection-process">Make an exact location match to speed up the selection process</a></td>
<td align="left">Performance</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-use-limit_conn-to-improve-limiting-the-download-speed">Use limit_conn to improve limiting the download speed</a></td>
<td align="left">Performance</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-tweak-passive-health-checks">Tweak passive health checks</a></td>
<td align="left">Load Balancing</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-dont-disable-backends-by-comments-use-down-parameter">Don't disable backends by comments, use down parameter</a></td>
<td align="left">Load Balancing</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
<tr>
<td align="left"><a href="#beginner-define-security-policies-with-securitytxt">Define security policies with security.txt</a></td>
<td align="left">Others</td>
<td align="center"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/low.png" alt="low"></a></td>
</tr>
</tbody>
</table>
<h1 id="books">Books</h1>
<blockquote>
<p>These books are probably pay or free. They can be official and unofficial.</p>
</blockquote>
<h4 id="nginx-essentials"><a href="https://www.amazon.com/Nginx-Essentials-Valery-Kholodkov/dp/1785289535">Nginx Essentials</a></h4>
<p>Authors: <strong>Valery Kholodkov</strong></p>
<p><em>Excel in Nginx quickly by learning to use its most essential features in real-life applications.</em></p>
<ul>
<li><em>Learn how to set up, configure, and operate an Nginx installation for day-to-day use</em></li>
<li><em>Explore the vast features of Nginx to manage it like a pro, and use them successfully to run your website</em></li>
<li><em>Example-based guide to get the best out of Nginx to reduce resource usage footprint</em></li>
</ul>
<p><i>This short review comes from this book or the store.</i></p>
<h4 id="nginx-cookbook"><a href="https://www.oreilly.com/library/view/nginx-cookbook/9781492049098/">Nginx Cookbook</a></h4>
<p>Authors: <strong>Derek DeJonghe</strong></p>
<p><em>You’ll find recipes for:</em></p>
<ul>
<li><em>Traffic management and A/B testing</em></li>
<li><em>Managing programmability and automation with dynamic templating and the NGINX Plus API</em></li>
<li><em>Securing access through encrypted traffic, secure links, HTTP authentication subrequests, and more</em></li>
<li><em>Deploying NGINX to AWS, Azure, and Google cloud-computing services</em></li>
<li><em>Using Docker to deploy containers and microservices</em></li>
<li><em>Debugging and troubleshooting, performance tuning, and practical ops tips</em></li>
</ul>
<p><i>This short review comes from this book or the store.</i></p>
<h4 id="nginx-http-server"><a href="https://www.amazon.com/Nginx-HTTP-Server-Harness-infrastructure/dp/178862355X">Nginx HTTP Server</a></h4>
<p>Authors: <strong>Martin Fjordvald</strong>, <strong>Clement Nedelcu</strong></p>
<p><em>Harness the power of Nginx to make the most of your infrastructure and serve pages faster than ever.</em></p>
<ul>
<li><em>Discover possible interactions between Nginx and Apache to get the best of both worlds</em></li>
<li><em>Learn to exploit the features offered by Nginx for your web applications</em></li>
<li><em>Get your hands on the most updated version of Nginx (1.13.2) to support all your web administration requirements</em></li>
</ul>
<p><i>This short review comes from this book or the store.</i></p>
<h4 id="nginx-high-performance"><a href="https://www.amazon.com/Nginx-High-Performance-Rahul-Sharma/dp/1785281836">Nginx High Performance</a></h4>
<p>Authors: <strong>Rahul Sharma</strong></p>
<p><em>Optimize NGINX for high-performance, scalable web applications.</em></p>
<ul>
<li><em>Configure Nginx for best performance, with configuration examples and explanations</em></li>
<li><em>Step–by-step tutorials for performance testing using open source software</em></li>
<li><em>Tune the TCP stack to make the most of the available infrastructure</em></li>
</ul>
<p><i>This short review comes from this book or the store.</i></p>
<h4 id="mastering-nginx"><a href="https://www.amazon.com/Mastering-Nginx-Dimitri-Aivaliotis/dp/1849517444">Mastering Nginx</a></h4>
<p>Authors: <strong>Dimitri Aivaliotis</strong></p>
<p><em>Written for experienced systems administrators and engineers, this book teaches you from scratch how to configure Nginx for any situation. Step-by-step instructions and real-world code snippets clarify even the most complex areas.</em></p>
<p><i>This short review comes from this book or the store.</i></p>
<h4 id="modsecurity-30-and-nginx-quick-start-guide"><a href="https://www.nginx.com/resources/library/modsecurity-3-nginx-quick-start-guide/">ModSecurity 3.0 and NGINX: Quick Start Guide</a></h4>
<p>Authors: <strong>Faisal Memon</strong>, <strong>Owen Garrett</strong>, <strong>Michael Pleshakov</strong></p>
<p><em>Learn in this ebook how to get started with ModSecurity, the world’s most widely deployed web application firewall (WAF), now available for NGINX and NGINX Plus.</em></p>
<p><i>This short review comes from this book or the store.</i></p>
<h4 id="cisco-ace-to-nginx-migration-guide"><a href="https://www.nginx.com/resources/library/cisco-ace-nginx-migration-guide/">Cisco ACE to NGINX: Migration Guide</a></h4>
<p>Authors: <strong>Faisal Memon</strong></p>
<p><em>This ebook provides step-by-step instructions on replacing Cisco ACE with NGINX and off-the-shelf servers. NGINX helps you cut costs and modernize.</em></p>
<p><em>In this ebook you will learn:</em></p>
<ul>
<li><em>How to migrate Cisco ACE configuration to NGINX, with detailed examples</em></li>
<li><em>Why you should go with a software load balancer, and not hardware</em></li>
</ul>
<p><i>This short review comes from this book or the store.</i></p>
<h1 id="external-resources">External Resources</h1>
<h5 id="nginx-official">Nginx official</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://www.nginx.com/"><b>Nginx Project</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://nginx.org/en/docs/"><b>Nginx Documentation</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.nginx.com/resources/wiki/"><b>Nginx Wiki</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://docs.nginx.com/nginx/admin-guide/"><b>Nginx Admin's Guide</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/"><b>Nginx Pitfalls and Common Mistakes</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://forum.nginx.org/"><b>Nginx Forum</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://mailman.nginx.org/mailman/listinfo/nginx"><b>Nginx Mailing List</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/nginx/nginx"><b>Nginx Read-only Mirror</b></a><br> </p>
<h5 id="based-on-the-nginx">Based on the Nginx</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://openresty.org/"><b>OpenResty</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://tengine.taobao.org/"><b>The Tengine Web Server</b></a><br> </p>
<h5 id="comparison-reviews">Comparison reviews</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://www.hostingadvice.com/how-to/nginx-vs-apache/"><b>NGINX vs. Apache (Pro/Con Review, Uses, &amp; Hosting for Each)</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/jiangwenyuan/nuster/wiki/Web-cache-server-performance-benchmark:-nuster-vs-nginx-vs-varnish-vs-squid"><b>Web cache server performance benchmark: nuster vs nginx vs varnish vs squid</b></a><br> </p>
<h5 id="cheatsheets--references">Cheatsheets &amp; References</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://gist.github.com/carlessanagustin/9509d0d31414804da03b"><b>Nginx Cheatsheet</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="http://www.scalescale.com/tips/nginx/"><b>Nginx Tutorials, Linux Sysadmin Configuration &amp; Optimizing Tips and Tricks</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/h5bp/server-configs-nginx"><b>Nginx boilerplate configs</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/nginx-boilerplate/nginx-boilerplate"><b>Awesome Nginx configuration template</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/SimulatedGREG/nginx-cheatsheet"><b>Nginx Quick Reference</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/fcambus/nginx-resources"><b>A collection of resources covering Nginx and more</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/lebinh/nginx-conf"><b>A collection of useful Nginx configuration snippets</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://openresty.org/download/agentzh-nginx-tutorials-en.html"><b>agentzh's Nginx Tutorials</b></a><br> </p>
<h5 id="performance--hardening">Performance &amp; Hardening</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/denji/nginx-tuning"><b>Nginx Tuning For Best Performance by Denji</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://istlsfastyet.com/"><b>TLS has exactly one performance problem: it is not used widely enough</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.ssllabs.com/projects/best-practices/"><b>SSL/TLS Deployment Best Practices</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.ssllabs.com/projects/rating-guide/index.html"><b>SSL Server Rating Guide</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.upguard.com/blog/how-to-build-a-tough-nginx-server-in-15-steps"><b>How to Build a Tough NGINX Server in 15 Steps</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html"><b>Top 25 Nginx Web Server Best Security Practices</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://calomel.org/nginx.html"><b>Nginx Secure Web Server</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://cipherli.st/"><b>Strong ciphers for Apache, Nginx, Lighttpd and more</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html"><b>Strong SSL Security on Nginx</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://enable-cors.org/index.html"><b>Enable cross-origin resource sharing (CORS)</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/nbs-system/naxsi"><b>NAXSI - WAF for Nginx</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://geekflare.com/install-modsecurity-on-nginx/"><b>ModSecurity for Nginx</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.owasp.org/index.php/Transport_Layer_Protection_Cheat_Sheet"><b>Transport Layer Protection Cheat Sheet</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://wiki.mozilla.org/Security/Server_Side_TLS"><b>Security/Server Side TLS</b></a><br> </p>
<h5 id="playgrounds">Playgrounds</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/sportebois/nginx-rate-limit-sandbox"><b>NGINX Rate Limit, Burst and nodelay sandbox</b></a><br> </p>
<h5 id="config-generators">Config generators</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://nginxconfig.io/"><b>Nginx config generator on steroids</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/"><b>Mozilla SSL Configuration Generator</b></a><br> </p>
<h5 id="static-analyzers">Static analyzers</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/yandex/gixy"><b>gixy</b></a> - is a tool to analyze Nginx configuration to prevent security misconfiguration and automate flaw detection.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/1connect/nginx-config-formatter"><b>nginx-config-formatter</b></a> - Nginx config file formatter/beautifier written in Python.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/vasilevich/nginxbeautifier"><b>nginxbeautifier</b></a> - format and beautify nginx config files.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/lovette/nginx-tools/tree/master/nginx-minify-conf"><b>nginx-minify-conf</b></a> - creates a minified version of a nginx configuration.<br> </p>
<h5 id="log-analyzers">Log analyzers</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://goaccess.io/"><b>GoAccess</b></a> - is a fast, terminal-based log analyzer (quickly analyze and view web server statistics in real time).<br> &nbsp;&nbsp;:black_small_square: <a href="https://www.graylog.org/"><b>Graylog</b></a> - is a leading centralized log management for capturing, storing, and enabling real-time analysis.<br> &nbsp;&nbsp;:black_small_square: <a href="https://www.elastic.co/products/logstash"><b>Logstash</b></a> - is an open source, server-side data processing pipeline.<br> </p>
<h5 id="performance-analyzers">Performance analyzers</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/lebinh/ngxtop"><b>ngxtop</b></a> - parses your nginx access log and outputs useful, top-like, metrics of your nginx server.<br> </p>
<h5 id="benchmarking-tools">Benchmarking tools</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://httpd.apache.org/docs/2.4/programs/ab.html"><b>ab</b></a> - is a single-threaded command line tool for measuring the performance of HTTP web servers.<br> &nbsp;&nbsp;:black_small_square: <a href="https://www.joedog.org/siege-home/"><b>siege</b></a> - is an http load testing and benchmarking utility.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/wg/wrk"><b>wrk</b></a> - is a modern HTTP benchmarking tool capable of generating significant load.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/codesenberg/bombardier"><b>bombardier</b></a> - is a HTTP(S) benchmarking tool.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/cmpxchg16/gobench"><b>gobench</b></a> - is a HTTP/HTTPS load testing and benchmarking tool.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/rakyll/hey"><b>hey</b></a> - is a HTTP load generator, ApacheBench (ab) replacement, formerly known as rakyll/boom.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/tarekziade/boom"><b>boom</b></a> - is a script you can use to quickly smoke-test your web app deployment.<br> &nbsp;&nbsp;:black_small_square: <a href="https://jmeter.apache.org/"><b>JMeter™</b></a> - is designed to load test functional behavior and measure performance.<br> &nbsp;&nbsp;:black_small_square: <a href="https://gatling.io/"><b>Gatling</b></a> - is a powerful open-source load and performance testing tool for web applications.<br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/locustio/locust"><b>locust</b></a> - is an easy-to-use, distributed, user load testing tool.<br> </p>
<h5 id="debugging-tools">Debugging tools</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/trimstray/htrace.sh"><b>htrace.sh</b></a> - is a simple Swiss Army knife for http/https troubleshooting and profiling.<br> </p>
<h5 id="development">Development</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://www.evanmiller.org/nginx-modules-guide.html"><b>Emiller’s Guide To Nginx Module Development</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.openmymind.net/An-Introduction-To-OpenResty-Nginx-Lua/"><b>An Introduction To OpenResty (nginx + lua) - Part 1</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.openmymind.net/An-Introduction-To-OpenResty-Part-2/"><b>An Introduction To OpenResty - Part 2 - Concepts</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.openmymind.net/An-Introduction-To-OpenResty-Part-3/"><b>An Introduction To OpenResty - Part 3 </b></a><br> </p>
<h5 id="online-tools">Online tools</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://www.ssllabs.com/ssltest/"><b>SSL Server Test by SSL Labs</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.ssllabs.com/ssltest/viewMyClient.html"><b>SSL/TLS Capabilities of Your Browser</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.htbridge.com/ssl/"><b>Test SSL/TLS (PCI DSS, HIPAA and NIST)</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://sslanalyzer.comodoca.com/"><b>SSL analyzer and certificate checker</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://cryptcheck.fr/"><b>Test your TLS server configuration (e.g. ciphers)</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.jitbit.com/sslcheck/"><b>Scan your website for non-secure content</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://2ton.com.au/dhtool/"><b>Public Diffie-Hellman Parameter Service/Tool</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://securityheaders.com/"><b>Analyse the HTTP response headers by Security Headers</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://observatory.mozilla.org/"><b>Analyze your website by Mozilla Observatory</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://sslmate.com/caa/"><b>CAA Record Helper</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://webhint.io/"><b>Linting tool that will help you with your site's accessibility, speed, security and more</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://urlscan.io/"><b>Service to scan and analyse websites</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.url-encode-decode.com/"><b>Tool from above to either encode or decode a string of text</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://uncoder.io/"><b>Online translator for search queries on log data</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://regex101.com/"><b>Online regex tester and debugger: PHP, PCRE, Python, Golang and JavaScript</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://regexr.com/"><b>Online tool to learn, build, &amp; test Regular Expressions</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.regextester.com/"><b>Online Regex Tester &amp; Debugger</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://gchq.github.io/CyberChef/"><b>A web app for encryption, encoding, compression and data analysis</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://nginx.viraptor.info/"><b>Nginx location match tester</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://detailyang.github.io/nginx-location-match-visible/"><b>Nginx location match visible</b></a><br> </p>
<h5 id="other-stuff">Other stuff</h5>
<p> &nbsp;&nbsp;:black_small_square: <a href="https://www.iana.org/assignments/tls-parameters/tls-parameters.xhtml"><b>Transport Layer Security (TLS) Parameters</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://wiki.mozilla.org/Security/Server_Side_TLS"><b>Security/Server Side TLS by Mozilla</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/"><b>TLS Security 6: Examples of TLS Vulnerabilities and Attacks</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.veracode.com/blog/2014/03/guidelines-for-setting-security-headers"><b>Guidelines for Setting Security Headers</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://medium.freecodecamp.org/secure-your-web-application-with-these-http-headers-fd66e0367628"><b>Secure your web application with these HTTP headers</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://zinoui.com/blog/security-http-headers"><b>Security HTTP Headers</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/GrrrDog/weird_proxies/wiki"><b>Analysis of various reverse proxies, cache proxies, load balancers, etc.</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://github.com/GrrrDog/TLS-Redirection#technical-details"><b>TLS Redirection (and Virtual Host Confusion)</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://nickcraver.com/blog/2017/05/22/https-on-stack-overflow/#the-beginning"><b>HTTPS on Stack Overflow: The End of a Long Road</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://www.aosabook.org/en/nginx.html"><b>The Architecture of Open Source Applications - Nginx</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="http://www.bbc.co.uk/blogs/internet/entries/17d22fb8-cea2-49d5-be14-86e7a1dcde04"><b>BBC Digital Media Distribution: How we improved throughput by 4x</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="http://www.kegel.com/c10k.html"><b>The C10K problem by Dan Kegel</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://hpbn.co/"><b>High Performance Browser Networking</b></a><br> &nbsp;&nbsp;:black_small_square: <a href="https://suniphrase.wordpress.com/2015/10/27/jemalloc-vs-tcmalloc-vs-dlmalloc/"><b>jemalloc vs tcmalloc vs dlmalloc</b></a><br> </p>
<h1 id="helpers">Helpers</h1>
<h4 id="nginx-directories-and-files">Nginx directories and files</h4>
<blockquote>
<p>If you compile NGINX server by default all files and directories are available from <code>/usr/local/nginx</code> location.</p>
</blockquote>
<p>For prebuilt NGINX package paths can be as follows:</p>
<ul>
<li><code>/etc/nginx</code> - is the default configuration root for the NGINX service<br>
<ul>
<li>other locations: <code>/usr/local/etc/nginx</code>, <code>/usr/local/nginx/conf</code></li>
</ul> </li>
<li><code>/etc/nginx/nginx.conf</code> - is the default configuration entry point used by the NGINX services, includes the top-level http block and all other configuration contexts and files<br>
<ul>
<li>other locations: <code>/usr/local/etc/nginx/nginx.conf</code>, <code>/usr/local/nginx/conf/nginx.conf</code></li>
</ul> </li>
<li><code>/usr/share/nginx</code> - is the default root directory for requests, contains <code>html</code> directory and basic static files</li>
<li><code>/var/log/nginx</code> - is the default log (access and error log) location for NGINX</li>
<li><code>/var/cache/nginx</code> - is the default temporary files location for NGINX<br>
<ul>
<li>other locations: <code>/var/lib/nginx</code></li>
</ul> </li>
<li><code>/etc/nginx/conf</code> - contains custom/vhosts configuration files<br>
<ul>
<li>other locations: <code>/etc/nginx/conf.d</code>, <code>/etc/nginx/sites-enabled</code></li>
</ul> </li>
<li><code>/var/run/nginx</code> - contains information about NGINX process(es)<br>
<ul>
<li>other locations: <code>/usr/local/nginx/logs</code></li>
</ul> </li>
</ul>
<h4 id="nginx-commands">Nginx commands</h4>
<ul>
<li><code>nginx -h</code> - shows the help</li>
<li><code>nginx -v</code> - shows the NGINX version</li>
<li><code>nginx -V</code> - shows the extended information about NGINX: version, build parameters and configuration arguments</li>
<li><code>nginx -t</code> - tests the NGINX configuration</li>
<li><code>nginx -c</code> - sets configuration file (default: <code>/etc/nginx/nginx.conf</code>)</li>
<li><code>nginx -p</code> - sets prefix path (default: <code>/etc/nginx/</code>)</li>
<li><code>nginx -T</code> - tests the NGINX configuration and prints the validated configuration on the screen</li>
<li><code>nginx -s</code> - sends a signal to the NGINX master process:
<ul>
<li><code>stop</code> - discontinues the NGINX process immediately</li>
<li><code>quit</code> - stops the NGINX process after it finishes processing inflight requests</li>
<li><code>reload</code> - reloads the configuration without stopping NGINX processes</li>
<li><code>reopen</code> - instructs NGINX to reopen log files</li>
</ul> </li>
<li><code>nginx -g</code> - sets <a href="https://nginx.org/en/docs/ngx_core_module.html">global directives</a> out of configuration file</li>
</ul>
<h4 id="configuration-syntax">Configuration syntax</h4>
<h5 id="comments">Comments</h5>
<p>NGINX configuration files don't support comment blocks; they only accept <code>#</code> at the beginning of a line for a comment.</p>
<h5 id="end-of-lines">End of lines</h5>
<p>Lines containing directives must end with a <code>;</code> or NGINX will fail to load the configuration and report an error.</p>
<h5 id="variables--strings">Variables &amp; Strings</h5>
<p>Variables in NGINX start with <code>$</code>. Some modules introduce variables can be used when setting directives.</p>
<blockquote>
<p>There are some directives that do not support variables, e.g. <code>access_log</code> or <code>error_log</code>.</p>
</blockquote>
<p>Strings may be inputted without quotes unless they include blank spaces, semicolons or curly braces, then they need to be escaped with backslashes or enclosed in single/double quotes.</p>
<p>Variables in quoted strings are expanded normally unless the <code>$</code> is escaped.</p>
<h5 id="directives-blocks-and-contexts">Directives, Blocks, and Contexts</h5>
<blockquote>
<p>Read this great article about <a href="https://blog.martinfjordvald.com/2012/08/understanding-the-nginx-configuration-inheritance-model/">the NGINX configuration inheritance model</a> by <a href="https://blog.martinfjordvald.com/about/">Martin Fjordvald</a>.</p>
</blockquote>
<p>Configuration options are called directives. We have four types of directives in NGINX:</p>
<ul>
<li>standard directive - one value per context: <pre><code class="language-bash">worker_connections 512;
</code></pre> </li>
<li>array directive - multiple values per context: <pre><code class="language-bash">error_log /var/log/nginx/localhost/localhost-error.log warn;
</code></pre> </li>
<li>action directive - something which does not just configure: <pre><code class="language-bash">rewrite ^(.*)$ /msie/$1 break;
</code></pre> </li>
<li><code>try_files</code> directive:</li>
</ul>
<pre><code class="language-bash">try_files $uri $uri/ /test/index.html;
</code></pre>
<p>Directives are organized into groups known as blocks or contexts. Generally context is a block directive can have other directives inside braces. It appears to be organized in a tree-like structure, defined by sets of brackets - <code>{</code> and <code>}</code>. It's a simple structure and very transparent.</p>
<p>As a general rule, if a directive is valid in multiple nested scopes, a declaration in a broader context will be passed on to any child contexts as default values.</p>
<blockquote>
<p>Directives placed in the configuration file outside of any contexts are considered to be in the global/main context.</p>
</blockquote>
<p>Contexts can be layered within one another so NGINX provides a level of inheritance. Their structure looks like this:</p>
<pre><code>Global/Main Context
        |
        |
        +-----» Events Context
        |
        |
        +-----» HTTP Context
        |          |
        |          |
        |          +-----» Server Context
        |          |          |
        |          |          |
        |          |          +-----» Location Context
        |          |
        |          |
        |          +-----» Upstream Context
        |
        |
        +-----» Mail Context
</code></pre>
<h5 id="measurement-units">Measurement units</h5>
<p>Sizes can be specified in:</p>
<ul>
<li><code>k</code> or <code>K</code>: Kilobytes</li>
<li><code>m</code> or <code>M</code>: Megabytes</li>
<li><code>g</code> or <code>G</code>: Gigabytes</li>
</ul>
<pre><code class="language-bash">client_max_body_size 2M;
</code></pre>
<p>Time intervals can be specified in:</p>
<ul>
<li><code>ms</code>: Milliseconds</li>
<li><code>s</code>: Seconds (default, without a suffix)</li>
<li><code>m</code>: Minutes</li>
<li><code>h</code>: Hours</li>
<li><code>d</code>: Days</li>
<li><code>w</code>: Weeks</li>
<li><code>M</code>: Months (30 days)</li>
<li><code>y</code>: Years (365 days)</li>
</ul>
<pre><code class="language-bash">proxy_read_timeout 20s;
</code></pre>
<h5 id="enable-syntax-highlight-for-nginx-configuration-file">Enable syntax highlight for Nginx configuration file</h5>
<h6 id="vivim">vi/vim</h6>
<pre><code class="language-bash"># 1) Download vim plugin for NGINX:

# Official NGINX vim plugin:
mkdir -p ~/.vim/syntax/

wget "http://www.vim.org/scripts/download_script.php?src_id=19394" -O ~/.vim/syntax/nginx.vim

# Improved NGINX vim plugin (incl. syntax highlighting) with Pathogen:
mkdir -p ~/.vim/{autoload,bundle}/

curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim
echo -en "\nexecute pathogen#infect()\n" &gt;&gt; ~/.vimrc

git clone https://github.com/chr4/nginx.vim ~/.vim/bundle/nginx.vim

# 2) Set location of NGINX config files:
cat &gt; ~/.vim/filetype.vim &lt;&lt; __EOF__
au BufRead,BufNewFile /etc/nginx/*,/etc/nginx/conf.d/*,/usr/local/nginx/conf/*,*/conf/nginx.conf if &amp;ft == '' | setfiletype nginx | endif
__EOF__
</code></pre>
<h6 id="sublime-text">Sublime Text</h6>
<p>Install <code>cabal</code> - system for building and packaging Haskell libraries and programs (on Ubuntu):</p>
<pre><code class="language-bash">add-apt-repository -y ppa:hvr/ghc
apt-get update

apt-get install -y cabal-install-1.22 ghc-7.10.2

# Add this to your shell main configuration file:
export PATH=$HOME/.cabal/bin:/opt/cabal/1.22/bin:/opt/ghc/7.10.2/bin:$PATH
source $HOME/.&lt;shellrc&gt;

cabal update
</code></pre>
<ul>
<li> <p><code>nginx-lint</code>:</p> <pre><code class="language-bash">git clone https://github.com/temoto/nginx-lint

cd nginx-lint &amp;&amp; cabal install --global
</code></pre> </li>
<li> <p><code>sublime-nginx</code> + <code>SublimeLinter-contrib-nginx-lint</code>:</p> <p>Bring up the <em>Command Palette</em> and type <code>install</code>. Among the commands you should see <em>Package Control: Install Package</em>. Type <code>nginx</code> to install <a href="https://github.com/brandonwamboldt/sublime-nginx">sublime-nginx</a> and after that do the above again for install <a href="https://github.com/irvinlim/SublimeLinter-contrib-nginx-lint">SublimeLinter-contrib-nginx-lint</a>: type <code>SublimeLinter-contrib-nginx-lint</code>.</p> </li>
</ul>
<h4 id="nginx-processes">Nginx processes</h4>
<p>NGINX has <strong>one master process</strong> and <strong>one or more worker processes</strong>.</p>
<p>The main purposes of the master process is to read and evaluate configuration files, as well as maintain the worker processes (respawn when a worker dies), handle signals, notify workers, opens log files, and, of course binding to ports.</p>
<p>Master process should be started as root user, because this will allow NGINX to open sockets below 1024 (it needs to be able to listen on port 80 for HTTP and 443 for HTTPS).</p>
<p>The worker processes do the actual processing of requests and get commands from master process. They runs in an event loop, handle network connections, read and write content to disk, and communicate with upstream servers. These are spawned by the master process, and the user and group will as specified (unprivileged).</p>
<blockquote>
<p>NGINX has also cache loader and cache manager processes but only if you enable caching.</p>
</blockquote>
<p>The following signals can be sent to the NGINX master process:</p>
<table>
<thead>
<tr>
<th align="left"><b>SIGNAL</b></th>
<th align="left"><b>DESCRIPTION</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>TERM</code>, <code>INT</code></td>
<td align="left">quick shutdown</td>
</tr>
<tr>
<td align="left"><code>QUIT</code></td>
<td align="left">graceful shutdown</td>
</tr>
<tr>
<td align="left"><code>KILL</code></td>
<td align="left">halts a stubborn process</td>
</tr>
<tr>
<td align="left"><code>HUP</code></td>
<td align="left">configuration reload, start new workers, gracefully shutdown the old worker processes</td>
</tr>
<tr>
<td align="left"><code>USR1</code></td>
<td align="left">reopen the log files</td>
</tr>
<tr>
<td align="left"><code>USR2</code></td>
<td align="left">upgrade executable on the fly</td>
</tr>
<tr>
<td align="left"><code>WINCH</code></td>
<td align="left">gracefully shutdown the worker processes</td>
</tr>
</tbody>
</table>
<p>There’s no need to control the worker processes yourself. However, they support some signals too:</p>
<table>
<thead>
<tr>
<th align="left"><b>SIGNAL</b></th>
<th align="left"><b>DESCRIPTION</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>TERM</code>, <code>INT</code></td>
<td align="left">quick shutdown</td>
</tr>
<tr>
<td align="left"><code>QUIT</code></td>
<td align="left">graceful shutdown</td>
</tr>
<tr>
<td align="left"><code>USR1</code></td>
<td align="left">reopen the log files</td>
</tr>
</tbody>
</table>
<h4 id="connection-processing">Connection processing</h4>
<p>NGINX supports a variety of connection processing methods which depends on the platform used. For more information please see <a href="https://nginx.org/en/docs/events.html">connection processing methods</a> explanation.</p>
<p>In general there are four types of event multiplexing:</p>
<ul>
<li><code>select</code> - is anachronism and not recommended but installed on all platforms as a fallback</li>
<li><code>poll</code> - is anachronism and not recommended</li>
<li><code>epoll</code> - recommend if you're using GNU/Linux</li>
<li><code>kqueue</code> - recommend if you're using BSD (is technically superior to <code>epoll</code>)</li>
</ul>
<p>There are also great resources (and comparisons) about them:</p>
<ul>
<li><a href="https://daniel.haxx.se/docs/poll-vs-select.html">poll vs select vs event-based</a></li>
<li><a href="http://www.ulduzsoft.com/2014/01/select-poll-epoll-practical-difference-for-system-architects/">select/poll/epoll: practical difference for system architects</a></li>
<li><a href="https://people.eecs.berkeley.edu/~sangjin/2012/12/21/epoll-vs-kqueue.html">Scalable Event Multiplexing: epoll vs. kqueue</a></li>
<li><a href="https://jvns.ca/blog/2017/06/03/async-io-on-linux--select--poll--and-epoll/">Async IO on Linux: select, poll, and epoll</a></li>
<li><a href="https://idea.popcount.org/2016-11-01-a-brief-history-of-select2/">A brief history of select(2)</a></li>
<li><a href="https://idea.popcount.org/2017-01-06-select-is-fundamentally-broken/">Select is fundamentally broken</a></li>
<li><a href="https://idea.popcount.org/2017-02-20-epoll-is-fundamentally-broken-12/">Epoll is fundamentally broken</a></li>
<li><a href="https://austingwalters.com/io-multiplexing/">I/O Multiplexing using epoll and kqueue System Calls</a></li>
<li><a href="http://bulk.fefe.de/scalability/">Benchmarking BSD and Linux</a></li>
</ul>
<p>Look also at this libevent benchmark:</p>
<p align="center"> <a href="https://www.nginx.com/resources/library/infographic-inside-nginx/"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/libevent-benchmark.jpg" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/libevent-benchmark.jpg" alt="libevent-benchmark"></a> </a> </p>
<p><i>This infographic comes from <a href="http://daemonforums.org/showthread.php?t=2124">daemonforums - An interesting benchmark (kqueue vs. epoll)</a>.</i></p>
<p>You may also view why big players use NGINX on FreeBSD instead of on GNU/Linux:</p>
<ul>
<li><a href="https://devinteske.com/wp/freebsd-nginx-performance/">FreeBSD NGINX Performance</a></li>
<li><a href="https://www.youtube.com/watch?v=KP_bKvXkoC4">Why did Netflix use NGINX and FreeBSD to build their own CDN?</a></li>
</ul>
<p>Okay, so how many simultaneous connections can be processed by NGINX?</p>
<pre><code class="language-bash">worker_processes * worker_connections = max clients (in theory)
</code></pre>
<p>According to this: if you are only running <strong>2</strong> worker processes with <strong>512</strong> worker connections, you will be able to serve <strong>1024</strong> clients.</p>
<blockquote>
<p>It is a bit confusing because the sum of <code>worker_processes</code> and <code>worker_connections</code> does not directly translate into the number of clients that can be served simultaneously. Each clients (e.g. browsers) opens a number of parallel connections to download various components that compose a web page, for example, images, scripts, and so on.</p>
</blockquote>
<h4 id="request-processing-stages">Request processing stages</h4>
<ul>
<li><code>NGX_HTTP_POST_READ_PHASE</code> - first phase, read the request header
<ul>
<li>example modules: <a href="https://nginx.org/en/docs/http/ngx_http_realip_module.html">ngx_http_realip_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_SERVER_REWRITE_PHASE</code> - implementation of rewrite directives defined in a server block
<ul>
<li>example modules: <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">ngx_http_rewrite_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_FIND_CONFIG_PHASE</code> - replace the location according to URI (location lookup)</li>
<li><code>NGX_HTTP_REWRITE_PHASE</code> - URI transformation on location level
<ul>
<li>example modules: <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">ngx_http_rewrite_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_POST_REWRITE_PHASE</code> - URI transformation post-processing (the request is redirected to a new location)
<ul>
<li>example modules: <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">ngx_http_rewrite_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_PREACCESS_PHASE</code> - authentication preprocessing request limit, connection limit (access restriction)
<ul>
<li>example modules: <a href="http://nginx.org/en/docs/http/ngx_http_limit_req_module.html">ngx_http_limit_req_module</a>, <a href="http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html">ngx_http_limit_conn_module</a>, <a href="https://nginx.org/en/docs/http/ngx_http_realip_module.html">ngx_http_realip_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_ACCESS_PHASE</code> - verification of the client (the authentication process, limiting access)
<ul>
<li>example modules: <a href="https://nginx.org/en/docs/http/ngx_http_access_module.html">ngx_http_access_module</a>, <a href="https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_POST_ACCESS_PHASE</code> - access restrictions check post-processing phase, the certification process, processing <code>satisfy any</code> directive
<ul>
<li>example modules: <a href="https://nginx.org/en/docs/http/ngx_http_access_module.html">ngx_http_access_module</a>, <a href="https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html">ngx_http_auth_basic_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_PRECONTENT_PHASE</code> - generating content
<ul>
<li>example modules: <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#try_files">ngx_http_try_files_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_CONTENT_PHASE</code> - content processing
<ul>
<li>example modules: <a href="https://nginx.org/en/docs/http/ngx_http_index_module.html">ngx_http_index_module</a>, <a href="https://nginx.org/en/docs/http/ngx_http_autoindex_module.html">ngx_http_autoindex_module</a>, <a href="https://nginx.org/en/docs/http/ngx_http_gzip_module.html">ngx_http_gzip_module</a></li>
</ul> </li>
<li><code>NGX_HTTP_LOG_PHASE</code> - log processing
<ul>
<li>example modules: <a href="https://nginx.org/en/docs/http/ngx_http_log_module.html">ngx_http_log_module</a></li>
</ul> </li>
</ul>
<p>You may feel lost now (me too...) so I let myself put this great preview:</p>
<p align="center"> <a href="https://www.nginx.com/resources/library/infographic-inside-nginx/"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/request-flow.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/request-flow.png" alt="request-flow"></a> </a> </p>
<p><i>This infographic comes from <a href="https://www.nginx.com/resources/library/infographic-inside-nginx/">Inside NGINX</a> official library.</i></p>
<h4 id="server-blocks-logic">Server blocks logic</h4>
<blockquote>
<p>NGINX does have <strong>server blocks</strong> (like a virtual hosts is an Apache) that use <code>listen</code> and <code>server_name</code> directives to bind to tcp sockets.</p>
</blockquote>
<p>Before start reading this chapter you should know what regular expressions are and how they works. I recommend two great and short write-ups about regular expressions created by <a href="https://medium.com/@jonny.fox">Jonny Fox</a>:</p>
<ul>
<li><a href="https://medium.com/factory-mind/regex-tutorial-a-simple-cheatsheet-by-examples-649dc1c3f285">Regex tutorial — A quick cheatsheet by examples</a></li>
<li><a href="https://medium.com/factory-mind/regex-cookbook-most-wanted-regex-aa721558c3c1">Regex cookbook — Top 10 Most wanted regex</a></li>
</ul>
<p>Why? Regular expressions can be used in both the <code>server_name</code> and <code>location</code> directives, and sometimes you must have a great skill of reading them. I think you should create the most readable regular expressions that do not become spaghetti code - impossible to debug and maintain.</p>
<p>It's short example of server block context (two server blocks):</p>
<pre><code class="language-bash">http {

  index index.html;
  root /var/www/example.com/default;

  server {

    listen 10.10.250.10:80;
    server_name www.example.com;

    access_log logs/example.access.log main;

    root /var/www/example.com/public;

    ...

  }

  server {

    listen 10.10.250.11:80;
    server_name "~^(api.)?example\.com api.de.example.com";

    access_log logs/example.access.log main;

    proxy_pass http://localhost:8080;

    ...

  }

}
</code></pre>
<h5 id="handle-incoming-connections">Handle incoming connections</h5>
<p>NGINX uses the following logic to determining which virtual server (server block) should be used:</p>
<ol>
<li> <p>Match the <code>address:port</code> pair to the <code>listen</code> directive - that can be multiple server blocks with <code>listen</code> directives of the same specificity that can handle the request</p>
<blockquote>
<p>NGINX use the <code>address:port</code> combination for handle incoming connections. This pair is assigned to the <code>listen</code> directive.</p>
</blockquote> <p>The <code>listen</code> directive can be set to:</p>
<ul>
<li>an IP address/port combination (<code>127.0.0.1:80;</code>)</li>
<li>a lone IP address, if only address is given, the port <code>80</code> is used (<code>127.0.0.1;</code>) - becomes <code>127.0.0.1:80;</code></li>
<li>a lone port which will listen to every interface on that port (<code>80;</code> or <code>*:80;</code>) - becomes <code>0.0.0.0:80;</code></li>
<li>the path to a UNIX-domain socket (<code>unix:/var/run/nginx.sock;</code>)</li>
</ul> <p>If the <code>listen</code> directive is not present then either <code>*:80</code> is used (runs with the superuser privileges), or <code>*:8000</code> otherwise.</p> <p>The next steps are as follows:</p>
<ul>
<li> <p>NGINX translates all incomplete <code>listen</code> directives by substituting missing values with their default values (see above)</p> </li>
<li> <p>NGINX attempts to collect a list of the server blocks that match the request most specifically based on the <code>address:port</code></p> </li>
<li> <p>If any block that is functionally using <code>0.0.0.0</code>, will not be selected if there are matching blocks that list a specific IP</p> </li>
<li> <p>If there is only one most specific match, that server block will be used to serve the request</p> </li>
<li> <p>If there are multiple server blocks with the same level of matching, NGINX then begins to evaluate the <code>server_name</code> directive of each server block</p> </li>
</ul> <p>Look at this short example:</p> <pre><code class="language-bash"># From client:
GET / HTTP/1.0
Host: api.random.com

server {

  # This block will be processed:
  listen 192.168.252.10;  # --&gt; 192.168.252.10:80

  ...

}

server {

  listen 80;  # --&gt; *:80 --&gt; 0.0.0.0:80
  server_name api.random.com;

  ...

}
</code></pre> </li>
<li> <p>Match the <code>Host</code> header field against the <code>server_name</code> directive as a string (the exact names hash table)</p> </li>
<li> <p>Match the <code>Host</code> header field against the <code>server_name</code> directive with a wildcard at the beginning of the string (the hash table with wildcard names starting with an asterisk)</p>
<blockquote>
<p>If one is found, that block will be used to serve the request. If multiple matches are found, the longest match will be used to serve the request.</p>
</blockquote> </li>
<li> <p>Match the <code>Host</code> header field against the <code>server_name</code> directive with a wildcard at the end of the string (the hash table with wildcard names ending with an asterisk)</p>
<blockquote>
<p>If one is found, that block is used to serve the request. If multiple matches are found, the longest match will be used to serve the request.</p>
</blockquote> </li>
<li> <p>Match the <code>Host</code> header field against the <code>server_name</code> directive as a regular expression</p>
<blockquote>
<p>The first <code>server_name</code> with a regular expression that matches the <code>Host</code> header will be used to serve the request.</p>
</blockquote> </li>
<li> <p>If all the <code>Host</code> headers doesn't match, then direct to the <code>listen</code> directive marked as <code>default_server</code></p> </li>
<li> <p>If all the <code>Host</code> headers doesn't match and there is no <code>default_server</code>, direct to the first server with a <code>listen</code> directive that satisfies first step</p> </li>
<li> <p>Finally, NGINX goes to the <code>location</code> context</p> </li>
</ol>
<p><i>This short list is based on <a href="#mastering-nginx">Mastering Nginx - The virtual server section</a>.</i></p>
<h5 id="matching-location">Matching location</h5>
<blockquote>
<p>For each request, NGINX goes through a process to choose the best location block that will be used to serve that request.</p>
</blockquote>
<p>Let's short introduction something about this:</p>
<ul>
<li>the exact match is the best priority (processed first); ends search if match</li>
<li>the prefix match is the second priority; there are two types of prefixes: <code>^~</code> and <code>(none)</code>, if this match used the <code>^~</code> prefix, searching stops</li>
<li>the regular expression match has the lowest priority; there are two types of prefixes: <code>~</code> and <code>~*</code>; in the order they are defined in the configuration file</li>
<li>if regular expression searching yielded a match, that result is used, otherwise, the match from prefix searching is used</li>
</ul>
<p>Short example from the <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location">Nginx documentation</a>:</p>
<pre><code class="language-bash">location = / {
  # Matches the query / only.
  [ configuration A ]
}
location / {
  # Matches any query, since all queries begin with /, but regular
  # expressions and any longer conventional blocks will be
  # matched first.
  [ configuration B ]
}
location /documents/ {
  # Matches any query beginning with /documents/ and continues searching,
  # so regular expressions will be checked. This will be matched only if
  # regular expressions don't find a match.
  [ configuration C ]
}
location ^~ /images/ {
  # Matches any query beginning with /images/ and halts searching,
  # so regular expressions will not be checked.
  [ configuration D ]
}
location ~* \.(gif|jpg|jpeg)$ {
  # Matches any request ending in gif, jpg, or jpeg. However, all
  # requests to the /images/ directory will be handled by
  # Configuration D.
  [ configuration E ]
}
</code></pre>
<p>To help you understand how does location match works:</p>
<ul>
<li><a href="https://nginx.viraptor.info/">Nginx location match tester</a></li>
<li><a href="https://detailyang.github.io/nginx-location-match-visible/">Nginx location match visible</a></li>
</ul>
<p>The location syntax looks like:</p>
<pre><code class="language-bash">location optional_modifier location_match { ... }
</code></pre>
<p><code>location_match</code> in the above defines what NGINX should check the request URI against. The <code>optional_modifier</code> below will cause the associated location block to be interpreted as follows:</p>
<ul>
<li> <p><code>(none)</code>: if no modifiers are present, the location is interpreted as a prefix match. To determine a match, the location will now be matched against the beginning of the URI</p> </li>
<li> <p><code>=</code>: is an exact match, without any wildcards, prefix matching or regular expressions; forces a literal match between the request URI and the location parameter</p> </li>
<li> <p><code>~</code>: if a tilde modifier is present, this location must be used for case sensitive matching (RE match)</p> </li>
<li> <p><code>~*</code>: if a tilde and asterisk modifier is used, the location must be used for case insensitive matching (RE match)</p> </li>
<li> <p><code>^~</code>: assuming this block is the best non-RE match, a carat followed by a tilde modifier means that RE matching will not take place</p> </li>
</ul>
<p>The process of choosing NGINX location block is as follows:</p>
<ol>
<li> <p>Prefix-based NGINX location matches (no regular expression). Each location will be checked against the request URI</p> </li>
<li> <p>NGINX searches for an exact match. If a "=" modifier exactly matches the request URI, this specific location block is chosen right away</p> </li>
<li> <p>If no exact (meaning no "=" modifier) location block is found, NGINX will continue with non-exact prefixes. It starts with the longest matching prefix location for this URI, with the following approach:</p>
<ul>
<li> <p>In case the longest matching prefix location has the "^~" modifier, NGINX will stop its search right away and choose this location</p> </li>
<li> <p>Assuming the longest matching prefix location doesn’t use the "^~"modifier, the match is temporarily stored and the process continues</p> </li>
</ul> </li>
<li> <p>As soon as the longest matching prefix location is chosen and stored, NGINX continues to evaluate the case-sensitive and insensitive regular expression locations. The first regular expression location that fits the URI is selected right away to process the request</p> </li>
<li> <p>If no regular expression locations are found that match the request URI, the previously stored prefix location is selected to serve the request</p> </li>
</ol>
<p>In order to better understand how this process work please see this short cheatsheet that will allow you to design your location blocks in a predictable way:</p>
<p align="center"> <a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx_location_cheatsheet.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/nginx_location_cheatsheet.png" alt="nginx-location-cheatsheet"></a> </p>
<blockquote>
<p>I recommend to use external tools for testing regular expressions. For more please see <a href="#online-tools">online tools</a> chapter.</p>
</blockquote>
<p>Ok, so we have following more complicated configuration:</p>
<pre><code class="language-bash">server {

 listen           80;
 server_name      xyz.com www.xyz.com;

 location ~ ^/(media|static)/ {
  root            /var/www/xyz.com/static;
  expires         10d;
 }

 location ~* ^/(media2|static2) {
  root            /var/www/xyz.com/static2;
  expires         20d;
 }

 location /static3 {
  root            /var/www/xyz.com/static3;
 }

 location ^~ /static4 {
  root            /var/www/xyz.com/static4;
 }

 location = /api {
  proxy_pass      http://127.0.0.1:8080;
 }

 location / {
  proxy_pass      http://127.0.0.1:8080;
 }

 location /backend {
  proxy_pass      http://127.0.0.1:8080;
 }

 location ~ logo.xcf$ {
  root            /var/www/logo;
  expires         48h;
 }

 location ~* .(png|ico|gif|xcf)$ {
  root            /var/www/img;
  expires         24h;
 }

 location ~ logo.ico$ {
  root            /var/www/logo;
  expires         96h;
 }

 location ~ logo.jpg$ {
  root            /var/www/logo;
  expires         48h;
 }

}
</code></pre>
<p>And here is the table with the results:</p>
<table>
<thead>
<tr>
<th align="left"><b>URL</b></th>
<th align="left"><b>LOCATIONS FOUND</b></th>
<th align="left"><b>FINAL MATCH</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>/</code></td>
<td align="left">1) prefix match for <code>/</code></td>
<td align="left"><code>/</code></td>
</tr>
<tr>
<td align="left"><code>/css</code></td>
<td align="left">1) prefix match for <code>/</code></td>
<td align="left"><code>/</code></td>
</tr>
<tr>
<td align="left"><code>/api</code></td>
<td align="left">1) exact match for <code>/api</code></td>
<td align="left"><code>/api</code></td>
</tr>
<tr>
<td align="left"><code>/api/</code></td>
<td align="left">1) prefix match for <code>/</code></td>
<td align="left"><code>/</code></td>
</tr>
<tr>
<td align="left"><code>/backend</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) prefix match for <code>/backend</code></td>
<td align="left"><code>/backend</code></td>
</tr>
<tr>
<td align="left"><code>/static</code></td>
<td align="left">1) prefix match for <code>/</code></td>
<td align="left"><code>/</code></td>
</tr>
<tr>
<td align="left"><code>/static/header.png</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case sensitive regex match for <code>^/(media\|static)/</code></td>
<td align="left"><code>^/(media\|static)/</code></td>
</tr>
<tr>
<td align="left"><code>/static/logo.jpg</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case sensitive regex match for <code>^/(media\|static)/</code></td>
<td align="left"><code>^/(media\|static)/</code></td>
</tr>
<tr>
<td align="left"><code>/media2</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case insensitive regex match for <code>^/(media2\|static2)</code></td>
<td align="left"><code>^/(media2\|static2)</code></td>
</tr>
<tr>
<td align="left"><code>/media2/</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case insensitive regex match for <code>^/(media2\|static2)</code></td>
<td align="left"><code>^/(media2\|static2)</code></td>
</tr>
<tr>
<td align="left"><code>/static2/logo.jpg</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case insensitive regex match for <code>^/(media2\|static2)</code></td>
<td align="left"><code>^/(media2\|static2)</code></td>
</tr>
<tr>
<td align="left"><code>/static2/logo.png</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case insensitive regex match for <code>^/(media2\|static2)</code></td>
<td align="left"><code>^/(media2\|static2)</code></td>
</tr>
<tr>
<td align="left"><code>/static3/logo.jpg</code></td>
<td align="left">1) prefix match for <code>/static3</code><br>2) prefix match for <code>/</code><br>3) case sensitive regex match for <code>logo.jpg$</code></td>
<td align="left"><code>logo.jpg$</code></td>
</tr>
<tr>
<td align="left"><code>/static3/logo.png</code></td>
<td align="left">1) prefix match for <code>/static3</code><br>2) prefix match for <code>/</code><br>3) case insensitive regex match for <code>.(png\|ico\|gif\|xcf)$</code></td>
<td align="left"><code>.(png\|ico\|gif\|xcf)$</code></td>
</tr>
<tr>
<td align="left"><code>/static4/logo.jpg</code></td>
<td align="left">1) priority prefix match for <code>/static4</code><br>2) prefix match for <code>/</code></td>
<td align="left"><code>/static4</code></td>
</tr>
<tr>
<td align="left"><code>/static4/logo.png</code></td>
<td align="left">1) priority prefix match for <code>/static4</code><br>2) prefix match for <code>/</code></td>
<td align="left"><code>/static4</code></td>
</tr>
<tr>
<td align="left"><code>/static5/logo.jpg</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case sensitive regex match for <code>logo.jpg$</code></td>
<td align="left"><code>logo.jpg$</code></td>
</tr>
<tr>
<td align="left"><code>/static5/logo.png</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case insensitive regex match for <code>.(png\|ico\|gif\|xcf)$</code></td>
<td align="left"><code>.(png\|ico\|gif\|xcf)$</code></td>
</tr>
<tr>
<td align="left"><code>/static5/logo.xcf</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case sensitive regex match for <code>logo.xcf$</code></td>
<td align="left"><code>logo.xcf$</code></td>
</tr>
<tr>
<td align="left"><code>/static5/logo.ico</code></td>
<td align="left">1) prefix match for <code>/</code><br>2) case insensitive regex match for <code>.(png\|ico\|gif\|xcf)$</code></td>
<td align="left"><code>.(png\|ico\|gif\|xcf)$</code></td>
</tr>
</tbody>
</table>
<h4 id="error-log-severity-levels">Error log severity levels</h4>
<p>The following is a list of all severity levels:</p>
<table>
<thead>
<tr>
<th align="left"><b>TYPE</b></th>
<th align="left"><b>DESCRIPTION</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>debug</code></td>
<td align="left">information that can be useful to pinpoint where a problem is occurring</td>
</tr>
<tr>
<td align="left"><code>info</code></td>
<td align="left">informational messages that aren’t necessary to read but may be good to know</td>
</tr>
<tr>
<td align="left"><code>notice</code></td>
<td align="left">something normal happened that is worth noting</td>
</tr>
<tr>
<td align="left"><code>warn</code></td>
<td align="left">something unexpected happened, however is not a cause for concern</td>
</tr>
<tr>
<td align="left"><code>error</code></td>
<td align="left">something was unsuccessful, contains the action of limiting rules</td>
</tr>
<tr>
<td align="left"><code>crit</code></td>
<td align="left">important problems that need to be addressed</td>
</tr>
<tr>
<td align="left"><code>alert</code></td>
<td align="left">severe situation where action is needed promptly</td>
</tr>
<tr>
<td align="left"><code>emerg</code></td>
<td align="left">the system is in an unusable state and requires immediate attention</td>
</tr>
</tbody>
</table>
<p>For example: if you set <code>crit</code> error log level, messages of <code>crit</code>, <code>alert</code>, and <code>emerg</code> levels are logged.</p>
<h4 id="rate-limiting">Rate limiting</h4>
<blockquote>
<p>All rate limiting rules (definitions) should be added to the NGINX <code>http</code> context.</p>
</blockquote>
<p>Rate limiting rules are useful for:</p>
<ul>
<li>traffic shaping</li>
<li>traffic optimizing</li>
<li>slow down the rate of incoming requests</li>
<li>protect http requests flood</li>
<li>protect against slow http attacks</li>
<li>prevent consume a lot of bandwidth</li>
<li>mitigating ddos attacks</li>
<li>protect brute-force attacks</li>
</ul>
<p>NGINX has following variables (unique keys) that can be used in a rate limiting rules:</p>
<table>
<thead>
<tr>
<th align="left"><b>VARIABLE</b></th>
<th align="left"><b>DESCRIPTION</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>$remote_addr</code></td>
<td align="left">client address</td>
</tr>
<tr>
<td align="left"><code>$binary_remote_addr</code></td>
<td align="left">client address in a binary form, it is smaller and saves space then <code>remote_addr</code></td>
</tr>
<tr>
<td align="left"><code>$server_name</code></td>
<td align="left">name of the server which accepted a request</td>
</tr>
<tr>
<td align="left"><code>$request_uri</code></td>
<td align="left">full original request URI (with arguments)</td>
</tr>
<tr>
<td align="left"><code>$query_string</code></td>
<td align="left">arguments in the request line</td>
</tr>
</tbody>
</table>
<p><i>Please see <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#variables">official doc</a> for more information about variables.</i></p>
<p>NGINX also provides following keys:</p>
<table>
<thead>
<tr>
<th align="left"><b>KEY</b></th>
<th align="left"><b>DESCRIPTION</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>limit_req_zone</code></td>
<td align="left">stores the current number of excessive requests</td>
</tr>
<tr>
<td align="left"><code>limit_conn_zone</code></td>
<td align="left">stores the maximum allowed number of connections</td>
</tr>
</tbody>
</table>
<p>and directives:</p>
<table>
<thead>
<tr>
<th align="left"><b>DIRECTIVE</b></th>
<th align="left"><b>DESCRIPTION</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>limit_req</code></td>
<td align="left">sets the shared memory zone and the maximum burst size of requests</td>
</tr>
<tr>
<td align="left"><code>limit_conn</code></td>
<td align="left">sets the shared memory zone and the maximum allowed number of connections to the server per a client IP</td>
</tr>
</tbody>
</table>
<p>Keys are used to store the state of each IP address and how often it has accessed a limited object. This information are stored in shared memory available from all NGINX worker processes.</p>
<p>Both keys also provides response status parameters indicating too many requests or connections with specific http code (default <strong>503</strong>).</p>
<ul>
<li><code>limit_req_status &lt;value&gt;</code></li>
<li><code>limit_conn_status &lt;value&gt;</code></li>
</ul>
<p>For example, if you want to set the desired logging level for cases when the server limits the number of connections:</p>
<pre><code class="language-bash"># Add this to http context:
limit_req_status 429;

# Set your own error page for 429 http code:
error_page 429 /rate_limit.html;
location = /rate_limit.html {
  root /usr/share/www/http-error-pages/sites/other;
  internal;
}

# And create this file:
cat &gt; /usr/share/www/http-error-pages/sites/other/rate_limit.html &lt;&lt; __EOF__
HTTP 429 Too Many Requests
__EOF__
</code></pre>
<p>Rate limiting rules also have zones that lets you define a shared space in which to count the incoming requests or connections.</p>
<blockquote>
<p>All requests or connections coming into the same space will be counted in the same rate limit. This is what allows you to limit per URL, per IP, or anything else.</p>
</blockquote>
<p>The zone has two required parts:</p>
<ul>
<li><code>&lt;name&gt;</code> - is the zone identifier</li>
<li><code>&lt;size&gt;</code> - is the zone size</li>
</ul>
<p>Example:</p>
<pre><code class="language-bash">&lt;key&gt; &lt;variable&gt; zone=&lt;name&gt;:&lt;size&gt;;
</code></pre>
<blockquote>
<p>State information for about <strong>16,000</strong> IP addresses takes <strong>1 megabyte</strong>. So <strong>1 kilobyte</strong> zone has <strong>16</strong> IP addresses.</p>
</blockquote>
<p>The range of zones is as follows:</p>
<ul>
<li><strong>http context</strong></li>
</ul>
<pre><code class="language-bash">http {

  ... zone=&lt;name&gt;;

</code></pre>
<ul>
<li><strong>server context</strong></li>
</ul>
<pre><code class="language-bash">server {

  ... zone=&lt;name&gt;;

</code></pre>
<ul>
<li><strong>location directive</strong></li>
</ul>
<pre><code class="language-bash">location /api {

  ... zone=&lt;name&gt;;

</code></pre>
<p><code>limit_req_zone</code> key lets you set <code>rate</code> parameter (optional) - it defines the rate limited URL(s).</p>
<p>For enable queue you should use <code>limit_req</code> or <code>limit_conn</code> directives (see above). <code>limit_req</code> also provides optional parameters:</p>
<table>
<thead>
<tr>
<th align="left"><b>PARAMETER</b></th>
<th align="left"><b>DESCRIPTION</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>burst=&lt;num&gt;</code></td>
<td align="left">sets the maximum number of excessive requests that await to be processed in a timely manner; maximum requests as <code>rate</code> * <code>burst</code> in <code>burst</code> seconds</td>
</tr>
<tr>
<td align="left"><code>nodelay</code></td>
<td align="left">it imposes a rate limit without constraining the allowed spacing between requests; default NGINX would return 503 response and not handle excessive requests</td>
</tr>
</tbody>
</table>
<blockquote>
<p><code>nodelay</code> parameters are only useful when you also set a <code>burst</code>.</p>
</blockquote>
<p>Without <code>nodelay</code> option NGINX would wait (no 503 response) and handle excessive requests with some delay.</p>
<h4 id="analyse-configuration">Analyse configuration</h4>
<p>It is an essential way for testing NGINX configuration:</p>
<pre><code class="language-bash">nginx -t -c /etc/nginx/nginx.conf;
</code></pre>
<p>An external tool for analyse NGINX configuration is <code>gixy</code>:</p>
<pre><code class="language-bash">gixy /etc/nginx/nginx.conf
</code></pre>
<h4 id="monitoring">Monitoring</h4>
<h5 id="goaccess">GoAccess</h5>
<blockquote>
<p>Paths configuration file:</p>
<ul>
<li><code>/etc/goaccess.conf</code></li>
<li><code>/etc/goaccess/goaccess.conf</code></li>
<li><code>/usr/local/etc/goaccess.conf</code></li>
</ul>
</blockquote>
<p>Prior to start GoAccess enable these parameters:</p>
<pre><code class="language-bash">time-format %H:%M:%S
date-format %d/%b/%Y
log-format  %h %^[%d:%t %^] "%r" %s %b "%R" "%u"
</code></pre>
<h6 id="build-and-install">Build and install</h6>
<pre><code class="language-bash"># Ubuntu/Debian
apt-get install gcc make libncursesw5-dev libgeoip-dev libtokyocabinet-dev

# RHEL/CentOS
yum install gcc ncurses-devel geoip-devel tokyocabinet-devel

cd /usr/local/src/

wget -c https://tar.goaccess.io/goaccess-1.3.tar.gz &amp;&amp; \
tar xzvfp goaccess-1.3.tar.gz

cd goaccess-1.3

./configure --enable-utf8 --enable-geoip=legacy --with-openssl=&lt;path_to_openssl_sources&gt; --sysconfdir=/etc/

make -j2 &amp;&amp; make install

ln -s /usr/local/bin/goaccess /usr/bin/goaccess
</code></pre>
<blockquote>
<p>Default path to configuration file: <code>/etc/goaccess/goaccess.conf</code>. You can always copy it from <code>/usr/local/src/goaccess-&lt;version&gt;/config/goaccess.conf</code> source tree.</p>
</blockquote>
<h6 id="analyse-log-file-and-enable-all-recorded-statistics">Analyse log file and enable all recorded statistics</h6>
<pre><code class="language-bash">goaccess -f access.log -a
</code></pre>
<h6 id="analyse-compressed-log-file">Analyse compressed log file</h6>
<pre><code class="language-bash">zcat access.log.1.gz | goaccess -a -p /etc/goaccess/goaccess.conf
</code></pre>
<h6 id="analyse-log-file-remotely">Analyse log file remotely</h6>
<pre><code class="language-bash">ssh user@remote_host 'access.log' | goaccess -a
</code></pre>
<h6 id="analyse-log-file-and-generate-html-report">Analyse log file and generate html report</h6>
<pre><code class="language-bash">goaccess -p /etc/goaccess/goaccess.conf -f access.log --log-format=COMBINED -o /var/www/index.html
</code></pre>
<h5 id="ngxtop">Ngxtop</h5>
<h6 id="analyse-log-file">Analyse log file</h6>
<pre><code class="language-bash">ngxtop -l access.log
</code></pre>
<h6 id="analyse-log-file-and-print-requests-with-4xx-and-5xx">Analyse log file and print requests with 4xx and 5xx</h6>
<pre><code class="language-bash">ngxtop -l access.log -i 'status &gt;= 400' print request status
</code></pre>
<h6 id="analyse-log-file-remotely-1">Analyse log file remotely</h6>
<pre><code class="language-bash">ssh user@remote_host tail -f access.log | ngxtop -f combined
</code></pre>
<h4 id="testing">Testing</h4>
<blockquote>
<p>You can change combinations and parameters of these commands.</p>
</blockquote>
<h6 id="send-request-and-show-response-headers">Send request and show response headers</h6>
<pre><code class="language-bash"># 1)
curl -Iks &lt;scheme&gt;://&lt;server_name&gt;:&lt;port&gt;

# 2)
http -p Hh &lt;scheme&gt;://&lt;server_name&gt;:&lt;port&gt;

# 3)
htrace.sh -u &lt;scheme&gt;://&lt;server_name&gt;:&lt;port&gt; -h
</code></pre>
<h6 id="send-request-with-http-method-user-agent-follow-redirects-and-show-response-headers">Send request with http method, user-agent, follow redirects and show response headers</h6>
<pre><code class="language-bash"># 1)
curl -Iks --location -X GET -A "x-agent" &lt;scheme&gt;://&lt;server_name&gt;:&lt;port&gt;

# 2)
http -p Hh GET &lt;scheme&gt;://&lt;server_name&gt;:&lt;port&gt; User-Agent:x-agent --follow

# 3)
htrace.sh -u &lt;scheme&gt;://&lt;server_name&gt;:&lt;port&gt; -M GET --user-agent "x-agent" -h
</code></pre>
<h6 id="send-multiple-requests">Send multiple requests</h6>
<pre><code class="language-bash"># URL sequence substitution with a dummy query string:
curl -ks &lt;scheme&gt;://&lt;server_name&gt;:&lt;port&gt;?[1-20]

# With shell 'for' loop:
for i in {1..20} ; do curl -ks &lt;scheme&gt;://&lt;server_name&gt;:&lt;port&gt; ; done
</code></pre>
<h6 id="testing-ssl-connection">Testing SSL connection</h6>
<pre><code class="language-bash"># 1)
echo | openssl s_client -connect &lt;server_name&gt;:&lt;port&gt;

# 2)
gnutls-cli --disable-sni -p 443 &lt;server_name&gt;
</code></pre>
<h6 id="testing-ssl-connection-with-sni-support">Testing SSL connection (with SNI support)</h6>
<pre><code class="language-bash"># 1)
echo | openssl s_client -servername &lt;server_name&gt; -connect &lt;server_name&gt;:&lt;port&gt;

# 2)
gnutls-cli -p 443 &lt;server_name&gt;
</code></pre>
<h6 id="testing-ssl-connection-with-specific-ssl-version">Testing SSL connection with specific SSL version</h6>
<pre><code class="language-bash">openssl s_client -tls1_2 -connect &lt;server_name&gt;:&lt;port&gt;
</code></pre>
<h6 id="testing-ssl-connection-with-specific-cipher">Testing SSL connection with specific cipher</h6>
<pre><code class="language-bash">openssl s_client -cipher 'AES128-SHA' -connect &lt;server_name&gt;:&lt;port&gt;
</code></pre>
<h6 id="tcp-syn-flood-denial-of-service-attack">TCP SYN flood Denial of Service attack</h6>
<blockquote>
<p>Only use this for testing the availability, performance and capacity planning of a web application of your environment.</p>
</blockquote>
<pre><code class="language-bash">hping3 -V -c 1000000 -d 120 -S -w 64 -p 80 --flood --rand-source &lt;remote_host&gt;
</code></pre>
<h6 id="http-denial-of-service-attack">HTTP Denial of Service attack</h6>
<blockquote>
<p>Only use this for testing the availability, performance and capacity planning of a web application of your environment.</p>
</blockquote>
<pre><code class="language-bash"># 1)
slowhttptest -g -o http_dos.stats -H -c 1000 -i 15 -r 200 -t GET -x 24 -p 3 -u &lt;scheme&gt;://&lt;server_name&gt;/index.php

slowhttptest -g -o http_dos.stats -B -c 5000 -i 5 -r 200 -t POST -l 180 -x 5 -u &lt;scheme&gt;://&lt;server_name&gt;/service/login

# 2)
pip3 install slowloris
slowloris &lt;server_name&gt;

# 3)
git clone https://github.com/jseidl/GoldenEye &amp;&amp; cd GoldenEye
./goldeneye.py  &lt;scheme&gt;://&lt;server_name&gt; -w 150 -s 75 -m GET
</code></pre>
<h4 id="debugging">Debugging</h4>
<blockquote>
<p>You can change combinations and parameters of these commands. When carrying out the analysis, remember about <a href="#beginner-use-debug-mode-for-debugging">debug log</a> and <a href="#beginner-use-custom-log-formats-for-debugging">log formats</a>.</p>
</blockquote>
<h6 id="show-information-about-nginx-processes">Show information about NGINX processes</h6>
<p>with <code>ps</code>:</p>
<pre><code class="language-bash">ps axw -o pid,ppid,gid,user,etime,%cpu,%mem,vsz,rss,wchan,ni,command | egrep '([n]ginx|[P]ID)'
</code></pre>
<p>with <code>top</code>:</p>
<pre><code class="language-bash">top -p $(pgrep -d , nginx)
</code></pre>
<h6 id="check-if-the-module-has-been-compiled">Check if the module has been compiled</h6>
<pre><code class="language-bash">nginx -V 2&gt;&amp;1 | grep -- 'http_geoip_module'
</code></pre>
<h6 id="show-the-most-accessed-ip-addresses">Show the most accessed IP addresses</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s s\n%10s s\n' "AMOUNT" "IP_ADDRESS"
awk '{print $1}' access.log | sort | uniq -c | sort -nr
</code></pre>
<h6 id="show-the-top-5-visitors-ip-addresses">Show the top 5 visitors (IP addresses)</h6>
<pre><code class="language-bash"># - add this to the end for print header:
#   ... | xargs printf '%10s%10s s\n%10s%10s s\n' "NUM" "AMOUNT" "IP_ADDRESS"
cut -d ' ' -f1 access.log | sort | uniq -c | sort -nr | head -5 | nl
</code></pre>
<h6 id="show-the-most-requested-urls">Show the most requested urls</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s\t%s\n%10s\t%s\n' "AMOUNT" "URL"
awk -F\" '{print $2}' access.log | awk '{print $2}' | sort | uniq -c | sort -nr
</code></pre>
<h6 id="show-the-most-requested-urls-containing-string">Show the most requested urls containing 'string'</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s\t%s\n%10s\t%s\n' "AMOUNT" "URL"
awk -F\" '($2 ~ "../../string") { print $2}' access.log | awk '{print $2}' | sort | uniq -c | sort -nr
</code></pre>
<h6 id="show-the-most-requested-urls-with-http-methods">Show the most requested urls with http methods</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s %8s\t%s\n%10s %8s\t%s\n' "AMOUNT" "METHOD" "URL"
awk -F\" '{print $2}' access.log | awk '{print $1 "\t" $2}' | sort | uniq -c | sort -nr
</code></pre>
<h6 id="show-the-most-accessed-response-codes">Show the most accessed response codes</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s\t%s\n%10s\t%s\n' "AMOUNT" "HTTP_CODE"
awk '{print $9}' access.log | sort | uniq -c | sort -nr
</code></pre>
<h6 id="analyse-web-server-log-and-show-only-2xx-http-codes">Analyse web server log and show only 2xx http codes</h6>
<pre><code class="language-bash">tail -n 100 -f access.log | grep "HTTP/[1-2].[0-1]\" [2]"
</code></pre>
<h6 id="analyse-web-server-log-and-show-only-5xx-http-codes">Analyse web server log and show only 5xx http codes</h6>
<pre><code class="language-bash">tail -n 100 -f access.log | grep "HTTP/[1-2].[0-1]\" [5]"
</code></pre>
<h6 id="show-requests-which-result-502-and-sort-them-by-number-per-requests-by-url">Show requests which result 502 and sort them by number per requests by url</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s\t%s\n%10s\t%s\n' "AMOUNT" "URL"
awk '($9 ~ /502/)' access.log | awk '{print $7}' | sort | uniq -c | sort -nr
</code></pre>
<h6 id="show-requests-which-result-404-for-php-files-and-sort-them-by-number-per-requests-by-url">Show requests which result 404 for php files and sort them by number per requests by url</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s\t%s\n%10s\t%s\n' "AMOUNT" "URL"
awk '($9 ~ /401/)' access.log | awk -F\" '($2 ~ "../../*.php")' | awk '{print $7}' | sort | uniq -c | sort -nr
</code></pre>
<h6 id="calculating-amount-of-http-response-codes">Calculating amount of http response codes</h6>
<pre><code class="language-bash"># Not less than 1 minute:
tail -2000 access.log | awk -v date=$(date -d '1 minutes ago' +"%d/%b/%Y:%H:%M") '$4 ~ date' | cut -d '"' -f3 | cut -d ' ' -f2 | sort | uniq -c | sort -nr

# Last 2000 requests from log file:
# - add this to the end for print header:
#   ... | xargs printf '%10s\t%s\n%10s\t%s\n' "AMOUNT" "HTTP_CODE"
tail -2000 access.log | cut -d '"' -f3 | cut -d ' ' -f2 | sort | uniq -c | sort -nr
</code></pre>
<h6 id="calculating-requests-per-second">Calculating requests per second</h6>
<pre><code class="language-bash"># In real time:
tail -F access.log | pv -lr &gt;/dev/null

# - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s%24s%18s\n%10s%24s%18s\n' "AMOUNT" "DATE" "IP_ADDRESS"
awk '{print $4 " " $1}' access.log | uniq -c | sort -nr | tr -d "["
</code></pre>
<h6 id="calculating-requests-per-second-with-ip-addresses">Calculating requests per second with IP addresses</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s%24s%18s\n%10s%24s%18s\n' "AMOUNT" "DATE" "IP_ADDRESS"
awk '{print $4 " " $1}' access.log | uniq -c | sort -nr | tr -d "["
</code></pre>
<h6 id="calculating-requests-per-second-with-ip-addresses-and-urls">Calculating requests per second with IP addresses and urls</h6>
<pre><code class="language-bash"># - add `head -n X` to the end to limit the result
# - add this to the end for print header:
#   ... | xargs printf '%10s%24s%18s\t%s\n%10s%24s%18s\t%s\n' "AMOUNT" "DATE" "IP_ADDRESS" "URL"
awk '{print $4 " " $1 " " $7}' access.log | uniq -c | sort -nr | tr -d "["
</code></pre>
<h6 id="get-entries-within-last-n-hours">Get entries within last n hours</h6>
<pre><code class="language-bash">awk -v _date=`date -d 'now-6 hours' +[%d/%b/%Y:%H:%M:%S` ' { if ($4 &gt; _date) print $0}' access.log

# date command shows output for specific locale, for prevent this you should set LANG variable:
awk -v _date=$(LANG=en_us.utf-8 date -d 'now-6 hours' +[%d/%b/%Y:%H:%M:%S) ' { if ($4 &gt; _date) print $0}' access.log

# or:
export LANG=en_us.utf-8
awk -v _date=$(date -d 'now-6 hours' +[%d/%b/%Y:%H:%M:%S) ' { if ($4 &gt; _date) print $0}' access.log
</code></pre>
<h6 id="get-entries-between-two-timestamps-range-of-dates">Get entries between two timestamps (range of dates)</h6>
<pre><code class="language-bash"># 1)
awk '$4&gt;"[05/Feb/2019:02:10" &amp;&amp; $4&lt;"[15/Feb/2019:08:20"' access.log

# 2)
# date command shows output for specific locale, for prevent this you should set LANG variable:
awk -v _dateB=$(LANG=en_us.utf-8 date -d '10:20' +[%d/%b/%Y:%H:%M:%S) -v _dateE=$(LANG=en_us.utf-8 date -d '20:30' +[%d/%b/%Y:%H:%M:%S) ' { if ($4 &gt; _dateB &amp;&amp; $4 &lt; _dateE) print $0}' access.log

# or:
export LANG=en_us.utf-8
awk -v _dateB=$(date -d '10:20' +[%d/%b/%Y:%H:%M:%S) -v _dateE=$(date -d '20:30' +[%d/%b/%Y:%H:%M:%S) ' { if ($4 &gt; _dateB &amp;&amp; $4 &lt; _dateE) print $0}' access.log

# 3)
# date command shows output for specific locale, for prevent this you should set LANG variable:
awk -v _dateB=$(LANG=en_us.utf-8 date -d 'now-12 hours' +[%d/%b/%Y:%H:%M:%S) -v _dateE=$(LANG=en_us.utf-8 date -d 'now-2 hours' +[%d/%b/%Y:%H:%M:%S) ' { if ($4 &gt; _dateB &amp;&amp; $4 &lt; _dateE) print $0}' access.log

# or:
export LANG=en_us.utf-8
awk -v _dateB=$(date -d 'now-12 hours' +[%d/%b/%Y:%H:%M:%S) -v _dateE=$(date -d 'now-2 hours' +[%d/%b/%Y:%H:%M:%S) ' { if ($4 &gt; _dateB &amp;&amp; $4 &lt; _dateE) print $0}' access.log
</code></pre>
<h6 id="get-line-rates-from-web-server-log">Get line rates from web server log</h6>
<pre><code class="language-bash">tail -F access.log | pv -N RAW -lc 1&gt;/dev/null
</code></pre>
<h6 id="trace-network-traffic-for-all-nginx-processes">Trace network traffic for all NGINX processes</h6>
<pre><code class="language-bash">strace -e trace=network -p `pidof nginx | sed -e 's/ /,/g'`
</code></pre>
<h6 id="list-all-files-accessed-by-a-nginx">List all files accessed by a NGINX</h6>
<pre><code class="language-bash">strace -ff -e trace=file nginx 2&gt;&amp;1 | perl -ne 's/^[^"]+"(([^\\"]|\\[\\"nt])*)".*/$1/ &amp;&amp; print'
</code></pre>
<h6 id="check-that-the-gzip-static-module-is-working">Check that the <code>gzip_static</code> module is working</h6>
<pre><code class="language-bash">strace -p `pidof nginx | sed -e 's/ /,/g'` 2&gt;&amp;1 | grep gz
</code></pre>
<h6 id="which-worker-processing-current-request">Which worker processing current request</h6>
<p>Example 1 (more elegant way):</p>
<pre><code class="language-bash">log_format debug-req-trace
                '$pid - "$request_method $scheme://$host$request_uri" '
                '$remote_addr:$remote_port $server_addr:$server_port '
                '$request_id';

# Output example:
31863 - "GET https://example.com/" 35.228.233.xxx:63784 10.240.20.2:443 be90154db5beb0e9dd13c5d91c8ecd4c
</code></pre>
<p>Example 2:</p>
<pre><code class="language-bash"># Run strace in the background:
nohup strace -s 256 -p `pidof nginx | sed -e 's/ /,/g'` 2&gt;&amp;1 -o /tmp/nginx-req.trace &lt;/dev/null &gt;/dev/null 2&gt;/dev/null &amp;

# Watch output file:
watch -n 0.1 "awk '/Host:/ {print \"pid: \" \$1 \", \" \"host: \" \$6}' /tmp/nginx-req.trace | sed 's/\\\r\\\n.*//'"

# Output example:
Every 0.1s: awk '/Host:/ {print "pid: " $1 ", " "host: " $6}' /tmp/nginx-req.trace | sed 's/\\r\\n.*//'

pid: 31863, host: example.com
</code></pre>
<h6 id="capture-only-http-packets">Capture only http packets</h6>
<pre><code class="language-bash">ngrep -d eth0 -qt 'HTTP' 'tcp'
</code></pre>
<h6 id="extract-http-user-agent-from-the-http-packets">Extract http User Agent from the http packets</h6>
<pre><code class="language-bash">tcpdump -ei eth0 -nn -A -s1500 -l | grep "User-Agent:"
</code></pre>
<h6 id="capture-only-http-get-and-post-packets">Capture only http GET and POST packets</h6>
<pre><code class="language-bash"># 1)
tcpdump -ei eth0 -s 0 -A -vv \
'tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420' or 'tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354'

# 2)
tcpdump -ei eth0 -s 0 -v -n -l | egrep -i "POST /|GET /|Host:"
</code></pre>
<h6 id="capture-requests-and-filter-by-source-ip-and-destination-port">Capture requests and filter by source ip and destination port</h6>
<pre><code class="language-bash">ngrep -d eth0 "&lt;server_name&gt;" src host 10.10.252.1 and dst port 80
</code></pre>
<h4 id="shell-aliases">Shell aliases</h4>
<pre><code class="language-bash">alias ng.test='nginx -t -c /etc/nginx/nginx.conf'

alias ng.stop='ng.test &amp;&amp; systemctl stop nginx'

alias ng.reload='ng.test &amp;&amp; systemctl reload nginx'
alias ng.reload='ng.test &amp;&amp; kill -HUP $(cat /var/run/nginx.pid)'
#                       ... kill -HUP $(ps auxw | grep [n]ginx | grep master | awk '{print $2}')

alias ng.restart='ng.test &amp;&amp; systemctl restart nginx'
alias ng.restart='ng.test &amp;&amp; kill -QUIT $(cat /var/run/nginx.pid) &amp;&amp; /usr/sbin/nginx'
#                        ... kill -QUIT $(ps auxw | grep [n]ginx | grep master | awk '{print $2}') ...
</code></pre>
<h4 id="configuration-snippets">Configuration snippets</h4>
<h5 id="restricting-access-with-basic-authentication">Restricting access with basic authentication</h5>
<pre><code class="language-bash"># 1) Generate file with htpasswd command:
htpasswd -c htpasswd_example.com.conf &lt;username&gt;

# 2) Include this file in specific context: (e.g. server):
server_name example.com;

  ...

  # These directives are optional, only if we need them:
  satisfy all;

  deny    10.255.10.0/24;
  allow   192.168.0.0/16;
  allow   127.0.0.1;
  deny    all;

  # It's important:
  auth_basic            "Restricted Area";
  auth_basic_user_file  /etc/nginx/acls/htpasswd_example.com.conf;

  location / {

    ...

  location /public/ {

    auth_basic off;

  }

  ...
</code></pre>
<h5 id="blockingallowing-ip-addresses">Blocking/allowing IP addresses</h5>
<p>Example 1:</p>
<pre><code class="language-bash"># 1) File: /etc/nginx/acls/allow.map.conf

# Map module:
map $remote_addr $globals_internal_map_acl {

  # Status code:
  #  - 0 = false
  #  - 1 = true
  default 0;

  ### INTERNAL ###
  10.255.10.0/24 1;
  10.255.20.0/24 1;
  10.255.30.0/24 1;
  192.168.0.0/16 1;

}

# 2) Include this file in http context:
include /etc/nginx/acls/allow.map.conf;

# 3) Turn on in a specific context (e.g. location):
server_name example.com;

  ...

  location / {

    proxy_pass http://localhost:80;
    client_max_body_size 10m;

  }

  location ~ ^/(backend|api|admin) {

    if ($globals_internal_map_acl) {

      set $pass 1;

    }

    if ($pass = 1) {

      proxy_pass http://localhost:80;
      client_max_body_size 10m;

    }

    if ($pass != 1) {

      rewrite ^(.*) https://example.com;

    }

  ...
</code></pre>
<p>Example 2:</p>
<pre><code class="language-bash"># 1) File: /etc/nginx/acls/allow.geo.conf

# Geo module:
geo $globals_internal_geo_acl {

  # Status code:
  #  - 0 = false
  #  - 1 = true
  default 0;

  ### INTERNAL ###
  10.255.10.0/24 1;
  10.255.20.0/24 1;
  10.255.30.0/24 1;
  192.168.0.0/16 1;

}

# 2) Include this file in http context:
include /etc/nginx/acls/allow.geo.conf;

# 3) Turn on in a specific context (e.g. location):
server_name example.com;

  ...

  location / {

    proxy_pass http://localhost:80;
    client_max_body_size 10m;

  }

  location ~ ^/(backend|api|admin) {

    if ($globals_internal_geo_acl = 0) {

      return 403;

    }

    proxy_pass http://localhost:80;
    client_max_body_size 10m;

  ...
</code></pre>
<p>Example 3:</p>
<pre><code class="language-bash"># 1) File: /etc/nginx/acls/allow.conf

### INTERNAL ###
allow 10.255.10.0/24;
allow 10.255.20.0/24;
allow 10.255.30.0/24;
allow 192.168.0.0/16;

### EXTERNAL ###
allow 35.228.233.xxx;

# 2) Include this file in http context:
include /etc/nginx/acls/allow.conf;

# 3) Turn on in a specific context (e.g. server):
server_name example.com;

  include /etc/nginx/acls/allow.conf;
  allow   35.228.233.xxx;
  deny    all;

  ...
</code></pre>
<h5 id="blocking-referrer-spam">Blocking referrer spam</h5>
<p>Example 1:</p>
<pre><code class="language-bash"># 1) File: /etc/nginx/limits.conf
map $http_referer $invalid_referer {

  hostnames;

  default                   0;

  # Invalid referrers:
  "invalid.com"             1;
  "~*spamdomain4.com"       1;
  "~*.invalid\.org"         1;

}

# 2) Include this file in http context:
include /etc/nginx/limits.conf;

# 3) Turn on in a specific context (e.g. server):
server_name example.com;

  if ($invalid_referer) { return 403; }

  ...
</code></pre>
<p>Example 2:</p>
<pre><code class="language-bash"># 1) Turn on in a specific context (e.g. location):
location /check_status {

  if ($http_referer ~ "spam1\.com|spam2\.com|spam3\.com") {

    return 444;

  }

  ...
</code></pre>
<p>How to test?</p>
<pre><code class="language-bash">siege -b -r 2 -c 40 -v https:/example.com/storage/img/header.jpg -H "Referer: https://spamdomain4.com/"
** SIEGE 4.0.4
** Preparing 5 concurrent users for battle.
The server is now under siege...
HTTP/1.1 403     0.11 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.12 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.18 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.18 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.19 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.10 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.11 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.11 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.12 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 403     0.12 secs:     124 bytes ==&gt; GET  /storage/img/header.jpg

...
</code></pre>
<h5 id="limiting-referrer-spam">Limiting referrer spam</h5>
<p>Example 1:</p>
<pre><code class="language-bash"># 1) File: /etc/nginx/limits.conf
map $http_referer $limit_ip_key_by_referer {

  hostnames;

  # It's important because if you set numeric value, e.g. 0 rate limiting rule will be catch all referers:
  default                   "";

  # Invalid referrers (we restrict them):
  "invalid.com"             $binary_remote_addr;
  "~referer-xyz.com"        $binary_remote_addr;
  "~*spamdomain4.com"       $binary_remote_addr;
  "~*.invalid\.org"         $binary_remote_addr;

}

limit_req_zone $limit_ip_key_by_referer zone=req_for_remote_addr_by_referer:1m rate=5r/s;

# 2) Include this file in http context:
include /etc/nginx/limits.conf;

# 3) Turn on in a specific context (e.g. server):
server_name example.com;

  limit_req zone=req_for_remote_addr_by_referer burst=2;

  ...
</code></pre>
<p>How to test?</p>
<pre><code class="language-bash">siege -b -r 2 -c 40 -v https:/example.com/storage/img/header.jpg -H "Referer: https://spamdomain4.com/"
** SIEGE 4.0.4
** Preparing 5 concurrent users for battle.
The server is now under siege...
HTTP/1.1 200     0.13 secs:    3174 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 503     0.14 secs:     206 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 503     0.15 secs:     206 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 503     0.10 secs:     206 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 503     0.10 secs:     206 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 503     0.10 secs:     206 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 200     0.63 secs:    3174 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 200     1.13 secs:    3174 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 200     1.00 secs:    3174 bytes ==&gt; GET  /storage/img/header.jpg
HTTP/1.1 200     1.04 secs:    3174 bytes ==&gt; GET  /storage/img/header.jpg

...
</code></pre>
<h5 id="limiting-the-rate-of-requests-with-burst-mode">Limiting the rate of requests with burst mode</h5>
<pre><code class="language-bash">limit_req_zone $binary_remote_addr zone=req_for_remote_addr:64k rate=10r/m;
</code></pre>
<ul>
<li>key/zone type: <code>limit_req_zone</code></li>
<li>the unique key for limiter: <code>$binary_remote_addr</code>
<ul>
<li>limit requests per IP as following</li>
</ul> </li>
<li>zone name: <code>req_for_remote_addr</code></li>
<li>zone size: <code>64k</code> (1024 IP addresses)</li>
<li>rate is <code>0,16</code> request each second or <code>10</code> requests per minute (<code>1</code> request every <code>6</code> second)</li>
</ul>
<p>Example of use:</p>
<pre><code class="language-bash">location ~ /stats {

  limit_req zone=req_for_remote_addr burst=5;
</code></pre>
<ul>
<li>set maximum requests as <code>rate</code> * <code>burst</code> in <code>burst</code> seconds
<ul>
<li>with bursts not exceeding <code>5</code> requests:
<ul>
<li><code>0,16r/s</code> * <code>5</code> = <code>0.80</code> requests per <code>5</code> seconds</li>
<li><code>10r/m</code> * <code>5</code> = <code>50</code> requests per <code>5</code> minutes</li>
</ul> </li>
</ul> </li>
</ul>
<p>Testing queue:</p>
<pre><code class="language-bash"># siege -b -r 1 -c 12 -v https://x409.info/stats/
** SIEGE 4.0.4
** Preparing 12 concurrent users for battle.
The server is now under siege...
HTTP/1.1 200 *   0.20 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.20 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.20 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.21 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.22 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.22 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.23 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *   6.22 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *  12.24 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *  18.27 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *  24.30 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *  30.32 secs:       2 bytes ==&gt; GET  /stats/
             |
             - burst=5
             - 0,16r/s, 10r/m - 1r every 6 seconds

Transactions:              6 hits
Availability:          50.00 %
Elapsed time:          30.32 secs
Data transferred:       0.01 MB
Response time:         15.47 secs
Transaction rate:       0.20 trans/sec
Throughput:             0.00 MB/sec
Concurrency:            3.06
Successful transactions:   6
Failed transactions:       6
Longest transaction:   30.32
Shortest transaction:   0.20
</code></pre>
<h5 id="limiting-the-rate-of-requests-with-burst-mode-and-nodelay">Limiting the rate of requests with burst mode and nodelay</h5>
<pre><code class="language-bash">limit_req_zone $binary_remote_addr zone=req_for_remote_addr:50m rate=2r/s;
</code></pre>
<ul>
<li>key/zone type: <code>limit_req_zone</code></li>
<li>the unique key for limiter: <code>$binary_remote_addr</code>
<ul>
<li>limit requests per IP as following</li>
</ul> </li>
<li>zone name: <code>req_for_remote_addr</code></li>
<li>zone size: <code>50m</code> (800,000 IP addresses)</li>
<li>rate is <code>2</code> request each second or <code>120</code> requests per minute (<code>2</code> requests every <code>1</code> second)</li>
</ul>
<p>Example of use:</p>
<pre><code class="language-bash">location ~ /stats {

  limit_req zone=req_for_remote_addr burst=5 nodelay;
</code></pre>
<ul>
<li>set maximum requests as <code>rate</code> * <code>burst</code> in <code>burst</code> seconds
<ul>
<li>with bursts not exceeding <code>5</code> requests
<ul>
<li><code>2r/s</code> * <code>5</code> = <code>10</code> requests per <code>5</code> seconds</li>
<li><code>120r/m</code> * <code>5</code> = <code>600</code> requests per <code>5</code> minutes</li>
</ul> </li>
</ul> </li>
<li>allocates slots in the queue according to the <code>burst</code> parameter with <code>nodelay</code></li>
</ul>
<p>Testing queue:</p>
<pre><code class="language-bash"># siege -b -r 1 -c 12 -v https://x409.info/stats/
** SIEGE 4.0.4
** Preparing 12 concurrent users for battle.
The server is now under siege...
HTTP/1.1 200 *   0.18 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *   0.18 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *   0.19 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *   0.19 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *   0.19 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 200 *   0.19 secs:       2 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.19 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.19 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.20 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.21 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.21 secs:    1501 bytes ==&gt; GET  /stats/
HTTP/1.1 503     0.22 secs:    1501 bytes ==&gt; GET  /stats/
             |
             - burst=5 with nodelay
             - 2r/s, 120r/m - 1r every 0.5 second

Transactions:              6 hits
Availability:          50.00 %
Elapsed time:           0.23 secs
Data transferred:       0.01 MB
Response time:          0.39 secs
Transaction rate:      26.09 trans/sec
Throughput:             0.04 MB/sec
Concurrency:           10.17
Successful transactions:   6
Failed transactions:       6
Longest transaction:    0.22
Shortest transaction:   0.18
</code></pre>
<h5 id="limiting-the-number-of-connections">Limiting the number of connections</h5>
<pre><code class="language-bash">limit_conn_zone $binary_remote_addr zone=conn_for_remote_addr:1m;
</code></pre>
<ul>
<li>key/zone type: <code>limit_conn_zone</code></li>
<li>the unique key for limiter: <code>$binary_remote_addr</code>
<ul>
<li>limit requests per IP as following</li>
</ul> </li>
<li>zone name: <code>conn_for_remote_addr</code></li>
<li>zone size: <code>1m</code> (16,000 IP addresses)</li>
</ul>
<p>Example of use:</p>
<pre><code class="language-bash">location ~ /stats {

  limit_conn conn_for_remote_addr 1;
</code></pre>
<ul>
<li>limit a single IP address to make no more than <code>1</code> connection from IP at the same time</li>
</ul>
<p>Testing queue:</p>
<pre><code class="language-bash"># siege -b -r 1 -c 100 -t 10s --no-parser https://x409.info/stats/
defaulting to time-based testing: 10 seconds
** SIEGE 4.0.4
** Preparing 100 concurrent users for battle.
The server is now under siege...
Lifting the server siege...
Transactions:            364 hits
Availability:          32.13 %
Elapsed time:           9.00 secs
Data transferred:       1.10 MB
Response time:          2.37 secs
Transaction rate:      40.44 trans/sec
Throughput:             0.12 MB/sec
Concurrency:           95.67
Successful transactions: 364
Failed transactions:     769
Longest transaction:    1.10
Shortest transaction:   0.38
</code></pre>
<h5 id="adding-and-removing-the-www-prefix">Adding and removing the <code>www</code> prefix</h5>
<ul>
<li><code>www</code> to <code>non-www</code>:</li>
</ul>
<pre><code class="language-bash">server {

  ...

  server_name www.domain.com;

  # $scheme will get the http or https protocol:
  return 301 $scheme://domain.com$request_uri;

}
</code></pre>
<ul>
<li><code>non-www</code> to <code>www</code>:</li>
</ul>
<pre><code class="language-bash">server {

  ...

  server_name domain.com;

  # $scheme will get the http or https protocol:
  return 301 $scheme://www.domain.com$request_uri;

}
</code></pre>
<h5 id="rewrite-post-request-with-payload-to-external-endpoint">Rewrite POST request with payload to external endpoint</h5>
<p><strong>POST</strong> data is passed in the body of the request, which gets dropped if you do a standard redirect.</p>
<p>Look at this:</p>
<table>
<thead>
<tr>
<th align="left"><b>DESCRITPION</b></th>
<th align="left"><b>PERMANENT</b></th>
<th align="left"><b>TEMPORARY</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">allows changing the request method from POST to GET</td>
<td align="left">301</td>
<td align="left">302</td>
</tr>
<tr>
<td align="left">does not allow changing the request method from POST to GET</td>
<td align="left">308</td>
<td align="left">307</td>
</tr>
</tbody>
</table>
<p>You can try with the HTTP status code 307, a RFC compliant browser should repeat the post request. You just need to write a NGINX rewrite rule with HTTP status code 307 or 308:</p>
<pre><code class="language-bash">location /api {

  # HTTP 307 only for POST requests:
  if ($request_method = POST) {

    return 307 https://api.example.com?request_uri;

  }

  # You can keep this for non-POST requests:
  rewrite ^ https://api.example.com?request_uri permanent;

  client_max_body_size    10m;

  ...

}
</code></pre>
<h5 id="allow-multiple-cross-domains-using-the-cors-headers">Allow multiple cross-domains using the CORS headers</h5>
<p>Example 1:</p>
<pre><code class="language-bash">location ~* \.(?:ttf|ttc|otf|eot|woff|woff2)$ {

  if ( $http_origin ~* (https?://(.+\.)?(domain1|domain2|domain3)\.(?:me|co|com)$) ) {

    add_header "Access-Control-Allow-Origin" "$http_origin";

  }

}
</code></pre>
<p>Example 2 (more slightly configuration; for GETs and POSTs):</p>
<pre><code class="language-bash">location / {

  if ($http_origin ~* (^https?://([^/]+\.)*(domainone|domaintwo)\.com$)) {

    set $cors "true";

  }

  # Determine the HTTP request method used:
  if ($request_method = 'GET') {

    set $cors "${cors}get";

  }

  if ($request_method = 'POST') {

    set $cors "${cors}post";

  }

  if ($cors = "true") {

    # Catch all in case there's a request method we're not dealing with properly:
    add_header 'Access-Control-Allow-Origin' "$http_origin";

  }

  if ($cors = "trueget") {

    add_header 'Access-Control-Allow-Origin' "$http_origin";
    add_header 'Access-Control-Allow-Credentials' 'true';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';

  }

  if ($cors = "truepost") {

    add_header 'Access-Control-Allow-Origin' "$http_origin";
    add_header 'Access-Control-Allow-Credentials' 'true';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';

  }

}
</code></pre>
<h4 id="other-snippets">Other snippets</h4>
<h6 id="create-a-temporary-static-backend">Create a temporary static backend</h6>
<p>Python 3.x:</p>
<pre><code class="language-bash">python3 -m http.server 8000 --bind 127.0.0.1
</code></pre>
<p>Python 2.x:</p>
<pre><code class="language-bash">python -m SimpleHTTPServer 8000
</code></pre>
<h6 id="create-a-temporary-static-backend-with-ssl-support">Create a temporary static backend with SSL support</h6>
<p>Python 3.x:</p>
<pre><code class="language-bash">from http.server import HTTPServer, BaseHTTPRequestHandler
import ssl

httpd = HTTPServer(('localhost', 4443), BaseHTTPRequestHandler)

httpd.socket = ssl.wrap_socket (httpd.socket,
        keyfile="path/to/key.pem",
        certfile='path/to/cert.pem', server_side=True)

httpd.serve_forever()
</code></pre>
<p>Python 2.x:</p>
<pre><code class="language-bash">import BaseHTTPServer, SimpleHTTPServer
import ssl

httpd = BaseHTTPServer.HTTPServer(('localhost', 4443),
        SimpleHTTPServer.SimpleHTTPRequestHandler)

httpd.socket = ssl.wrap_socket (httpd.socket,
        keyfile="path/tp/key.pem",
        certfile='path/to/cert.pem', server_side=True)

httpd.serve_forever()
</code></pre>
<h6 id="generate-private-key-without-passphrase">Generate private key without passphrase</h6>
<pre><code class="language-bash"># _len: 2048, 4096
( _fd="private.key" ; _len="4096" ; \
openssl genrsa -out ${_fd} ${_len} )
</code></pre>
<h6 id="generate-csr">Generate CSR</h6>
<pre><code class="language-bash">( _fd="private.key" ; _fd_csr="request.csr" ; \
openssl req -out ${_fd_csr} -new -key ${_fd} )
</code></pre>
<h6 id="generate-csr-metadata-from-existing-certificate">Generate CSR (metadata from existing certificate)</h6>
<pre><code class="language-bash">( _fd="private.key" ; _fd_csr="request.csr" ; _fd_crt="cert.crt" ; \
openssl x509 -x509toreq -in ${_fd_crt} -out ${_fd_csr} -signkey ${_fd} )
</code></pre>
<h6 id="generate-csr-with--config-param">Generate CSR with -config param</h6>
<pre><code class="language-bash">( _fd="private.key" ; _fd_csr="request.csr" ; \
openssl req -new -sha256 -key ${_fd} -out ${_fd_csr} \
-config &lt;(
cat &lt;&lt;-EOF
[req]
default_bits = 2048
prompt = no
default_md = sha256
req_extensions = req_ext
distinguished_name = dn

[ dn ]
C=&lt;two-letter ISO abbreviation for your country&gt;
ST=&lt;state or province where your organization is legally located&gt;
L=&lt;city where your organization is legally located&gt;
O=&lt;legal name of your organization&gt;
OU=&lt;section of the organization&gt;
CN=&lt;fully qualified domain name&gt;

[ req_ext ]
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = &lt;fully qualified domain name&gt;
DNS.2 = &lt;next domain&gt;
DNS.3 = &lt;next domain&gt;
EOF
))
</code></pre>
<h6 id="generate-private-key-and-csr">Generate private key and CSR</h6>
<pre><code class="language-bash">( _fd="private.key" ; _fd_csr="request.csr" ; _len="4096" ; \
openssl req -out ${_fd_csr} -new -newkey rsa:${_len} -nodes -keyout ${_fd} )
</code></pre>
<h6 id="generate-ecdsa-private-key">Generate ECDSA private key</h6>
<pre><code class="language-bash"># _curve: prime256v1, secp521r1, secp384r1
( _fd="private.key" ; _curve="prime256v1" ; \
openssl ecparam -out ${_fd} -name ${_curve} -genkey )

# _curve: X25519
( _fd="private.key" ; _curve="x25519" ; \
openssl genpkey -algorithm ${_curve} -out ${_fd} )
</code></pre>
<h6 id="generate-private-key-with-csr-ecc">Generate private key with CSR (ECC)</h6>
<pre><code class="language-bash"># _curve: prime256v1, secp521r1, secp384r1
( _fd="domain.com.key" ; _fd_csr="domain.com.csr" ; _curve="prime256v1" ; \
openssl ecparam -out ${_fd} -name ${_curve} -genkey ; \
openssl req -new -key ${_fd} -out ${_fd_csr} -sha256 )
</code></pre>
<h6 id="generate-self-signed-certificate">Generate self-signed certificate</h6>
<pre><code class="language-bash"># _len: 2048, 4096
( _fd="domain.key" ; _fd_out="domain.crt" ; _len="4096" ; _days="365" ; \
openssl req -newkey rsa:${_len} -nodes \
-keyout ${_fd} -x509 -days ${_days} -out ${_fd_out} )
</code></pre>
<h6 id="generate-self-signed-certificate-from-existing-private-key">Generate self-signed certificate from existing private key</h6>
<pre><code class="language-bash"># _len: 2048, 4096
( _fd="domain.key" ; _fd_out="domain.crt" ; _days="365" ; \
openssl req -key ${_fd} -nodes \
-x509 -days ${_days} -out ${_fd_out} )
</code></pre>
<h6 id="generate-self-signed-certificate-from-existing-private-key-and-csr">Generate self-signed certificate from existing private key and csr</h6>
<pre><code class="language-bash"># _len: 2048, 4096
( _fd="domain.key" ; _fd_csr="domain.csr" ; _fd_out="domain.crt" ; _days="365" ; \
openssl x509 -signkey ${_fd} -nodes \
-in ${_fd_csr} -req -days ${_days} -out ${_fd_out} )
</code></pre>
<h6 id="generate-multidomain-certificate">Generate multidomain certificate</h6>
<pre><code class="language-bash">certbot certonly -d example.com -d www.example.com
</code></pre>
<h6 id="generate-wildcard-certificate">Generate wildcard certificate</h6>
<pre><code class="language-bash">certbot certonly --manual --preferred-challenges=dns -d example.com -d *.example.com
</code></pre>
<h6 id="generate-certificate-with-4096-bit-private-key">Generate certificate with 4096 bit private key</h6>
<pre><code class="language-bash">certbot certonly -d example.com -d www.example.com --rsa-key-size 4096
</code></pre>
<h6 id="generate-dh-param-key">Generate DH Param key</h6>
<pre><code class="language-bash">openssl dhparam -out /etc/nginx/ssl/dhparam_4096.pem 4096
</code></pre>
<h6 id="convert-der-to-pem">Convert DER to PEM</h6>
<pre><code class="language-bash">( _fd_der="cert.crt" ; _fd_pem="cert.pem" ; \
openssl x509 -in ${_fd_der} -inform der -outform pem -out ${_fd_pem} )
</code></pre>
<h6 id="convert-pem-to-der">Convert PEM to DER</h6>
<pre><code class="language-bash">( _fd_der="cert.crt" ; _fd_pem="cert.pem" ; \
openssl x509 -in ${_fd_pem} -outform der -out ${_fd_der} )
</code></pre>
<h6 id="verification-of-the-private-key">Verification of the private key</h6>
<pre><code class="language-bash">( _fd="private.key" ; \
openssl rsa -noout -text -in ${_fd} )
</code></pre>
<h6 id="verification-of-the-public-key">Verification of the public key</h6>
<pre><code class="language-bash"># 1)
( _fd="public.key" ; \
openssl pkey -noout -text -pubin -in ${_fd} )

# 2)
( _fd="private.key" ; \
openssl rsa -inform PEM -noout -in ${_fd} &amp;&gt; /dev/null ; \
if [ $? = 0 ] ; then echo -en "OK\n" ; fi )
</code></pre>
<h6 id="verification-of-the-certificate">Verification of the certificate</h6>
<pre><code class="language-bash">( _fd="certificate.crt" ; # format: pem, cer, crt \
openssl x509 -noout -text -in ${_fd} )
</code></pre>
<h6 id="verification-of-the-csr">Verification of the CSR</h6>
<pre><code class="language-bash">( _fd_csr="request.csr" ; \
openssl req -text -noout -in ${_fd_csr} )
</code></pre>
<h6 id="check-whether-the-private-key-and-the-certificate-match">Check whether the private key and the certificate match</h6>
<pre><code class="language-bash">(openssl rsa -noout -modulus -in private.key | openssl md5 ; \
openssl x509 -noout -modulus -in certificate.crt | openssl md5) | uniq
</code></pre>
<h4 id="installation-from-prebuilt-packages">Installation from prebuilt packages</h4>
<h5 id="rhel7-or-centos-7">RHEL7 or CentOS 7</h5>
<h6 id="from-epel">From EPEL</h6>
<pre><code class="language-bash"># Install epel repository:
yum install epel-release
# or alternative:
#   wget -c https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
#   yum install epel-release-latest-7.noarch.rpm

# Install NGINX:
yum install nginx
</code></pre>
<h6 id="from-software-collections">From Software Collections</h6>
<pre><code class="language-bash"># Install and enable scl:
yum install centos-release-scl
yum-config-manager --enable rhel-server-rhscl-7-rpms

# Install NGINX (rh-nginx14, rh-nginx16, rh-nginx18):
yum install rh-nginx16

# Enable NGINX from SCL:
scl enable rh-nginx16 bash
</code></pre>
<h6 id="from-official-repository">From Official Repository</h6>
<pre><code class="language-bash"># Where:
#   - &lt;os_type&gt; is: rhel or centos
cat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt; __EOF__
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/&lt;os_type&gt;/$releasever/$basearch/
gpgcheck=0
enabled=1
__EOF__

# Install NGINX:
yum install nginx
</code></pre>
<h5 id="debian-or-ubuntu">Debian or Ubuntu</h5>
<p>Check available flavors of NGINX before install. For more information please see <a href="https://askubuntu.com/a/556382">this</a> great answer by <a href="https://askubuntu.com/users/10616/thomas-ward">Thomas Ward</a>.</p>
<h6 id="from-debianubuntu-repository">From Debian/Ubuntu Repository</h6>
<pre><code class="language-bash"># Install NGINX:
apt-get install nginx
</code></pre>
<h6 id="from-official-repository-1">From Official Repository</h6>
<pre><code class="language-bash"># Where:
#   - &lt;os_type&gt; is: debian or ubuntu
#   - &lt;os_release&gt; is: xenial, bionic, jessie, stretch or other
cat &gt; /etc/apt/sources.list.d/nginx.list &lt;&lt; __EOF__
deb http://nginx.org/packages/&lt;os_type&gt;/ &lt;os_release&gt; nginx
deb-src http://nginx.org/packages/&lt;os_type&gt;/ &lt;os_release&gt; nginx
__EOF__

# Update packages list:
apt-get update

# Download the public key (or &lt;pub_key&gt; from your GPG error):
apt-key adv --keyserver keyserver.ubuntu.com --recv-keys &lt;pub_key&gt;

# Install NGINX:
apt-get update
apt-get install nginx
</code></pre>
<h4 id="installation-from-source">Installation from source</h4>
<p>The build is configured using the <code>configure</code> command. The configure shell script attempts to guess correct values for various system-dependent variables used during compilation. It uses those values to create a <code>Makefile</code>. Of course you can adjust certain environment variables to make configure able to find the packages like a <code>zlib</code> or <code>openssl</code>, and of many other options (paths, modules).</p>
<p>Before the beginning installation process please read these important articles which describes exactly the entire installation process and the parameters using the <code>configure</code> command:</p>
<ul>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/installoptions/">Installation and Compile-Time Options</a></li>
<li><a href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/#configure">Installing NGINX Open Source</a></li>
<li><a href="https://nginx.org/en/docs/configure.html">Building nginx from Sources</a></li>
</ul>
<p>In this chapter I'll present three (very similar) methods of installation. They relate to:</p>
<ul>
<li>the <a href="#install-nginx-on-centos-7">NGINX on CentOS 7</a></li>
<li>the <a href="#install-openresty-on-centos-7">OpenResty on CentOS 7</a></li>
<li>the <a href="#install-tengine-on-ubuntu-1804">Tengine on Ubuntu 18.04</a></li>
</ul>
<p>Each of them is suited towards a high performance as well as high-concurrency applications. They work great as a high-end proxy servers too.</p>
<p>Look also on this short note about the system locations. That can be useful too:</p>
<ul>
<li>For booting the system, rescues and maintenance: <code>/</code>
<ul>
<li><code>/bin</code> - user programs</li>
<li><code>/sbin</code> - system programs</li>
<li><code>/lib</code> - shared libraries</li>
</ul> </li>
<li>Full running environment: <code>/usr</code>
<ul>
<li><code>/usr/bin</code> - user programs</li>
<li><code>/usr/sbin</code> - system programs</li>
<li><code>/usr/lib</code> - shared libraries</li>
<li><code>/usr/share</code> - manual pages, data</li>
</ul> </li>
<li>Added packages: <code>/usr/local</code>
<ul>
<li><code>/usr/local/bin</code> - user programs</li>
<li><code>/usr/local/sbin</code> - system programs</li>
<li><code>/usr/local/lib</code> - shared libraries</li>
<li><code>/usr/local/share</code> - manual pages, data</li>
</ul> </li>
</ul>
<h5 id="automatic-installation">Automatic installation</h5>
<p>Installation from source consists of multiple steps. If you don't want to pass through all of them manually, you can run automated script. I created it to facilitate the whole installation process.</p>
<blockquote>
<p>It supports Debian and RHEL like distributions.</p>
</blockquote>
<p>This tool is located in <code>lib/ngx_installer.sh</code>. Configuration file is in <code>lib/ngx_installer.conf</code>. By default, it show prompt to confirm steps but you can disable it if you want:</p>
<pre><code class="language-bash">cd lib/
export NGX_PROMPT=0 ; bash ngx_installer.sh
</code></pre>
<h5 id="nginx-package">Nginx package</h5>
<p>There are currently two versions of NGINX:</p>
<ul>
<li><strong>stable</strong> - is recommended, doesn’t include all of the latest features, but has critical bug fixes from mainline release</li>
<li><strong>mainline</strong> - is typically quite stable as well, includes the latest features and bug fixes and is always up to date</li>
</ul>
<p>You can download NGINX source code from an official read-only mirrors:</p>
<blockquote>
<p>Detailed instructions about download and compile the NGINX sources can be found later in the handbook.</p>
</blockquote>
<ul>
<li><a href="https://nginx.org/download/">NGINX source code</a></li>
<li><a href="https://github.com/nginx/nginx">NGINX GitHub repository</a></li>
</ul>
<h5 id="dependencies">Dependencies</h5>
<p>Mandatory requirements:</p>
<blockquote>
<p>Download, compile and install or install prebuilt packages from repository of your distribution.</p>
</blockquote>
<ul>
<li><a href="https://www.openssl.org/source/">OpenSSL</a> library</li>
<li><a href="https://zlib.net/">Zlib</a> or <a href="https://github.com/cloudflare/zlib">Cloudflare Zlib</a> library</li>
<li><a href="https://ftp.pcre.org/pub/pcre/">PCRE</a> library</li>
<li><a href="https://github.com/LuaJIT/LuaJIT">LuaJIT v2.1</a> or <a href="https://github.com/openresty/luajit2">OpenResty's LuaJIT2</a> library</li>
<li><a href="https://github.com/jemalloc/jemalloc">jemalloc</a> library</li>
</ul>
<p>OpenResty's LuaJIT uses its own branch of LuaJIT with various important bug fixes and optimizations for OpenResty's use cases.</p>
<p>I also use Cloudflare Zlib version due to performance. See below articles:</p>
<ul>
<li><a href="http://www.htslib.org/benchmarks/zlib.html">A comparison of Zlib implementations</a></li>
<li><a href="https://medium.com/@centminmod/improving-nginx-zlib-compression-performance-eb961f3ac0f4">Improving Nginx Zlib Compression Performance</a></li>
</ul>
<p>If you download and compile above sources the good point is to install additional packages (dependent on the system version) before building NGINX:</p>
<table>
<thead>
<tr>
<th align="left"><b>Debian Like</b></th>
<th align="left"><b>RedHat Like</b></th>
<th align="left"><b>Comment</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>gcc</code><br><code>make</code><br><code>build-essential</code><br><code>linux-headers*</code><br><code>bison</code></td>
<td align="left"><code>gcc</code><br><code>gcc-c++</code><br><code>kernel-devel</code><br><code>bison</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>perl</code><br><code>libperl-dev</code><br><code>libphp-embed</code></td>
<td align="left"><code>perl</code><br><code>perl-devel</code><br><code>perl-ExtUtils-Embed</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libssl-dev</code>*</td>
<td align="left"><code>openssl-devel</code>*</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>zlib1g-dev</code>*</td>
<td align="left"><code>zlib-devel</code>*</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libpcre2-dev</code>*</td>
<td align="left"><code>pcre-devel</code>*</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libluajit-5.1-dev</code>*</td>
<td align="left"><code>luajit-devel</code>*</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libxslt-dev</code></td>
<td align="left"><code>libxslt libxslt-devel</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libgd-dev</code></td>
<td align="left"><code>gd gd-devel</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libgeoip-dev</code></td>
<td align="left"><code>GeoIP-devel</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libxml2-dev</code></td>
<td align="left"><code>libxml2-devel</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libexpat-dev</code></td>
<td align="left"><code>expat-devel</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>libgoogle-perftools-dev</code><br><code>libgoogle-perftools4</code></td>
<td align="left"><code>gperftools-devel</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>cpio</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>gettext-devel</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>autoconf</code></td>
<td align="left"><code>autoconf</code></td>
<td align="left">for <code>jemalloc</code> from sources</td>
</tr>
<tr>
<td align="left"><code>libjemalloc1</code><br><code>libjemalloc-dev</code>*</td>
<td align="left"><code>jemalloc</code><br><code>jemalloc-devel</code>*</td>
<td align="left">for <code>jemalloc</code></td>
</tr>
<tr>
<td align="left"><code>libpam0g-dev</code></td>
<td align="left"><code>pam-devel</code></td>
<td align="left">for <code>ngx_http_auth_pam_module</code></td>
</tr>
<tr>
<td align="left"><code>jq</code></td>
<td align="left"><code>jq</code></td>
<td align="left">for http error pages generator</td>
</tr>
</tbody>
</table>
<p><i>* If you don't use from sources.</i></p>
<p>Shell one-liners example:</p>
<pre><code class="language-bash"># Ubuntu/Debian
apt-get install gcc make build-essential bison perl libperl-dev libphp-embed libssl-dev zlib1g-dev libpcre2-dev libluajit-5.1-dev libxslt-dev libgd-dev libgeoip-dev libxml2-dev libexpat-dev libgoogle-perftools-dev libgoogle-perftools4 autoconf jq

# RedHat/CentOS
yum install gcc gcc-c++ kernel-devel bison perl perl-devel perl-ExtUtils-Embed openssl-devel zlib-devel pcre-devel luajit-devel libxslt libxslt-devel gd gd-devel GeoIP-devel libxml2-devel expat-devel gperftools-devel cpio gettext-devel autoconf jq
</code></pre>
<h5 id="3rd-party-modules">3rd party modules</h5>
<blockquote>
<p>Not all external modules can work properly with your currently NGINX version. You should read the documentation of each module before adding it to the modules list. You should also to check what version of module is compatible with your NGINX release.</p>
</blockquote>
<p>Modules can be compiled as a shared object (<code>*.so</code> file) and then dynamically loaded into NGINX at runtime (<code>--add-dynamic-module</code>). On the other hand you can also built them into NGINX at compile time and linked to the NGINX binary statically (<code>--add-module</code>).</p>
<p>I mixed both variants because some of the modules are built-in automatically even if I try them to be compiled as a dynamic modules (they are not support dynamic linking).</p>
<p>You can download external modules from:</p>
<ul>
<li><a href="https://www.nginx.com/resources/wiki/modules/">NGINX 3rd Party Modules</a></li>
<li><a href="https://openresty.org/en/components.html">OpenResty Components</a></li>
<li><a href="https://github.com/alibaba/tengine/tree/master/modules">Tengine Modules</a></li>
</ul>
<p>A short description of the modules that I used (not only) in this step-by-step tutorial:</p>
<ul>
<li><a href="https://github.com/simplresty/ngx_devel_kit"><code>ngx_devel_kit</code></a>** - adds additional generic tools that module developers can use in their own modules</li>
<li><a href="https://github.com/openresty/lua-nginx-module"><code>lua-nginx-module</code></a> - embed the Power of Lua into NGINX</li>
<li><a href="https://github.com/openresty/set-misc-nginx-module"><code>set-misc-nginx-module</code></a> - various <code>set_xxx</code> directives added to NGINX's rewrite module</li>
<li><a href="https://github.com/openresty/echo-nginx-module"><code>echo-nginx-module</code></a> - module for bringing the power of <code>echo</code>, <code>sleep</code>, <code>time</code> and more to NGINX's config file</li>
<li><a href="https://github.com/openresty/headers-more-nginx-module"><code>headers-more-nginx-module</code></a> - set, add, and clear arbitrary output headers</li>
<li><a href="https://github.com/openresty/replace-filter-nginx-module"><code>replace-filter-nginx-module</code></a> - streaming regular expression replacement in response bodies</li>
<li><a href="https://github.com/openresty/array-var-nginx-module"><code>array-var-nginx-module</code></a> - add supports for array-typed variables to NGINX config files</li>
<li><a href="https://github.com/openresty/encrypted-session-nginx-module"><code>encrypted-session-nginx-module</code></a> - encrypt and decrypt NGINX variable values</li>
<li><a href="https://github.com/vozlt/nginx-module-sysguard"><code>nginx-module-sysguard</code></a> - module to protect servers when system load or memory use goes too high</li>
<li><a href="https://github.com/nginx-clojure/nginx-access-plus"><code>nginx-access-plus</code></a> - allows limiting access to certain http request methods and client addresses</li>
<li><a href="https://github.com/yaoweibin/ngx_http_substitutions_filter_module"><code>ngx_http_substitutions_filter_module</code></a> - can do both regular expression and fixed string substitutions</li>
<li><a href="https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng/src"><code>nginx-sticky-module-ng</code></a> - module to add a sticky cookie to be always forwarded to the same</li>
<li><a href="https://github.com/vozlt/nginx-module-vts"><code>nginx-module-vts</code></a> - Nginx virtual host traffic status module</li>
<li><a href="https://github.com/google/ngx_brotli"><code>ngx_brotli</code></a> - module for Brotli compression</li>
<li><a href="https://github.com/nbs-system/naxsi"><code>ngx_http_naxsi_module</code></a> - is an open-source, high performance, low rules maintenance WAF for NGINX</li>
<li><a href="http://mdounin.ru/hg/ngx_http_delay_module"><code>ngx_http_delay_module</code></a> - allows to delay requests for a given time</li>
<li><a href="https://github.com/alibaba/nginx-backtrace"><code>nginx-backtrace</code></a>* - module to dump backtrace when a worker process exits abnormally</li>
<li><a href="https://github.com/chobits/ngx_debug_pool"><code>ngx_debug_pool</code></a>* - provides access to information of memory usage for NGINX memory pool</li>
<li><a href="https://github.com/hongxiaolong/ngx_debug_timer"><code>ngx_debug_timer</code></a>* - provides access to information of timer usage for NGINX</li>
<li><a href="https://github.com/yaoweibin/nginx_upstream_check_module"><code>nginx_upstream_check_module</code></a>* - health checks upstreams for NGINX</li>
<li><a href="https://github.com/alibaba/nginx-http-footer-filter"><code>nginx-http-footer-filter</code></a>* - module that prints some text in the footer of a request upstream server</li>
<li><a href="https://github.com/agentzh/memc-nginx-module"><code>memc-nginx-module</code></a> - extended version of the standard Memcached module</li>
<li><a href="https://github.com/arut/nginx-rtmp-module"><code>nginx-rtmp-module</code></a> - NGINX-based Media Streaming Server</li>
<li><a href="https://github.com/aperezdc/ngx-fancyindex"><code>ngx-fancyindex</code></a> - generates of file listings, like the built-in autoindex module does, but adding a touch of style</li>
<li><a href="https://github.com/cfsego/ngx_log_if"><code>ngx_log_if</code></a> - allows you to control when not to write down access log</li>
<li><a href="https://github.com/alibaba/nginx-http-user-agent"><code>nginx-http-user-agent</code></a> - module to match browsers and crawlers</li>
<li><a href="https://github.com/sto/ngx_http_auth_pam_module"><code>ngx_http_auth_pam_module</code></a> - module to use PAM for simple http authentication</li>
<li><a href="https://github.com/cuber/ngx_http_google_filter_module"><code>ngx_http_google_filter_module</code></a> - is a filter module which makes google mirror much easier to deploy</li>
<li><a href="https://github.com/wandenberg/nginx-push-stream-module"><code>nginx-push-stream-module</code></a> - a pure stream http push technology for your Nginx setup</li>
<li><a href="https://github.com/yaoweibin/nginx_tcp_proxy_module"><code>nginx_tcp_proxy_module</code></a> - add the feature of tcp proxy with nginx, with health check and status monitor</li>
</ul>
<p><i>* Available in Tengine Web Server (but these modules may have been updated/patched by Tengine Team).</i><br> <i>** Is already being used in quite a few third party modules.</i></p>
<h5 id="compiler-and-linker">Compiler and linker</h5>
<p>Someting about compiler and linker options. Out of the box you probably do not need to provide any flags yourself, the configure script should detect automatically some reasonable defaults. However, in order to optimize for speed and/or security, you should probably provide a few compiler flags. See <a href="https://developers.redhat.com/blog/2018/03/21/compiler-and-linker-flags-gcc/">this</a> recommendations by RedHat.</p>
<p>You should also read <a href="https://wiki.openssl.org/index.php/Compilation_and_Installation">Compilation and Installation</a> for OpenSSL.</p>
<p>There are examples:</p>
<pre><code class="language-bash"># 1)
#   --with-cc-opt="-I/usr/local/include -I${OPENSSL_INC} -I${LUAJIT_INC} -I${JEMALLOC_INC} -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC"
# 2)
#   --with-cc-opt="-I/usr/local/include -m64 -march=native -DTCP_FASTOPEN=23 -g -O3 -fstack-protector-strong -flto -fuse-ld=gold --param=ssp-buffer-size=4 -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wno-deprecated-declarations -gsplit-dwarf"

# Example of use linker options:
# 1)
#   --with-ld-opt="-Wl,-E -L/usr/local/lib -ljemalloc -lpcre -Wl,-rpath,/usr/local/lib,-z,relro -Wl,-z,now -pie"
# 2)
#   --with-ld-opt="-L/usr/local/lib -ljemalloc -Wl,-lpcre -Wl,-z,relro -Wl,-rpath,/usr/local/lib"
</code></pre>
<h5 id="systemtap">SystemTap</h5>
<blockquote>
<p>SystemTap is a scripting language and tool for dynamically instrumenting running production Linux kernel-based operating systems. It's required for <code>openresty-systemtap-toolkit</code> for OpenResty.</p>
</blockquote>
<blockquote>
<p>It's good <a href="https://gist.github.com/notsobad/b8f5ebb9b99f3a818f30">all-in-one tutorial</a> for install and configure SystemTap on CentOS 7/Ubuntu distributions.</p>
</blockquote>
<pre><code class="language-bash">cd /opt

git clone --depth 1 https://github.com/openresty/openresty-systemtap-toolkit

# RHEL/CentOS
yum install yum-utils
yum --enablerepo=base-debuginfo install kernel-devel-$(uname -r) kernel-headers-$(uname -r) kernel-debuginfo-$(uname -r) kernel-debuginfo-common-x86_64-$(uname -r)
yum --enablerepo=base-debuginfo install systemtap systemtap-debuginfo

reboot

# Run this commands for testing SystemTap:
stap -v -e 'probe vfs.read {printf("read performed\n"); exit()}'
stap -v -e 'probe begin { printf("Hello, World!\n"); exit() }'
</code></pre>
<blockquote>
<p>For installation SystemTap on Ubuntu/Debian:</p>
<ul>
<li><a href="https://wiki.ubuntu.com/Kernel/Systemtap">Ubuntu Wiki - Systemtap</a></li>
<li><a href="https://blog.jeffli.me/blog/2014/10/10/install-systemtap-in-ubuntu-14-dot-04/">Install SystemTap in Ubuntu 14.04</a></li>
</ul>
</blockquote>
<h4 id="install-nginx-on-centos-7">Install Nginx on CentOS 7</h4>
<h6 id="pre-installation-tasks">Pre installation tasks</h6>
<p>Set NGINX version (I use stable and newest release):</p>
<pre><code class="language-bash">export ngx_version="1.16.0"
</code></pre>
<p>Set temporary variables:</p>
<pre><code class="language-bash">ngx_src="../../usr/local/src"
ngx_base="${ngx_src}/nginx-${ngx_version}"
ngx_master="${ngx_base}/master"
ngx_modules="${ngx_base}/modules"
</code></pre>
<p>Create directories:</p>
<pre><code class="language-bash">for i in "$ngx_base" "${ngx_master}" "$ngx_modules" ; do

  mkdir "$i"

done
</code></pre>
<h6 id="install-or-build-dependencies">Install or build dependencies</h6>
<blockquote>
<p>In my configuration I used all prebuilt dependencies without <code>libssl-dev</code>, <code>zlib1g-dev</code>, <code>libluajit-5.1-dev</code> and <code>libpcre2-dev</code> because I compiled them manually - for TLS 1.3 support and with OpenResty recommendation for LuaJIT.</p>
</blockquote>
<p><strong>Install prebuilt packages, export variables and set symbolic link:</strong></p>
<pre><code class="language-bash"># It's important and required, regardless of chosen sources:
yum install gcc gcc-c++ kernel-devel bison perl perl-devel perl-ExtUtils-Embed libxslt libxslt-devel gd gd-devel GeoIP-devel libxml2-devel expat-devel gperftools-devel cpio gettext-devel autoconf jq

# In this example we use sources for all below packages so we do not install them:
yum install openssl-devel zlib-devel pcre-devel luajit-devel

# For LuaJIT (libluajit-5.1-dev):
export LUAJIT_LIB="../../usr/local/x86_64-linux-gnu"
export LUAJIT_INC="../../usr/include/luajit-2.1"

ln -s /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2 /usr/local/lib/liblua.so
</code></pre>
<blockquote>
<p>Remember to build <a href="#sregex"><code>sregex</code></a> also if you use above steps.</p>
</blockquote>
<p><strong>Or download and compile them:</strong></p>
<p>PCRE:</p>
<pre><code class="language-bash">cd "${ngx_src}"

export pcre_version="8.42"

export PCRE_SRC="${ngx_src}/pcre-${pcre_version}"
export PCRE_LIB="../../usr/local/lib"
export PCRE_INC="../../usr/local/include"

wget https://ftp.pcre.org/pub/pcre/pcre-${pcre_version}.tar.gz &amp;&amp; tar xzvf pcre-${pcre_version}.tar.gz

cd "$PCRE_SRC"

./configure

make -j2 &amp;&amp; make test
make install
</code></pre>
<p>Zlib:</p>
<pre><code class="language-bash"># I recommend to use Cloudflare Zlib version (cloudflare/zlib) instead an original Zlib (zlib.net), but both installation methods are similar:
cd "${ngx_src}"

export ZLIB_SRC="${ngx_src}/zlib"
export ZLIB_LIB="../../usr/local/lib"
export ZLIB_INC="../../usr/local/include"

# For original Zlib:
#   export zlib_version="1.2.11"
#   wget http://www.zlib.net/zlib-${zlib_version}.tar.gz &amp;&amp; tar xzvf zlib-${zlib_version}.tar.gz
#   cd "${ZLIB_SRC}-${zlib_version}"

# For Cloudflare Zlib:
git clone --depth 1 https://github.com/cloudflare/zlib

cd "$ZLIB_SRC"

./configure

make -j2 &amp;&amp; make test
make install
</code></pre>
<p>OpenSSL:</p>
<pre><code class="language-bash">cd "${ngx_src}"

export openssl_version="1.1.1b"

export OPENSSL_SRC="${ngx_src}/openssl-${openssl_version}"
export OPENSSL_DIR="../../usr/local/openssl-${openssl_version}"
export OPENSSL_LIB="${OPENSSL_DIR}/lib"
export OPENSSL_INC="${OPENSSL_DIR}/include"

wget https://www.openssl.org/source/openssl-${openssl_version}.tar.gz &amp;&amp; tar xzvf openssl-${openssl_version}.tar.gz

cd "${ngx_src}/openssl-${openssl_version}"

# Please run this and add as a compiler param:
export __GCC_SSL=("__SIZEOF_INT128__:enable-ec_nistp_64_gcc_128")

for _cc_opt in "${__GCC_SSL[@]}" ; do

    _cc_key=$(echo "$_cc_opt" | cut -d ":" -f1)
    _cc_value=$(echo "$_cc_opt" | cut -d ":" -f2)

  if [[ ! $(gcc -dM -E - &lt;/dev/null | grep -q "$_cc_key") ]] ; then

    echo -en "$_cc_value is supported on this machine\n"
    _openssl_gcc+="$_cc_value "

  fi

done

./config --prefix="$OPENSSL_DIR" --openssldir="$OPENSSL_DIR" shared zlib no-ssl3 no-weak-ssl-ciphers -DOPENSSL_NO_HEARTBEATS -fstack-protector-strong "$_openssl_gcc"

make -j2 &amp;&amp; make test
make install

# Setup PATH environment variables:
cat &gt; /etc/profile.d/openssl.sh &lt;&lt; __EOF__
#!/bin/sh
export PATH=${OPENSSL_DIR}/bin:${PATH}
export LD_LIBRARY_PATH=${OPENSSL_DIR}/lib:${LD_LIBRARY_PATH}
__EOF__

chmod +x /etc/profile.d/openssl.sh &amp;&amp; source /etc/profile.d/openssl.sh

# To make the OpenSSL 1.1.1b version visible globally first:
mv /usr/bin/openssl /usr/bin/openssl-old
ln -s ${OPENSSL_DIR}/bin/openssl /usr/bin/openssl

cat &gt; /etc/ld.so.conf.d/openssl.conf &lt;&lt; __EOF__
${OPENSSL_DIR}/lib
__EOF__
</code></pre>
<p>LuaJIT:</p>
<pre><code class="language-bash"># I recommend to use OpenResty's branch (openresty/luajit2) instead LuaJIT (LuaJIT/LuaJIT), but both installation methods are similar:
cd "${ngx_src}"

export LUAJIT_SRC="${ngx_src}/luajit2"
export LUAJIT_LIB="../../usr/local/lib"
export LUAJIT_INC="../../usr/local/include/luajit-2.1"

# For originall LuaJIT:
#   git clone http://luajit.org/git/luajit-2.0 luajit2
#   cd "$LUAJIT_SRC"

# For OpenResty's LuaJIT:
git clone --depth 1 https://github.com/openresty/luajit2

cd "$LUAJIT_SRC"

make &amp;&amp; make install

ln -s /usr/local/lib/libluajit-5.1.so.2.1.0 /usr/local/lib/liblua.so
</code></pre>
<p><a id="sregex"></a>sregex:</p>
<blockquote>
<p>Required for <code>replace-filter-nginx-module</code> module.</p>
</blockquote>
<pre><code class="language-bash">cd "${ngx_src}"

git clone --depth 1 https://github.com/openresty/sregex

cd "${ngx_src}/sregex"

make &amp;&amp; make install
</code></pre>
<p>jemalloc:</p>
<blockquote>
<p>To verify <code>jemalloc</code> in use: <code>lsof -n | grep jemalloc</code>.</p>
</blockquote>
<pre><code class="language-bash">cd "${ngx_src}"

export JEMALLOC_SRC="${ngx_src}/jemalloc"
export JEMALLOC_INC="../../usr/local/include/jemalloc"

git clone --depth 1 https://github.com/jemalloc/jemalloc

cd "$JEMALLOC_SRC"

./autogen.sh

make &amp;&amp; make install
</code></pre>
<p>Update links and cache to the shared libraries for both types of installation:</p>
<pre><code class="language-bash">ldconfig
</code></pre>
<h6 id="get-nginx-sources">Get Nginx sources</h6>
<pre><code class="language-bash">cd "${ngx_base}"

wget https://nginx.org/download/nginx-${ngx_version}.tar.gz

# or alternative:
#   git clone --depth 1 https://github.com/nginx/nginx master

tar zxvf nginx-${ngx_version}.tar.gz -C "${ngx_master}" --strip 1
</code></pre>
<h6 id="download-3rd-party-modules">Download 3rd party modules</h6>
<pre><code class="language-bash">cd "${ngx_modules}"

for i in \
https://github.com/simplresty/ngx_devel_kit \
https://github.com/openresty/lua-nginx-module \
https://github.com/openresty/set-misc-nginx-module \
https://github.com/openresty/echo-nginx-module \
https://github.com/openresty/headers-more-nginx-module \
https://github.com/openresty/replace-filter-nginx-module \
https://github.com/openresty/array-var-nginx-module \
https://github.com/openresty/encrypted-session-nginx-module \
https://github.com/vozlt/nginx-module-sysguard \
https://github.com/nginx-clojure/nginx-access-plus \
https://github.com/yaoweibin/ngx_http_substitutions_filter_module \
https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng \
https://github.com/vozlt/nginx-module-vts \
https://github.com/google/ngx_brotli ; do

  git clone --depth 1 "$i"

done

wget http://mdounin.ru/hg/ngx_http_delay_module/archive/tip.tar.gz -O delay-module.tar.gz
mkdir delay-module &amp;&amp; tar xzvf delay-module.tar.gz -C delay-module --strip 1
</code></pre>
<p>For <code>ngx_brotli</code>:</p>
<pre><code class="language-bash">cd "${ngx_modules}/ngx_brotli"

git submodule update --init
</code></pre>
<p>I also use some modules from Tengine:</p>
<ul>
<li><code>ngx_backtrace_module</code></li>
<li><code>ngx_debug_pool</code></li>
<li><code>ngx_debug_timer</code></li>
<li><code>ngx_http_upstream_check_module</code></li>
<li><code>ngx_http_footer_filter_module</code></li>
</ul>
<pre><code class="language-bash">cd "${ngx_modules}"

git clone --depth 1 https://github.com/alibaba/tengine
</code></pre>
<p>If you use NAXSI:</p>
<pre><code class="language-bash">cd "${ngx_modules}"

git clone --depth 1 https://github.com/nbs-system/naxsi
</code></pre>
<h6 id="build-nginx">Build Nginx</h6>
<pre><code class="language-bash">cd "${ngx_master}"

# - you can also build NGINX without 3rd party modules
# - remember about compiler and linker options
# - don't set values for --with-openssl, --with-pcre, and --with-zlib if you select prebuilt packages for them
./configure --prefix=/etc/nginx \
            --conf-path=/etc/nginx/nginx.conf \
            --sbin-path=/usr/sbin/nginx \
            --pid-path=/var/run/nginx.pid \
            --lock-path=/var/run/nginx.lock \
            --user=nginx \
            --group=nginx \
            --modules-path=/etc/nginx/modules \
            --error-log-path=/var/log/nginx/error.log \
            --http-log-path=/var/log/nginx/access.log \
            --http-client-body-temp-path=/var/cache/nginx/client_temp \
            --http-proxy-temp-path=/var/cache/nginx/proxy_temp \
            --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \
            --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \
            --http-scgi-temp-path=/var/cache/nginx/scgi_temp \
            --with-compat \
            --with-debug \
            --with-file-aio \
            --with-threads \
            --with-stream \
            --with-stream_realip_module \
            --with-stream_ssl_module \
            --with-stream_ssl_preread_module \
            --with-http_addition_module \
            --with-http_auth_request_module \
            --with-http_degradation_module \
            --with-http_geoip_module \
            --with-http_gunzip_module \
            --with-http_gzip_static_module \
            --with-http_image_filter_module \
            --with-http_perl_module \
            --with-http_random_index_module \
            --with-http_realip_module \
            --with-http_secure_link_module \
            --with-http_ssl_module \
            --with-http_stub_status_module \
            --with-http_sub_module \
            --with-http_v2_module \
            --with-google_perftools_module \
            --with-openssl=${OPENSSL_SRC} \
            --with-openssl-opt="shared zlib no-ssl3 no-weak-ssl-ciphers -DOPENSSL_NO_HEARTBEATS -fstack-protector-strong ${_openssl_gcc}" \
            --with-pcre=${PCRE_SRC} \
            --with-pcre-jit \
            --with-zlib=${ZLIB_SRC} \
            --without-http-cache \
            --without-http_memcached_module \
            --without-mail_pop3_module \
            --without-mail_imap_module \
            --without-mail_smtp_module \
            --without-http_fastcgi_module \
            --without-http_scgi_module \
            --without-http_uwsgi_module \
            --add-module=${ngx_modules}/ngx_devel_kit \
            --add-module=${ngx_modules}/encrypted-session-nginx-module \
            --add-module=${ngx_modules}/nginx-access-plus/src/c \
            --add-module=${ngx_modules}/ngx_http_substitutions_filter_module \
            --add-module=${ngx_modules}/nginx-sticky-module-ng \
            --add-module=${ngx_modules}/nginx-module-vts \
            --add-module=${ngx_modules}/ngx_brotli \
            --add-module=${ngx_modules}/tengine/modules/ngx_backtrace_module \
            --add-module=${ngx_modules}/tengine/modules/ngx_debug_pool \
            --add-module=${ngx_modules}/tengine/modules/ngx_debug_timer \
            --add-module=${ngx_modules}/tengine/modules/ngx_http_footer_filter_module \
            --add-module=${ngx_modules}/tengine/modules/ngx_http_upstream_check_module \
            --add-module=${ngx_modules}/tengine/modules/ngx_slab_stat \
            --add-dynamic-module=${ngx_modules}/lua-nginx-module \
            --add-dynamic-module=${ngx_modules}/set-misc-nginx-module \
            --add-dynamic-module=${ngx_modules}/echo-nginx-module \
            --add-dynamic-module=${ngx_modules}/headers-more-nginx-module \
            --add-dynamic-module=${ngx_modules}/replace-filter-nginx-module \
            --add-dynamic-module=${ngx_modules}/array-var-nginx-module \
            --add-dynamic-module=${ngx_modules}/nginx-module-sysguard \
            --add-dynamic-module=${ngx_modules}/delay-module \
            --add-dynamic-module=${ngx_modules}/naxsi/naxsi_src \
            --with-cc-opt="-I/usr/local/include -m64 -march=native -DTCP_FASTOPEN=23 -g -O3 -fstack-protector-strong -flto -fuse-ld=gold --param=ssp-buffer-size=4 -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wno-deprecated-declarations -gsplit-dwarf" \
            --with-ld-opt="-L/usr/local/lib -ljemalloc -Wl,-lpcre -Wl,-z,relro -Wl,-rpath,/usr/local/lib"

make -j2 &amp;&amp; make test
make install

ldconfig
</code></pre>
<p>Check NGINX version:</p>
<pre><code class="language-bash">nginx -v
nginx version: nginx/1.16.0
</code></pre>
<p>And list all files in <code>/etc/nginx</code>:</p>
<pre><code class="language-bash">.
├── fastcgi.conf
├── fastcgi.conf.default
├── fastcgi_params
├── fastcgi_params.default
├── html
│&nbsp;&nbsp; ├── 50x.html
│&nbsp;&nbsp; └── index.html
├── koi-utf
├── koi-win
├── mime.types
├── mime.types.default
├── modules
│&nbsp;&nbsp; ├── ngx_http_array_var_module.so
│&nbsp;&nbsp; ├── ngx_http_delay_module.so
│&nbsp;&nbsp; ├── ngx_http_echo_module.so
│&nbsp;&nbsp; ├── ngx_http_headers_more_filter_module.so
│&nbsp;&nbsp; ├── ngx_http_lua_module.so
│&nbsp;&nbsp; ├── ngx_http_naxsi_module.so
│&nbsp;&nbsp; ├── ngx_http_replace_filter_module.so
│&nbsp;&nbsp; ├── ngx_http_set_misc_module.so
│&nbsp;&nbsp; └── ngx_http_sysguard_module.so
├── nginx.conf
├── nginx.conf.default
├── scgi_params
├── scgi_params.default
├── uwsgi_params
├── uwsgi_params.default
└── win-utf

2 directories, 26 files
</code></pre>
<h6 id="post-installation-tasks">Post installation tasks</h6>
<p>Create a system user/group:</p>
<pre><code class="language-bash"># Ubuntu/Debian
adduser --system --home /non-existent --no-create-home --shell /usr/sbin/nologin --disabled-login --disabled-password --gecos "nginx user" --group nginx

# RedHat/CentOS
groupadd -r -g 920 nginx

useradd --system --home-dir /non-existent --no-create-home --shell /usr/sbin/nologin --uid 920 --gid nginx nginx

passwd -l nginx
</code></pre>
<p>Create required directories:</p>
<pre><code class="language-bash">for i in \
/var/www \
/var/log/nginx \
/var/cache/nginx ; do

  mkdir -p "$i" &amp;&amp; chown -R nginx:nginx "$i"

done
</code></pre>
<p>Include the necessary error pages:</p>
<blockquote>
<p>You can also define them e.g. in <code>/etc/nginx/errors.conf</code> or other file and attach it as needed in server contexts.</p>
</blockquote>
<ul>
<li>default location: <code>/etc/nginx/html</code> <pre><code class="language-bash">50x.html  index.html
</code></pre> </li>
</ul>
<p>Update modules list and include <code>modules.conf</code> to your configuration:</p>
<pre><code class="language-bash">_mod_dir="../../etc/nginx/modules"

:&gt;"${_mod_dir}.conf"

for _module in $(ls "${_mod_dir}/") ; do echo -en "load_module\t\t${_mod_dir}/$_module;\n" &gt;&gt; "${_mod_dir}.conf" ; done
</code></pre>
<p>Create <code>logrotate</code> configuration:</p>
<pre><code class="language-bash">cat &gt; /etc/logrotate.d/nginx &lt;&lt; __EOF__
/var/log/nginx/*.log {
  daily
  missingok
  rotate 14
  compress
  delaycompress
  notifempty
  create 0640 nginx nginx
  sharedscripts
  prerotate
    if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
      run-parts /etc/logrotate.d/httpd-prerotate; \
    fi \
  endscript
  postrotate
    invoke-rc.d nginx reload &gt;/dev/null 2&gt;&amp;1
  endscript
}
__EOF__
</code></pre>
<p>Add systemd service:</p>
<pre><code class="language-bash">cat &gt; /lib/systemd/system/nginx.service &lt;&lt; __EOF__
# Stop dance for nginx
# =======================
#
# ExecStop sends SIGSTOP (graceful stop) to the nginx process.
# If, after 5s (--retry QUIT/5) nginx is still running, systemd takes control
# and sends SIGTERM (fast shutdown) to the main process.
# After another 5s (TimeoutStopSec=5), and if nginx is alive, systemd sends
# SIGKILL to all the remaining processes in the process group (KillMode=mixed).
#
# nginx signals reference doc:
# http://nginx.org/en/docs/control.html
#
[Unit]
Description=A high performance web server and a reverse proxy server
Documentation=man:nginx(8)
After=network.target

[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t -q -g 'daemon on; master_process on;'
ExecStart=/usr/sbin/nginx -g 'daemon on; master_process on;'
ExecReload=/usr/sbin/nginx -g 'daemon on; master_process on;' -s reload
ExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid
TimeoutStopSec=5
KillMode=mixed

[Install]
WantedBy=multi-user.target
__EOF__
</code></pre>
<p>Reload systemd manager configuration:</p>
<pre><code class="language-bash">systemctl daemon-reload
</code></pre>
<p>Enable NGINX service:</p>
<pre><code class="language-bash">systemctl enable nginx
</code></pre>
<p>Test NGINX configuration:</p>
<pre><code class="language-bash">nginx -t -c /etc/nginx/nginx.conf
</code></pre>
<h4 id="install-openresty-on-centos-7">Install OpenResty on CentOS 7</h4>
<blockquote>
<p><em>OpenResty is a full-fledged web application server by bundling the standard nginx core, lots of 3rd-party nginx modules, as well as most of their external dependencies.</em></p>
<p><em>This bundle is maintained by Yichun Zhang (<a href="https://github.com/agentzh">agentzh</a>).</em></p>
</blockquote>
<ul>
<li>Official github repository: <a href="https://github.com/openresty/openresty">OpenResty</a></li>
<li>Official website: <a href="https://openresty.org/en/">OpenResty</a></li>
<li>Official documentations: <a href="https://openresty.org/en/getting-started.html">OpenResty Getting Started</a> and <a href="https://openresty.org/en/ebooks.html">OpenResty eBooks</a></li>
</ul>
<p>OpenResty is a more than web server. I would call it a superset of the NGINX web server. OpenResty comes with LuaJIT, a just-in-time compiler for the Lua scripting language and many Lua libraries, lots of high quality 3rd-party NGINX modules, and most of their external dependencies.</p>
<p>OpenResty has good quality and performance. For me, the ability to run Lua scripts from within is also really great.</p>
<details>
<summary><b>Show step-by-step OpenResty installation</b></summary>
<br>
<ul>
<li><a href="#pre-installation-tasks-1">Pre installation tasks</a></li>
<li><a href="#install-or-build-dependencies-1">Install or build dependencies</a></li>
<li><a href="#get-openresty-sources-1">Get OpenResty sources</a></li>
<li><a href="#download-3rd-party-modules-1">Download 3rd party modules</a></li>
<li><a href="#build-openresty">Build OpenResty</a></li>
<li><a href="#post-installation-tasks-1">Post installation tasks</a></li>
</ul>
<h6 id="pre-installation-tasks-1">Pre installation tasks</h6>
<p>Set the OpenResty version (I use newest and stable release):</p>
<pre><code class="language-bash">export ngx_version="1.15.8.1"
</code></pre>
<p>Set temporary variables:</p>
<pre><code class="language-bash">ngx_src="../../usr/local/src"
ngx_base="${ngx_src}/openresty-${ngx_version}"
ngx_master="${ngx_base}/master"
ngx_modules="${ngx_base}/modules"
</code></pre>
<p>Create directories:</p>
<pre><code class="language-bash">for i in "$ngx_base" "${ngx_master}" "$ngx_modules" ; do

  mkdir "$i"

done
</code></pre>
<h6 id="install-or-build-dependencies-1">Install or build dependencies</h6>
<blockquote>
<p>In my configuration I used all prebuilt dependencies without <code>libssl-dev</code>, <code>zlib1g-dev</code>, and <code>libpcre2-dev</code> because I compiled them manually - for TLS 1.3 support. In addition, LuaJIT comes with OpenResty.</p>
</blockquote>
<p><strong>Install prebuilt packages, export variables and set symbolic link:</strong></p>
<pre><code class="language-bash"># It's important and required, regardless of chosen sources:
yum install gcc gcc-c++ kernel-devel bison perl perl-devel perl-ExtUtils-Embed libxslt libxslt-devel gd gd-devel GeoIP-devel libxml2-devel expat-devel gperftools-devel cpio gettext-devel autoconf jq

# In this example we use sources for all below packages so we do not install them:
yum install openssl-devel zlib-devel pcre-devel
</code></pre>
<blockquote>
<p>Remember to build <a href="#sregex"><code>sregex</code></a> also if you use above steps.</p>
</blockquote>
<p><strong>Or download and compile them:</strong></p>
<p>PCRE:</p>
<pre><code class="language-bash">cd "${ngx_src}"

export pcre_version="8.42"

export PCRE_SRC="${ngx_base}/pcre-${pcre_version}"
export PCRE_LIB="../../usr/local/lib"
export PCRE_INC="../../usr/local/include"

wget https://ftp.pcre.org/pub/pcre/pcre-${pcre_version}.tar.gz &amp;&amp; tar xzvf pcre-${pcre_version}.tar.gz

cd "$PCRE_SRC"

./configure

make -j2 &amp;&amp; make test
make install
</code></pre>
<p>Zlib:</p>
<pre><code class="language-bash"># I recommend to use Cloudflare Zlib version (cloudflare/zlib) instead an original Zlib (zlib.net), but both installation methods are similar:
cd "${ngx_src}"

export ZLIB_SRC="${ngx_src}/zlib"
export ZLIB_LIB="../../usr/local/lib"
export ZLIB_INC="../../usr/local/include"

# For original Zlib:
#   export zlib_version="1.2.11"
#   wget http://www.zlib.net/zlib-${zlib_version}.tar.gz &amp;&amp; tar xzvf zlib-${zlib_version}.tar.gz
#   cd "${ZLIB_SRC}-${zlib_version}"

# For Cloudflare Zlib:
git clone --depth 1 https://github.com/cloudflare/zlib

cd "$ZLIB_SRC"

./configure

make -j2 &amp;&amp; make test
make install
</code></pre>
<p>OpenSSL:</p>
<pre><code class="language-bash">cd "${ngx_src}"

export openssl_version="1.1.1b"

export OPENSSL_SRC="${ngx_src}/openssl-${openssl_version}"
export OPENSSL_DIR="../../usr/local/openssl-${openssl_version}"
export OPENSSL_LIB="${OPENSSL_DIR}/lib"
export OPENSSL_INC="${OPENSSL_DIR}/include"

wget https://www.openssl.org/source/openssl-${openssl_version}.tar.gz &amp;&amp; tar xzvf openssl-${openssl_version}.tar.gz

cd "${ngx_src}/openssl-${openssl_version}"

# Please run this and add as a compiler param:
export __GCC_SSL=("__SIZEOF_INT128__:enable-ec_nistp_64_gcc_128")

for _cc_opt in "${__GCC_SSL[@]}" ; do

    _cc_key=$(echo "$_cc_opt" | cut -d ":" -f1)
    _cc_value=$(echo "$_cc_opt" | cut -d ":" -f2)

  if [[ ! $(gcc -dM -E - &lt;/dev/null | grep -q "$_cc_key") ]] ; then

    echo -en "$_cc_value is supported on this machine\n"
    _openssl_gcc+="$_cc_value "

  fi

done

./config --prefix="$OPENSSL_DIR" --openssldir="$OPENSSL_DIR" shared zlib no-ssl3 no-weak-ssl-ciphers -DOPENSSL_NO_HEARTBEATS -fstack-protector-strong "$_openssl_gcc"

make -j2 &amp;&amp; make test
make install

# Setup PATH environment variables:
cat &gt; /etc/profile.d/openssl.sh &lt;&lt; __EOF__
#!/bin/sh
export PATH=${OPENSSL_DIR}/bin:${PATH}
export LD_LIBRARY_PATH=${OPENSSL_DIR}/lib:${LD_LIBRARY_PATH}
__EOF__

chmod +x /etc/profile.d/openssl.sh &amp;&amp; source /etc/profile.d/openssl.sh

# To make the OpenSSL 1.1.1b version visible globally first:
mv /usr/bin/openssl /usr/bin/openssl-old
ln -s ${OPENSSL_DIR}/bin/openssl /usr/bin/openssl

cat &gt; /etc/ld.so.conf.d/openssl.conf &lt;&lt; __EOF__
${OPENSSL_DIR}/lib
__EOF__
</code></pre>
<p><a id="sregex"></a>sregex:</p>
<blockquote>
<p>Required for <code>replace-filter-nginx-module</code> module.</p>
</blockquote>
<pre><code class="language-bash">cd "${ngx_src}"

git clone --depth 1 https://github.com/openresty/sregex

cd "${ngx_src}/sregex"

make &amp;&amp; make install
</code></pre>
<p>jemalloc:</p>
<blockquote>
<p>To verify <code>jemalloc</code> in use: <code>lsof -n | grep jemalloc</code>.</p>
</blockquote>
<pre><code class="language-bash">cd "${ngx_src}"

export JEMALLOC_SRC="../../usr/local/src/jemalloc"
export JEMALLOC_INC="../../usr/local/include/jemalloc"

git clone --depth 1 https://github.com/jemalloc/jemalloc

cd "$JEMALLOC_SRC"

./autogen.sh

make &amp;&amp; make install
</code></pre>
<p>Update links and cache to the shared libraries for both types of installation:</p>
<pre><code class="language-bash">ldconfig
</code></pre>
<h6 id="get-openresty-sources">Get OpenResty sources</h6>
<pre><code class="language-bash">cd "${ngx_base}"

wget https://openresty.org/download/openresty-${ngx_version}.tar.gz

tar zxvf openresty-${ngx_version}.tar.gz -C "${ngx_master}" --strip 1
</code></pre>
<h6 id="download-3rd-party-modules-1">Download 3rd party modules</h6>
<pre><code class="language-bash">cd "${ngx_modules}"

for i in \
https://github.com/openresty/replace-filter-nginx-module \
https://github.com/vozlt/nginx-module-sysguard \
https://github.com/nginx-clojure/nginx-access-plus \
https://github.com/yaoweibin/ngx_http_substitutions_filter_module \
https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng \
https://github.com/vozlt/nginx-module-vts \
https://github.com/google/ngx_brotli ; do

  git clone --depth 1 "$i"

done

wget http://mdounin.ru/hg/ngx_http_delay_module/archive/tip.tar.gz -O delay-module.tar.gz
mkdir delay-module &amp;&amp; tar xzvf delay-module.tar.gz -C delay-module --strip 1
</code></pre>
<p>For <code>ngx_brotli</code>:</p>
<pre><code class="language-bash">cd "${ngx_modules}/ngx_brotli"

git submodule update --init
</code></pre>
<p>I also use some modules from Tengine:</p>
<ul>
<li><code>ngx_backtrace_module</code></li>
<li><code>ngx_debug_pool</code></li>
<li><code>ngx_debug_timer</code></li>
<li><code>ngx_http_upstream_check_module</code></li>
<li><code>ngx_http_footer_filter_module</code></li>
</ul>
<pre><code class="language-bash">cd "${ngx_modules}"

git clone --depth 1 https://github.com/alibaba/tengine
</code></pre>
<p>If you use NAXSI:</p>
<pre><code class="language-bash">cd "${ngx_modules}"

git clone --depth 1 https://github.com/nbs-system/naxsi
</code></pre>
<h6 id="build-openresty">Build OpenResty</h6>
<pre><code class="language-bash">cd "${ngx_master}"

# - you can also build OpenResty without 3rd party modules
# - remember about compiler and linker options
# - don't set values for --with-openssl, --with-pcre, and --with-zlib if you select prebuilt packages for them
./configure --prefix=/etc/nginx \
            --conf-path=/etc/nginx/nginx.conf \
            --sbin-path=/usr/sbin/nginx \
            --pid-path=/var/run/nginx.pid \
            --lock-path=/var/run/nginx.lock \
            --user=nginx \
            --group=nginx \
            --modules-path=/etc/nginx/modules \
            --error-log-path=/var/log/nginx/error.log \
            --http-log-path=/var/log/nginx/access.log \
            --http-client-body-temp-path=/var/cache/nginx/client_temp \
            --http-proxy-temp-path=/var/cache/nginx/proxy_temp \
            --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \
            --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \
            --http-scgi-temp-path=/var/cache/nginx/scgi_temp \
            --with-compat \
            --with-debug \
            --with-file-aio \
            --with-threads \
            --with-stream \
            --with-stream_geoip_module \
            --with-stream_realip_module \
            --with-stream_ssl_module \
            --with-stream_ssl_preread_module \
            --with-http_addition_module \
            --with-http_auth_request_module \
            --with-http_degradation_module \
            --with-http_geoip_module \
            --with-http_gunzip_module \
            --with-http_gzip_static_module \
            --with-http_image_filter_module \
            --with-http_perl_module \
            --with-http_random_index_module \
            --with-http_realip_module \
            --with-http_secure_link_module \
            --with-http_slice_module \
            --with-http_ssl_module \
            --with-http_stub_status_module \
            --with-http_sub_module \
            --with-http_v2_module \
            --with-google_perftools_module \
            --with-luajit \
            --with-openssl=${OPENSSL_SRC} \
            --with-openssl-opt="shared zlib no-ssl3 no-weak-ssl-ciphers -DOPENSSL_NO_HEARTBEATS -fstack-protector-strong ${_openssl_gcc}" \
            --with-pcre=${PCRE_SRC} \
            --with-pcre-jit \
            --with-zlib=${ZLIB_SRC} \
            --without-http-cache \
            --without-http_memcached_module \
            --without-http_redis2_module \
            --without-http_redis_module \
            --without-http_rds_json_module \
            --without-http_rds_csv_module \
            --without-lua_redis_parser \
            --without-lua_rds_parser \
            --without-lua_resty_redis \
            --without-lua_resty_memcached \
            --without-lua_resty_mysql \
            --without-lua_resty_websocket \
            --without-mail_pop3_module \
            --without-mail_imap_module \
            --without-mail_smtp_module \
            --without-http_fastcgi_module \
            --without-http_scgi_module \
            --without-http_uwsgi_module \
            --add-module=${ngx_modules}/nginx-access-plus/src/c \
            --add-module=${ngx_modules}/ngx_http_substitutions_filter_module \
            --add-module=${ngx_modules}/nginx-module-vts \
            --add-module=${ngx_modules}/ngx_brotli \
            --add-module=${ngx_modules}/tengine/modules/ngx_backtrace_module \
            --add-module=${ngx_modules}/tengine/modules/ngx_debug_pool \
            --add-module=${ngx_modules}/tengine/modules/ngx_debug_timer \
            --add-module=${ngx_modules}/tengine/modules/ngx_http_footer_filter_module \
            --add-module=${ngx_modules}/tengine/modules/ngx_http_upstream_check_module \
            --add-module=${ngx_modules}/tengine/modules/ngx_slab_stat \
            --add-dynamic-module=${ngx_modules}/replace-filter-nginx-module \
            --add-dynamic-module=${ngx_modules}/nginx-module-sysguard \
            --add-dynamic-module=${ngx_modules}/delay-module \
            --add-dynamic-module=${ngx_modules}/naxsi/naxsi_src \
            --with-cc-opt="-I/usr/local/include -m64 -march=native -DTCP_FASTOPEN=23 -g -O3 -fstack-protector-strong -flto -fuse-ld=gold --param=ssp-buffer-size=4 -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wno-deprecated-declarations -gsplit-dwarf" \
            --with-ld-opt="-L/usr/local/lib -ljemalloc -Wl,-lpcre -Wl,-z,relro -Wl,-rpath,/usr/local/lib"

make &amp;&amp; make test
make install

ldconfig
</code></pre>
<p>Check OpenResty version:</p>
<pre><code class="language-bash">nginx -v
nginx version: openresty/1.15.8.1
</code></pre>
<p>And list all files in <code>/etc/nginx</code>:</p>
<pre><code class="language-bash">.
├── bin
│&nbsp;&nbsp; ├── md2pod.pl
│&nbsp;&nbsp; ├── nginx-xml2pod
│&nbsp;&nbsp; ├── openresty -&gt; /usr/sbin/nginx
│&nbsp;&nbsp; ├── opm
│&nbsp;&nbsp; ├── resty
│&nbsp;&nbsp; ├── restydoc
│&nbsp;&nbsp; └── restydoc-index
├── COPYRIGHT
├── fastcgi.conf
├── fastcgi.conf.default
├── fastcgi_params
├── fastcgi_params.default
├── koi-utf
├── koi-win
├── luajit
│&nbsp;&nbsp; ├── bin
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── luajit -&gt; luajit-2.1.0-beta3
│&nbsp;&nbsp; │&nbsp;&nbsp; └── luajit-2.1.0-beta3
│&nbsp;&nbsp; ├── include
│&nbsp;&nbsp; │&nbsp;&nbsp; └── luajit-2.1
│&nbsp;&nbsp; │&nbsp;&nbsp;     ├── lauxlib.h
│&nbsp;&nbsp; │&nbsp;&nbsp;     ├── luaconf.h
│&nbsp;&nbsp; │&nbsp;&nbsp;     ├── lua.h
│&nbsp;&nbsp; │&nbsp;&nbsp;     ├── lua.hpp
│&nbsp;&nbsp; │&nbsp;&nbsp;     ├── luajit.h
│&nbsp;&nbsp; │&nbsp;&nbsp;     └── lualib.h
│&nbsp;&nbsp; ├── lib
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── libluajit-5.1.a
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── libluajit-5.1.so -&gt; libluajit-5.1.so.2.1.0
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── libluajit-5.1.so.2 -&gt; libluajit-5.1.so.2.1.0
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── libluajit-5.1.so.2.1.0
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── 5.1
│&nbsp;&nbsp; │&nbsp;&nbsp; └── pkgconfig
│&nbsp;&nbsp; │&nbsp;&nbsp;     └── luajit.pc
│&nbsp;&nbsp; └── share
│&nbsp;&nbsp;     ├── lua
│&nbsp;&nbsp;     │&nbsp;&nbsp; └── 5.1
│&nbsp;&nbsp;     ├── luajit-2.1.0-beta3
│&nbsp;&nbsp;     │&nbsp;&nbsp; └── jit
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── bc.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── bcsave.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_arm64be.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_arm64.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_arm.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_mips64el.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_mips64.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_mipsel.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_mips.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_ppc.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_x64.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dis_x86.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── dump.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── p.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── v.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     ├── vmdef.lua
│&nbsp;&nbsp;     │&nbsp;&nbsp;     └── zone.lua
│&nbsp;&nbsp;     └── man
│&nbsp;&nbsp;         └── man1
│&nbsp;&nbsp;             └── luajit.1
├── lualib
│&nbsp;&nbsp; ├── cjson.so
│&nbsp;&nbsp; ├── librestysignal.so
│&nbsp;&nbsp; ├── ngx
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── balancer.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── base64.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── errlog.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ocsp.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── pipe.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── process.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── re.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── resp.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── semaphore.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ssl
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── session.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; └── ssl.lua
│&nbsp;&nbsp; ├── resty
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── aes.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── core
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── base64.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── base.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── ctx.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── exit.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── hash.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── misc.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── ndk.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── phase.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── regex.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── request.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── response.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── shdict.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── time.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── uri.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── utils.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── var.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── worker.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── core.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── dns
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── resolver.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── limit
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── conn.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── count.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── req.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── traffic.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── lock.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── lrucache
│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── pureffi.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── lrucache.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── md5.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── random.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── sha1.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── sha224.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── sha256.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── sha384.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── sha512.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── sha.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── shell.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── signal.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── string.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── upload.lua
│&nbsp;&nbsp; │&nbsp;&nbsp; └── upstream
│&nbsp;&nbsp; │&nbsp;&nbsp;     └── healthcheck.lua
│&nbsp;&nbsp; └── tablepool.lua
├── mime.types
├── mime.types.default
├── modules
│&nbsp;&nbsp; ├── ngx_http_delay_module.so
│&nbsp;&nbsp; ├── ngx_http_naxsi_module.so
│&nbsp;&nbsp; ├── ngx_http_replace_filter_module.so
│&nbsp;&nbsp; └── ngx_http_sysguard_module.so
├── nginx
│&nbsp;&nbsp; └── html
│&nbsp;&nbsp;     ├── 50x.html
│&nbsp;&nbsp;     └── index.html
├── nginx.conf
├── nginx.conf.default
├── pod
│&nbsp;&nbsp; ├── array-var-nginx-module-0.05
│&nbsp;&nbsp; │&nbsp;&nbsp; └── array-var-nginx-module-0.05.pod
│&nbsp;&nbsp; ├── drizzle-nginx-module-0.1.11
│&nbsp;&nbsp; │&nbsp;&nbsp; └── drizzle-nginx-module-0.1.11.pod
│&nbsp;&nbsp; ├── echo-nginx-module-0.61
│&nbsp;&nbsp; │&nbsp;&nbsp; └── echo-nginx-module-0.61.pod
│&nbsp;&nbsp; ├── encrypted-session-nginx-module-0.08
│&nbsp;&nbsp; │&nbsp;&nbsp; └── encrypted-session-nginx-module-0.08.pod
│&nbsp;&nbsp; ├── form-input-nginx-module-0.12
│&nbsp;&nbsp; │&nbsp;&nbsp; └── form-input-nginx-module-0.12.pod
│&nbsp;&nbsp; ├── headers-more-nginx-module-0.33
│&nbsp;&nbsp; │&nbsp;&nbsp; └── headers-more-nginx-module-0.33.pod
│&nbsp;&nbsp; ├── iconv-nginx-module-0.14
│&nbsp;&nbsp; │&nbsp;&nbsp; └── iconv-nginx-module-0.14.pod
│&nbsp;&nbsp; ├── lua-5.1.5
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-5.1.5.pod
│&nbsp;&nbsp; ├── lua-cjson-2.1.0.7
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-cjson-2.1.0.7.pod
│&nbsp;&nbsp; ├── luajit-2.1
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── changes.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── contact.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ext_c_api.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── extensions.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ext_ffi_api.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ext_ffi.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ext_ffi_semantics.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ext_ffi_tutorial.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ext_jit.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ext_profiler.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── faq.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── install.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── luajit-2.1.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── running.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; └── status.pod
│&nbsp;&nbsp; ├── luajit-2.1-20190507
│&nbsp;&nbsp; │&nbsp;&nbsp; └── luajit-2.1-20190507.pod
│&nbsp;&nbsp; ├── lua-rds-parser-0.06
│&nbsp;&nbsp; ├── lua-redis-parser-0.13
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-redis-parser-0.13.pod
│&nbsp;&nbsp; ├── lua-resty-core-0.1.17
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── lua-resty-core-0.1.17.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.balancer.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.base64.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.errlog.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.ocsp.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.pipe.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.process.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.re.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.resp.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.semaphore.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx.ssl.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; └── ngx.ssl.session.pod
│&nbsp;&nbsp; ├── lua-resty-dns-0.21
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-dns-0.21.pod
│&nbsp;&nbsp; ├── lua-resty-limit-traffic-0.06
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── lua-resty-limit-traffic-0.06.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── resty.limit.conn.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── resty.limit.count.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── resty.limit.req.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; └── resty.limit.traffic.pod
│&nbsp;&nbsp; ├── lua-resty-lock-0.08
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-lock-0.08.pod
│&nbsp;&nbsp; ├── lua-resty-lrucache-0.09
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-lrucache-0.09.pod
│&nbsp;&nbsp; ├── lua-resty-memcached-0.14
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-memcached-0.14.pod
│&nbsp;&nbsp; ├── lua-resty-mysql-0.21
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-mysql-0.21.pod
│&nbsp;&nbsp; ├── lua-resty-redis-0.27
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-redis-0.27.pod
│&nbsp;&nbsp; ├── lua-resty-shell-0.02
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-shell-0.02.pod
│&nbsp;&nbsp; ├── lua-resty-signal-0.02
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-signal-0.02.pod
│&nbsp;&nbsp; ├── lua-resty-string-0.11
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-string-0.11.pod
│&nbsp;&nbsp; ├── lua-resty-upload-0.10
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-upload-0.10.pod
│&nbsp;&nbsp; ├── lua-resty-upstream-healthcheck-0.06
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-upstream-healthcheck-0.06.pod
│&nbsp;&nbsp; ├── lua-resty-websocket-0.07
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-resty-websocket-0.07.pod
│&nbsp;&nbsp; ├── lua-tablepool-0.01
│&nbsp;&nbsp; │&nbsp;&nbsp; └── lua-tablepool-0.01.pod
│&nbsp;&nbsp; ├── memc-nginx-module-0.19
│&nbsp;&nbsp; │&nbsp;&nbsp; └── memc-nginx-module-0.19.pod
│&nbsp;&nbsp; ├── nginx
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── accept_failed.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── beginners_guide.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── chunked_encoding_from_backend.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── configure.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── configuring_https_servers.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── contributing_changes.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── control.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── converting_rewrite_rules.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── daemon_master_process_off.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── debugging_log.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── development_guide.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── events.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── example.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── faq.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── freebsd_tuning.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── hash.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── howto_build_on_win32.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── install.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── license_copyright.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── load_balancing.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── nginx_dtrace_pid_provider.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── nginx.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_core_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_google_perftools_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_access_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_addition_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_api_module_head.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_auth_basic_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_auth_jwt_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_auth_request_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_autoindex_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_browser_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_charset_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_core_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_dav_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_empty_gif_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_f4f_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_fastcgi_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_flv_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_geoip_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_geo_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_grpc_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_gunzip_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_gzip_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_gzip_static_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_headers_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_hls_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_image_filter_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_index_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_js_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_keyval_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_limit_conn_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_limit_req_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_log_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_map_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_memcached_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_mirror_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_mp4_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_perl_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_proxy_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_random_index_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_realip_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_referer_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_rewrite_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_scgi_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_secure_link_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_session_log_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_slice_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_spdy_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_split_clients_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_ssi_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_ssl_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_status_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_stub_status_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_sub_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_upstream_conf_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_upstream_hc_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_upstream_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_userid_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_uwsgi_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_v2_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_http_xslt_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_mail_auth_http_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_mail_core_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_mail_imap_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_mail_pop3_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_mail_proxy_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_mail_smtp_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_mail_ssl_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_access_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_core_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_geoip_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_geo_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_js_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_keyval_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_limit_conn_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_log_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_map_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_proxy_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_realip_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_return_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_split_clients_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_ssl_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_ssl_preread_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_upstream_hc_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_upstream_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_stream_zone_sync_module.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── request_processing.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── server_names.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── stream_processing.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── switches.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── syntax.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── sys_errlist.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── syslog.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── variables_in_config.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── websocket.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── welcome_nginx_facebook.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; └── windows.pod
│&nbsp;&nbsp; ├── ngx_coolkit-0.2
│&nbsp;&nbsp; ├── ngx_devel_kit-0.3.1rc1
│&nbsp;&nbsp; │&nbsp;&nbsp; └── ngx_devel_kit-0.3.1rc1.pod
│&nbsp;&nbsp; ├── ngx_lua-0.10.15
│&nbsp;&nbsp; │&nbsp;&nbsp; └── ngx_lua-0.10.15.pod
│&nbsp;&nbsp; ├── ngx_lua_upstream-0.07
│&nbsp;&nbsp; │&nbsp;&nbsp; └── ngx_lua_upstream-0.07.pod
│&nbsp;&nbsp; ├── ngx_postgres-1.0
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── ngx_postgres-1.0.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; └── todo.pod
│&nbsp;&nbsp; ├── ngx_stream_lua-0.0.7
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── dev_notes.pod
│&nbsp;&nbsp; │&nbsp;&nbsp; └── ngx_stream_lua-0.0.7.pod
│&nbsp;&nbsp; ├── opm-0.0.5
│&nbsp;&nbsp; │&nbsp;&nbsp; └── opm-0.0.5.pod
│&nbsp;&nbsp; ├── rds-csv-nginx-module-0.09
│&nbsp;&nbsp; │&nbsp;&nbsp; └── rds-csv-nginx-module-0.09.pod
│&nbsp;&nbsp; ├── rds-json-nginx-module-0.15
│&nbsp;&nbsp; │&nbsp;&nbsp; └── rds-json-nginx-module-0.15.pod
│&nbsp;&nbsp; ├── redis2-nginx-module-0.15
│&nbsp;&nbsp; │&nbsp;&nbsp; └── redis2-nginx-module-0.15.pod
│&nbsp;&nbsp; ├── redis-nginx-module-0.3.7
│&nbsp;&nbsp; ├── resty-cli-0.24
│&nbsp;&nbsp; │&nbsp;&nbsp; └── resty-cli-0.24.pod
│&nbsp;&nbsp; ├── set-misc-nginx-module-0.32
│&nbsp;&nbsp; │&nbsp;&nbsp; └── set-misc-nginx-module-0.32.pod
│&nbsp;&nbsp; ├── srcache-nginx-module-0.31
│&nbsp;&nbsp; │&nbsp;&nbsp; └── srcache-nginx-module-0.31.pod
│&nbsp;&nbsp; └── xss-nginx-module-0.06
│&nbsp;&nbsp;     └── xss-nginx-module-0.06.pod
├── resty.index
├── scgi_params
├── scgi_params.default
├── site
│&nbsp;&nbsp; ├── lualib
│&nbsp;&nbsp; ├── manifest
│&nbsp;&nbsp; └── pod
├── uwsgi_params
├── uwsgi_params.default
└── win-utf

78 directories, 305 files
</code></pre>
<h6 id="post-installation-tasks-1">Post installation tasks</h6>
<blockquote>
<p>Check all post installation tasks from <a href="#post-installation-tasks">Nginx on CentOS 7 - Post installation tasks</a> section.</p>
</blockquote>
</details>
<h4 id="install-tengine-on-ubuntu-1804">Install Tengine on Ubuntu 18.04</h4>
<blockquote>
<p><em>Tengine is a web server originated by Taobao, the largest e-commerce website in Asia. It is based on the NGINX HTTP server and has many advanced features. There’s a lot of features in Tengine that do not (yet) exist in NGINX.</em></p>
</blockquote>
<ul>
<li>Official github repository: <a href="https://github.com/alibaba/tengine">Tengine</a></li>
<li>Official documentation: <a href="https://tengine.taobao.org/documentation.html">Tengine Documentation</a></li>
</ul>
<p>Generally, Tengine is a great solution, including many patches, improvements, additional modules, and most importantly it is very actively maintained.</p>
<p>The build and installation process is very similar to <a href="#install-nginx-on-centos-7">Install Nginx on Centos 7</a>. However, I will only specify the most important changes.</p>
<details>
<summary><b>Show step-by-step Tengine installation</b></summary>
<br>
<ul>
<li><a href="#pre-installation-tasks-2">Pre installation tasks</a></li>
<li><a href="#install-or-build-dependencies-2">Install or build dependencies</a></li>
<li><a href="#get-tengine-sources">Get Tengine sources</a></li>
<li><a href="#download-3rd-party-modules-2">Download 3rd party modules</a></li>
<li><a href="#build-tengine">Build Tengine</a></li>
<li><a href="#post-installation-tasks-2">Post installation tasks</a></li>
</ul>
<h6 id="pre-installation-tasks-2">Pre installation tasks</h6>
<p>Set the Tengine version (I use newest and stable release):</p>
<pre><code class="language-bash">export ngx_version="2.3.0"
</code></pre>
<p>Set temporary variables:</p>
<pre><code class="language-bash">ngx_src="../../usr/local/src"
ngx_base="${ngx_src}/tengine-${ngx_version}"
ngx_master="${ngx_base}/master"
ngx_modules="${ngx_base}/modules"
</code></pre>
<p>Create directories:</p>
<pre><code class="language-bash">for i in "$ngx_base" "${ngx_master}" "$ngx_modules" ; do

  mkdir "$i"

done
</code></pre>
<h6 id="install-or-build-dependencies-2">Install or build dependencies</h6>
<p>Install prebuilt packages, export variables and set symbolic link:</p>
<pre><code class="language-bash">apt-get install gcc make build-essential bison perl libperl-dev libphp-embed libxslt-dev libgd-dev libgeoip-dev libxml2-dev libexpat-dev libgoogle-perftools-dev libgoogle-perftools4 autoconf jq

# In this example we don't use zlib sources:
apt-get install zlib1g-dev
</code></pre>
<p>PCRE:</p>
<pre><code class="language-bash">cd "${ngx_src}"

export pcre_version="8.42"

export PCRE_SRC="${ngx_base}/pcre-${pcre_version}"
export PCRE_LIB="../../usr/local/lib"
export PCRE_INC="../../usr/local/include"

wget https://ftp.pcre.org/pub/pcre/pcre-${pcre_version}.tar.gz &amp;&amp; tar xzvf pcre-${pcre_version}.tar.gz

cd "$PCRE_SRC"

./configure

make -j2 &amp;&amp; make test
make install
</code></pre>
<p>OpenSSL:</p>
<pre><code class="language-bash">cd "${ngx_src}"

export openssl_version="1.1.1b"

export OPENSSL_SRC="${ngx_src}/openssl-${openssl_version}"
export OPENSSL_DIR="../../usr/local/openssl-${openssl_version}"
export OPENSSL_LIB="${OPENSSL_DIR}/lib"
export OPENSSL_INC="${OPENSSL_DIR}/include"

wget https://www.openssl.org/source/openssl-${openssl_version}.tar.gz &amp;&amp; tar xzvf openssl-${openssl_version}.tar.gz

cd "${ngx_src}/openssl-${openssl_version}"

# Please run this and add as a compiler param:
export __GCC_SSL=("__SIZEOF_INT128__:enable-ec_nistp_64_gcc_128")

for _cc_opt in "${__GCC_SSL[@]}" ; do

    _cc_key=$(echo "$_cc_opt" | cut -d ":" -f1)
    _cc_value=$(echo "$_cc_opt" | cut -d ":" -f2)

  if [[ ! $(gcc -dM -E - &lt;/dev/null | grep -q "$_cc_key") ]] ; then

    echo -en "$_cc_value is supported on this machine\n"
    _openssl_gcc+="$_cc_value "

  fi

done

./config --prefix="$OPENSSL_DIR" --openssldir="$OPENSSL_DIR" shared zlib no-ssl3 no-weak-ssl-ciphers -DOPENSSL_NO_HEARTBEATS -fstack-protector-strong "$_openssl_gcc"

make -j2 &amp;&amp; make test
make install

# Setup PATH environment variables:
cat &gt; /etc/profile.d/openssl.sh &lt;&lt; __EOF__
#!/bin/sh
export PATH=${OPENSSL_DIR}/bin:${PATH}
export LD_LIBRARY_PATH=${OPENSSL_DIR}/lib:${LD_LIBRARY_PATH}
__EOF__

chmod +x /etc/profile.d/openssl.sh &amp;&amp; source /etc/profile.d/openssl.sh

# To make the OpenSSL 1.1.1b version visible globally first:
mv /usr/bin/openssl /usr/bin/openssl-old
ln -s ${OPENSSL_DIR}/bin/openssl /usr/bin/openssl

cat &gt; /etc/ld.so.conf.d/openssl.conf &lt;&lt; __EOF__
${OPENSSL_DIR}/lib
__EOF__
</code></pre>
<p>LuaJIT:</p>
<pre><code class="language-bash"># I recommend to use OpenResty's branch (openresty/luajit2) instead LuaJIT (LuaJIT/LuaJIT), but both installation methods are similar:
cd "${ngx_src}"

export LUAJIT_SRC="${ngx_src}/luajit2"
export LUAJIT_LIB="../../usr/local/lib"
export LUAJIT_INC="../../usr/local/include/luajit-2.1"

# For originall LuaJIT:
#   git clone http://luajit.org/git/luajit-2.0 luajit2
#   cd "$LUAJIT_SRC"

# For OpenResty's LuaJIT:
git clone --depth 1 https://github.com/openresty/luajit2

cd "$LUAJIT_SRC"

make &amp;&amp; make install

ln -s /usr/local/lib/libluajit-5.1.so.2.1.0 /usr/local/lib/liblua.so
</code></pre>
<p>sregex:</p>
<blockquote>
<p>Required for <code>replace-filter-nginx-module</code> module.</p>
</blockquote>
<pre><code class="language-bash">cd "${ngx_src}"

git clone --depth 1 https://github.com/openresty/sregex

cd "${ngx_src}/sregex"

make &amp;&amp; make install
</code></pre>
<p>jemalloc:</p>
<blockquote>
<p>To verify <code>jemalloc</code> in use: <code>lsof -n | grep jemalloc</code>.</p>
</blockquote>
<pre><code class="language-bash">cd "${ngx_src}"

export JEMALLOC_SRC="../../usr/local/src/jemalloc"
export JEMALLOC_INC="../../usr/local/include/jemalloc"

git clone --depth 1 https://github.com/jemalloc/jemalloc

cd "$JEMALLOC_SRC"

./autogen.sh

make &amp;&amp; make install
</code></pre>
<p>Update links and cache to the shared libraries for both types of installation:</p>
<pre><code class="language-bash">ldconfig
</code></pre>
<h6 id="get-tengine-sources">Get Tengine sources</h6>
<pre><code class="language-bash">cd "${ngx_base}"

wget https://tengine.taobao.org/download/tengine-${ngx_version}.tar.gz

# or alternative:
#   git clone --depth 1 https://github.com/alibaba/tengine master

tar zxvf tengine-${ngx_version}.tar.gz -C "${ngx_master}"
</code></pre>
<h6 id="download-3rd-party-modules-2">Download 3rd party modules</h6>
<blockquote>
<p>Not all modules from <a href="#3rd-party-modules">this</a> section working properly with Tengine (e.g. <code>ndk_http_module</code> and other dependent on it).</p>
</blockquote>
<pre><code class="language-bash">cd "${ngx_modules}"

for i in \
https://github.com/openresty/echo-nginx-module \
https://github.com/openresty/headers-more-nginx-module \
https://github.com/openresty/replace-filter-nginx-module \
https://github.com/nginx-clojure/nginx-access-plus \
https://github.com/yaoweibin/ngx_http_substitutions_filter_module \
https://github.com/vozlt/nginx-module-vts \
https://github.com/google/ngx_brotli ; do

  git clone --depth 1 "$i"

done

wget http://mdounin.ru/hg/ngx_http_delay_module/archive/tip.tar.gz -O delay-module.tar.gz
mkdir delay-module &amp;&amp; tar xzvf delay-module.tar.gz -C delay-module --strip 1
</code></pre>
<p>For <code>ngx_brotli</code>:</p>
<pre><code class="language-bash">cd "${ngx_modules}/ngx_brotli"

git submodule update --init
</code></pre>
<p>If you use NAXSI:</p>
<pre><code class="language-bash">cd "${ngx_modules}"

git clone --depth 1 https://github.com/nbs-system/naxsi
</code></pre>
<h6 id="build-tengine">Build Tengine</h6>
<pre><code class="language-bash">cd "${ngx_master}"

# - you can also build Tengine without 3rd party modules
# - remember about compiler and linker options
# - don't set values for --with-openssl, --with-pcre, and --with-zlib if you select prebuilt packages for them
./configure --prefix=/etc/nginx \
            --conf-path=/etc/nginx/nginx.conf \
            --sbin-path=/usr/sbin/nginx \
            --pid-path=/var/run/nginx.pid \
            --lock-path=/var/run/nginx.lock \
            --user=nginx \
            --group=nginx \
            --modules-path=/etc/nginx/modules \
            --error-log-path=/var/log/nginx/error.log \
            --http-log-path=/var/log/nginx/access.log \
            --http-client-body-temp-path=/var/cache/nginx/client_temp \
            --http-proxy-temp-path=/var/cache/nginx/proxy_temp \
            --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \
            --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \
            --http-scgi-temp-path=/var/cache/nginx/scgi_temp \
            --with-compat \
            --with-debug \
            --with-file-aio \
            --with-threads \
            --with-stream \
            --with-stream_geoip_module \
            --with-stream_realip_module \
            --with-stream_ssl_module \
            --with-stream_ssl_preread_module \
            --with-http_addition_module \
            --with-http_auth_request_module \
            --with-http_degradation_module \
            --with-http_geoip_module \
            --with-http_gunzip_module \
            --with-http_gzip_static_module \
            --with-http_image_filter_module \
            --with-http_lua_module \
            --with-http_perl_module \
            --with-http_random_index_module \
            --with-http_realip_module \
            --with-http_secure_link_module \
            --with-http_ssl_module \
            --with-http_stub_status_module \
            --with-http_sub_module \
            --with-http_v2_module \
            --with-google_perftools_module \
            --with-openssl=${OPENSSL_SRC} \
            --with-openssl-opt="shared zlib no-ssl3 no-weak-ssl-ciphers -DOPENSSL_NO_HEARTBEATS -fstack-protector-strong ${_openssl_gcc}" \
            --with-pcre=${PCRE_SRC} \
            --with-pcre-jit \
            --with-jemalloc=${JEMALLOC_SRC} \
            --without-http-cache \
            --without-http_memcached_module \
            --without-mail_pop3_module \
            --without-mail_imap_module \
            --without-mail_smtp_module \
            --without-http_fastcgi_module \
            --without-http_scgi_module \
            --without-http_uwsgi_module \
            --without-http_upstream_keepalive_module \
            --add-module=${ngx_master}/modules/ngx_backtrace_module \
            --add-module=${ngx_master}/modules/ngx_debug_pool \
            --add-module=${ngx_master}/modules/ngx_debug_timer \
            --add-module=${ngx_master}/modules/ngx_http_footer_filter_module \
            --add-module=${ngx_master}/modules/ngx_http_lua_module \
            --add-module=${ngx_master}/modules/ngx_http_proxy_connect_module \
            --add-module=${ngx_master}/modules/ngx_http_reqstat_module \
            --add-module=${ngx_master}/modules/ngx_http_slice_module \
            --add-module=${ngx_master}/modules/ngx_http_sysguard_module \
            --add-module=${ngx_master}/modules/ngx_http_trim_filter_module \
            --add-module=${ngx_master}/modules/ngx_http_upstream_check_module \
            --add-module=${ngx_master}/modules/ngx_http_upstream_consistent_hash_module \
            --add-module=${ngx_master}/modules/ngx_http_upstream_dynamic_module \
            --add-module=${ngx_master}/modules/ngx_http_upstream_keepalive_module \
            --add-module=${ngx_master}/modules/ngx_http_upstream_session_sticky_module \
            --add-module=${ngx_master}/modules/ngx_http_user_agent_module \
            --add-module=${ngx_master}/modules/ngx_slab_stat \
            --add-module=${ngx_modules}/nginx-access-plus/src/c \
            --add-module=${ngx_modules}/ngx_http_substitutions_filter_module \
            --add-module=${ngx_modules}/nginx-module-vts \
            --add-module=${ngx_modules}/ngx_brotli \
            --add-dynamic-module=${ngx_modules}/echo-nginx-module \
            --add-dynamic-module=${ngx_modules}/headers-more-nginx-module \
            --add-dynamic-module=${ngx_modules}/replace-filter-nginx-module \
            --add-dynamic-module=${ngx_modules}/delay-module \
            --add-dynamic-module=${ngx_modules}/naxsi/naxsi_src \
            --with-cc-opt="-I/usr/local/include -I${OPENSSL_INC} -I${LUAJIT_INC} -I${JEMALLOC_INC} -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC" \
            --with-ld-opt="-Wl,-E -L/usr/local/lib -ljemalloc -lpcre -Wl,-rpath,/usr/local/lib/,-z,relro -Wl,-z,now -pie"

make -j2 &amp;&amp; make test
make install

ldconfig
</code></pre>
<p>Check Tengine version:</p>
<pre><code class="language-bash">nginx -v
Tengine version: Tengine/2.3.0
nginx version: nginx/1.15.9
</code></pre>
<p>And list all files in <code>/etc/nginx</code>:</p>
<pre><code class="language-bash">tree
.
├── fastcgi.conf
├── fastcgi.conf.default
├── fastcgi_params
├── fastcgi_params.default
├── html
│&nbsp;&nbsp; ├── 50x.html
│&nbsp;&nbsp; └── index.html
├── koi-utf
├── koi-win
├── mime.types
├── mime.types.default
├── modules
│&nbsp;&nbsp; ├── ngx_http_delay_module.so
│&nbsp;&nbsp; ├── ngx_http_echo_module.so
│&nbsp;&nbsp; ├── ngx_http_headers_more_filter_module.so
│&nbsp;&nbsp; ├── ngx_http_naxsi_module.so
│&nbsp;&nbsp; └── ngx_http_replace_filter_module.so
├── nginx.conf
├── nginx.conf.default
├── scgi_params
├── scgi_params.default
├── uwsgi_params
├── uwsgi_params.default
└── win-utf

2 directories, 22 files
</code></pre>
<h6 id="post-installation-tasks-2">Post installation tasks</h6>
<blockquote>
<p>Check all post installation tasks from <a href="#post-installation-tasks">Nginx on CentOS 7 - Post installation tasks</a> section.</p>
</blockquote>
</details>
<h1 id="base-rules">Base Rules</h1>
<p>These are the basic set of rules to keep NGINX in good condition.</p>
<h4 id="organising-nginx-configuration"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Organising Nginx configuration</h4>
<h6 id="rationale">Rationale</h6>
<blockquote>
<p>When your NGINX configuration grow, the need for organising your configuration will also grow. Well organised code is:</p>
<ul>
<li>easier to understand</li>
<li>easier to maintain</li>
<li>easier to work with</li>
</ul>
</blockquote>
<blockquote>
<p>Use <code>include</code> directive to move common server settings into a separate files and to attach your NGINX specific code to global config, contexts and other.</p>
</blockquote>
<h6 id="example">Example</h6>
<pre><code class="language-bash"># Store this configuration in e.g. https-ssl-common.conf
listen 10.240.20.2:443 ssl;

root /etc/nginx/error-pages/other;

ssl_certificate /etc/nginx/domain.com/certs/nginx_domain.com_bundle.crt;
ssl_certificate_key /etc/nginx/domain.com/certs/domain.com.key;

# And include this file in server section:
server {

  include /etc/nginx/domain.com/commons/https-ssl-common.conf;

  server_name domain.com www.domain.com;

  ...
</code></pre>
<h6 id="external-resources-1">External resources</h6>
<ul>
<li><a href="https://kbroman.org/steps2rr/pages/organize.html">Organize your data and code</a></li>
</ul>
<h4 id="format-prettify-and-indent-your-nginx-code"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Format, prettify and indent your Nginx code</h4>
<h6 id="rationale-1">Rationale</h6>
<blockquote>
<p>Work with unreadable configuration files is terrible, if syntax isn’t very readable, it makes your eyes sore, and you suffers from headaches.</p>
</blockquote>
<blockquote>
<p>When your code is formatted, it is significantly easier to maintain, debug, optimize, and can be read and understood in a short amount of time. You should eliminate code style violations from your NGINX configuration files.</p>
</blockquote>
<blockquote>
<p>Choose your formatter style and setup a common config for it. Some rules are universal, but the most important thing is to keep a consistent NGINX code style throughout your code base:</p>
<ul>
<li>use whitespaces and blank lines to arrange and separate code blocks</li>
<li>use tabs for indents - they are consistent, customizable and allow mistakes to be more noticeable (unless you are a 4 space kind of guy)</li>
<li>use comments to explain why things are done not what is done</li>
<li>use meaningful naming conventions</li>
<li>simple is better than complex but complex is better than complicated</li>
</ul>
</blockquote>
<blockquote>
<p>Of course, the NGINX configuration code is not a programming language. All files are written in their own language or syntax so we should not overdo it, but I think it's worth sticking to the general rules and make your and other NGINX adminstrators life easier.</p>
</blockquote>
<h6 id="example-1">Example</h6>
<pre><code class="language-bash"># Good NGINX code style:
http {

  # Attach global rules:
  include         /etc/nginx/proxy.conf;
  include         /etc/nginx/fastcgi.conf;

  index           index.html index.htm index.php;

  default_type    application/octet-stream;

  # Standard log format:
  log_format      main '$remote_addr - $remote_user [$time_local]  $status '
                       '"$request" $body_bytes_sent "$http_referer" '
                       '"$http_user_agent" "$http_x_forwarded_for"';

  access_log      /var/log/nginx/access.log main;

  sendfile        on;
  tcp_nopush      on;

  # This seems to be required for some vhosts:
  server_names_hash_bucket_size 128;

  ...

# Bad NGINX code style:
http {
  include    nginx/proxy.conf;
  include    /etc/nginx/fastcgi.conf;
  index    index.html index.htm index.php;

  default_type application/octet-stream;
  log_format   main '$remote_addr - $remote_user [$time_local]  $status '
    '"$request" $body_bytes_sent "$http_referer" '
    '"$http_user_agent" "$http_x_forwarded_for"';
  access_log   logs/access.log    main;
  sendfile on;
  tcp_nopush   on;
  server_names_hash_bucket_size 128; # this seems to be required for some vhosts

  ...
</code></pre>
<h6 id="external-resources-2">External resources</h6>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Programming_style">Programming style</a></li>
<li><a href="https://www2.cs.arizona.edu/~mccann/style_c.html">Toward Developing Good Programming Style</a></li>
<li><a href="https://github.com/1connect/nginx-config-formatter">nginx-config-formatter</a></li>
<li><a href="https://github.com/vasilevich/nginxbeautifier">Format and beautify nginx config files</a></li>
</ul>
<h4 id="use-reload-method-to-change-configurations-on-the-fly"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use <code>reload</code> method to change configurations on the fly</h4>
<h6 id="rationale-2">Rationale</h6>
<blockquote>
<p>Use the <code>reload</code> method of NGINX to achieve a graceful reload of the configuration without stopping the server and dropping any packets. This function of the master process allows to rolls back the changes and continues to work with stable and old working configuration.</p>
</blockquote>
<blockquote>
<p>This ability of NGINX is very critical in a high-uptime, dynamic environments for keeping the load balancer or standalone server online.</p>
</blockquote>
<blockquote>
<p>Master process checks the syntax validity of the new configuration and tries to apply all changes. If this procedure has been accomplished, the master process create new worker processes and sends shutdown messages to old. Old workers stops accepting new connections after received a shut down signal but current requests are still processing. After that, the old workers exit.</p>
</blockquote>
<blockquote>
<p>When you restart NGINX you might encounter situation in which NGINX will stop, and won't start back again, because of syntax error. Reload method is safer than restarting because before old process will be terminated, new configuration file is parsed and whole process is aborted if there are any problems with it.</p>
</blockquote>
<blockquote>
<p>To stop NGINX processes with waiting for the worker processes to finish serving current requests use <code>nginx -s quit</code> command. It's better than <code>nginx -s stop</code> for fast shutdown.</p>
</blockquote>
<p>From NGINX documentation:</p>
<blockquote>
<p><em>In order for NGINX to re-read the configuration file, a HUP signal should be sent to the master process. The master process first checks the syntax validity, then tries to apply new configuration, that is, to open log files and new listen sockets. If this fails, it rolls back changes and continues to work with old configuration. If this succeeds, it starts new worker processes, and sends messages to old worker processes requesting them to shut down gracefully. Old worker processes close listen sockets and continue to service old clients. After all clients are serviced, old worker processes are shut down.</em></p>
</blockquote>
<h6 id="example-2">Example</h6>
<pre><code class="language-bash"># 1)
systemctl reload nginx

# 2)
service nginx reload

# 3)
/etc/init.d/nginx reload

# 4)
/usr/sbin/nginx -s reload

# 5)
kill -HUP $(cat /var/run/nginx.pid)
# or
kill -HUP $(ps auxw | grep [n]ginx | grep master | awk '{print $2}')
</code></pre>
<h6 id="external-resources-3">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/control.html#reconfiguration">Changing Configuration</a></li>
</ul>
<h4 id="separate-listen-directives-for-80-and-443"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Separate <code>listen</code> directives for 80 and 443</h4>
<h6 id="rationale-3">Rationale</h6>
<blockquote>
<p>I don't like duplicating the rules, but it's certainly an easy and maintainable way.</p>
</blockquote>
<h6 id="example-3">Example</h6>
<pre><code class="language-bash"># For http:
server {

  listen 10.240.20.2:80;

  ...

}

# For https:
server {

  listen 10.240.20.2:443 ssl;

  ...

}
</code></pre>
<h6 id="external-resources-4">External resources</h6>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/understanding-the-nginx-configuration-file-structure-and-configuration-contexts">Understanding the Nginx Configuration File Structure and Configuration Contexts</a></li>
</ul>
<h4 id="define-the-listen-directives-explicitly-with-addressport-pair"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Define the <code>listen</code> directives explicitly with <code>address:port</code> pair</h4>
<h6 id="rationale-4">Rationale</h6>
<blockquote>
<p>NGINX translates all incomplete <code>listen</code> directives by substituting missing values with their default values.</p>
</blockquote>
<blockquote>
<p>NGINX will only evaluate the <code>server_name</code> directive when it needs to distinguish between server blocks that match to the same level in the listen directive.</p>
</blockquote>
<blockquote>
<p>Set IP address and port number to prevents soft mistakes which may be difficult to debug.</p>
</blockquote>
<h6 id="example-4">Example</h6>
<pre><code class="language-bash">server {

  # This block will be processed:
  listen 192.168.252.10;  # --&gt; 192.168.252.10:80

  ...

}

server {

  listen 80;  # --&gt; *:80 --&gt; 0.0.0.0:80
  server_name api.random.com;

  ...

}
</code></pre>
<h6 id="external-resources-5">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#listen">Nginx HTTP Core Module - Listen</a></li>
<li><a href="https://serverfault.com/questions/875140/understanding-different-values-for-nginx-listen-directive">Understanding different values for nginx 'listen' directive</a></li>
</ul>
<h4 id="prevent-processing-requests-with-undefined-server-names"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Prevent processing requests with undefined server names</h4>
<h6 id="rationale-5">Rationale</h6>
<blockquote>
<p>NGINX should prevent processing requests with undefined server names (also on IP address). It also protects against configuration errors and don't pass traffic to incorrect backends. The problem is easily solved by creating a default catch all server config.</p>
</blockquote>
<blockquote>
<p>If none of the listen directives have the <code>default_server</code> parameter then the first server with the <code>address:port</code> pair will be the default server for this pair (it means that NGINX always has a default server).</p>
</blockquote>
<blockquote>
<p>If someone makes a request using an IP address instead of a server name, the <code>Host</code> request header field will contain the IP address and the request can be handled using the IP address as the server name.</p>
</blockquote>
<blockquote>
<p>Also good point is <code>return 444;</code> for default server name because this will close the connection and log it internally, for any domain that isn't defined in NGINX.</p>
</blockquote>
<h6 id="example-5">Example</h6>
<pre><code class="language-bash"># Place it at the beginning of the configuration file to prevent mistakes.
server {

  # Add default_server to your listen directive in the server that you want to act as the default.
  listen 10.240.20.2:443 default_server ssl;

  # We catch:
  #   - invalid domain names
  #   - requests without the "Host" header
  #   - and all others (also due to the above setting)
  #   - default_server in server_name directive is not required - I add this for a better understanding
  server_name _ "" default_server;

  ...

  return 444;

  # We can also serve:
  # location / {

    # static file (error page):
    # root /etc/nginx/error-pages/404;
    # or redirect:
    # return 301 https://badssl.com;

    # return 444;

  # }

}

server {

  listen 10.240.20.2:443 ssl;

  server_name domain.com;

  ...

}

server {

  listen 10.240.20.2:443 ssl;

  server_name domain.org;

  ...

}
</code></pre>
<h6 id="external-resources-6">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/http/server_names.html">Server names</a></li>
<li><a href="https://nginx.org/en/docs/http/request_processing.html">How nginx processes a request</a></li>
<li><a href="https://blog.gahooa.com/2013/08/21/nginx-how-to-specify-a-default-server/">nginx: how to specify a default server</a></li>
</ul>
<h4 id="use-only-one-ssl-config-for-specific-listen-directive"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use only one SSL config for specific listen directive</h4>
<h6 id="rationale-6">Rationale</h6>
<blockquote>
<p>For sharing a single IP address between several HTTPS servers you should use one SSL config (e.g. protocols, ciphers, curves) because changes will affect only the default server.</p>
</blockquote>
<blockquote>
<p>Remember that regardless of SSL parameters, you are able to use multiple SSL certificates.</p>
</blockquote>
<blockquote>
<p>If you want to set up different SSL configurations for the same IP address then it will fail. It's important because SSL configuration is presented for default server - if none of the listen directives have the <code>default_server</code> parameter then the first server in your configuration. So you should use only one SSL setup with several names on the same IP address.</p>
</blockquote>
<blockquote>
<p>It's also to prevent mistakes and configuration mismatch.</p>
</blockquote>
<h6 id="example-6">Example</h6>
<pre><code class="language-bash"># Store this configuration in e.g. https.conf
listen 192.168.252.10:443 default_server ssl http2;

ssl_protocols TLSv1.2;
ssl_ciphers "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384";

ssl_prefer_server_ciphers on;

ssl_ecdh_curve secp521r1:secp384r1;

...

# Include this file to the server context (attach domain-a.com for specific listen directive)
server {

  include /etc/nginx/https.conf;

  server_name domain-a.com;

  ...

}

# Include this file to the server context (attach domain-b.com for specific listen directive)
server {

  include /etc/nginx/https.conf;

  server_name domain-b.com;

  ...

}
</code></pre>
<h6 id="external-resources-7">External resources</h6>
<ul>
<li><a href="https://serverfault.com/questions/766831/nginx-one-ip-and-multiple-ssl-certificates">Nginx one ip and multiple ssl certificates</a></li>
</ul>
<h4 id="force-all-connections-over-tls"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Force all connections over TLS</h4>
<h6 id="rationale-7">Rationale</h6>
<blockquote>
<p>You should always use HTTPS instead of HTTP to protect your website, even if it doesn’t handle sensitive communications.</p>
</blockquote>
<blockquote>
<p>We have currently the first free and open CA - <a href="https://letsencrypt.org/">Let's Encrypt</a> - so generating and implementing certificates has never been so easy. It was created to provide free and easy-to-use TLS and SSL certificates.</p>
</blockquote>
<h6 id="example-7">Example</h6>
<pre><code class="language-bash">server {

  listen 10.240.20.2:80;

  server_name domain.com;

  return 301 https://$host$request_uri;

}

server {

  listen 10.240.20.2:443 ssl;

  server_name domain.com;

  ...

}
</code></pre>
<h6 id="external-resources-8">External resources</h6>
<ul>
<li><a href="https://security.stackexchange.com/questions/23646/should-we-force-user-to-https-on-website">Should we force user to HTTPS on website?</a></li>
<li><a href="https://letsencrypt.org/docs/">Let's Encrypt Documentation</a></li>
</ul>
<h4 id="use-geomap-modules-instead-allowdeny"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use geo/map modules instead allow/deny</h4>
<h6 id="rationale-8">Rationale</h6>
<blockquote>
<p>Use map or geo modules (one of them) to prevent users abusing your servers.</p>
</blockquote>
<blockquote>
<p>This allows to create variables with values depending on the client IP address.</p>
</blockquote>
<h6 id="example-8">Example</h6>
<pre><code class="language-bash"># Map module:
map $remote_addr $globals_internal_map_acl {

  # Status code:
  #  - 0 = false
  #  - 1 = true
  default 0;

  ### INTERNAL ###
  10.255.10.0/24 1;
  10.255.20.0/24 1;
  10.255.30.0/24 1;
  192.168.0.0/16 1;

}

# Geo module:
geo $globals_internal_geo_acl {

  # Status code:
  #  - 0 = false
  #  - 1 = true
  default 0;

  ### INTERNAL ###
  10.255.10.0/24 1;
  10.255.20.0/24 1;
  10.255.30.0/24 1;
  192.168.0.0/16 1;

}
</code></pre>
<h6 id="external-resources-9">External resources</h6>
<ul>
<li><a href="https://www.axivo.com/resources/nginx-basic-configuration.3/update?update=27">Nginx Basic Configuration (Geo Ban)</a></li>
<li><a href="#blockingallowing-ip-addresses">Blocking/allowing IP addresses</a></li>
</ul>
<h4 id="map-all-the-things"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Map all the things...</h4>
<h6 id="rationale-9">Rationale</h6>
<blockquote>
<p>Manage a large number of redirects with NGINX maps and use them to customize your key-value pairs.</p>
</blockquote>
<blockquote>
<p>Map module provides a more elegant solution for clearly parsing a big list of regexes, e.g. User-Agents, Referrers.</p>
</blockquote>
<h6 id="example-9">Example</h6>
<pre><code class="language-bash">map $http_user_agent $device_redirect {

  default "desktop";

  ~(?i)ip(hone|od) "mobile";
  ~(?i)android.*(mobile|mini) "mobile";
  ~Mobile.+Firefox "mobile";
  ~^HTC "mobile";
  ~Fennec "mobile";
  ~IEMobile "mobile";
  ~BB10 "mobile";
  ~SymbianOS.*AppleWebKit "mobile";
  ~Opera\sMobi "mobile";

}

# Turn on in a specific context (e.g. location):
if ($device_redirect = "mobile") {

  return 301 https://m.domain.com$request_uri;

}
</code></pre>
<h6 id="external-resources-10">External resources</h6>
<ul>
<li><a href="http://nginx.org/en/docs/http/ngx_http_map_module.html">Module ngx_http_map_module</a></li>
<li><a href="https://www.ignoredbydinosaurs.com/posts/236-cool-nginx-feature-of-the-week">Cool Nginx feature of the week</a></li>
</ul>
<h4 id="drop-the-same-root-inside-location-block"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Drop the same root inside location block</h4>
<h6 id="rationale-10">Rationale</h6>
<blockquote>
<p>If you add a root to every location block then a location block that isn’t matched will have no root. Set global <code>root</code> inside server directive.</p>
</blockquote>
<h6 id="example-10">Example</h6>
<pre><code class="language-bash">server {

  server_name domain.com;

  root /var/www/domain.com/public;

  location / {

    ...

  }

  location /api {

    ...

  }

  location /static {

    root /var/www/domain.com/static;

    ...

  }

}
</code></pre>
<h6 id="external-resources-11">External resources</h6>
<ul>
<li><a href="http://wiki.nginx.org/Pitfalls#Root_inside_Location_Block">Nginx Pitfalls: Root inside location block</a></li>
</ul>
<h4 id="use-debug-mode-for-debugging"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use debug mode for debugging</h4>
<h6 id="rationale-11">Rationale</h6>
<blockquote>
<p>There's probably more detail than you want, but that can sometimes be a lifesaver (but log file growing rapidly on a very high-traffic sites).</p>
</blockquote>
<h6 id="example-11">Example</h6>
<pre><code class="language-bash">rewrite_log on;
error_log /var/log/nginx/error-debug.log debug;
</code></pre>
<h6 id="external-resources-12">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/debugging_log.html">A debugging log</a></li>
</ul>
<h4 id="use-custom-log-formats-for-debugging"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use custom log formats for debugging</h4>
<h6 id="rationale-12">Rationale</h6>
<blockquote>
<p>Anything you can access as a variable in NGINX config, you can log, including non-standard http headers, etc. so it's a simple way to create your own log format for specific situations.</p>
</blockquote>
<blockquote>
<p>This is extremely helpful for debugging specific <code>location</code> directives.</p>
</blockquote>
<h6 id="example-12">Example</h6>
<pre><code class="language-bash"># Default main log format from NGINX repository:
log_format main
                '$remote_addr - $remote_user [$time_local] "$request" '
                '$status $body_bytes_sent "$http_referer" '
                '"$http_user_agent" "$http_x_forwarded_for"';

# Extended main log format:
log_format main-level-0
                '$remote_addr - $remote_user [$time_local] '
                '"$request_method $scheme://$host$request_uri '
                '$server_protocol" $status $body_bytes_sent '
                '"$http_referer" "$http_user_agent" '
                '$request_time';

# Debug log formats:
log_format debug-level-0
                '$remote_addr - $remote_user [$time_local] '
                '"$request_method $scheme://$host$request_uri '
                '$server_protocol" $status $body_bytes_sent '
                '$request_id $pid $msec $request_time '
                '$upstream_connect_time $upstream_header_time '
                '$upstream_response_time "$request_filename" '
                '$request_completion';

log_format debug-level-1
                '$remote_addr - $remote_user [$time_local] '
                '"$request_method $scheme://$host$request_uri '
                '$server_protocol" $status $body_bytes_sent '
                '$request_id $pid $msec $request_time '
                '$upstream_connect_time $upstream_header_time '
                '$upstream_response_time "$request_filename" $request_length '
                '$request_completion $connection $connection_requests '
                '"$http_user_agent"';

log_format debug-level-2
                '$remote_addr - $remote_user [$time_local] '
                '"$request_method $scheme://$host$request_uri '
                '$server_protocol" $status $body_bytes_sent '
                '$request_id $pid $msec $request_time '
                '$upstream_connect_time $upstream_header_time '
                '$upstream_response_time "$request_filename" $request_length '
                '$request_completion $connection $connection_requests '
                '$remote_addr $remote_port $server_addr $server_port '
                '$http_x_forwarded_for "$http_referer" "$http_user_agent"';

# Debug log format for SSL:
log_format debug-ssl-level-0
                '$remote_addr - $remote_user [$time_local] '
                '"$request_method $scheme://$host$request_uri '
                '$server_protocol" $status $body_bytes_sent '
                '"$http_referer" "$http_user_agent" '
                '$request_time '
                '$tls_version $ssl_protocol $ssl_cipher';
</code></pre>
<h6 id="external-resources-13">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/http/ngx_http_log_module.html">Module ngx_http_log_module</a></li>
<li><a href="https://fabianlee.org/2017/02/14/nginx-custom-access-log-format-and-error-levels/">Nginx: Custom access log format and error levels</a></li>
<li><a href="https://serverfault.com/questions/636790/nginx-log-complete-request-response-with-all-headers">nginx: Log complete request/response with all headers?</a></li>
</ul>
<h1 id="performance">Performance</h1>
<p>NGINX is a insanely fast, but you can adjust a few things to make sure it's as fast as possible for your use case.</p>
<h4 id="adjust-worker-processes"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Adjust worker processes</h4>
<h6 id="rationale-13">Rationale</h6>
<blockquote>
<p>The <code>worker_processes</code> directive is the sturdy spine of life for NGINX. This directive is responsible for letting our virtual server know many workers to spawn once it has become bound to the proper IP and port(s).</p>
</blockquote>
<blockquote>
<p>I think for high load proxy servers (also standalone servers) good value is <code>ALL_CORES - 1</code> (please test it before used).</p>
</blockquote>
<blockquote>
<p>Rule of thumb: If much time is spent blocked on I/O, worker processes should be increased further.</p>
</blockquote>
<p>Official NGINX documentation say:</p>
<blockquote>
<p><em>When one is in doubt, setting it to the number of available CPU cores would be a good start (the value "auto" will try to autodetect it).</em></p>
</blockquote>
<h6 id="example-13">Example</h6>
<pre><code class="language-bash"># VCPU = 4 , expr $(nproc --all) - 1
worker_processes 3;
</code></pre>
<h6 id="external-resources-14">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/ngx_core_module.html#worker_processes">Nginx Core Module - worker_processes</a></li>
</ul>
<h4 id="use-http2"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use HTTP/2</h4>
<h6 id="rationale-14">Rationale</h6>
<blockquote>
<p>The primary goals for HTTP/2 are to reduce latency by enabling full request and response multiplexing, minimize protocol overhead via efficient compression of HTTP header fields, and add support for request prioritization and server push.</p>
</blockquote>
<blockquote>
<p>HTTP/2 will make our applications faster, simpler, and more robust.</p>
</blockquote>
<blockquote>
<p>HTTP/2 is backwards-compatible with HTTP/1.1, so it would be possible to ignore it completely and everything will continue to work as before because if the client that does not support HTTP/2 will never ask the server for an HTTP/2 communication upgrade: the communication between them will be fully HTTP1/1.</p>
</blockquote>
<blockquote>
<p>Also include the <code>ssl</code> parameter, required because browsers do not support HTTP/2 without encryption.</p>
</blockquote>
<blockquote>
<p>HTTP/2 has a extremely large <a href="https://http2.github.io/http2-spec/#BadCipherSuites">blacklist</a> of old and insecure ciphers, so you should avoid them.</p>
</blockquote>
<h6 id="example-14">Example</h6>
<pre><code class="language-bash"># For https:
server {

  listen 10.240.20.2:443 ssl http2;

  ...
</code></pre>
<h6 id="external-resources-15">External resources</h6>
<ul>
<li><a href="https://developers.google.com/web/fundamentals/performance/http2/">Introduction to HTTP/2</a></li>
<li><a href="https://kinsta.com/learn/what-is-http2/">What is HTTP/2 - The Ultimate Guide</a></li>
<li><a href="https://www.upwork.com/hiring/development/the-http2-protocol-its-pros-cons-and-how-to-start-using-it/">The HTTP/2 Protocol: Its Pros &amp; Cons and How to Start Using It</a></li>
</ul>
<h4 id="maintaining-ssl-sessions"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Maintaining SSL sessions</h4>
<h6 id="rationale-15">Rationale</h6>
<blockquote>
<p>This improves performance from the clients’ perspective, because it eliminates the need for a new (and time-consuming) SSL handshake to be conducted each time a request is made.</p>
</blockquote>
<blockquote>
<p>Most servers do not purge sessions or ticket keys, thus increasing the risk that a server compromise would leak data from previous (and future) connections.</p>
</blockquote>
<blockquote>
<p>Set SSL Session Timeout to <code>5</code> minutes for prevent abused by advertisers like Google and Facebook.</p>
</blockquote>
<h6 id="example-15">Example</h6>
<pre><code class="language-bash">ssl_session_cache shared:SSL:10m;
ssl_session_timeout 5m;
ssl_session_tickets off;
ssl_buffer_size 1400;
</code></pre>
<h6 id="external-resources-16">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_session_cache">SSL Session (cache)</a></li>
<li><a href="https://vincent.bernat.ch/en/blog/2011-ssl-session-reuse-rfc5077">Speeding up TLS: enabling session reuse</a></li>
</ul>
<h4 id="use-exact-names-in-server-name-directive-where-possible"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use exact names in <code>server_name</code> directive where possible</h4>
<h6 id="rationale-16">Rationale</h6>
<blockquote>
<p>Exact names, wildcard names starting with an asterisk, and wildcard names ending with an asterisk are stored in three hash tables bound to the listen ports.</p>
</blockquote>
<blockquote>
<p>The exact names hash table is searched first. If a name is not found, the hash table with wildcard names starting with an asterisk is searched. If the name is not found there, the hash table with wildcard names ending with an asterisk is searched. Searching wildcard names hash table is slower than searching exact names hash table because names are searched by domain parts.</p>
</blockquote>
<blockquote>
<p>Regular expressions are tested sequentially and therefore are the slowest method and are non-scalable. For these reasons, it is better to use exact names where possible.</p>
</blockquote>
<h6 id="example-16">Example</h6>
<pre><code class="language-bash"># It is more efficient to define them explicitly:
server {

    listen       80;

    server_name  example.org  www.example.org  *.example.org;

    ...

}

# than to use the simplified form:
server {

    listen       80;

    server_name  .example.org;

    ...

}
</code></pre>
<h6 id="external-resources-17">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/http/server_names.html">Server names</a></li>
<li><a href="#virtual-server-logic">Virtual server logic</a></li>
</ul>
<h4 id="avoid-checks-server-name-with-if-directive"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Avoid checks <code>server_name</code> with <code>if</code> directive</h4>
<h6 id="rationale-17">Rationale</h6>
<blockquote>
<p>When NGINX receives a request no matter what is the subdomain being requested, be it <code>www.example.com</code> or just the plain <code>example.com</code> this <code>if</code> directive is always evaluated. Since you’re requesting NGINX to check for the <code>Host</code> header for every request. It’s extremely inefficient.</p>
</blockquote>
<blockquote>
<p>Instead use two server directives like the example below. This approach decreases NGINX processing requirements.</p>
</blockquote>
<h6 id="example-17">Example</h6>
<pre><code class="language-bash"># Bad configuration:
server {

  ...

  server_name                 domain.com www.domain.com;

  if ($host = www.domain.com) {

    return                    301 https://domain.com$request_uri;

  }

  server_name                 domain.com;

  ...

}

# Good configuration:
server {

    server_name               www.domain.com;
    return                    301 $scheme://domain.com$request_uri;
    # If you force your web traffic to use HTTPS:
    #                         301 https://domain.com$request_uri;

}

server {

    listen                    80;

    server_name               domain.com;

    ...

}
</code></pre>
<h6 id="external-resources-18">External resources</h6>
<ul>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/depth/ifisevil/">If Is Evil</a></li>
</ul>
<h4 id="make-an-exact-location-match-to-speed-up-the-selection-process"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Make an exact location match to speed up the selection process</h4>
<h6 id="rationale-18">Rationale</h6>
<blockquote>
<p>Exact location matches are often used to speed up the selection process by immediately ending the execution of the algorithm.</p>
</blockquote>
<h6 id="example-18">Example</h6>
<pre><code class="language-bash"># Matches the query / only and stops searching:
location = / {

  ...

}

# Matches the query /v9 only and stops searching:
location = /v9 {

  ...

}

...

# Matches any query due to the fact that all queries begin at /,
# but regular expressions and any longer conventional blocks will be matched at first place:
location / {

  ...

}
</code></pre>
<h6 id="external-resources-19">External resources</h6>
<ul>
<li><a href="https://artfulrobot.uk/blog/untangling-nginx-location-block-matching-algorithm">Untangling the nginx location block matching algorithm</a></li>
</ul>
<h4 id="use-limit-conn-to-improve-limiting-the-download-speed"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use <code>limit_conn</code> to improve limiting the download speed</h4>
<h6 id="rationale-19">Rationale</h6>
<blockquote>
<p>NGINX provides two directives to limiting download speed:</p>
<ul>
<li><code>limit_rate_after</code> - sets the amount of data transferred before the <code>limit_rate</code> directive takes effect</li>
<li><code>limit_rate</code> - allows you to limit the transfer rate of individual client connections (past exceeding <code>limit_rate_after</code>)</li>
</ul>
</blockquote>
<blockquote>
<p>This solution limits NGINX download speed per connection, so, if one user opens multiple e.g. video files, it will be able to download <code>X * the number of times</code> he connected to the video files.</p>
</blockquote>
<blockquote>
<p>To prevent this situation use <code>limit_conn_zone</code> and <code>limit_conn</code> directives.</p>
</blockquote>
<h6 id="example-19">Example</h6>
<pre><code class="language-bash"># Create limit connection zone:
limit_conn_zone $binary_remote_addr zone=conn_for_remote_addr:1m;

# Add rules to limiting the download speed:
limit_rate_after 1m;  # run at maximum speed for the first 1 megabyte
limit_rate 250k;      # and set rate limit after 1 megabyte

# Enable queue:
location /videos {

  # Max amount of data by one client: 10 megabytes (limit_rate_after * 10)
  limit_conn conn_for_remote_addr 10;

  ...
</code></pre>
<h6 id="external-resources-20">External resources</h6>
<ul>
<li><a href="https://www.scalescale.com/tips/nginx/how-to-limit-nginx-download-speed/">How to Limit Nginx download Speed</a></li>
</ul>
<h1 id="hardening">Hardening</h1>
<p>In this chapter I will talk about some of the NGINX hardening approaches and security standards.</p>
<h4 id="keep-nginx-up-to-date"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Keep NGINX up-to-date</h4>
<h6 id="rationale-20">Rationale</h6>
<blockquote>
<p>NGINX is a very secure and stable but vulnerabilities in the main binary itself do pop up from time to time. It's the main reason for keep NGINX up-to-date as hard as you can.</p>
</blockquote>
<blockquote>
<p>A very safe way to plan the update is once a new stable version is released but for me the most common way to handle NGINX updates is to wait a few weeks after the stable release.</p>
</blockquote>
<blockquote>
<p>Before update/upgrade NGINX remember about do it on the testing environment.</p>
</blockquote>
<blockquote>
<p>Most modern GNU/Linux distros will not push the latest version of NGINX into their default package lists so maybe you should consider install it from sources.</p>
</blockquote>
<h6 id="external-resources-21">External resources</h6>
<ul>
<li><a href="#installation-from-prebuilt-packages">Installation from prebuilt packages</a></li>
<li><a href="#installation-from-source">Installation from source</a></li>
</ul>
<h4 id="run-as-an-unprivileged-user"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Run as an unprivileged user</h4>
<h6 id="rationale-21">Rationale</h6>
<blockquote>
<p>There is no real difference in security just by changing the process owner name. On the other hand in security, the principle of least privilege states that an entity should be given no more permission than necessary to accomplish its goals within a given system. This way only master process runs as root.</p>
</blockquote>
<h6 id="example-20">Example</h6>
<pre><code class="language-bash"># Edit nginx.conf:
user nginx;

# Set owner and group for root (app, default) directory:
chown -R nginx:nginx /var/www/domain.com
</code></pre>
<h6 id="external-resources-22">External resources</h6>
<ul>
<li><a href="https://unix.stackexchange.com/questions/134301/why-does-nginx-starts-process-as-root">Why does nginx starts process as root?</a></li>
</ul>
<h4 id="disable-unnecessary-modules"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Disable unnecessary modules</h4>
<h6 id="rationale-22">Rationale</h6>
<blockquote>
<p>It is recommended to disable any modules which are not required as this will minimize the risk of any potential attacks by limiting the operations allowed by the web server.</p>
</blockquote>
<blockquote>
<p>The best way to disable unused modules you should use the <code>configure</code> option during installation.</p>
</blockquote>
<h6 id="example-21">Example</h6>
<pre><code class="language-bash"># During installation:
./configure --without-http_autoindex_module

# Comment modules in the configuration file e.g. modules.conf:
# load_module                 /usr/share/nginx/modules/ndk_http_module.so;
# load_module                 /usr/share/nginx/modules/ngx_http_auth_pam_module.so;
# load_module                 /usr/share/nginx/modules/ngx_http_cache_purge_module.so;
# load_module                 /usr/share/nginx/modules/ngx_http_dav_ext_module.so;
load_module                   /usr/share/nginx/modules/ngx_http_echo_module.so;
# load_module                 /usr/share/nginx/modules/ngx_http_fancyindex_module.so;
load_module                   /usr/share/nginx/modules/ngx_http_geoip_module.so;
load_module                   /usr/share/nginx/modules/ngx_http_headers_more_filter_module.so;
# load_module                 /usr/share/nginx/modules/ngx_http_image_filter_module.so;
# load_module                 /usr/share/nginx/modules/ngx_http_lua_module.so;
load_module                   /usr/share/nginx/modules/ngx_http_perl_module.so;
# load_module                 /usr/share/nginx/modules/ngx_mail_module.so;
# load_module                 /usr/share/nginx/modules/ngx_nchan_module.so;
# load_module                 /usr/share/nginx/modules/ngx_stream_module.so;
</code></pre>
<h6 id="external-resources-23">External resources</h6>
<ul>
<li><a href="https://github.com/nginx-modules">nginx-modules</a></li>
</ul>
<h4 id="protect-sensitive-resources"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Protect sensitive resources</h4>
<h6 id="rationale-23">Rationale</h6>
<blockquote>
<p>Hidden directories and files should never be web accessible - sometimes critical data are published during application deploy. If you use control version system you should defninitely drop the access to the critical hidden directories like a <code>.git</code> or <code>.svn</code> to prevent expose source code of your application.</p>
</blockquote>
<blockquote>
<p>Sensitive resources contains items that abusers can use to fully recreate the source code used by the site and look for bugs, vulnerabilities, and exposed passwords.</p>
</blockquote>
<h6 id="example-22">Example</h6>
<pre><code class="language-bash">if ($request_uri ~ "../../\.git") {

  return 403;

}

# or
location ~ /\.git {

  deny all;

}

# or
location ~* ^.*(\.(?:git|svn|htaccess))$ {

  return 403;

}

# or all . directories/files excepted .well-known
location ~ /\.(?!well-known\/) {

  deny all;

}
</code></pre>
<h6 id="external-resources-24">External resources</h6>
<ul>
<li><a href="https://github.com/bl4de/research/tree/master/hidden_directories_leaks">Hidden directories and files as a source of sensitive information about web application</a></li>
</ul>
<h4 id="hide-nginx-version-number"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Hide Nginx version number</h4>
<h6 id="rationale-24">Rationale</h6>
<blockquote>
<p>Disclosing the version of NGINX running can be undesirable, particularly in environments sensitive to information disclosure.</p>
</blockquote>
<p>But the "Official Apache Documentation (Apache Core Features)" say:</p>
<blockquote>
<p><em>Setting ServerTokens to less than minimal is not recommended because it makes it more difficult to debug interoperational problems. Also note that disabling the Server: header does nothing at all to make your server more secure. The idea of "security through obscurity" is a myth and leads to a false sense of safety.</em></p>
</blockquote>
<h6 id="example-23">Example</h6>
<pre><code class="language-bash">server_tokens off;
</code></pre>
<h6 id="external-resources-25">External resources</h6>
<ul>
<li><a href="https://geekflare.com/remove-server-header-banner-nginx/">Remove Version from Server Header Banner in nginx</a></li>
<li><a href="https://www.tunetheweb.com/security/http-security-headers/server-header/">Reduce or remove server headers</a></li>
</ul>
<h4 id="hide-nginx-server-signature"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Hide Nginx server signature</h4>
<h6 id="rationale-25">Rationale</h6>
<blockquote>
<p>In my opinion there is no real reason or need to show this much information about your server. It is easy to look up particular vulnerabilities once you know the version number.</p>
</blockquote>
<blockquote>
<p>You should compile NGINX from sources with <code>ngx_headers_more</code> to used <code>more_set_headers</code> directive.</p>
</blockquote>
<h6 id="example-24">Example</h6>
<pre><code class="language-bash">more_set_headers "Server: Unknown";
</code></pre>
<h6 id="external-resources-26">External resources</h6>
<ul>
<li><a href="https://www.troyhunt.com/shhh-dont-let-your-response-headers/">Shhh... don’t let your response headers talk too loudly</a></li>
<li><a href="https://stackoverflow.com/questions/24594971/how-to-changehide-the-nginx-server-signature">How to change (hide) the Nginx Server Signature?</a></li>
</ul>
<h4 id="hide-upstream-proxy-headers"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Hide upstream proxy headers</h4>
<h6 id="rationale-26">Rationale</h6>
<blockquote>
<p>When NGINX is used to proxy requests to an upstream server (such as a PHP-FPM instance), it can be beneficial to hide certain headers sent in the upstream response (e.g. the version of PHP running).</p>
</blockquote>
<h6 id="example-25">Example</h6>
<pre><code class="language-bash">proxy_hide_header X-Powered-By;
proxy_hide_header X-AspNetMvc-Version;
proxy_hide_header X-AspNet-Version;
proxy_hide_header X-Drupal-Cache;
</code></pre>
<h6 id="external-resources-27">External resources</h6>
<ul>
<li><a href="https://veggiespam.com/headers/">Remove insecure http headers</a></li>
</ul>
<h4 id="use-only-the-latest-supported-openssl-version"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use only the latest supported OpenSSL version</h4>
<h6 id="rationale-27">Rationale</h6>
<blockquote>
<p>Before start see <a href="https://www.openssl.org/policies/releasestrat.html">Release Strategy Policies</a> and <a href="https://www.openssl.org/news/changelog.html">Changelog</a> on the OpenSSL website.</p>
</blockquote>
<blockquote>
<p>Criteria for choosing OpenSSL version can vary and it depends all on your use.</p>
</blockquote>
<blockquote>
<p>The latest versions of the major OpenSSL library are (may be changed):</p>
<ul>
<li>the next version of OpenSSL will be 3.0.0</li>
<li>version 1.1.1 will be supported until 2023-09-11 (LTS)
<ul>
<li>last minor version: 1.1.1b (February 26, 2019)</li>
</ul> </li>
<li>version 1.1.0 will be supported until 2019-09-11
<ul>
<li>last minor version: 1.1.0j (November 20, 2018)</li>
</ul> </li>
<li>version 1.0.2 will be supported until 2019-12-31 (LTS)
<ul>
<li>last minor version: 1.0.2r (February 26, 2019)</li>
</ul> </li>
<li>any other versions are no longer supported</li>
</ul>
</blockquote>
<blockquote>
<p>In my opinion the only safe way is based on the up-to-date and still supported version of the OpenSSL. And what's more, I recommend to hang on to the latest versions (e.g. 1.1.1).</p>
</blockquote>
<blockquote>
<p>If your system repositories do not have the newest OpenSSL, you can do the <a href="https://github.com/trimstray/nginx-admins-handbook#installation-from-source">compilation</a> process (see OpenSSL sub-section).</p>
</blockquote>
<h6 id="external-resources-28">External resources</h6>
<ul>
<li><a href="https://www.openssl.org/">OpenSSL Official Website</a></li>
<li><a href="https://www.openssl.org/blog/">OpenSSL Official Blog</a></li>
<li><a href="https://www.openssl.org/news/newslog.html">OpenSSL Official Newslog</a></li>
</ul>
<h4 id="use-min-2048-bit-private-keys"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use min. 2048-bit private keys</h4>
<h6 id="rationale-28">Rationale</h6>
<blockquote>
<p>Advisories recommend 2048 for now. Security experts are projecting that 2048 bits will be sufficient for commercial use until around the year 2030 (as per NIST).</p>
</blockquote>
<blockquote>
<p>The latest version of FIPS-186 also say the U.S. Federal Government generate (and use) digital signatures with 1024, 2048, or 3072 bit key lengths.</p>
</blockquote>
<blockquote>
<p>Generally there is no compelling reason to choose 4096 bit keys over 2048 provided you use sane expiration intervals.</p>
</blockquote>
<blockquote>
<p>If you want to get <strong>A+ with 100%s on SSL Lab</strong> (for Key Exchange) you should definitely use 4096 bit private keys. That's the main reason why you should use them.</p>
</blockquote>
<blockquote>
<p>Longer keys take more time to generate and require more CPU (please use <code>openssl speed rsa</code> on your server) and power when used for encrypting and decrypting, also the SSL handshake at the start of each connection will be slower. It also has a small impact on the client side (e.g. browsers).</p>
</blockquote>
<blockquote>
<p>Use of alternative solution: <a href="https://en.wikipedia.org/wiki/Elliptic-curve_cryptography">ECC Certificate Signing Request (CSR)</a> - <code>ECDSA</code> certificates contain an <code>ECC</code> public key. <code>ECC</code> keys are better than <code>RSA &amp; DSA</code> keys in that the <code>ECC</code> algorithm is harder to break.</p>
</blockquote>
<p>The "SSL/TLS Deployment Best Practices" book say:</p>
<blockquote>
<p><em>The cryptographic handshake, which is used to establish secure connections, is an operation whose cost is highly influenced by private key size. Using a key that is too short is insecure, but using a key that is too long will result in "too much" security and slow operation. For most web sites, using RSA keys stronger than 2048 bits and ECDSA keys stronger than 256 bits is a waste of CPU power and might impair user experience. Similarly, there is little benefit to increasing the strength of the ephemeral key exchange beyond 2048 bits for DHE and 256 bits for ECDHE.</em></p>
</blockquote>
<p>Konstantin Ryabitsev (Reddit):</p>
<blockquote>
<p><em>Generally speaking, if we ever find ourselves in a world where 2048-bit keys are no longer good enough, it won't be because of improvements in brute-force capabilities of current computers, but because RSA will be made obsolete as a technology due to revolutionary computing advances. If that ever happens, 3072 or 4096 bits won't make much of a difference anyway. This is why anything above 2048 bits is generally regarded as a sort of feel-good hedging theatre.</em></p>
</blockquote>
<p><strong>My recommendation:</strong></p>
<blockquote>
<p>Use 2048-bit key instead 4096-bit at this moment.</p>
</blockquote>
<h6 id="example-26">Example</h6>
<pre><code class="language-bash">### Example (RSA):
( _fd="domain.com.key" ; _len="2048" ; openssl genrsa -out ${_fd} ${_len} )

# Let's Encrypt:
certbot certonly -d domain.com -d www.domain.com --rsa-key-size 2048

### Example (ECC):
# _curve: prime256v1, secp521r1, secp384r1
( _fd="domain.com.key" ; _fd_csr="domain.com.csr" ; _curve="prime256v1" ; \
openssl ecparam -out ${_fd} -name ${_curve} -genkey ; \
openssl req -new -key ${_fd} -out ${_fd_csr} -sha256 )

# Let's Encrypt (from above):
certbot --csr ${_fd_csr} -[other-args]
</code></pre>
<p>For <code>x25519</code>:</p>
<pre><code class="language-bash">( _fd="private.key" ; _curve="x25519" ; \
openssl genpkey -algorithm ${_curve} -out ${_fd} )
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-use-min-2048-bit-private-keys"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" alt="arrowtr_100"></a></a></sub></p>
<pre><code class="language-bash">( _fd="domain.com.key" ; _len="2048" ; openssl genrsa -out ${_fd} ${_len} )

# Let's Encrypt:
certbot certonly -d domain.com -d www.domain.com
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-use-min-2048-bit-private-keys"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_90.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_90.png" alt="arrowtr_90"></a></a></sub></p>
<h6 id="external-resources-29">External resources</h6>
<ul>
<li><a href="https://csrc.nist.gov/Projects/Key-Management/Key-Management-Guidelines">Key Management Guidelines by NIST</a></li>
<li><a href="https://csrc.nist.gov/publications/detail/sp/800-131a/archive/2011-01-13">Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths</a></li>
<li><a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf">FIPS PUB 186-4 - Digital Signature Standard (DSS)</a> [pdf]</li>
<li><a href="https://www.keylength.com/">Cryptographic Key Length Recommendations</a></li>
<li><a href="https://certsimple.com/blog/measuring-ssl-rsa-keys">So you're making an RSA key for an HTTPS certificate. What key size do you use?</a></li>
<li><a href="https://danielpocock.com/rsa-key-sizes-2048-or-4096-bits/">RSA Key Sizes: 2048 or 4096 bits?</a></li>
<li><a href="https://msol.io/blog/tech/create-a-self-signed-ecc-certificate/">Create a self-signed ECC certificate</a></li>
</ul>
<h4 id="keep-only-tls-12-and-tls-13"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Keep only TLS 1.2 and TLS 1.3</h4>
<h6 id="rationale-29">Rationale</h6>
<blockquote>
<p>It is recommended to run TLS 1.1/1.2/1.3 and fully disable SSLv2, SSLv3 and TLS 1.0 that have protocol weaknesses.</p>
</blockquote>
<blockquote>
<p>TLS 1.1 and 1.2 are both without security issues - but only TLS 1.2 and TLS 1.3 provides modern cryptographic algorithms. TLS 1.3 is a new TLS version that will power a faster and more secure web for the next few years. TLS 1.0 and TLS 1.1 protocols will be removed from browsers at the beginning of 2020.</p>
</blockquote>
<blockquote>
<p>TLS 1.2 does require careful configuration to ensure obsolete cipher suites with identified vulnerabilities are not used in conjunction with it. TLS 1.3 removes the need to make these decisions. TLS 1.3 version also improves TLS 1.2 security, privace and performance issues.</p>
</blockquote>
<blockquote>
<p>Before enabling specific protocol version, you should check which ciphers are supported by the protocol. So if you turn on TLS 1.1, TLS 1.2 and TLS 1.3 both remember about <a href="#beginner-use-only-strong-ciphers">the correct (and strong)</a> ciphers to handle them. Otherwise, they will not be anyway works without supported ciphers (no TLS handshake will succeed).</p>
</blockquote>
<blockquote>
<p>If you told NGINX to use TLS 1.3, it will use TLS 1.3 only where is available. NGINX supports TLS 1.3 since version 1.13.0 (released in April 2017), when built against OpenSSL 1.1.1 or more.</p>
</blockquote>
<p><strong>My recommendation:</strong></p>
<blockquote>
<p>Use only <a href="#keep-only-tls1.2-tls13">TLSv1.3 and TLSv1.2</a>.</p>
</blockquote>
<h6 id="example-27">Example</h6>
<p>TLS 1.3 + 1.2:</p>
<pre><code class="language-bash">ssl_protocols TLSv1.3 TLSv1.2;
</code></pre>
<p>TLS 1.2:</p>
<pre><code class="language-bash">ssl_protocols TLSv1.2;
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-keep-only-tls-12-and-tls-13"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" alt="arrowtr_100"></a></a></sub></p>
<p>TLS 1.3 + 1.2 + 1.1:</p>
<pre><code class="language-bash">ssl_protocols TLSv1.3 TLSv1.2 TLSv1.1;
</code></pre>
<p>TLS 1.2 + 1.1:</p>
<pre><code class="language-bash">ssl_protocols TLSv1.2 TLSv1.1;
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-keep-only-tls-12-and-tls-13"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_95.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_95.png" alt="arrowtr_95"></a></a></sub></p>
<h6 id="external-resources-30">External resources</h6>
<ul>
<li><a href="https://www.ietf.org/rfc/rfc5246.txt">The Transport Layer Security (TLS) Protocol Version 1.2</a></li>
<li><a href="https://tools.ietf.org/html/draft-ietf-tls-tls13-18">The Transport Layer Security (TLS) Protocol Version 1.3</a></li>
<li><a href="https://tls12.ulfheim.net/">TLS1.2 - Every byte explained and reproduced</a></li>
<li><a href="https://tls13.ulfheim.net/">TLS1.3 - Every byte explained and reproduced</a></li>
<li><a href="https://wiki.openssl.org/index.php/TLS1.3">TLS1.3 - OpenSSLWiki</a></li>
<li><a href="https://medium.com/@ethicalevil/tls-handshake-protocol-overview-a39e8eee2cf5">TLS v1.2 handshake overview</a></li>
<li><a href="https://kinsta.com/blog/tls-1-3/">An Overview of TLS 1.3 - Faster and More Secure</a></li>
<li><a href="https://blog.cloudflare.com/rfc-8446-aka-tls-1-3/">A Detailed Look at RFC 8446 (a.k.a. TLS 1.3)</a></li>
<li><a href="https://www.wolfssl.com/differences-between-tls-1-2-and-tls-1-3/">Differences between TLS 1.2 and TLS 1.3</a></li>
<li><a href="https://www.ssl.com/article/tls-1-3-is-here-to-stay/">TLS 1.3 is here to stay</a></li>
<li><a href="https://ma.ttias.be/enable-tls-1-3-nginx/">How to enable TLS 1.3 on Nginx</a></li>
<li><a href="https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2019/february/downgrade-attack-on-tls-1.3-and-vulnerabilities-in-major-tls-libraries/">Downgrade Attack on TLS 1.3 and Vulnerabilities in Major TLS Libraries</a></li>
<li><a href="https://www.fastly.com/blog/phase-two-our-tls-10-and-11-deprecation-plan">Phase two of our TLS 1.0 and 1.1 deprecation plan</a></li>
<li><a href="https://www.keycdn.com/blog/deprecating-tls-1-0-and-1-1">Deprecating TLS 1.0 and 1.1 - Enhancing Security for Everyone</a></li>
<li><a href="https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/">TLS/SSL Explained – Examples of a TLS Vulnerability and Attack, Final Part</a></li>
<li><a href="https://security.googleblog.com/2014/10/this-poodle-bites-exploiting-ssl-30.html">This POODLE bites: exploiting the SSL 3.0 fallback</a></li>
<li><a href="https://blog.pcisecuritystandards.org/are-you-ready-for-30-june-2018-sayin-goodbye-to-ssl-early-tls">Are You Ready for 30 June 2018? Saying Goodbye to SSL/early TLS</a></li>
</ul>
<h4 id="use-only-strong-ciphers"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use only strong ciphers</h4>
<h6 id="rationale-30">Rationale</h6>
<blockquote>
<p>This parameter changes quite often, the recommended configuration for today may be out of date tomorrow.</p>
</blockquote>
<blockquote>
<p>To check ciphers supported by OpenSSL on your server: <code>openssl ciphers -s -v</code>, <code>openssl ciphers -s -v ECDHE</code> or <code>openssl ciphers -s -v DHE</code>.</p>
</blockquote>
<blockquote>
<p>For more security use only strong and not vulnerable cipher suites. Place <code>ECDHE</code> and <code>DHE</code> suites at the top of your list. The order is important; because <code>ECDHE</code> suites are faster, you want to use them whenever clients supports them.</p>
</blockquote>
<blockquote>
<p>For backward compatibility software components you should use less restrictive ciphers. Not only that you have to enable at least one special <code>AES128</code> cipher for HTTP/2 support regarding to <a href="https://tools.ietf.org/html/rfc7540#section-9.2.2">RFC7540: TLS 1.2 Cipher Suites</a>, you also have to allow <code>prime256</code> elliptic curves which reduces the score for key exchange by another 10% even if a secure server preferred order is set.</p>
</blockquote>
<blockquote>
<p>Also modern cipher suites (e.g. from Mozilla recommendations) suffers from compatibility troubles mainly because drops <code>SHA-1</code>. But be careful if you want to use ciphers with <code>HMAC-SHA-1</code> - there's a perfectly good <a href="https://crypto.stackexchange.com/a/26518">explanation</a> why.</p>
</blockquote>
<blockquote>
<p>If you want to get <strong>A+ with 100%s on SSL Lab</strong> (for Cipher Strength) you should definitely disable <code>128-bit</code> ciphers. That's the main reason why you should not use them.</p>
</blockquote>
<blockquote>
<p>In my opinion <code>128-bit</code> symmetric encryption doesn’t less secure. For example TLS 1.3 use <code>TLS_AES_128_GCM_SHA256 (0x1301)</code> (for TLS-compliant applications). It is not possible to control ciphers for TLS 1.3 without support from client to use new API for TLSv1.3 cipher suites so at this moment it's always on (also if you disable potentially weak cipher from NGINX). On the other hand the ciphers in TLSv1.3 have been restricted to only a handful of completely secure ciphers by leading crypto experts.</p>
</blockquote>
<blockquote>
<p>For TLS 1.2 you should consider disable weak ciphers without forward secrecy like ciphers with <code>CBC</code> algorithm. Using them also reduces the final grade because they don't use ephemeral keys. In my opinion you should use ciphers with <code>AEAD</code> (TLS 1.3 supports only these suites) encryption because they don't have any known weaknesses.</p>
</blockquote>
<blockquote>
<p>You should also absolutely disable weak ciphers regardless of the TLS version do you use, like those with <code>DSS</code>, <code>DSA</code>, <code>DES/3DES</code>, <code>RC4</code>, <code>MD5</code>, <code>SHA1</code>, <code>null</code>, anon in the name.</p>
</blockquote>
<blockquote>
<p>We have a nice online tool for testing compatibility cipher suites with user agents: <a href="https://cryptcheck.fr/suite/">CryptCheck</a>. I think it will be very helpful for you.</p>
</blockquote>
<p><strong>My recommendation:</strong></p>
<blockquote>
<p>Use only <a href="#keep-only-tls1.2-tls13">TLSv1.3 and TLSv1.2</a> with below cipher suites:</p>
</blockquote>
<pre><code class="language-bash">ssl_ciphers "TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256";
</code></pre>
<h6 id="example-28">Example</h6>
<p>Cipher suites for TLS 1.3:</p>
<pre><code class="language-bash">ssl_ciphers "TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384";
</code></pre>
<p>Cipher suites for TLS 1.2:</p>
<pre><code class="language-bash">ssl_ciphers "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-SHA384";
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-use-only-strong-ciphers"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" alt="arrowtr_100"></a></a></sub></p>
<p>Cipher suites for TLS 1.3:</p>
<pre><code class="language-bash">ssl_ciphers "TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256";
</code></pre>
<p>Cipher suites for TLS 1.2:</p>
<pre><code class="language-bash"># 1)
ssl_ciphers "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-SHA384";

# 2)
ssl_ciphers "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256";

# 3)
ssl_ciphers "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256";

# 4)
ssl_ciphers "EECDH+CHACHA20:EDH+AESGCM:AES256+EECDH:AES256+EDH";
</code></pre>
<p>Cipher suites for TLS 1.1 + 1.2:</p>
<pre><code class="language-bash"># 1)
ssl_ciphers "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256";

# 2)
ssl_ciphers "ECDHE-ECDSA-CHACHA20-POLY1305:ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:!AES256-GCM-SHA256:!AES256-GCM-SHA128:!aNULL:!MD5";
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-use-only-strong-ciphers"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_90.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_90.png" alt="arrowtr_90"></a></a></sub></p>
<p>This will also give a baseline for comparison with <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">Mozilla SSL Configuration Generator</a>:</p>
<ul>
<li>Modern profile with OpenSSL 1.1.0b (TLSv1.2)</li>
</ul>
<pre><code class="language-bash">ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';
</code></pre>
<ul>
<li>Intermediate profile with OpenSSL 1.1.0b (TLSv1, TLSv1.1 and TLSv1.2)</li>
</ul>
<pre><code class="language-bash">ssl_ciphers 'ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS';
</code></pre>
<h6 id="external-resources-31">External resources</h6>
<ul>
<li><a href="https://www.iana.org/assignments/tls-parameters/tls-parameters.xhtml#tls-parameters-4">TLS Cipher Suites</a></li>
<li><a href="https://technology.amis.nl/2017/07/04/ssltls-choose-cipher-suite/">SSL/TLS: How to choose your cipher suite</a></li>
<li><a href="https://sparanoid.com/note/http2-and-ecdsa-cipher-suites/">HTTP/2 and ECDSA Cipher Suites</a></li>
<li><a href="https://www.securityevaluators.com/ssl-tls-protocol-versions-cipher-suites-use/">Which SSL/TLS Protocol Versions and Cipher Suites Should I Use?</a></li>
<li><a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/TLS_Cipher_String_Cheat_Sheet.html">Recommendations for a cipher string by OWASP</a></li>
<li><a href="https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/">Recommendations for TLS/SSL Cipher Hardening by Acunetix</a></li>
<li><a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Modern_compatibility">Mozilla’s Modern compatibility suite</a></li>
<li><a href="https://tls.mbed.org/kb/cryptography/ephemeral-diffie-hellman">Why use Ephemeral Diffie-Hellman</a></li>
<li><a href="https://blogs.technet.microsoft.com/askpfeplat/2017/12/26/cipher-suite-breakdown/">Cipher Suite Breakdown</a></li>
<li><a href="https://testssl.sh/openssl-iana.mapping.html">OpenSSL IANA Mapping</a></li>
</ul>
<h4 id="use-more-secure-ecdh-curve"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use more secure ECDH Curve</h4>
<h6 id="rationale-31">Rationale</h6>
<blockquote>
<p>For a SSL server certificate, an "elliptic curve" certificate will be used only with digital signatures (<code>ECDSA</code> algorithm).</p>
</blockquote>
<blockquote>
<p><code>x25519</code> is a more secure but slightly less compatible option. To maximise interoperability with existing browsers and servers, stick to <code>P-256 prime256v1</code> and <code>P-384 secp384r1</code> curves.</p>
</blockquote>
<blockquote>
<p>NSA Suite B says that NSA uses curves <code>P-256</code> and <code>P-384</code> (in OpenSSL, they are designated as, respectively, <code>prime256v1</code> and <code>secp384r1</code>). There is nothing wrong with <code>P-521</code>, except that it is, in practice, useless. Arguably, <code>P-384</code> is also useless, because the more efficient <code>P-256</code> curve already provides security that cannot be broken through accumulation of computing power.</p>
</blockquote>
<blockquote>
<p>Use <code>P-256</code> to minimize trouble. If you feel that your manhood is threatened by using a 256-bit curve where a 384-bit curve is available, then use <code>P-384</code>: it will increases your computational and network costs.</p>
</blockquote>
<blockquote>
<p>If you use TLS 1.3 you should enable <code>prime256v1</code> signature algorithm. Without this SSL Lab reports <code>TLS_AES_128_GCM_SHA256 (0x1301)</code> signature as weak.</p>
</blockquote>
<blockquote>
<p>If you do not set <code>ssh_ecdh_curve</code>, then NGINX will use its default settings, e.g. Chrome will prefer <code>x25519</code>, but this is <strong>not recommended</strong> because you can not control default settings (seems to be <code>P-256</code>) from the NGINX.</p>
</blockquote>
<blockquote>
<p>Explicitly set <code>ssh_ecdh_curve X25519:prime256v1:secp521r1:secp384r1;</code> <strong>decreases the Key Exchange SSL Labs rating</strong>.</p>
</blockquote>
<blockquote>
<p>Definitely do not use the <code>secp112r1</code>, <code>secp112r2</code>, <code>secp128r1</code>, <code>secp128r2</code>, <code>secp160k1</code>, <code>secp160r1</code>, <code>secp160r2</code>, <code>secp192k1</code> curves. They have a too small size for security application according to NIST recommendation.</p>
</blockquote>
<p><strong>My recommendation:</strong></p>
<blockquote>
<p>Use only <a href="#keep-only-tls1.2-tls13">TLSv1.3 and TLSv1.2</a> and <a href="#use-only-strong-ciphers">only strong ciphers</a> with above curves:</p>
</blockquote>
<pre><code class="language-bash">ssl_ecdh_curve X25519:secp521r1:secp384r1:prime256v1;
</code></pre>
<h6 id="example-29">Example</h6>
<p>Curves for TLS 1.2:</p>
<pre><code class="language-bash">ssl_ecdh_curve secp521r1:secp384r1:prime256v1;
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-use-more-secure-ecdh-curve"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" alt="arrowtr_100"></a></a></sub></p>
<pre><code class="language-bash"># Alternative (this one doesn’t affect compatibility, by the way; it’s just a question of the preferred order).

# This setup downgrade Key Exchange score but is recommended for TLS 1.2 + 1.3:
ssl_ecdh_curve X25519:secp521r1:secp384r1:prime256v1;
</code></pre>
<h6 id="external-resources-32">External resources</h6>
<ul>
<li><a href="http://www.secg.org/">Standards for Efficient Cryptography Group</a></li>
<li><a href="https://safecurves.cr.yp.to/">SafeCurves: choosing safe curves for elliptic-curve cryptography</a></li>
<li><a href="https://blog.cr.yp.to/20140323-ecdsa.html">P-521 is pretty nice prime</a></li>
<li><a href="https://certsimple.com/blog/safe-curves-and-openssl">Safe ECC curves for HTTPS are coming sooner than you think</a></li>
<li><a href="https://www.keylength.com/">Cryptographic Key Length Recommendations</a></li>
<li><a href="https://www.owasp.org/index.php/Testing_for_Weak_SSL/TLS_Ciphers,_Insufficient_Transport_Layer_Protection_(OTG-CRYPST-001)">Testing for Weak SSL/TLS Ciphers, Insufficient Transport Layer Protection (OTG-CRYPST-001)</a></li>
<li><a href="https://tls.mbed.org/kb/cryptography/elliptic-curve-performance-nist-vs-brainpool">Elliptic Curve performance: NIST vs Brainpool</a></li>
<li><a href="https://security.stackexchange.com/questions/78621/which-elliptic-curve-should-i-use/91562">Which elliptic curve should I use?</a></li>
</ul>
<h4 id="use-strong-key-exchange"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Use strong Key Exchange</h4>
<h6 id="rationale-32">Rationale</h6>
<blockquote>
<p>The DH key is only used if DH ciphers are used. Modern clients prefer <code>ECDHE</code> instead and if your NGINX accepts this preference then the handshake will not use the DH param at all since it will not do a <code>DHE</code> key exchange but an <code>ECDHE</code> key exchange.</p>
</blockquote>
<blockquote>
<p>Most of the modern profiles from places like Mozilla's ssl config generator no longer recommend using this.</p>
</blockquote>
<blockquote>
<p>Default key size in OpenSSL is <code>1024 bits</code> - it's vulnerable and breakable. For the best security configuration use your own <code>4096 bit</code> DH Group or use known safe ones pre-defined DH groups (it's recommended) from <a href="https://wiki.mozilla.org/Security/Server_Side_TLS#ffdhe4096">mozilla</a>.</p>
</blockquote>
<h6 id="example-30">Example</h6>
<pre><code class="language-bash"># To generate a DH key:
openssl dhparam -out /etc/nginx/ssl/dhparam_4096.pem 4096

# To produce "DSA-like" DH parameters:
openssl dhparam -dsaparam -out /etc/nginx/ssl/dhparam_4096.pem 4096

# To generate a ECDH key:
openssl ecparam -out /etc/nginx/ssl/ecparam.pem -name prime256v1

# NGINX configuration:
ssl_dhparam /etc/nginx/ssl/dhparams_4096.pem;
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-use-strong-key-exchange"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_100.png" alt="arrowtr_100"></a></a></sub></p>
<h6 id="external-resources-33">External resources</h6>
<ul>
<li><a href="https://weakdh.org/">Weak Diffie-Hellman and the Logjam Attack</a></li>
<li><a href="https://weakdh.org/sysadmin.html">Guide to Deploying Diffie-Hellman for TLS</a></li>
<li><a href="https://wiki.mozilla.org/Security/Server_Side_TLS#ffdhe4096">Pre-defined DHE groups</a></li>
<li><a href="https://security.stackexchange.com/questions/95178/diffie-hellman-parameters-still-calculating-after-24-hours/95184#95184">Instructs OpenSSL to produce "DSA-like" DH parameters</a></li>
<li><a href="https://security.stackexchange.com/questions/44251/openssl-generate-different-types-of-self-signed-certificate">OpenSSL generate different types of self signed certificate</a></li>
</ul>
<h4 id="defend-against-the-beast-attack"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Defend against the BEAST attack</h4>
<h6 id="rationale-33">Rationale</h6>
<blockquote>
<p>Generally the BEAST attack relies on a weakness in the way CBC mode is used in SSL/TLS.</p>
</blockquote>
<blockquote>
<p>More specifically, to successfully perform the BEAST attack, there are some conditions which needs to be met:</p>
<ul>
<li>vulnerable version of SSL must be used using a block cipher (CBC in particular)</li>
<li>JavaScript or a Java applet injection - should be in the same origin of the web site</li>
<li>data sniffing of the network connection must be possible</li>
</ul>
</blockquote>
<blockquote>
<p>To prevent possible use BEAST attacks you should enable server-side protection, which causes the server ciphers should be preferred over the client ciphers, and completely excluded TLS 1.0 from your protocol stack.</p>
</blockquote>
<h6 id="example-31">Example</h6>
<pre><code class="language-bash">ssl_prefer_server_ciphers on;
</code></pre>
<h6 id="external-resources-34">External resources</h6>
<ul>
<li><a href="https://commandlinefanatic.com/cgi-bin/showarticle.cgi?article=art027">An Illustrated Guide to the BEAST Attack</a></li>
<li><a href="https://blog.ivanristic.com/2013/09/is-beast-still-a-threat.html">Is BEAST still a threat?</a></li>
<li><a href="https://blogs.cisco.com/security/beat-the-beast-with-tls">Beat the BEAST with TLS 1.1/1.2 and More</a></li>
</ul>
<h4 id="mitigation-of-crimebreach-attacks"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Mitigation of CRIME/BREACH attacks</h4>
<h6 id="rationale-34">Rationale</h6>
<blockquote>
<p>Disable HTTP compression or compress only zero sensitive content.</p>
</blockquote>
<blockquote>
<p>You should probably never use TLS compression. Some user agents (at least Chrome) will disable it anyways. Disabling SSL/TLS compression stops the attack very effectively. A deployment of HTTP/2 over TLS 1.2 must disable TLS compression (please see <a href="https://tools.ietf.org/html/rfc7540#section-9.2">RFC 7540: 9.2. Use of TLS Features</a>).</p>
</blockquote>
<blockquote>
<p>CRIME exploits SSL/TLS compression which is disabled since nginx 1.3.2. BREACH exploits HTTP compression</p>
</blockquote>
<blockquote>
<p>Some attacks are possible (e.g. the real BREACH attack is a complicated) because of gzip (HTTP compression not TLS compression) being enabled on SSL requests. In most cases, the best action is to simply disable gzip for SSL.</p>
</blockquote>
<blockquote>
<p>Compression is not the only requirement for the attack to be done so using it does not mean that the attack will succeed. Generally you should consider whether having an accidental performance drop on HTTPS sites is better than HTTPS sites being accidentally vulnerable.</p>
</blockquote>
<blockquote>
<p>You shouldn't use HTTP compression on private responses when using TLS.</p>
</blockquote>
<blockquote>
<p>I would gonna to prioritize security over performance but compression can be (I think) okay to HTTP compress publicly available static content like css or js and HTML content with zero sensitive info (like an "About Us" page).</p>
</blockquote>
<blockquote>
<p>Remember: by default, NGINX doesn't compress image files using its per-request gzip module.</p>
</blockquote>
<blockquote>
<p>Gzip static module is better, for 2 reasons:</p>
<ul>
<li>you don't have to gzip for each request</li>
<li>you can use a higher gzip level</li>
</ul>
</blockquote>
<blockquote>
<p>You should put the <code>gzip_static on;</code> inside the blocks that configure static files, but if you’re only running one site, it’s safe to just put it in the http block.</p>
</blockquote>
<h6 id="example-32">Example</h6>
<pre><code class="language-bash"># Disable dynamic HTTP compression:
gzip off;

# Enable dynamic HTTP compression for specific location context:
location / {

  gzip on;

  ...

}

# Enable static gzip compression:
location ^~ /assets/ {

  gzip_static on;

  ...

}
</code></pre>
<h6 id="external-resources-35">External resources</h6>
<ul>
<li><a href="https://security.stackexchange.com/questions/20406/is-http-compression-safe">Is HTTP compression safe?</a></li>
<li><a href="https://www.pcworld.com/article/3051675/http-compression-continues-to-put-encrypted-communications-at-risk.html">HTTP compression continues to put encrypted communications at risk</a></li>
<li><a href="http://niiconsulting.com/checkmate/2013/12/ssltls-attacks-part-2-crime-attack/">SSL/TLS attacks: Part 2 – CRIME Attack</a></li>
<li><a href="https://blog.qualys.com/ssllabs/2013/08/07/defending-against-the-breach-attack">Defending against the BREACH Attack</a></li>
<li><a href="https://security.stackexchange.com/questions/172581/to-avoid-breach-can-we-use-gzip-on-non-token-responses">To avoid BREACH, can we use gzip on non-token responses?</a></li>
<li><a href="https://blog.ircmaxell.com/2013/08/dont-worry-about-breach.html">Don't Worry About BREACH</a></li>
<li><a href="http://nginx.org/en/docs/http/ngx_http_gzip_static_module.html">Module ngx_http_gzip_static_module</a></li>
<li><a href="https://theartofmachinery.com/2016/06/06/nginx_gzip_static.html">Offline Compression with Nginx</a></li>
</ul>
<h4 id="http-strict-transport-security"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> HTTP Strict Transport Security</h4>
<h6 id="rationale-35">Rationale</h6>
<blockquote>
<p>The header indicates for how long a browser should unconditionally refuse to take part in unsecured HTTP connection for a specific domain.</p>
</blockquote>
<h6 id="example-33">Example</h6>
<pre><code class="language-bash">add_header Strict-Transport-Security "max-age=63072000; includeSubdomains" always;
</code></pre>
<p>&nbsp;&nbsp;<sub><a href="#beginner-http-strict-transport-security"><a href="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_A+.png" data-uk-lightbox><img src="https://github.com/trimstray/nginx-admins-handbook/blob/master/static/img/arrowtr_A+.png" alt="arrowtr_A+"></a></a></sub></p>
<h6 id="external-resources-36">External resources</h6>
<ul>
<li><a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet">HTTP Strict Transport Security Cheat Sheet</a></li>
<li><a href="https://zinoui.com/blog/security-http-headers#strict-transport-security">Security HTTP Headers - Strict-Transport-Security</a></li>
</ul>
<h4 id="reduce-xss-risks-content-security-policy"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Reduce XSS risks (Content-Security-Policy)</h4>
<h6 id="rationale-36">Rationale</h6>
<blockquote>
<p>CSP reduce the risk and impact of XSS attacks in modern browsers.</p>
</blockquote>
<blockquote>
<p>Whitelisting known-good resource origins, refusing to execute potentially dangerous inline scripts, and banning the use of eval are all effective mechanisms for mitigating cross-site scripting attacks.</p>
</blockquote>
<blockquote>
<p>CSP is a good defence-in-depth measure to make exploitation of an accidental lapse in that less likely.</p>
</blockquote>
<blockquote>
<p>Before enable this header you should discuss with developers about it. They probably going to have to update your application to remove any inline script and style, and make some additional modifications there.</p>
</blockquote>
<h6 id="example-34">Example</h6>
<pre><code class="language-bash"># This policy allows images, scripts, AJAX, and CSS from the same origin, and does not allow any other resources to load.
add_header Content-Security-Policy "default-src 'none'; script-src 'self'; connect-src 'self'; img-src 'self'; style-src 'self';" always;
</code></pre>
<h6 id="external-resources-37">External resources</h6>
<ul>
<li><a href="https://content-security-policy.com/">Content Security Policy (CSP) Quick Reference Guide</a></li>
<li><a href="https://www.owasp.org/index.php/Content_Security_Policy">Content Security Policy – OWASP</a></li>
<li><a href="https://zinoui.com/blog/security-http-headers#content-security-policy">Security HTTP Headers - Content-Security-Policy</a></li>
</ul>
<h4 id="control-the-behavior-of-the-referer-header-referrer-policy"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Control the behavior of the Referer header (Referrer-Policy)</h4>
<h6 id="rationale-37">Rationale</h6>
<blockquote>
<p>Determine what information is sent along with the requests.</p>
</blockquote>
<h6 id="example-35">Example</h6>
<pre><code class="language-bash">add_header Referrer-Policy "no-referrer";
</code></pre>
<h6 id="external-resources-38">External resources</h6>
<ul>
<li><a href="https://scotthelme.co.uk/a-new-security-header-referrer-policy/">A new security header: Referrer Policy</a></li>
<li><a href="https://zinoui.com/blog/security-http-headers#referrer-policy">Security HTTP Headers - Referrer-Policy</a></li>
</ul>
<h4 id="provide-clickjacking-protection-x-frame-options"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Provide clickjacking protection (X-Frame-Options)</h4>
<h6 id="rationale-38">Rationale</h6>
<blockquote>
<p>Helps to protect your visitors against clickjacking attacks. It is recommended that you use the <code>x-frame-options</code> header on pages which should not be allowed to render a page in a frame.</p>
</blockquote>
<h6 id="example-36">Example</h6>
<pre><code class="language-bash">add_header X-Frame-Options "SAMEORIGIN" always;
</code></pre>
<h6 id="external-resources-39">External resources</h6>
<ul>
<li><a href="https://www.owasp.org/index.php/Clickjacking_Defense_Cheat_Sheet">Clickjacking Defense Cheat Sheet</a></li>
<li><a href="https://zinoui.com/blog/security-http-headers#x-frame-options">Security HTTP Headers - X-Frame-Options</a></li>
</ul>
<h4 id="prevent-some-categories-of-xss-attacks-x-xss-protection"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Prevent some categories of XSS attacks (X-XSS-Protection)</h4>
<h6 id="rationale-39">Rationale</h6>
<blockquote>
<p>Enable the cross-site scripting (XSS) filter built into modern web browsers.</p>
</blockquote>
<h6 id="example-37">Example</h6>
<pre><code class="language-bash">add_header X-XSS-Protection "1; mode=block" always;
</code></pre>
<h6 id="external-resources-40">External resources</h6>
<ul>
<li><a href="https://www.tunetheweb.com/security/http-security-headers/x-xss-protection/">X-XSS-Protection HTTP Header</a></li>
<li><a href="https://zinoui.com/blog/security-http-headers#x-xss-protection">Security HTTP Headers - X-XSS-Protection</a></li>
</ul>
<h4 id="prevent-sniff-mimetype-middleware-x-content-type-options"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Prevent Sniff Mimetype middleware (X-Content-Type-Options)</h4>
<h6 id="rationale-40">Rationale</h6>
<blockquote>
<p>It prevents the browser from doing MIME-type sniffing (prevents "mime" based attacks).</p>
</blockquote>
<h6 id="example-38">Example</h6>
<pre><code class="language-bash">add_header X-Content-Type-Options "nosniff" always;
</code></pre>
<h6 id="external-resources-41">External resources</h6>
<ul>
<li><a href="https://www.keycdn.com/support/x-content-type-options">X-Content-Type-Options HTTP Header</a></li>
<li><a href="https://zinoui.com/blog/security-http-headers#x-content-type-options">Security HTTP Headers - X-Content-Type-Options</a></li>
</ul>
<h4 id="deny-the-use-of-browser-features-feature-policy"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Deny the use of browser features (Feature-Policy)</h4>
<h6 id="rationale-41">Rationale</h6>
<blockquote>
<p>This header protects your site from third parties using APIs that have security and privacy implications, and also from your own team adding outdated APIs or poorly optimized images.</p>
</blockquote>
<h6 id="example-39">Example</h6>
<pre><code class="language-bash">add_header Feature-Policy "geolocation 'none'; midi 'none'; notifications 'none'; push 'none'; sync-xhr 'none'; microphone 'none'; camera 'none'; magnetometer 'none'; gyroscope 'none'; speaker 'none'; vibrate 'none'; fullscreen 'none'; payment 'none'; usb 'none';";
</code></pre>
<h6 id="external-resources-42">External resources</h6>
<ul>
<li><a href="https://docs.google.com/document/d/1k0Ua-ZWlM_PsFCFdLMa8kaVTo32PeNZ4G7FFHqpFx4E/edit">Feature Policy Explainer</a></li>
<li><a href="https://github.com/w3c/webappsec-feature-policy/blob/master/features.html">Policy Controlled Features</a></li>
<li><a href="https://zinoui.com/blog/security-http-headers#feature-policy">Security HTTP Headers - Feature-Policy</a></li>
</ul>
<h4 id="reject-unsafe-http-methods"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Reject unsafe HTTP methods</h4>
<h6 id="rationale-42">Rationale</h6>
<blockquote>
<p>Set of methods support by a resource. An ordinary web server supports the <code>HEAD</code>, <code>GET</code> and <code>POST</code> methods to retrieve static and dynamic content. Other (e.g. <code>OPTIONS</code>, <code>TRACE</code>) methods should not be supported on public web servers, as they increase the attack surface.</p>
</blockquote>
<h6 id="example-40">Example</h6>
<pre><code class="language-bash">add_header Allow "GET, POST, HEAD" always;

if ($request_method !~ ^(GET|POST|HEAD)$) {

  return 405;

}
</code></pre>
<h6 id="external-resources-43">External resources</h6>
<ul>
<li><a href="https://www.onwebsecurity.com/security/unsafe-http-methods.html">Vulnerability name: Unsafe HTTP methods</a></li>
</ul>
<h4 id="control-buffer-overflow-attacks"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Control Buffer Overflow attacks</h4>
<h6 id="rationale-43">Rationale</h6>
<blockquote>
<p>Buffer overflow attacks are made possible by writing data to a buffer and exceeding that buffers’ boundary and overwriting memory fragments of a process. To prevent this in NGINX we can set buffer size limitations for all clients.</p>
</blockquote>
<h6 id="example-41">Example</h6>
<pre><code class="language-bash">client_body_buffer_size 100k;
client_header_buffer_size 1k;
client_max_body_size 100k;
large_client_header_buffers 2 1k;
</code></pre>
<h6 id="external-resources-44">External resources</h6>
<ul>
<li><a href="https://www.owasp.org/index.php/SCG_WS_nginx">SCG WS nginx</a></li>
</ul>
<h4 id="mitigating-slow-http-dos-attack-closing-slow-connections"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Mitigating Slow HTTP DoS attack (Closing Slow Connections)</h4>
<h6 id="rationale-44">Rationale</h6>
<blockquote>
<p>Close connections that are writing data too infrequently, which can represent an attempt to keep connections open as long as possible.</p>
</blockquote>
<h6 id="example-42">Example</h6>
<pre><code class="language-bash">client_body_timeout 10s;
client_header_timeout 10s;
keepalive_timeout 5s 5s;
send_timeout 10s;
</code></pre>
<h6 id="external-resources-45">External resources</h6>
<ul>
<li><a href="https://www.nginx.com/blog/mitigating-ddos-attacks-with-nginx-and-nginx-plus/">Mitigating DDoS Attacks with NGINX and NGINX Plus</a></li>
<li><a href="https://www.owasp.org/index.php/SCG_WS_nginx">SCG WS nginx</a></li>
</ul>
<h1 id="reverse-proxy">Reverse Proxy</h1>
<p>One of the frequent uses of NGINX is setting it up as a proxy server.</p>
<p>To be completed.</p>
<h1 id="load-balancing">Load Balancing</h1>
<p>Load balancing is a useful mechanism to distribute incoming traffic around several capable servers. We may improve of some rules about the NGINX working as a load balancer.</p>
<h4 id="tweak-passive-health-checks"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Tweak passive health checks</h4>
<h6 id="rationale-45">Rationale</h6>
<blockquote>
<p>Monitoring for health is important on all types of load balancing mainly for business continuity. Passive checks watches for failed or timed-out connections as they pass through NGINX as requested by a client.</p>
</blockquote>
<blockquote>
<p>This functionality is enabled by default but the parameters mentioned here allow you to tweak their behavior. Default values are: <code>max_fails=1</code> and <code>fail_timeout=10s</code>.</p>
</blockquote>
<h6 id="example-43">Example</h6>
<pre><code class="language-bash">upstream backend {

  server bk01_node:80 max_fails=3 fail_timeout=5s;
  server bk02_node:80 max_fails=3 fail_timeout=5s;

}
</code></pre>
<h6 id="external-resources-46">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html">Module ngx_http_upstream_module</a></li>
</ul>
<h4 id="dont-disable-backends-by-comments-use-down-parameter"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Don't disable backends by comments, use <code>down</code> parameter</h4>
<h6 id="rationale-46">Rationale</h6>
<blockquote>
<p>Sometimes we need to turn off backends e.g. at maintenance-time. I think good solution is marks the server as permanently unavailable with <code>down</code> parameter even if the downtime takes a short time.</p>
</blockquote>
<blockquote>
<p>Comments are good for really permanently disable servers or if you want to leave information for historical purposes.</p>
</blockquote>
<blockquote>
<p>NGINX also provides a <code>backup</code> parameter which marks the server as a backup server. It will be passed requests when the primary servers are unavailable. I use this option rarely for the above purposes and only if I am sure that the backends will work at the maintenance time.</p>
</blockquote>
<h6 id="example-44">Example</h6>
<pre><code class="language-bash">upstream backend {

  server bk01_node:80 max_fails=3 fail_timeout=5s down;
  server bk02_node:80 max_fails=3 fail_timeout=5s;

}
</code></pre>
<h6 id="external-resources-47">External resources</h6>
<ul>
<li><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html">Module ngx_http_upstream_module</a></li>
</ul>
<h1 id="others">Others</h1>
<p>This rules aren't strictly related to the NGINX but in my opinion they're also very important aspect of security.</p>
<h4 id="enable-dns-caa-policy"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Enable DNS CAA Policy</h4>
<h6 id="rationale-47">Rationale</h6>
<blockquote>
<p>DNS CAA policy helps you to control which Certificat Authorities are allowed to issue certificates for your domain becaues if no CAA record is present, any CA is allowed to issue a certificate for the domain.</p>
</blockquote>
<h6 id="example-45">Example</h6>
<p>Generic configuration (Google Cloud DNS, Route 53, OVH, and other hosted services) for Let's Encrypt:</p>
<pre><code class="language-bash">example.com. CAA 0 issue "letsencrypt.org"
</code></pre>
<p>Standard Zone File (BIND, PowerDNS and Knot DNS) for Let's Encrypt:</p>
<pre><code class="language-bash">example.com. IN CAA 0 issue "letsencrypt.org"
</code></pre>
<h6 id="external-resources-48">External resources</h6>
<ul>
<li><a href="https://tools.ietf.org/html/rfc6844">DNS Certification Authority Authorization (CAA) Resource Record</a></li>
<li><a href="https://support.dnsimple.com/articles/caa-record/">CAA Records</a></li>
<li><a href="https://sslmate.com/caa/">CAA Record Helper</a></li>
</ul>
<h4 id="define-security-policies-with-securitytxt"><a href="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" data-uk-lightbox><img src="https://img.cntofu.com/book/nginx-admins-handbook//img/beginner.png" alt="emoji places:beginner" height="20" width="20" align="absmiddle"></a> Define security policies with <code>security.txt</code></h4>
<h6 id="rationale-48">Rationale</h6>
<blockquote>
<p>The main purpose of <code>security.txt</code> is to help make things easier for companies and security researchers when trying to secure platforms. It also provides information to assist in disclosing security vulnerabilities.</p>
</blockquote>
<blockquote>
<p>When security researchers detect potential vulnerabilities in a page or application, they will try to contact someone "appropriate" to "responsibly" reveal the problem. It's worth taking care of getting to the right address.</p>
</blockquote>
<blockquote>
<p>This file should be placed under the <code>/.well-known/</code> path, e.g. <code>/.well-known/security.txt</code> (<a href="https://tools.ietf.org/html/rfc5785">RFC5785</a>) of a domain name or IP address for web properties.</p>
</blockquote>
<h6 id="example-46">Example</h6>
<pre><code class="language-bash">curl -ks https://example.com/.well-known/security.txt

Contact: security@example.com
Contact: +1-209-123-0123
Encryption: https://example.com/pgp.txt
Preferred-Languages: en
Canonical: https://example.com/.well-known/security.txt
Policy: https://example.com/security-policy.html
</code></pre>
<p>And from Google:</p>
<pre><code class="language-bash">curl -ks https://www.google.com/.well-known/security.txt

Contact: https://g.co/vulnz
Contact: mailto:security@google.com
Encryption: https://services.google.com/corporate/publickey.txt
Acknowledgements: https://bughunter.withgoogle.com/
Policy: https://g.co/vrp
Hiring: https://g.co/SecurityPrivacyEngJobs
# Flag: BountyCon{075e1e5eef2bc8d49bfe4a27cd17f0bf4b2b85cf}
</code></pre>
<h6 id="external-resources-49">External resources</h6>
<ul>
<li><a href="https://tools.ietf.org/html/draft-foudil-securitytxt-05">A Method for Web Security Policies</a></li>
<li><a href="https://securitytxt.org/">security.txt</a></li>
</ul>
<h1 id="configuration-examples">Configuration Examples</h1>
<blockquote>
<p>Remember to make a copy of the current configuration and all files/directories.</p>
</blockquote>
<h2 id="installation">Installation</h2>
<p>I used step-by-step tutorial from <a href="#installation-from-source">Installation from source</a>.</p>
<h2 id="configuration">Configuration</h2>
<p>Configuration of Google Cloud instance:</p>
<table>
<thead>
<tr>
<th align="left"><b>ITEM</b></th>
<th align="left"><b>VALUE</b></th>
<th align="left"><b>COMMENT</b></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">VM</td>
<td align="left">Google Cloud Platform</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">vCPU</td>
<td align="left">2x</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Memory</td>
<td align="left">4096MB</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">HTTP</td>
<td align="left">Varnish on port 80</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">HTTPS</td>
<td align="left">NGINX on port 443</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<h2 id="reverse-proxy-1">Reverse Proxy</h2>
<p>This chapter describes the basic configuration of my proxy server (for <a href="https://blkcipher.info">blkcipher.info</a> domain).</p>
<blockquote>
<p>Configuration of my Reverse Proxy server is based on <a href="#installation-from-source">installation from source</a> chapter. If you go through the installation process step by step you can use the following configuration (minor adjustments may be required).</p>
</blockquote>
<h4 id="import-configuration">Import configuration</h4>
<p>It's very simple - clone the repo, backup your current configuration and perform full directory sync:</p>
<pre><code class="language-bash">git clone https://github.com/trimstray/nginx-admins-handbook

tar czvfp ~/nginx.etc.tgz /etc/nginx &amp;&amp; mv /etc/nginx /etc/nginx.old

rsync -avur lib/nginx/ /etc/nginx/
</code></pre>
<blockquote>
<p>If you compiled NGINX you should also update/refresh modules. All compiled modules are stored in <code>/usr/local/src/nginx-${ngx_version}/master/objs</code> and installed in accordance with the value of the <code>--modules-path</code> variable.</p>
</blockquote>
<h4 id="set-bind-ip-address">Set bind IP address</h4>
<h6 id="find-and-replace-1921682522-string-in-directory-and-file-names">Find and replace 192.168.252.2 string in directory and file names</h6>
<pre><code class="language-bash">cd /etc/nginx
find . -not -path '*/\.git*' -depth -name '*192.168.252.2*' -execdir bash -c 'mv -v "$1" "${1//192.168.252.2/xxx.xxx.xxx.xxx}"' _ {} \;
</code></pre>
<h6 id="find-and-replace-1921682522-string-in-configuration-files">Find and replace 192.168.252.2 string in configuration files</h6>
<pre><code class="language-bash">cd /etc/nginx
find . -not -path '*/\.git*' -type f -print0 | xargs -0 sed -i 's/192.168.252.2/xxx.xxx.xxx.xxx/g'
</code></pre>
<h4 id="set-your-domain-name">Set your domain name</h4>
<h6 id="find-and-replace-blkcipherinfo-string-in-directory-and-file-names">Find and replace blkcipher.info string in directory and file names</h6>
<pre><code class="language-bash">cd /etc/nginx
find . -not -path '*/\.git*' -depth -name '*blkcipher.info*' -execdir bash -c 'mv -v "$1" "${1//blkcipher.info/example.com}"' _ {} \;
</code></pre>
<h6 id="find-and-replace-blkcipherinfo-string-in-configuration-files">Find and replace blkcipher.info string in configuration files</h6>
<pre><code class="language-bash">cd /etc/nginx
find . -not -path '*/\.git*' -type f -print0 | xargs -0 sed -i 's/blkcipher_info/example_com/g'
find . -not -path '*/\.git*' -type f -print0 | xargs -0 sed -i 's/blkcipher.info/example.com/g'
</code></pre>
<h4 id="regenerate-private-keys-and-certs">Regenerate private keys and certs</h4>
<h6 id="for-localhost">For localhost</h6>
<pre><code class="language-bash">cd /etc/nginx/master/_server/localhost/certs

# Private key + Self-signed certificate:
( _fd="localhost.key" ; _fd_crt="nginx_localhost_bundle.crt" ; \
openssl req -x509 -newkey rsa:2048 -keyout ${_fd} -out ${_fd_crt} -days 365 -nodes \
-subj "../../C=X0/ST=localhost/L=localhost/O=localhost/OU=X00/CN=localhost" )
</code></pre>
<h6 id="for-default-server">For <code>default_server</code></h6>
<pre><code class="language-bash">cd /etc/nginx/master/_server/defaults/certs

# Private key + Self-signed certificate:
( _fd="defaults.key" ; _fd_crt="nginx_defaults_bundle.crt" ; \
openssl req -x509 -newkey rsa:2048 -keyout ${_fd} -out ${_fd_crt} -days 365 -nodes \
-subj "../../C=X1/ST=default/L=default/O=default/OU=X11/CN=default_server" )
</code></pre>
<h6 id="for-your-domain-eg-lets-encrypt">For your domain (e.g. Let's Encrypt)</h6>
<pre><code class="language-bash">cd /etc/nginx/master/_server/example.com/certs

# For multidomain:
certbot certonly -d example.com -d www.example.com --rsa-key-size 2048

# For wildcard:
certbot certonly --manual --preferred-challenges=dns -d example.com -d *.example.com --rsa-key-size 2048

# Copy private key and chain:
cp /etc/letsencrypt/live/example.com/fullchain.pem nginx_example.com_bundle.crt
cp /etc/letsencrypt/live/example.com/privkey.pem example.com.key
</code></pre>
<h4 id="update-modules-list">Update modules list</h4>
<p>Update modules list and include <code>modules.conf</code> to your configuration:</p>
<pre><code class="language-bash">_mod_dir="../../etc/nginx/modules"

:&gt;"${_mod_dir}.conf"

for _module in $(ls "${_mod_dir}/") ; do echo -en "load_module\t\t${_mod_dir}/$_module;\n" &gt;&gt; "${_mod_dir}.conf" ; done
</code></pre>
<h4 id="generating-the-necessary-error-pages">Generating the necessary error pages</h4>
<blockquote>
<p>In the example (<code>lib/nginx</code>) error pages are included from <code>lib/nginx/master/_static/errors.conf</code> file.</p>
</blockquote>
<ul>
<li>default location: <code>/etc/nginx/html</code>: <pre><code class="language-bash">50x.html  index.html
</code></pre> </li>
<li>custom location: <code>/usr/share/www</code>: <pre><code class="language-bash">cd /etc/nginx/snippets/http-error-pages

./httpgen

# You can also sync sites/ directory with /etc/nginx/html:
#   rsync -var sites/ /etc/nginx/html/
rsync -var sites/ /usr/share/www/
</code></pre> </li>
</ul>
<h4 id="add-new-domain">Add new domain</h4>
<h6 id="updated-nginxconf">Updated <code>nginx.conf</code></h6>
<pre><code class="language-bash"># At the end of the file (in 'IPS/DOMAINS' section):
include /etc/nginx/master/_server/domain.com/servers.conf;
include /etc/nginx/master/_server/domain.com/backends.conf;
</code></pre>
<h6 id="init-domain-directory">Init domain directory</h6>
<pre><code class="language-bash">cd /etc/nginx/cd master/_server
cp -R example.com domain.com

cd domain.com
find . -not -path '*/\.git*' -depth -name '*example.com*' -execdir bash -c 'mv -v "$1" "${1//example.com/domain.com}"' _ {} \;
find . -not -path '*/\.git*' -type f -print0 | xargs -0 sed -i 's/example_com/domain_com/g'
find . -not -path '*/\.git*' -type f -print0 | xargs -0 sed -i 's/example.com/domain.com/g'
</code></pre>
<h4 id="create-log-directories">Create log directories</h4>
<pre><code class="language-bash">mkdir -p /var/log/nginx/localhost
mkdir -p /var/log/nginx/defaults
mkdir -p /var/log/nginx/others
mkdir -p /var/log/nginx/domains/blkcipher.info

chown -R nginx:nginx /var/log/nginx
</code></pre>
<h4 id="logrotate-configuration">Logrotate configuration</h4>
<pre><code class="language-bash">cp /etc/nginx/snippets/logrotate.d/nginx /etc/logrotate.d/
</code></pre>
<h4 id="test-your-configuration">Test your configuration</h4>
<pre><code class="language-bash">nginx -t -c /etc/nginx/nginx.conf
</code></pre>
</div>
<hr class="uk-article-divider">
<div class="uk-block uk-block-muted uk-padding-top-remove uk-padding-bottom-remove uk-margin-large-top  book-recommend-wrap">
<div class="uk-margin-top uk-margin-bottom uk-margin-left uk-margin-right">
<div class="uk-margin uk-text-muted "><i class="uk-icon-outdent uk-icon-justify uk-margin-small-right"></i>书籍推荐</div>
<div class="books">
<ul class="uk-book-list">
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/124/index.html">
<img class="uk-book-cover" src="../../static/icons/48/nginx_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/124/index.html">Nginx学习笔记</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/66.html">tyloafer</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="nginx">nginx</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">11页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年7月8日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 0个">0</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/154/index.html">
<img class="uk-book-cover" src="../../static/icons/48/python_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/154/index.html">Python 学习总结</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/86.html">itroger</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="python">python</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">11页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年5月12日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 0个">0</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/8/index.html">
<img class="uk-book-cover" src="../../static/icons/48/netty_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/8/index.html">Netty 实战(精髓)</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/6.html">waylau</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="netty">netty</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">101页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年5月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 817个">817</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/69/index.html">
<img class="uk-book-cover" src="../../static/icons/48/android_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/69/index.html">Android 资源大全中文版</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/19.html">伯乐在线</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="android">android</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">1页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月6日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 1046个">1046</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/62/index.html">
<img class="uk-book-cover" src="../../static/icons/48/machine-learning_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/62/index.html">Google 深度学习笔记</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/38.html">ahangchen</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="machine-learning">machine-learning</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">19页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2018年6月5日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 1243个">1243</span>
</div>
</div>
</div>
</li>
<hr>
<li>
<div class="uk-book-item">
<div class="uk-book-header uk-clearfix">
<a href="../../book/143/index.html">
<img class="uk-book-cover" src="../../static/icons/48/intellij_48.png" height="48px" alt="">
</a>
<h4 class="uk-book-title uk-margin-small-bottom"><a href="../../book/143/index.html">IntelliJ IDEA 简体中文专题教程</a></h4>
<div class="uk-book-meta  uk-text-middle uk-float-left">
<a class="uk-margin-small-right  uk-text-middle user-name " href="../../user/76.html">judasn</a>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-badge uk-badge-notification  book-subject" title="intellij">intellij</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">43页</span>
<span class="uk-margin-small-right  uk-text-middle">•</span>
<span class="uk-margin-small-right  uk-text-middle">2019年3月3日</span>
</div>
<div class="uk-book-tip uk-float-right  uk-text-middle">
<span class="uk-badge uk-badge-notification" title="github star 10995个">10995</span>
</div>
</div>
</div>
</li>
<hr>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="tm-navbar uk-navbar uk-navbar-attached reader-nav">
<div class="uk-float-left uk-margin-small-top">
<a href="javascript:;" title="目录菜单" class="show-menu  uk-icon-hover  uk-icon-align-justify uk-margin-right"></a>
<div data-uk-dropdown="{mode:'click',pos:'bottom-left'}" class="font-setting-wrap">
<a class="uk-icon-hover uk-icon-font uk-margin-right" aria-label="字体设置" href="javascript:;"></a>
<div class="uk-dropdown dropdown-menu">
<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-reduce">小字</button>
<button class="uk-button-link button size-2 font-enlarge">大字</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-2 font-1 ">宋体</button>
<button class="uk-button-link button size-2 font-2 ">黑体</button>
</div>
<hr>
<div class="buttons uk-clearfix">
<button class="uk-button-link button size-3 color-theme-sun "><i class="uk-icon-sun-o"></i>白天</button>
<button class="uk-button-link button size-3 color-theme-eye "><i class="uk-icon-eye"></i>护眼</button>
<button class="uk-button-link button size-3 color-theme-moon "><i class="uk-icon-moon-o"></i>夜晚</button></div>
</div>
</div>
<a class="logo uk-margin-right" href="../../" title="返回首页"><img class="" src="../../static/components/images/icon_32.png" /></a>
</div>
<div class="uk-navbar-flip  uk-hidden-small">
<div id="share-box"></div>
</div>
</nav>
<div id="menu-id" class="uk-offcanvas reader-offcanvas">
<div class="uk-offcanvas-bar">
<ul class="book-menu-bar uk-nav uk-nav-offcanvas" data-uk-nav>
<li>
<a href="../../book/190/index.html" data-book-page-rel-url="index.html" data-book-page-id="0" title="封面">封面</a>
</li>
<li>
<a class="pjax" href="../../book/190/readme.html" data-book-page-rel-url="readme.html" data-book-page-id="0" title="简介">简介</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#introduction" title="Introduction" data-book-page-rel-url="README.html#introduction" data-book-page-id="12725">Introduction</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#general-disclaimer" title="General disclaimer" data-book-page-rel-url="README.html#general-disclaimer" data-book-page-id="12726">General disclaimer</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#contributing--support" title="Contributing & Support" data-book-page-rel-url="README.html#contributing--support" data-book-page-id="12727">Contributing & Support</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#reports-blkcipherinfo" title="Reports: blkcipher.info" data-book-page-rel-url="README.html#reports-blkcipherinfo" data-book-page-id="12729">Reports: blkcipher.info</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#ssl-labs" title="SSL Labs" data-book-page-rel-url="README.html#ssl-labs" data-book-page-id="12730">SSL Labs</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#mozilla-observatory" title="Mozilla Observatory" data-book-page-rel-url="README.html#mozilla-observatory" data-book-page-id="12731">Mozilla Observatory</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#printable-high-res-hardening-checklists" title="Printable high-res hardening checklists" data-book-page-rel-url="README.html#printable-high-res-hardening-checklists" data-book-page-id="12732">Printable high-res hardening checklists</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#printable-high-res-hardening-cheatsheet" title="Printable high-res hardening cheatsheet" data-book-page-rel-url="README.html#printable-high-res-hardening-cheatsheet" data-book-page-id="13045">Printable high-res hardening cheatsheet</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#all-in-one-checklist-as-a-quick-introduction" title="All in one checklist as a quick introduction" data-book-page-rel-url="README.html#all-in-one-checklist-as-a-quick-introduction" data-book-page-id="13052">All in one checklist as a quick introduction</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#books" title="Books" data-book-page-rel-url="README.html#books" data-book-page-id="12733">Books</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-essentials" title="Nginx Essentials" data-book-page-rel-url="README.html#nginx-essentials" data-book-page-id="12734">Nginx Essentials</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-cookbook" title="Nginx Cookbook" data-book-page-rel-url="README.html#nginx-cookbook" data-book-page-id="12735">Nginx Cookbook</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-http-server" title="Nginx HTTP Server" data-book-page-rel-url="README.html#nginx-http-server" data-book-page-id="12736">Nginx HTTP Server</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-high-performance" title="Nginx High Performance" data-book-page-rel-url="README.html#nginx-high-performance" data-book-page-id="12737">Nginx High Performance</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#modsecurity-30-and-nginx-quick-start-guide" title="ModSecurity 3.0 and NGINX: Quick Start Guide" data-book-page-rel-url="README.html#modsecurity-30-and-nginx-quick-start-guide" data-book-page-id="12739">ModSecurity 3.0 and NGINX: Quick Start Guide</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#cisco-ace-to-nginx-migration-guide" title="Cisco ACE to NGINX: Migration Guide" data-book-page-rel-url="README.html#cisco-ace-to-nginx-migration-guide" data-book-page-id="12740">Cisco ACE to NGINX: Migration Guide</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#external-resources" title="External Resources" data-book-page-rel-url="README.html#external-resources" data-book-page-id="12741">External Resources</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-official" title="Nginx official" data-book-page-rel-url="README.html#nginx-official" data-book-page-id="12742">Nginx official</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#based-on-the-nginx" title="Based on the Nginx" data-book-page-rel-url="README.html#based-on-the-nginx" data-book-page-id="12743">Based on the Nginx</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#comparison-reviews" title="Comparison reviews" data-book-page-rel-url="README.html#comparison-reviews" data-book-page-id="12744">Comparison reviews</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#cheatsheets--references" title="Cheatsheets & References" data-book-page-rel-url="README.html#cheatsheets--references" data-book-page-id="12745">Cheatsheets & References</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#performance--hardening" title="Performance & Hardening" data-book-page-rel-url="README.html#performance--hardening" data-book-page-id="12746">Performance & Hardening</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#playgrounds" title="Playgrounds" data-book-page-rel-url="README.html#playgrounds" data-book-page-id="12747">Playgrounds</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#config-generators" title="Config generators" data-book-page-rel-url="README.html#config-generators" data-book-page-id="12748">Config generators</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#static-analyzers" title="Static analyzers" data-book-page-rel-url="README.html#static-analyzers" data-book-page-id="12749">Static analyzers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#log-analyzers" title="Log analyzers" data-book-page-rel-url="README.html#log-analyzers" data-book-page-id="12750">Log analyzers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#performance-analyzers" title="Performance analyzers" data-book-page-rel-url="README.html#performance-analyzers" data-book-page-id="12751">Performance analyzers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#benchmarking-tools" title="Benchmarking tools" data-book-page-rel-url="README.html#benchmarking-tools" data-book-page-id="12752">Benchmarking tools</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#debugging-tools" title="Debugging tools" data-book-page-rel-url="README.html#debugging-tools" data-book-page-id="12985">Debugging tools</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#development" title="Development" data-book-page-rel-url="README.html#development" data-book-page-id="12753">Development</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#other-stuff" title="Other stuff" data-book-page-rel-url="README.html#other-stuff" data-book-page-id="12755">Other stuff</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#helpers" title="Helpers" data-book-page-rel-url="README.html#helpers" data-book-page-id="12756">Helpers</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-directories-and-files" title="Nginx directories and files" data-book-page-rel-url="README.html#nginx-directories-and-files" data-book-page-id="12757">Nginx directories and files</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-commands" title="Nginx commands" data-book-page-rel-url="README.html#nginx-commands" data-book-page-id="12758">Nginx commands</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-processes" title="Nginx processes" data-book-page-rel-url="README.html#nginx-processes" data-book-page-id="12759">Nginx processes</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#configuration-syntax" title="Configuration syntax" data-book-page-rel-url="README.html#configuration-syntax" data-book-page-id="12760">Configuration syntax</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#comments" title="Comments" data-book-page-rel-url="README.html#comments" data-book-page-id="12761">Comments</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#variables--strings" title="Variables & Strings" data-book-page-rel-url="README.html#variables--strings" data-book-page-id="12762">Variables & Strings</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#directives-blocks-and-contexts" title="Directives, Blocks, and Contexts" data-book-page-rel-url="README.html#directives-blocks-and-contexts" data-book-page-id="12763">Directives, Blocks, and Contexts</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#measurement-units" title="Measurement units" data-book-page-rel-url="README.html#measurement-units" data-book-page-id="12764">Measurement units</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#enable-syntax-highlight-for-nginx-configuration-file" title="Enable syntax highlight for Nginx configuration file" data-book-page-rel-url="README.html#enable-syntax-highlight-for-nginx-configuration-file" data-book-page-id="12765">Enable syntax highlight for Nginx configuration file</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#connection-processing" title="Connection processing" data-book-page-rel-url="README.html#connection-processing" data-book-page-id="12766">Connection processing</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#request-processing-stages" title="Request processing stages" data-book-page-rel-url="README.html#request-processing-stages" data-book-page-id="12767">Request processing stages</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#server-blocks-logic" title="Server blocks logic" data-book-page-rel-url="README.html#server-blocks-logic" data-book-page-id="12768">Server blocks logic</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#handle-incoming-connections" title="Handle incoming connections" data-book-page-rel-url="README.html#handle-incoming-connections" data-book-page-id="12769">Handle incoming connections</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#matching-location" title="Matching location" data-book-page-rel-url="README.html#matching-location" data-book-page-id="12770">Matching location</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#error-log-severity-levels" title="Error log severity levels" data-book-page-rel-url="README.html#error-log-severity-levels" data-book-page-id="12771">Error log severity levels</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#rate-limiting" title="Rate limiting" data-book-page-rel-url="README.html#rate-limiting" data-book-page-id="12772">Rate limiting</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-configuration" title="Analyse configuration" data-book-page-rel-url="README.html#analyse-configuration" data-book-page-id="12773">Analyse configuration</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#monitoring" title="Monitoring" data-book-page-rel-url="README.html#monitoring" data-book-page-id="12774">Monitoring</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#goaccess" title="GoAccess" data-book-page-rel-url="README.html#goaccess" data-book-page-id="12775">GoAccess</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#build-and-install" title="Build and install" data-book-page-rel-url="README.html#build-and-install" data-book-page-id="12776">Build and install</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-log-file-and-enable-all-recorded-statistics" title="Analyse log file and enable all recorded statistics" data-book-page-rel-url="README.html#analyse-log-file-and-enable-all-recorded-statistics" data-book-page-id="12777">Analyse log file and enable all recorded statistics</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-compressed-log-file" title="Analyse compressed log file" data-book-page-rel-url="README.html#analyse-compressed-log-file" data-book-page-id="12778">Analyse compressed log file</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-log-file-remotely" title="Analyse log file remotely" data-book-page-rel-url="README.html#analyse-log-file-remotely" data-book-page-id="12779">Analyse log file remotely</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-log-file-and-generate-html-report" title="Analyse log file and generate html report" data-book-page-rel-url="README.html#analyse-log-file-and-generate-html-report" data-book-page-id="12780">Analyse log file and generate html report</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#ngxtop" title="Ngxtop" data-book-page-rel-url="README.html#ngxtop" data-book-page-id="12781">Ngxtop</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-log-file" title="Analyse log file" data-book-page-rel-url="README.html#analyse-log-file" data-book-page-id="12782">Analyse log file</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-log-file-and-print-requests-with-4xx-and-5xx" title="Analyse log file and print requests with 4xx and 5xx" data-book-page-rel-url="README.html#analyse-log-file-and-print-requests-with-4xx-and-5xx" data-book-page-id="12783">Analyse log file and print requests with 4xx and 5xx</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html##analyse-log-file-remotely-1" title="Analyse log file remotely" data-book-page-rel-url="README.html##analyse-log-file-remotely-1" data-book-page-id="12784">Analyse log file remotely</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-log-file-remotely-1" title="Analyse log file remotely" data-book-page-rel-url="README.html#analyse-log-file-remotely-1" data-book-page-id="13046">Analyse log file remotely</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing" title="Testing" data-book-page-rel-url="README.html#testing" data-book-page-id="12990">Testing</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#send-request-to-the-specific-ipport-and-show-response-headers" title="Send request to the specific ip:port and show response headers" data-book-page-rel-url="README.html#send-request-to-the-specific-ipport-and-show-response-headers" data-book-page-id="12991">Send request to the specific ip:port and show response headers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#send-request-to-the-remote-host-and-show-response-headers" title="Send request to the remote host and show response headers" data-book-page-rel-url="README.html#send-request-to-the-remote-host-and-show-response-headers" data-book-page-id="13002">Send request to the remote host and show response headers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#see-the-top-5-ip-addresses-in-a-web-server-log" title="See the top 5 IP addresses in a web server log" data-book-page-rel-url="README.html#see-the-top-5-ip-addresses-in-a-web-server-log" data-book-page-id="12787">See the top 5 IP addresses in a web server log</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#send-request-and-show-response-headers" title="Send request and show response headers" data-book-page-rel-url="README.html#send-request-and-show-response-headers" data-book-page-id="13008">Send request and show response headers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#see-the-top-5-ip-addresses" title="See the top 5 IP addresses" data-book-page-rel-url="README.html#see-the-top-5-ip-addresses" data-book-page-id="12977">See the top 5 IP addresses</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#send-multiple-requests-to-the-specific-ipport" title="Send multiple requests to the specific ip:port" data-book-page-rel-url="README.html#send-multiple-requests-to-the-specific-ipport" data-book-page-id="12992">Send multiple requests to the specific ip:port</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#send-multiple-requests-to-the-remote-host" title="Send multiple requests to the remote host" data-book-page-rel-url="README.html#send-multiple-requests-to-the-remote-host" data-book-page-id="13003">Send multiple requests to the remote host</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#send-request-with-http-method-user-agent-follow-redirects-and-show-response-headers" title="Send request with http method, user-agent, follow redirects and show response headers" data-book-page-rel-url="README.html#send-request-with-http-method-user-agent-follow-redirects-and-show-response-headers" data-book-page-id="13009">Send request with http method, user-agent, follow redirects and show response headers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-to-the-remote-host" title="Testing SSL connection to the remote host" data-book-page-rel-url="README.html#testing-ssl-connection-to-the-remote-host" data-book-page-id="12993">Testing SSL connection to the remote host</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#send-multiple-requests" title="Send multiple requests" data-book-page-rel-url="README.html#send-multiple-requests" data-book-page-id="13010">Send multiple requests</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-to-the-remote-host-with-sni-support" title="Testing SSL connection to the remote host (with SNI support)" data-book-page-rel-url="README.html#testing-ssl-connection-to-the-remote-host-with-sni-support" data-book-page-id="12994">Testing SSL connection to the remote host (with SNI support)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection" title="Testing SSL connection" data-book-page-rel-url="README.html#testing-ssl-connection" data-book-page-id="13011">Testing SSL connection</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-to-the-remote-host-with-specific-ssl-version" title="Testing SSL connection to the remote host with specific ssl version" data-book-page-rel-url="README.html#testing-ssl-connection-to-the-remote-host-with-specific-ssl-version" data-book-page-id="12995">Testing SSL connection to the remote host with specific ssl version</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-to-the-remote-host-with-specific-version" title="Testing SSL connection to the remote host with specific version" data-book-page-rel-url="README.html#testing-ssl-connection-to-the-remote-host-with-specific-version" data-book-page-id="13004">Testing SSL connection to the remote host with specific version</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-with-sni-support" title="Testing SSL connection (with SNI support)" data-book-page-rel-url="README.html#testing-ssl-connection-with-sni-support" data-book-page-id="13012">Testing SSL connection (with SNI support)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-to-the-remote-host-with-specific-ssl-cipher" title="Testing SSL connection to the remote host with specific ssl cipher" data-book-page-rel-url="README.html#testing-ssl-connection-to-the-remote-host-with-specific-ssl-cipher" data-book-page-id="12996">Testing SSL connection to the remote host with specific ssl cipher</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-to-the-remote-host-with-specific-cipher" title="Testing SSL connection to the remote host with specific cipher" data-book-page-rel-url="README.html#testing-ssl-connection-to-the-remote-host-with-specific-cipher" data-book-page-id="13005">Testing SSL connection to the remote host with specific cipher</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-with-specific-ssl-version" title="Testing SSL connection with specific SSL version" data-book-page-rel-url="README.html#testing-ssl-connection-with-specific-ssl-version" data-book-page-id="13013">Testing SSL connection with specific SSL version</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#testing-ssl-connection-with-specific-cipher" title="Testing SSL connection with specific cipher" data-book-page-rel-url="README.html#testing-ssl-connection-with-specific-cipher" data-book-page-id="13014">Testing SSL connection with specific cipher</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#tcp-syn-flood-denial-of-service-attack" title="HTTP Denial of Service attack" data-book-page-rel-url="README.html#tcp-syn-flood-denial-of-service-attack" data-book-page-id="12997">HTTP Denial of Service attack</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-information-about-the-nginx-processes" title="Show information about the NGINX processes" data-book-page-rel-url="README.html#show-information-about-the-nginx-processes" data-book-page-id="12989">Show information about the NGINX processes</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#debugging" title="Debugging" data-book-page-rel-url="README.html#debugging" data-book-page-id="12785">Debugging</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#get-range-of-dates-in-a-web-server-log" title="Get range of dates in a web server log" data-book-page-rel-url="README.html#get-range-of-dates-in-a-web-server-log" data-book-page-id="12790">Get range of dates in a web server log</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-information-about-nginx-processes" title="Show information about NGINX processes" data-book-page-rel-url="README.html#show-information-about-nginx-processes" data-book-page-id="13044">Show information about NGINX processes</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-the-most-requested-ips" title="Show the most requested IPs" data-book-page-rel-url="README.html#show-the-most-requested-ips" data-book-page-id="12976">Show the most requested IPs</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#check-if-the-module-has-been-compiled" title="Check if the module has been compiled" data-book-page-rel-url="README.html#check-if-the-module-has-been-compiled" data-book-page-id="12786">Check if the module has been compiled</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-the-top-5-ip-addresses" title="Show the top 5 IP addresses" data-book-page-rel-url="README.html#show-the-top-5-ip-addresses" data-book-page-id="12988">Show the top 5 IP addresses</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-the-most-accessed-ip-addresses" title="Show the most accessed IP addresses" data-book-page-rel-url="README.html#show-the-most-accessed-ip-addresses" data-book-page-id="13047">Show the most accessed IP addresses</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-the-top-5-visitors-ip-addresses" title="Show the top 5 visitors (IP addresses)" data-book-page-rel-url="README.html#show-the-top-5-visitors-ip-addresses" data-book-page-id="13048">Show the top 5 visitors (IP addresses)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-the-most-requested-urls" title="Show the most requested urls" data-book-page-rel-url="README.html#show-the-most-requested-urls" data-book-page-id="12978">Show the most requested urls</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-the-most-requested-urls-containing-string" title="Show the most requested urls containing 'string'" data-book-page-rel-url="README.html#show-the-most-requested-urls-containing-string" data-book-page-id="12979">Show the most requested urls containing 'string'</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-the-most-requested-urls-with-http-methods" title="Show the most requested urls with http methods" data-book-page-rel-url="README.html#show-the-most-requested-urls-with-http-methods" data-book-page-id="13049">Show the most requested urls with http methods</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-the-most-accessed-response-codes" title="Show the most accessed response codes" data-book-page-rel-url="README.html#show-the-most-accessed-response-codes" data-book-page-id="13050">Show the most accessed response codes</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-web-server-log-and-show-only-2xx-http-codes" title="Analyse web server log and show only 2xx http codes" data-book-page-rel-url="README.html#analyse-web-server-log-and-show-only-2xx-http-codes" data-book-page-id="12788">Analyse web server log and show only 2xx http codes</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#analyse-web-server-log-and-show-only-5xx-http-codes" title="Analyse web server log and show only 5xx http codes" data-book-page-rel-url="README.html#analyse-web-server-log-and-show-only-5xx-http-codes" data-book-page-id="12789">Analyse web server log and show only 5xx http codes</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-requests-which-result-502-and-sort-them-by-number-per-requests-by-url" title="Show requests which result 502 and sort them by number per requests by url" data-book-page-rel-url="README.html#show-requests-which-result-502-and-sort-them-by-number-per-requests-by-url" data-book-page-id="12980">Show requests which result 502 and sort them by number per requests by url</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#show-requests-which-result-404-for-php-files-and-sort-them-by-number-per-requests-by-url" title="Show requests which result 404 for php files and sort them by number per requests by url" data-book-page-rel-url="README.html#show-requests-which-result-404-for-php-files-and-sort-them-by-number-per-requests-by-url" data-book-page-id="12981">Show requests which result 404 for php files and sort them by number per requests by url</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#calculating-amount-of-http-response-codes" title="Calculating amount of http response codes" data-book-page-rel-url="README.html#calculating-amount-of-http-response-codes" data-book-page-id="12982">Calculating amount of http response codes</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#calculating-requests-per-second" title="Calculating requests per second" data-book-page-rel-url="README.html#calculating-requests-per-second" data-book-page-id="12983">Calculating requests per second</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#calculating-requests-per-second-with-ip-addresses" title="Calculating requests per second with IP addresses" data-book-page-rel-url="README.html#calculating-requests-per-second-with-ip-addresses" data-book-page-id="12986">Calculating requests per second with IP addresses</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#calculating-requests-per-second-with-ip-addresses-and-urls" title="Calculating requests per second with IP addresses and urls" data-book-page-rel-url="README.html#calculating-requests-per-second-with-ip-addresses-and-urls" data-book-page-id="13051">Calculating requests per second with IP addresses and urls</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#get-entries-within-last-n-hours" title="Get entries within last n hours" data-book-page-rel-url="README.html#get-entries-within-last-n-hours" data-book-page-id="12984">Get entries within last n hours</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#get-entries-between-two-timestamps-range-of-dates" title="Get entries between two timestamps (range of dates)" data-book-page-rel-url="README.html#get-entries-between-two-timestamps-range-of-dates" data-book-page-id="12987">Get entries between two timestamps (range of dates)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#get-line-rates-from-web-server-log" title="Get line rates from web server log" data-book-page-rel-url="README.html#get-line-rates-from-web-server-log" data-book-page-id="12791">Get line rates from web server log</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#extract-http-user-agent-from-http-request-header" title="Extract HTTP User Agent from HTTP request header" data-book-page-rel-url="README.html#extract-http-user-agent-from-http-request-header" data-book-page-id="12998">Extract HTTP User Agent from HTTP request header</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#extract-http-user-agent-from-the-http-request-header" title="Extract http User Agent from the http request header" data-book-page-rel-url="README.html#extract-http-user-agent-from-the-http-request-header" data-book-page-id="13006">Extract http User Agent from the http request header</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#trace-network-traffic-for-all-nginx-processes" title="Trace network traffic for all NGINX processes" data-book-page-rel-url="README.html#trace-network-traffic-for-all-nginx-processes" data-book-page-id="12792">Trace network traffic for all NGINX processes</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#capture-only-http-requests" title="Capture only http requests" data-book-page-rel-url="README.html#capture-only-http-requests" data-book-page-id="12999">Capture only http requests</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#list-all-files-accessed-by-a-nginx" title="List all files accessed by a NGINX" data-book-page-rel-url="README.html#list-all-files-accessed-by-a-nginx" data-book-page-id="12793">List all files accessed by a NGINX</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#check-that-the-gzip_static-module-is-working" title="Check that the gzip_static module is working" data-book-page-rel-url="README.html#check-that-the-gzip_static-module-is-working" data-book-page-id="12794">Check that the gzip_static module is working</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#capture-requests-to-the-specific-server-name-and-filter-by-source-ip-and-destination-port" title="Capture requests to the specific server name and filter by source ip and destination port" data-book-page-rel-url="README.html#capture-requests-to-the-specific-server-name-and-filter-by-source-ip-and-destination-port" data-book-page-id="13001">Capture requests to the specific server name and filter by source ip and destination port</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#capture-requests-to-the-remote-host-and-filter-by-source-ip-and-destination-port" title="Capture requests to the remote host and filter by source ip and destination port" data-book-page-rel-url="README.html#capture-requests-to-the-remote-host-and-filter-by-source-ip-and-destination-port" data-book-page-id="13007">Capture requests to the remote host and filter by source ip and destination port</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#which-worker-processing-current-request" title="Which worker processing current request" data-book-page-rel-url="README.html#which-worker-processing-current-request" data-book-page-id="12795">Which worker processing current request</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#capture-only-http-packets" title="Capture only http packets" data-book-page-rel-url="README.html#capture-only-http-packets" data-book-page-id="13015">Capture only http packets</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#extract-http-user-agent-from-the-http-packets" title="Extract http User Agent from the http packets" data-book-page-rel-url="README.html#extract-http-user-agent-from-the-http-packets" data-book-page-id="13016">Extract http User Agent from the http packets</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#capture-only-http-get-and-post-packets" title="Capture only http GET and POST packets" data-book-page-rel-url="README.html#capture-only-http-get-and-post-packets" data-book-page-id="13000">Capture only http GET and POST packets</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#capture-requests-and-filter-by-source-ip-and-destination-port" title="Capture requests and filter by source ip and destination port" data-book-page-rel-url="README.html#capture-requests-and-filter-by-source-ip-and-destination-port" data-book-page-id="13017">Capture requests and filter by source ip and destination port</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#shell-aliases" title="Shell aliases" data-book-page-rel-url="README.html#shell-aliases" data-book-page-id="12796">Shell aliases</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#configuration-snippets" title="Configuration snippets" data-book-page-rel-url="README.html#configuration-snippets" data-book-page-id="12797">Configuration snippets</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#restricting-access-with-basic-authentication" title="Restricting access with basic authentication" data-book-page-rel-url="README.html#restricting-access-with-basic-authentication" data-book-page-id="12798">Restricting access with basic authentication</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#blocking-referrer-spam" title="Blocking referrer spam" data-book-page-rel-url="README.html#blocking-referrer-spam" data-book-page-id="12800">Blocking referrer spam</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#limiting-referrer-spam" title="Limiting referrer spam" data-book-page-rel-url="README.html#limiting-referrer-spam" data-book-page-id="12801">Limiting referrer spam</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#limiting-the-rate-of-requests-with-burst-mode" title="Limiting the rate of requests with burst mode" data-book-page-rel-url="README.html#limiting-the-rate-of-requests-with-burst-mode" data-book-page-id="12802">Limiting the rate of requests with burst mode</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#limiting-the-rate-of-requests-with-burst-mode-and-nodelay" title="Limiting the rate of requests with burst mode and nodelay" data-book-page-rel-url="README.html#limiting-the-rate-of-requests-with-burst-mode-and-nodelay" data-book-page-id="12803">Limiting the rate of requests with burst mode and nodelay</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#limiting-the-number-of-connections" title="Limiting the number of connections" data-book-page-rel-url="README.html#limiting-the-number-of-connections" data-book-page-id="12804">Limiting the number of connections</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#adding-and-removing-the-www-prefix" title="Adding and removing the www prefix" data-book-page-rel-url="README.html#adding-and-removing-the-www-prefix" data-book-page-id="12805">Adding and removing the www prefix</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#rewrite-post-request-with-payload-to-external-endpoint" title="Rewrite POST request with payload to external endpoint" data-book-page-rel-url="README.html#rewrite-post-request-with-payload-to-external-endpoint" data-book-page-id="12806">Rewrite POST request with payload to external endpoint</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#allow-multiple-cross-domains-using-the-cors-headers" title="Allow multiple cross-domains using the CORS headers" data-book-page-rel-url="README.html#allow-multiple-cross-domains-using-the-cors-headers" data-book-page-id="12807">Allow multiple cross-domains using the CORS headers</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#other-snippets" title="Other snippets" data-book-page-rel-url="README.html#other-snippets" data-book-page-id="13018">Other snippets</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#create-a-temporary-static-backend" title="Create a temporary static backend" data-book-page-rel-url="README.html#create-a-temporary-static-backend" data-book-page-id="13019">Create a temporary static backend</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-csr-metadata-from-exist-certificate" title="Generate CSR (metadata from exist certificate)" data-book-page-rel-url="README.html#generate-csr-metadata-from-exist-certificate" data-book-page-id="13023">Generate CSR (metadata from exist certificate)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#create-a-temporary-static-backend-with-ssl-support" title="Create a temporary static backend with SSL support" data-book-page-rel-url="README.html#create-a-temporary-static-backend-with-ssl-support" data-book-page-id="13020">Create a temporary static backend with SSL support</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-private-key-without-passphrase" title="Generate private key without passphrase" data-book-page-rel-url="README.html#generate-private-key-without-passphrase" data-book-page-id="13021">Generate private key without passphrase</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-csr" title="Generate CSR" data-book-page-rel-url="README.html#generate-csr" data-book-page-id="13022">Generate CSR</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-csr-metadata-from-existing-certificate" title="Generate CSR (metadata from existing certificate)" data-book-page-rel-url="README.html#generate-csr-metadata-from-existing-certificate" data-book-page-id="13037">Generate CSR (metadata from existing certificate)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-csr-with--config-param" title="Generate CSR with -config param" data-book-page-rel-url="README.html#generate-csr-with--config-param" data-book-page-id="13024">Generate CSR with -config param</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-private-key-and-csr" title="Generate private key and csr" data-book-page-rel-url="README.html#generate-private-key-and-csr" data-book-page-id="13025">Generate private key and csr</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-ecdsa-private-key" title="Generate ECDSA private key" data-book-page-rel-url="README.html#generate-ecdsa-private-key" data-book-page-id="13026">Generate ECDSA private key</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-private-key-with-csr-ecc" title="Generate private key with csr (ECC)" data-book-page-rel-url="README.html#generate-private-key-with-csr-ecc" data-book-page-id="13027">Generate private key with csr (ECC)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-self-signed-certificate" title="Generate self-signed certificate" data-book-page-rel-url="README.html#generate-self-signed-certificate" data-book-page-id="13028">Generate self-signed certificate</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-self-signed-certificate-from-existing-private-key" title="Generate self-signed certificate from existing private key" data-book-page-rel-url="README.html#generate-self-signed-certificate-from-existing-private-key" data-book-page-id="13029">Generate self-signed certificate from existing private key</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-self-signed-certificate-from-existing-private-key-and-csr" title="Generate self-signed certificate from existing private key and csr" data-book-page-rel-url="README.html#generate-self-signed-certificate-from-existing-private-key-and-csr" data-book-page-id="13030">Generate self-signed certificate from existing private key and csr</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-multidomain-certificate" title="Generate multidomain certificate" data-book-page-rel-url="README.html#generate-multidomain-certificate" data-book-page-id="13031">Generate multidomain certificate</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-wildcard-certificate" title="Generate wildcard certificate" data-book-page-rel-url="README.html#generate-wildcard-certificate" data-book-page-id="13032">Generate wildcard certificate</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#checking-whether-the-private-key-and-the-certificate-match" title="Checking whether the private key and the certificate match" data-book-page-rel-url="README.html#checking-whether-the-private-key-and-the-certificate-match" data-book-page-id="13036">Checking whether the private key and the certificate match</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-certificate-with-4096-bit-private-key" title="Generate certificate with 4096 bit private key" data-book-page-rel-url="README.html#generate-certificate-with-4096-bit-private-key" data-book-page-id="13033">Generate certificate with 4096 bit private key</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generate-dh-param-key" title="Generate DH Param key" data-book-page-rel-url="README.html#generate-dh-param-key" data-book-page-id="13038">Generate DH Param key</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#convert-der-to-pem" title="Convert DER to PEM" data-book-page-rel-url="README.html#convert-der-to-pem" data-book-page-id="13034">Convert DER to PEM</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#convert-pem-to-der" title="Convert PEM to DER" data-book-page-rel-url="README.html#convert-pem-to-der" data-book-page-id="13035">Convert PEM to DER</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#verification-of-the-private-key" title="Verification of the private key" data-book-page-rel-url="README.html#verification-of-the-private-key" data-book-page-id="13039">Verification of the private key</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#verification-of-the-public-key" title="Verification of the public key" data-book-page-rel-url="README.html#verification-of-the-public-key" data-book-page-id="13040">Verification of the public key</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#verification-of-the-certificate" title="Verification of the certificate" data-book-page-rel-url="README.html#verification-of-the-certificate" data-book-page-id="13041">Verification of the certificate</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#verification-of-the-csr" title="Verification of the CSR" data-book-page-rel-url="README.html#verification-of-the-csr" data-book-page-id="13042">Verification of the CSR</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#check-whether-the-private-key-and-the-certificate-match" title="Check whether the private key and the certificate match" data-book-page-rel-url="README.html#check-whether-the-private-key-and-the-certificate-match" data-book-page-id="13043">Check whether the private key and the certificate match</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#rhel7-or-centos-7" title="RHEL7 or CentOS 7" data-book-page-rel-url="README.html#rhel7-or-centos-7" data-book-page-id="12809">RHEL7 or CentOS 7</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#debian-or-ubuntu" title="Debian or Ubuntu" data-book-page-rel-url="README.html#debian-or-ubuntu" data-book-page-id="12810">Debian or Ubuntu</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#automatic-installation" title="Automatic installation" data-book-page-rel-url="README.html#automatic-installation" data-book-page-id="12812">Automatic installation</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#nginx-package" title="Nginx package" data-book-page-rel-url="README.html#nginx-package" data-book-page-id="12813">Nginx package</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#dependencies" title="Dependencies" data-book-page-rel-url="README.html#dependencies" data-book-page-id="12814">Dependencies</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#compiler-and-linker" title="Compiler and linker" data-book-page-rel-url="README.html#compiler-and-linker" data-book-page-id="12816">Compiler and linker</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#systemtap" title="SystemTap" data-book-page-rel-url="README.html#systemtap" data-book-page-id="12817">SystemTap</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#pre-installation-tasks" title="Pre installation tasks" data-book-page-rel-url="README.html#pre-installation-tasks" data-book-page-id="12819">Pre installation tasks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#install-or-build-dependencies" title="Install or build dependencies" data-book-page-rel-url="README.html#install-or-build-dependencies" data-book-page-id="12820">Install or build dependencies</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#get-nginx-sources" title="Get Nginx sources" data-book-page-rel-url="README.html#get-nginx-sources" data-book-page-id="12821">Get Nginx sources</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#download-3rd-party-modules" title="Download 3rd party modules" data-book-page-rel-url="README.html#download-3rd-party-modules" data-book-page-id="12822">Download 3rd party modules</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#build-nginx" title="Build Nginx" data-book-page-rel-url="README.html#build-nginx" data-book-page-id="12823">Build Nginx</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#base-rules" title="Base Rules" data-book-page-rel-url="README.html#base-rules" data-book-page-id="12827">Base Rules</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-reload-method-to-change-configurations-on-the-fly" title="Use reload method to change configurations on the fly" data-book-page-rel-url="README.html#beginner-use-reload-method-to-change-configurations-on-the-fly" data-book-page-id="12833">Use reload method to change configurations on the fly</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-map-all-the-things" title="Map all the things..." data-book-page-rel-url="README.html#beginner-map-all-the-things" data-book-page-id="12837">Map all the things...</a>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#performance" title="Performance" data-book-page-rel-url="README.html#performance" data-book-page-id="12841">Performance</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#hardening" title="Hardening" data-book-page-rel-url="README.html#hardening" data-book-page-id="12849">Hardening</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#load-balancing" title="Load Balancing" data-book-page-rel-url="README.html#load-balancing" data-book-page-id="12873">Load Balancing</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#others" title="Others" data-book-page-rel-url="README.html#others" data-book-page-id="12876">Others</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#reverse-proxy" title="Reverse Proxy" data-book-page-rel-url="README.html#reverse-proxy" data-book-page-id="12880">Reverse Proxy</a>
<ul>
<li>
<a class="pjax" href="../../book/190/README.html#installation" title="Installation" data-book-page-rel-url="README.html#installation" data-book-page-id="12881">Installation</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#configuration" title="Configuration" data-book-page-rel-url="README.html#configuration" data-book-page-id="12882">Configuration</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#import-configuration" title="Import configuration" data-book-page-rel-url="README.html#import-configuration" data-book-page-id="12883">Import configuration</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#set-bind-ip-address" title="Set bind IP address" data-book-page-rel-url="README.html#set-bind-ip-address" data-book-page-id="12884">Set bind IP address</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#set-your-domain-name" title="Set your domain name" data-book-page-rel-url="README.html#set-your-domain-name" data-book-page-id="12885">Set your domain name</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#regenerate-private-keys-and-certs" title="Regenerate private keys and certs" data-book-page-rel-url="README.html#regenerate-private-keys-and-certs" data-book-page-id="12886">Regenerate private keys and certs</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#update-modules-list" title="Update modules list" data-book-page-rel-url="README.html#update-modules-list" data-book-page-id="12887">Update modules list</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#generating-the-necessary-error-pages" title="Generating the necessary error pages" data-book-page-rel-url="README.html#generating-the-necessary-error-pages" data-book-page-id="12888">Generating the necessary error pages</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#add-new-domain" title="Add new domain" data-book-page-rel-url="README.html#add-new-domain" data-book-page-id="12889">Add new domain</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#test-your-configuration" title="Test your configuration" data-book-page-rel-url="README.html#test-your-configuration" data-book-page-id="12890">Test your configuration</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#todo-list" title="to improve and to do" data-book-page-rel-url="README.html#todo-list" data-book-page-id="12728">to improve and to do</a>
</li>
<li>
<a class="pjax" href="../../book/190/CONTRIBUTING.html" title="contributing guidelines" data-book-page-rel-url="CONTRIBUTING.html" data-book-page-id="12891">contributing guidelines</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#configuration-examples" title="configuration examples" data-book-page-rel-url="README.html#configuration-examples" data-book-page-id="12879">configuration examples</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-define-the-listen-directives-explicitly-with-addressport-pair" title="Define the listen directives explicitly with address:port pair" data-book-page-rel-url="README.html#beginner-define-the-listen-directives-explicitly-with-addressport-pair" data-book-page-id="12831">Define the listen directives explicitly with address:port pair</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-prevent-processing-requests-with-undefined-server-names" title="Prevent processing requests with undefined server names" data-book-page-rel-url="README.html#beginner-prevent-processing-requests-with-undefined-server-names" data-book-page-id="12832">Prevent processing requests with undefined server names</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-force-all-connections-over-tls" title="Force all connections over TLS" data-book-page-rel-url="README.html#beginner-force-all-connections-over-tls" data-book-page-id="12835">Force all connections over TLS</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#keep-nginx-up-to-date" title="Keep NGINX up-to-date" data-book-page-rel-url="README.html#keep-nginx-up-to-date" data-book-page-id="13053">Keep NGINX up-to-date</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-run-as-an-unprivileged-user" title="Run as an unprivileged user" data-book-page-rel-url="README.html#beginner-run-as-an-unprivileged-user" data-book-page-id="12850">Run as an unprivileged user</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-protect-sensitive-resources" title="Protect sensitive resources" data-book-page-rel-url="README.html#beginner-protect-sensitive-resources" data-book-page-id="12852">Protect sensitive resources</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-min-2048-bit-private-keys" title="Use min. 2048-bit private keys" data-book-page-rel-url="README.html#beginner-use-min-2048-bit-private-keys" data-book-page-id="12857">Use min. 2048-bit private keys</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-keep-only-tls-12-and-tls-13" title="Keep only TLS 1.2 and TLS 1.3" data-book-page-rel-url="README.html#beginner-keep-only-tls-12-and-tls-13" data-book-page-id="12858">Keep only TLS 1.2 and TLS 1.3</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-more-secure-ecdh-curve" title="Use more secure ECDH Curve" data-book-page-rel-url="README.html#beginner-use-more-secure-ecdh-curve" data-book-page-id="12860">Use more secure ECDH Curve</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-strong-key-exchange" title="Use strong Key Exchange" data-book-page-rel-url="README.html#beginner-use-strong-key-exchange" data-book-page-id="12861">Use strong Key Exchange</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-defend-against-the-beast-attack" title="Defend against the BEAST attack" data-book-page-rel-url="README.html#beginner-defend-against-the-beast-attack" data-book-page-id="12862">Defend against the BEAST attack</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-disable-http-compression-or-compress-only-zero-sensitive-content-mitigation-of-crimebreach-attacks" title="Mitigation of CRIME/BREACH attacks" data-book-page-rel-url="README.html#beginner-disable-http-compression-or-compress-only-zero-sensitive-content-mitigation-of-crimebreach-attacks" data-book-page-id="13054">Mitigation of CRIME/BREACH attacks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-mitigation-of-crimebreach-attacks" title="Mitigation of CRIME/BREACH attacks" data-book-page-rel-url="README.html#beginner-mitigation-of-crimebreach-attacks" data-book-page-id="13055">Mitigation of CRIME/BREACH attacks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-http-strict-transport-security" title="HTTP Strict Transport Security" data-book-page-rel-url="README.html#beginner-http-strict-transport-security" data-book-page-id="12863">HTTP Strict Transport Security</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-reduce-xss-risks-content-security-policy" title="Reduce XSS risks (Content-Security-Policy)" data-book-page-rel-url="README.html#beginner-reduce-xss-risks-content-security-policy" data-book-page-id="12864">Reduce XSS risks (Content-Security-Policy)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-control-the-behavior-of-the-referer-header-referrer-policy" title="Control the behavior of the Referer header (Referrer-Policy)" data-book-page-rel-url="README.html#beginner-control-the-behavior-of-the-referer-header-referrer-policy" data-book-page-id="12865">Control the behavior of the Referer header (Referrer-Policy)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-provide-clickjacking-protection-x-frame-options" title="Provide clickjacking protection (X-Frame-Options)" data-book-page-rel-url="README.html#beginner-provide-clickjacking-protection-x-frame-options" data-book-page-id="12866">Provide clickjacking protection (X-Frame-Options)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-prevent-some-categories-of-xss-attacks-x-xss-protection" title="Prevent some categories of XSS attacks (X-XSS-Protection)" data-book-page-rel-url="README.html#beginner-prevent-some-categories-of-xss-attacks-x-xss-protection" data-book-page-id="12867">Prevent some categories of XSS attacks (X-XSS-Protection)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-prevent-sniff-mimetype-middleware-x-content-type-options" title="Prevent Sniff Mimetype middleware (X-Content-Type-Options)" data-book-page-rel-url="README.html#beginner-prevent-sniff-mimetype-middleware-x-content-type-options" data-book-page-id="12868">Prevent Sniff Mimetype middleware (X-Content-Type-Options)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-reject-unsafe-http-methods" title="Reject unsafe HTTP methods" data-book-page-rel-url="README.html#beginner-reject-unsafe-http-methods" data-book-page-id="12870">Reject unsafe HTTP methods</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-organising-nginx-configuration" title="Organising Nginx configuration" data-book-page-rel-url="README.html#beginner-organising-nginx-configuration" data-book-page-id="12828">Organising Nginx configuration</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-format-prettify-and-indent-your-nginx-code" title="Format, prettify and indent your Nginx code" data-book-page-rel-url="README.html#beginner-format-prettify-and-indent-your-nginx-code" data-book-page-id="12829">Format, prettify and indent your Nginx code</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-http2" title="Use HTTP/2" data-book-page-rel-url="README.html#beginner-use-http2" data-book-page-id="12843">Use HTTP/2</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-maintaining-ssl-sessions" title="Maintaining SSL sessions" data-book-page-rel-url="README.html#beginner-maintaining-ssl-sessions" data-book-page-id="12844">Maintaining SSL sessions</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-exact-names-in-server-name-directive-where-possible" title="Use exact names in server_name directive where possible" data-book-page-rel-url="README.html#beginner-use-exact-names-in-server-name-directive-where-possible" data-book-page-id="12845">Use exact names in server_name directive where possible</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-avoid-checks-server_name-with-if-directive" title="Avoid checks server_name with if directive" data-book-page-rel-url="README.html#beginner-avoid-checks-server_name-with-if-directive" data-book-page-id="12846">Avoid checks server_name with if directive</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-disable-unnecessary-modules" title="Disable unnecessary modules" data-book-page-rel-url="README.html#beginner-disable-unnecessary-modules" data-book-page-id="12851">Disable unnecessary modules</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-hide-nginx-version-number" title="Hide Nginx version number" data-book-page-rel-url="README.html#beginner-hide-nginx-version-number" data-book-page-id="12853">Hide Nginx version number</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-hide-nginx-server-signature" title="Hide Nginx server signature" data-book-page-rel-url="README.html#beginner-hide-nginx-server-signature" data-book-page-id="12854">Hide Nginx server signature</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-hide-upstream-proxy-headers" title="Hide upstream proxy headers" data-book-page-rel-url="README.html#beginner-hide-upstream-proxy-headers" data-book-page-id="12855">Hide upstream proxy headers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-only-the-latest-supported-openssl-version" title="Use only the latest supported OpenSSL version" data-book-page-rel-url="README.html#beginner-use-only-the-latest-supported-openssl-version" data-book-page-id="12856">Use only the latest supported OpenSSL version</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-deny-the-use-of-browser-features-feature-policy" title="Deny the use of browser features (Feature-Policy)" data-book-page-rel-url="README.html#beginner-deny-the-use-of-browser-features-feature-policy" data-book-page-id="12869">Deny the use of browser features (Feature-Policy)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-control-buffer-overflow-attacks" title="Control Buffer Overflow attacks" data-book-page-rel-url="README.html#beginner-control-buffer-overflow-attacks" data-book-page-id="12871">Control Buffer Overflow attacks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-mitigating-slow-http-dos-attack-closing-slow-connections" title="Mitigating Slow HTTP DoS attack (Closing Slow Connections)" data-book-page-rel-url="README.html#beginner-mitigating-slow-http-dos-attack-closing-slow-connections" data-book-page-id="12872">Mitigating Slow HTTP DoS attack (Closing Slow Connections)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-enable-dns-caa-policy" title="Enable DNS CAA Policy" data-book-page-rel-url="README.html#beginner-enable-dns-caa-policy" data-book-page-id="12877">Enable DNS CAA Policy</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-separate-listen-directives-for-80-and-443" title="Separate listen directives for 80 and 443" data-book-page-rel-url="README.html#beginner-separate-listen-directives-for-80-and-443" data-book-page-id="12830">Separate listen directives for 80 and 443</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-only-one-ssl-config-for-specific-listen-directive" title="Use only one SSL config for specific listen directive" data-book-page-rel-url="README.html#beginner-use-only-one-ssl-config-for-specific-listen-directive" data-book-page-id="12834">Use only one SSL config for specific listen directive</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-geomap-modules-instead-allowdeny" title="Use geo/map modules instead allow/deny" data-book-page-rel-url="README.html#beginner-use-geomap-modules-instead-allowdeny" data-book-page-id="12836">Use geo/map modules instead allow/deny</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-drop-the-same-root-inside-location-block" title="Drop the same root inside location block" data-book-page-rel-url="README.html#beginner-drop-the-same-root-inside-location-block" data-book-page-id="12838">Drop the same root inside location block</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-adjust-worker-processes" title="Adjust worker processes" data-book-page-rel-url="README.html#beginner-adjust-worker-processes" data-book-page-id="12842">Adjust worker processes</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-make-an-exact-location-match-to-speed-up-the-selection-process" title="Make an exact location match to speed up the selection process" data-book-page-rel-url="README.html#beginner-make-an-exact-location-match-to-speed-up-the-selection-process" data-book-page-id="12847">Make an exact location match to speed up the selection process</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-limit_conn-to-improve-limiting-the-download-speed" title="Use limit_conn to improve limiting the download speed" data-book-page-rel-url="README.html#beginner-use-limit_conn-to-improve-limiting-the-download-speed" data-book-page-id="12848">Use limit_conn to improve limiting the download speed</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-tweak-passive-health-checks" title="Tweak passive health checks" data-book-page-rel-url="README.html#beginner-tweak-passive-health-checks" data-book-page-id="12874">Tweak passive health checks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-dont-disable-backends-by-comments-use-down-parameter" title="Don't disable backends by comments, use down parameter" data-book-page-rel-url="README.html#beginner-dont-disable-backends-by-comments-use-down-parameter" data-book-page-id="12875">Don't disable backends by comments, use down parameter</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-define-security-policies-with-securitytxt" title="Define security policies with security.txt" data-book-page-rel-url="README.html#beginner-define-security-policies-with-securitytxt" data-book-page-id="12878">Define security policies with security.txt</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#mastering-nginx" title="Mastering Nginx - The virtual server section" data-book-page-rel-url="README.html#mastering-nginx" data-book-page-id="12738">Mastering Nginx - The virtual server section</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#online-tools" title="online tools" data-book-page-rel-url="README.html#online-tools" data-book-page-id="12754">online tools</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-debug-mode-for-debugging" title="debug log" data-book-page-rel-url="README.html#beginner-use-debug-mode-for-debugging" data-book-page-id="12839">debug log</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-custom-log-formats-for-debugging" title="log formats" data-book-page-rel-url="README.html#beginner-use-custom-log-formats-for-debugging" data-book-page-id="12840">log formats</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#install-openresty-on-centos-7" title="OpenResty on CentOS 7" data-book-page-rel-url="README.html#install-openresty-on-centos-7" data-book-page-id="12825">OpenResty on CentOS 7</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#install-tengine-on-ubuntu-1804" title="Tengine on Ubuntu 18.04" data-book-page-rel-url="README.html#install-tengine-on-ubuntu-1804" data-book-page-id="12826">Tengine on Ubuntu 18.04</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#pre-installation-tasks-1" title="Pre installation tasks" data-book-page-rel-url="README.html#pre-installation-tasks-1" data-book-page-id="12893">Pre installation tasks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#install-or-build-dependencies-1" title="Install or build dependencies" data-book-page-rel-url="README.html#install-or-build-dependencies-1" data-book-page-id="12894">Install or build dependencies</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#get-openresty-sources-1" title="Get OpenResty sources" data-book-page-rel-url="README.html#get-openresty-sources-1" data-book-page-id="12895">Get OpenResty sources</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#download-3rd-party-modules-1" title="Download 3rd party modules" data-book-page-rel-url="README.html#download-3rd-party-modules-1" data-book-page-id="12896">Download 3rd party modules</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#build-openresty" title="Build OpenResty" data-book-page-rel-url="README.html#build-openresty" data-book-page-id="12897">Build OpenResty</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#post-installation-tasks-1" title="Post installation tasks" data-book-page-rel-url="README.html#post-installation-tasks-1" data-book-page-id="12898">Post installation tasks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#sregex" title="`sregex`" data-book-page-rel-url="README.html#sregex" data-book-page-id="12892">`sregex`</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#install-nginx-on-centos-7" title="Install Nginx on Centos 7" data-book-page-rel-url="README.html#install-nginx-on-centos-7" data-book-page-id="12818">Install Nginx on Centos 7</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#pre-installation-tasks-2" title="Pre installation tasks" data-book-page-rel-url="README.html#pre-installation-tasks-2" data-book-page-id="12899">Pre installation tasks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#install-or-build-dependencies-2" title="Install or build dependencies" data-book-page-rel-url="README.html#install-or-build-dependencies-2" data-book-page-id="12900">Install or build dependencies</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#get-tengine-sources" title="Get Tengine sources" data-book-page-rel-url="README.html#get-tengine-sources" data-book-page-id="12901">Get Tengine sources</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#download-3rd-party-modules-2" title="Download 3rd party modules" data-book-page-rel-url="README.html#download-3rd-party-modules-2" data-book-page-id="12902">Download 3rd party modules</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#build-tengine" title="Build Tengine" data-book-page-rel-url="README.html#build-tengine" data-book-page-id="12903">Build Tengine</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#post-installation-tasks-2" title="Post installation tasks" data-book-page-rel-url="README.html#post-installation-tasks-2" data-book-page-id="12904">Post installation tasks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#3rd-party-modules" title="this" data-book-page-rel-url="README.html#3rd-party-modules" data-book-page-id="12815">this</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#post-installation-tasks" title="Nginx on CentOS 7 - Post installation tasks" data-book-page-rel-url="README.html#post-installation-tasks" data-book-page-id="12824">Nginx on CentOS 7 - Post installation tasks</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#blockingallowing-ip-addresses" title="Blocking/allowing IP addresses" data-book-page-rel-url="README.html#blockingallowing-ip-addresses" data-book-page-id="12799">Blocking/allowing IP addresses</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#virtual-server-logic" title="Virtual server logic" data-book-page-rel-url="README.html#virtual-server-logic" data-book-page-id="12905">Virtual server logic</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#installation-from-prebuilt-packages" title="Installation from prebuilt packages" data-book-page-rel-url="README.html#installation-from-prebuilt-packages" data-book-page-id="12808">Installation from prebuilt packages</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#beginner-use-only-strong-ciphers" title="the correct (and strong)" data-book-page-rel-url="README.html#beginner-use-only-strong-ciphers" data-book-page-id="12859">the correct (and strong)</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#keep-only-tls1.2-tls13" title="TLSv1.3 and TLSv1.2" data-book-page-rel-url="README.html#keep-only-tls1.2-tls13" data-book-page-id="12906">TLSv1.3 and TLSv1.2</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#use-only-strong-ciphers" title="only strong ciphers" data-book-page-rel-url="README.html#use-only-strong-ciphers" data-book-page-id="12907">only strong ciphers</a>
</li>
<li>
<a class="pjax" href="../../book/190/README.html#installation-from-source" title="installation from source" data-book-page-rel-url="README.html#installation-from-source" data-book-page-id="12811">installation from source</a>
</li>
</ul>
</div>
</div>
<script src="https://cdn.staticfile.net/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../static/components/uikit-2.27.5/js/uikit.reader.js"></script>
<script type="text/javascript" src="../../static/components/social-share/social-share.min.js"></script>
<script>(function(){var bp =document.createElement('script');var curProtocol =window.location.protocol.split(':')[0];if (curProtocol ==='https') {bp.src ='https://zz.bdstatic.com/linksubmit/push.js';}
else {bp.src ='http://push.zhanzhang.baidu.com/push.js';}
var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
<script src="https://cdn.staticfile.net/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.net/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.staticfile.net/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.staticfile.net/uikit/2.27.5/js/components/lightbox.min.js"></script>
<link rel="dns-prefetch" href="../..//cdn.mathjax.org" />
<script type="text/x-mathjax-config">
 function initMathJax() {
    var mathId = $("book-content-section")[0];
    MathJax.Hub.Config({
        tex2jax: {skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a']},
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,mathId]);
 };
initMathJax();
</script>
<script src='https://cdn.staticfile.net/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
<style>
	.MathJax_Display{display:inline!important;}
</style>
<script type="text/javascript" src="../../static/components/js/reader.js"></script>
<script type="text/javascript">var bookId =190;var bookPageId =12725;var bookPageRelUrl ='README.html#introduction';</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38429407-1"></script>
<script>window.dataLayer =window.dataLayer ||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-38429407-1');</script>
<script>var _hmt =_hmt ||[];(function() {var hm =document.createElement("script");hm.src ="https://hm.baidu.com/hm.js?f28e71bd2b5dee3439448dca9f534107";var s =document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>
</body>
</html>